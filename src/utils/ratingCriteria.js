// ============================================
// VA RATING CRITERIA - DATA STRUCTURE & ANALYSIS
// ============================================
// Based on 38 CFR Part 4 - Schedule for Rating Disabilities
// This file contains rating criteria definitions and logic to
// analyze logged symptoms against VA evaluation standards.
//
// DISCLAIMER: This is for documentation guidance only.
// The VA makes all final rating determinations.

import {
  analyzeBloodPressurePredominance,
  getAverageBloodPressure,
  getMeasurements,
} from './measurements';

// ============================================
// HELPER FUNCTIONS
// ============================================

/**
 * Safely get symptom ID from a log entry
 * Checks both log.symptomId and log. Symptom for backward compatibility
 * @param {Object} log - The log entry
 * @returns {string|null} - The symptom ID or null
 */
const getLogSymptomId = (log) => {
  return log.symptomId || log.symptom || null;
};

// ============================================
// CONDITION DEFINITIONS
// ============================================

export const CONDITIONS = {
  MIGRAINE: {
    id: 'migraine',
    name: 'Migraine',
    diagnosticCode: '8100',
    cfrReference: '38 CFR 4.124a',
    symptomIds: ['migraine'],
  },
  SLEEP_APNEA: {
    id: 'sleep-apnea',
    name: 'Sleep Apnea',
    diagnosticCode: '6847',
    cfrReference: '38 CFR 4.97',
    symptomIds: ['sleep-issues', 'sleep-apnea'],
  },
  PTSD: {
    id: 'ptsd',
    name: 'PTSD',
    diagnosticCode: '9411',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['ptsd-nightmare', 'ptsd-flashback', 'ptsd-hypervigilance', 'ptsd-avoidance', 'ptsd-panic', 'nightmares'], // Include old 'nightmares' for backward compatibility
  },
  MAJOR_DEPRESSION: {
    id: 'major-depression',
    name: 'Major Depressive Disorder',
    diagnosticCode: '9434',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['depression', 'mdd-episode', 'mdd-anhedonia', 'mdd-hopelessness'],
  },
  GENERALIZED_ANXIETY: {
    id: 'generalized-anxiety',
    name: 'Generalized Anxiety Disorder',
    diagnosticCode: '9400',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['anxiety', 'gad-worry', 'gad-restlessness', 'gad-muscle-tension'], // 'anxiety' for backward compatibility
  },
  PANIC_DISORDER: {
    id: 'panic-disorder',
    name: 'Panic Disorder',
    diagnosticCode: '9412',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['panic-attack', 'panic-agoraphobia', 'panic-anticipatory-anxiety'],
  },
  BIPOLAR: {
    id: 'bipolar',
    name: 'Bipolar Disorder',
    diagnosticCode: '9432',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['bipolar-manic', 'bipolar-depressive', 'bipolar-mixed'],
  },
  LUMBOSACRAL_STRAIN: {
    id: 'lumbosacral-strain',
    name: 'Lumbosacral Strain (Low Back Pain)',
    diagnosticCode: '5237',
    cfrReference: '38 CFR 4.71a',
    symptomIds: [ 'lower-back-pain', 'back-pain', 'back-stiffness', 'back-spasm', 'back-radicular', 'back-numbness'],
  },
  INTERVERTEBRAL_DISC: {
    id: 'intervertebral-disc',
    name: 'Intervertebral Disc Syndrome',
    diagnosticCode: '5243',
    cfrReference: '38 CFR 4.71a',
    symptomIds: [ 'disc-pain', 'back-pain', 'back-radicular', 'lower-back-pain', 'back-numbness'],
  },
  KNEE_INSTABILITY: {
    id: 'knee-instability',
    name: 'Knee Instability',
    diagnosticCode: '5257',
    cfrReference: '38 CFR 4.71a',
    symptomIds: [ 'knee-instability', 'knee-pain', 'knee-swelling', 'knee-stiffness', 'knee-locking'],
  },
  TBI: {
    id: 'tbi',
    name: 'Traumatic Brain Injury (TBI)',
    diagnosticCode: '8045',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [ 'tbi-memory', 'tbi-concentration', 'tbi-confusion', 'tbi-headache', 'tbi-mood', 'tbi-sleep'],
  },
  HYPERTENSION: {
    id: 'hypertension',
    name: 'Hypertension',
    diagnosticCode: '7101',
    cfrReference: '38 CFR 4.104',
    symptomIds: [ 'high-blood-pressure', 'hypertension-headache', 'chest-pressure', 'palpitations'],
  },
  DIABETES: {
    id: 'diabetes',
    name: 'Diabetes Mellitus',
    diagnosticCode: '7913',
    cfrReference: '38 CFR 4.119',
    symptomIds: ['fatigue', 'dizziness', 'weakness', 'frequent-urination', 'excessive-thirst'],
  },
  IBS: {
    id: 'ibs',
    name: 'Irritable Bowel Syndrome',
    diagnosticCode: '7319',
    cfrReference: '38 CFR 4.114',
    symptomIds: ['ibs-diarrhea', 'ibs-constipation', 'ibs-pain', 'ibs-bloating', 'ibs-urgency'],
  },
  GERD: {
    id: 'gerd',
    name: 'Gastroesophageal Reflux Disease (GERD)',
    diagnosticCode: '7346',
    cfrReference: '38 CFR 4.114',
    symptomIds: ['gerd-heartburn', 'gerd-regurgitation', 'gerd-chest-pain', 'gerd-difficulty-swallowing', 'gerd-nausea'],
  },
  RADICULOPATHY: {
    id: 'radiculopathy',
    name: 'Radiculopathy',
    diagnosticCode: '8520',
    cfrReference: '38 CFR 4.124a',
    symptomIds: ['radiculopathy-pain', 'radiculopathy-numbness', 'radiculopathy-tingling', 'radiculopathy-weakness', 'radiculopathy-burning'],
  },
  CHRONIC_FATIGUE: {
    id: 'chronic-fatigue',
    name: 'Chronic Fatigue Syndrome',
    diagnosticCode: '6354',
    cfrReference: '38 CFR 4.88b',
    symptomIds: ['cfs-fatigue', 'cfs-cognitive', 'cfs-sleep', 'cfs-pain', 'cfs-headache'],
  },
  PERIPHERAL_NEUROPATHY: {
    id: 'peripheral-neuropathy',
    name: 'Peripheral Neuropathy',
    diagnosticCode: '8999',
    cfrReference: '38 CFR 4.124a',
    symptomIds: ['pn-numbness', 'pn-tingling', 'pn-burning', 'pn-pain', 'pn-weakness'],
  },
  MENIERES: {
    id: 'menieres',
    name: "Meniere's Disease",
    diagnosticCode: '6205',
    cfrReference: '38 CFR 4.85',
    symptomIds: ['menieres-vertigo', 'menieres-tinnitus', 'menieres-hearing-loss', 'menieres-nausea'],
  },
  RHINITIS: {
    id: 'rhinitis',
    name: 'Rhinitis (Allergic or Vasomotor)',
    diagnosticCode: '6522',
    cfrReference: '38 CFR 4.97',
    symptomIds: ['rhinitis-congestion', 'rhinitis-drainage', 'rhinitis-sneezing', 'rhinitis-breathing'],
  },
  TMJ: {
    id: 'tmj',
    name: 'Temporomandibular Joint (TMJ) Disorder',
    diagnosticCode: '9905',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['tmj-pain', 'tmj-clicking', 'tmj-limited-opening', 'tmj-locking', 'tmj-headache'],
  },
  PLANTAR_FASCIITIS: {
    id: 'plantar-fasciitis',
    name: 'Plantar Fasciitis',
    diagnosticCode: '5276',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['pf-heel-pain', 'pf-arch-pain', 'pf-morning-pain', 'pf-stiffness', 'pf-difficulty-walking'],
  },
  INSOMNIA: {
    id: 'insomnia',
    name: 'Insomnia (Sleep Disorder)',
    diagnosticCode: '8108',
    cfrReference: '38 CFR 4.124a',
    symptomIds: ['insomnia-difficulty-falling-asleep', 'insomnia-difficulty-staying-asleep', 'insomnia-early-waking', 'insomnia-fatigue', 'insomnia-irritability'],
  },
  SINUSITIS: {
    id: 'sinusitis',
    name: 'Chronic Sinusitis',
    diagnosticCode: '6510',
    cfrReference: '38 CFR 4.97',
    symptomIds: ['sinusitis-facial-pain', 'sinusitis-pressure', 'sinusitis-congestion', 'sinusitis-headache', 'sinusitis-drainage'],
  },
  SHOULDER: {
    id: 'shoulder',
    name: 'Shoulder Conditions',
    diagnosticCode: '5201-5203',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['shoulder-pain', 'shoulder-limited-rom', 'shoulder-instability', 'shoulder-weakness', 'shoulder-stiffness'],
  },
  HIP: {
    id: 'hip',
    name: 'Hip Conditions',
    diagnosticCode: '5252-5255',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['hip-pain', 'hip-limited-rom', 'hip-stiffness', 'hip-weakness', 'hip-limping'],
  },
  ANKLE: {
    id: 'ankle',
    name: 'Ankle Conditions',
    diagnosticCode: '5270-5271',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['ankle-pain', 'ankle-limited-rom', 'ankle-stiffness', 'ankle-instability', 'ankle-swelling', 'ankle-weakness'],
  },
  WRIST: {
    id: 'wrist',
    name: 'Wrist Conditions',
    diagnosticCode: '5214-5215',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['wrist-pain', 'wrist-limited-rom', 'wrist-stiffness', 'wrist-weakness', 'wrist-numbness', 'wrist-swelling'],
  },
  ELBOW: {
    id: 'elbow',
    name: 'Elbow Conditions',
    diagnosticCode: '5205-5207',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['elbow-pain', 'elbow-limited-flexion', 'elbow-limited-extension', 'elbow-stiffness', 'elbow-weakness', 'elbow-instability'],
  },
  DEGENERATIVE_ARTHRITIS: {
    id: 'degenerative-arthritis',
    name: 'Degenerative Arthritis (Osteoarthritis)',
    diagnosticCode: '5003',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['arthritis-joint-pain', 'arthritis-morning-stiffness', 'arthritis-flare', 'arthritis-reduced-function', 'arthritis-swelling', 'arthritis-crepitus'],
  },
  // ============================================
  // PHASE 4A: GOUT (DC 5017)
  // ============================================
  GOUT: {
    id: 'gout',
    name: 'Gout',
    diagnosticCode: '5017',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['gout-acute-attack', 'gout-joint-pain', 'gout-swelling', 'gout-redness', 'gout-limited-motion', 'gout-tophi', 'gout-tenderness', 'gout-functional-loss'],
  },
  // ============================================
  // PHASE 4A: BURSITIS (DC 5019)
  // ============================================
  BURSITIS: {
    id: 'bursitis',
    name: 'Bursitis',
    diagnosticCode: '5019',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['bursitis-pain', 'bursitis-swelling', 'bursitis-tenderness', 'bursitis-limited-motion', 'bursitis-stiffness', 'bursitis-warmth', 'bursitis-flare', 'bursitis-functional-loss'],
  },
  // ============================================
  // PHASE 4A: TENDINITIS/TENOSYNOVITIS (DC 5024)
  // ============================================
  TENDINITIS: {
    id: 'tendinitis',
    name: 'Tendinitis/Tenosynovitis',
    diagnosticCode: '5024',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['tendinitis-pain', 'tendinitis-swelling', 'tendinitis-tenderness', 'tendinitis-limited-motion', 'tendinitis-stiffness', 'tendinitis-crepitus', 'tendinitis-weakness', 'tendinitis-flare', 'tendinitis-functional-loss'],
  },
  // ============================================
  // PHASE 4B: MYOSITIS (DC 5021)
  // ============================================
  MYOSITIS: {
    id: 'myositis',
    name: 'Myositis',
    diagnosticCode: '5021',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['myositis-muscle-pain', 'myositis-weakness', 'myositis-tenderness', 'myositis-swelling', 'myositis-stiffness', 'myositis-fatigue', 'myositis-limited-motion', 'myositis-flare', 'myositis-functional-loss'],
  },
  // ============================================
  // PHASE 4B: OSTEOMYELITIS (DC 5000)
  // ============================================
  OSTEOMYELITIS: {
    id: 'osteomyelitis',
    name: 'Osteomyelitis',
    diagnosticCode: '5000',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['osteo-bone-pain', 'osteo-fever', 'osteo-swelling', 'osteo-redness', 'osteo-drainage', 'osteo-fatigue', 'osteo-weight-loss', 'osteo-limited-motion', 'osteo-flare', 'osteo-constitutional'],
  },
  // ============================================
  // PHASE 4B: MULTI-JOINT ARTHRITIS (DC 5002)
  // ============================================
  MULTI_JOINT_ARTHRITIS: {
    id: 'multi-joint-arthritis',
    name: 'Multi-Joint Arthritis (Active Process)',
    diagnosticCode: '5002',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['mja-joint-pain', 'mja-joint-swelling', 'mja-morning-stiffness', 'mja-fatigue', 'mja-weight-loss', 'mja-anemia', 'mja-fever', 'mja-flare', 'mja-incapacitating', 'mja-functional-loss', 'mja-limited-motion'],
  },
  // ============================================
  // PHASE 4C: SPINE EXPANSION
  // DC 5235, 5236, 5238, 5240, 5241
  // All rated under General Rating Formula for Diseases and Injuries of the Spine
  // ============================================
  VERTEBRAL_FRACTURE: {
    id: 'vertebral-fracture',
    name: 'Vertebral Fracture or Dislocation',
    diagnosticCode: '5235',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['vfx-pain', 'vfx-limited-flexion', 'vfx-limited-extension', 'vfx-stiffness', 'vfx-muscle-spasm', 'vfx-radicular', 'vfx-numbness', 'vfx-height-loss', 'vfx-kyphosis', 'vfx-functional-loss'],
  },
  SACROILIAC_INJURY: {
    id: 'sacroiliac-injury',
    name: 'Sacroiliac Injury and Weakness',
    diagnosticCode: '5236',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['si-pain', 'si-buttock-pain', 'si-hip-pain', 'si-groin-pain', 'si-leg-pain', 'si-stiffness', 'si-instability', 'si-difficulty-sitting', 'si-difficulty-standing', 'si-difficulty-walking', 'si-limited-flexion', 'si-functional-loss'],
  },
  SPINAL_STENOSIS: {
    id: 'spinal-stenosis',
    name: 'Spinal Stenosis',
    diagnosticCode: '5238',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['ss-back-pain', 'ss-leg-pain', 'ss-leg-weakness', 'ss-numbness', 'ss-walking-difficulty', 'ss-relief-sitting', 'ss-balance-problems', 'ss-limited-flexion', 'ss-limited-extension', 'ss-bladder-bowel', 'ss-functional-loss'],
  },
  ANKYLOSING_SPONDYLITIS: {
    id: 'ankylosing-spondylitis',
    name: 'Ankylosing Spondylitis',
    diagnosticCode: '5240',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['as-back-pain', 'as-morning-stiffness', 'as-night-pain', 'as-limited-flexion', 'as-limited-extension', 'as-limited-lateral', 'as-chest-expansion', 'as-fatigue', 'as-peripheral-joint', 'as-enthesitis', 'as-flare', 'as-fusion', 'as-functional-loss'],
  },
  SPINAL_FUSION: {
    id: 'spinal-fusion',
    name: 'Spinal Fusion',
    diagnosticCode: '5241',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['sf-pain', 'sf-adjacent-pain', 'sf-stiffness', 'sf-limited-flexion', 'sf-limited-extension', 'sf-limited-rotation', 'sf-muscle-spasm', 'sf-radicular', 'sf-numbness', 'sf-hardware-pain', 'sf-functional-loss'],
  },
  ASTHMA: {
    id: 'asthma',
    name: 'Bronchial Asthma',
    diagnosticCode: '6602',
    cfrReference: '38 CFR 4.97',
    symptomIds: [ 'asthma-attack', 'asthma-wheezing', 'asthma-shortness-breath', 'asthma-cough', 'asthma-chest-tightness', 'asthma-rescue-inhaler', 'asthma-er-visit', 'asthma-md-visit',
    ],
  },
  COPD: {
    id: 'copd',
    name: 'Chronic Obstructive Pulmonary Disease',
    diagnosticCode: '6604',
    cfrReference: '38 CFR 4.97',
    symptomIds: [ 'copd-shortness-breath', 'copd-chronic-cough', 'copd-sputum', 'copd-wheezing', 'copd-exacerbation', 'copd-oxygen-use', 'copd-er-visit', 'copd-hospitalization',
    ],
  },
  CHRONIC_BRONCHITIS: {
    id: 'chronic-bronchitis',
    name: 'Chronic Bronchitis',
    diagnosticCode: '6600',
    cfrReference: '38 CFR 4.97',
    symptomIds: [ 'bronchitis-productive-cough', 'bronchitis-sputum', 'bronchitis-shortness-breath', 'bronchitis-chest-discomfort', 'bronchitis-exacerbation', 'bronchitis-oxygen-use',
    ],
  },
  EMPHYSEMA: {
    id: 'emphysema',
    name: 'Pulmonary Emphysema',
    diagnosticCode: '6603',
    cfrReference: '38 CFR 4.97',
    symptomIds: [ 'emphysema-shortness-breath', 'emphysema-barrel-chest', 'emphysema-wheezing', 'emphysema-fatigue', 'emphysema-oxygen-use', 'emphysema-exacerbation',
    ],
  },
  // Phase 11: Bronchiectasis (DC 6601)
  BRONCHIECTASIS: {
    id: 'bronchiectasis',
    name: 'Bronchiectasis',
    diagnosticCode: '6601',
    cfrReference: '38 CFR 4.97',
    symptomIds: [
      'bronchiectasis-cough', 'bronchiectasis-sputum', 'bronchiectasis-purulent-sputum',
      'bronchiectasis-hemoptysis', 'bronchiectasis-infection', 'bronchiectasis-incapacitating',
      'bronchiectasis-antibiotic', 'bronchiectasis-shortness-breath', 'bronchiectasis-fatigue',
      'bronchiectasis-weight-loss', 'bronchiectasis-anorexia',
    ],
  },
  // Phase 11: Pulmonary Fibrosis / Interstitial Lung Disease (DC 6825)
  PULMONARY_FIBROSIS: {
    id: 'pulmonary-fibrosis',
    name: 'Pulmonary Fibrosis (Interstitial Lung Disease)',
    diagnosticCode: '6825',
    cfrReference: '38 CFR 4.97',
    symptomIds: [
      'pf-shortness-breath', 'pf-dry-cough', 'pf-fatigue', 'pf-exercise-intolerance',
      'pf-oxygen-use', 'pf-clubbing', 'pf-weight-loss', 'pf-chest-discomfort',
      'pf-exacerbation', 'pf-hospitalization',
    ],
  },
  // Phase 11: Sarcoidosis (DC 6846)
  SARCOIDOSIS: {
    id: 'sarcoidosis',
    name: 'Sarcoidosis',
    diagnosticCode: '6846',
    cfrReference: '38 CFR 4.97',
    symptomIds: [
      'sarcoid-shortness-breath', 'sarcoid-cough', 'sarcoid-chest-pain', 'sarcoid-fatigue',
      'sarcoid-fever', 'sarcoid-night-sweats', 'sarcoid-weight-loss', 'sarcoid-skin-lesions',
      'sarcoid-eye-symptoms', 'sarcoid-joint-pain', 'sarcoid-lymph-nodes', 'sarcoid-cardiac',
      'sarcoid-corticosteroid',
    ],
  },
  HEARING_LOSS: {
    id: 'hearing-loss',
    name: 'Hearing Loss',
    diagnosticCode: '6100',
    cfrReference: '38 CFR 4.85',
    symptomIds: ['hearing-loss-noticed'],
  },
  SCARS: {
    id: 'scars',
    name: 'Scars (Disfiguring)',
    diagnosticCode: '7800-7805',
    cfrReference: '38 CFR 4.118',
    symptomIds: ['scar-pain', 'scar-limitation', 'scar-disfigurement'],
  },
  PSORIASIS: {
    id: 'psoriasis',
    name: 'Psoriasis',
    diagnosticCode: '7816',
    cfrReference: '38 CFR 4.118',
    symptomIds: ['psoriasis-flare'],
  },
  ECZEMA: {
    id: 'eczema',
    name: 'Eczema/Dermatitis',
    diagnosticCode: '7806',
    cfrReference: '38 CFR 4.118',
    symptomIds: ['eczema-flare'],
  },
  TBI_RESIDUALS: {
    id: 'tbi-residuals',
    name: 'Residuals of TBI',
    diagnosticCode: '8045-1',
    cfrReference: '38 CFR 4.124a',
    symptomIds: ['tbi-cognitive', 'tbi-emotional'],
  },
  EPILEPSY_MAJOR: {
    id: 'epilepsy-major',
    name: 'Epilepsy, Grand Mal',
    diagnosticCode: '8910',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [ 'seizure-major', 'seizure-partial', 'seizure-psychomotor', 'aura-pre-seizure'],
  },
  EPILEPSY_MINOR: {
    id: 'epilepsy-minor',
    name: 'Epilepsy, Petit Mal',
    diagnosticCode: '8911',
    cfrReference: '38 CFR 4.124a',
    symptomIds: ['seizure-minor', 'aura-pre-seizure'],
  },

  // Phase 1D: Epilepsy Expansion
  EPILEPSY_JACKSONIAN: {
    id: 'epilepsy-jacksonian',
    name: 'Epilepsy, Jacksonian/Focal',
    diagnosticCode: '8912',
    cfrReference: '38 CFR 4.124a',
    category: 'neurological',
  },
  EPILEPSY_DIENCEPHALIC: {
    id: 'epilepsy-diencephalic',
    name: 'Epilepsy, Diencephalic',
    diagnosticCode: '8913',
    cfrReference: '38 CFR 4.124a',
    category: 'neurological',
  },
  EPILEPSY_PSYCHOMOTOR: {
    id: 'epilepsy-psychomotor',
    name: 'Epilepsy, Psychomotor',
    diagnosticCode: '8914',
    cfrReference: '38 CFR 4.124a',
    category: 'neurological',
  },
  GERD_COMPLICATIONS: {
    id: 'gerd-complications',
    name: 'GERD with Complications',
    diagnosticCode: '7346',
    cfrReference: '38 CFR 4.114',
    symptomIds: ['gerd-complication'],
  },
  ULCERATIVE_COLITIS: {
    id: 'ulcerative-colitis',
    name: 'Ulcerative Colitis / IBD',
    diagnosticCode: '7323/7326',
    cfrReference: '38 CFR 4.114',
    symptomIds: [ 'uc-diarrhea', 'uc-rectal-bleeding', 'uc-abdominal-pain', 'uc-urgency', 'uc-incontinence', 'uc-fever', 'uc-hospitalization',
    ],
  },
  PEPTIC_ULCER: {
    id: 'peptic-ulcer',
    name: 'Peptic Ulcer Disease',
    diagnosticCode: '7304',
    cfrReference: '38 CFR 4.114',
    symptomIds: [ 'ulcer-abdominal-pain', 'ulcer-nausea', 'ulcer-vomiting', 'ulcer-hematemesis', 'ulcer-melena', 'ulcer-hospitalization',
    ],
  },
  HEMORRHOIDS: {
    id: 'hemorrhoids',
    name: 'Hemorrhoids',
    diagnosticCode: '7336',
    cfrReference: '38 CFR 4.114',
    symptomIds: [ 'hemorrhoid-bleeding', 'hemorrhoid-prolapse', 'hemorrhoid-thrombosis', 'hemorrhoid-pain',
    ],
  },
  DIVERTICULITIS: {
    id: 'diverticulitis',
    name: 'Diverticulitis',
    diagnosticCode: '7327',
    cfrReference: '38 CFR 4.114',
    symptomIds: [ 'divert-abdominal-pain', 'divert-fever', 'divert-flare', 'divert-hospitalization', 'divert-complication',
    ],
  },
  HYPOTHYROIDISM: {
    id: 'hypothyroidism',
    name: 'Hypothyroidism',
    diagnosticCode: '7903',
    cfrReference: '38 CFR 4.119',
    symptomIds: [ 'hypo-fatigue', 'hypo-cold-intolerance', 'hypo-weight-gain', 'hypo-depression', 'hypo-muscle-weakness', 'hypo-constipation', 'hypo-dry-skin',
    ],
  },
  HYPERTHYROIDISM: {
    id: 'hyperthyroidism',
    name: 'Hyperthyroidism/Graves\' Disease',
    diagnosticCode: '7900',
    cfrReference: '38 CFR 4.119',
    symptomIds: [
      'hyper-weight-loss', 'hyper-rapid-heartbeat', 'hyper-tremor', 'hyper-heat-intolerance',
      'hyper-sweating', 'hyper-anxiety', 'hyper-irritability', 'hyper-fatigue', 'hyper-muscle-weakness',
      'hyper-sleep-difficulty', 'hyper-appetite-increase', 'hyper-bowel-changes',
      'graves-eye-bulging', 'graves-eye-irritation', 'graves-double-vision', 'graves-eye-pain', 'graves-light-sensitivity'
    ],
  },
  THYROIDITIS: {
    id: 'thyroiditis',
    name: 'Thyroiditis',
    diagnosticCode: '7906',
    cfrReference: '38 CFR 4.119',
    symptomIds: [
      'thyroiditis-neck-pain', 'thyroiditis-swelling', 'thyroiditis-difficulty-swallowing',
      'thyroiditis-hyper-phase', 'thyroiditis-hypo-phase', 'thyroiditis-fatigue'
    ],
  },
  HYPERPARATHYROIDISM: {
    id: 'hyperparathyroidism',
    name: 'Hyperparathyroidism',
    diagnosticCode: '7904',
    cfrReference: '38 CFR 4.119',
    symptomIds: [
      'hpth-fatigue', 'hpth-bone-pain', 'hpth-kidney-stones', 'hpth-abdominal-pain',
      'hpth-nausea', 'hpth-constipation', 'hpth-confusion', 'hpth-depression',
      'hpth-muscle-weakness', 'hpth-excessive-thirst', 'hpth-frequent-urination',
      'hpth-anorexia', 'hpth-fracture'
    ],
  },
  HYPOPARATHYROIDISM: {
    id: 'hypoparathyroidism',
    name: 'Hypoparathyroidism',
    diagnosticCode: '7905',
    cfrReference: '38 CFR 4.119',
    symptomIds: [
      'hopth-muscle-cramps', 'hopth-tingling', 'hopth-muscle-spasms', 'hopth-fatigue',
      'hopth-dry-skin', 'hopth-brittle-nails', 'hopth-hair-loss', 'hopth-seizures',
      'hopth-depression', 'hopth-anxiety', 'hopth-memory-problems', 'hopth-cataracts'
    ],
  },
  // ============================================
  // PHASE 3B: ADRENAL & PITUITARY CONDITIONS
  // ============================================

  // Addison's Disease (Adrenocortical Insufficiency) - DC 7911
  ADDISONS_DISEASE: {
    name: "Addison's Disease",
    code: 'ADDISONS_DISEASE',
    diagnosticCode: '7911',
    cfrReference: '38 CFR 4.119',
    description: "Adrenocortical insufficiency characterized by inadequate production of cortisol and aldosterone",
    symptomIds: [
      'addisons-crisis', 'addisons-episode', 'addisons-fatigue', 'addisons-weight-loss',
      'addisons-hypotension', 'addisons-hyperpigmentation', 'addisons-salt-craving',
      'addisons-nausea', 'addisons-abdominal-pain', 'addisons-muscle-weakness',
      'addisons-muscle-pain', 'addisons-irritability', 'addisons-dizziness',
      'addisons-hypoglycemia', 'addisons-dehydration'
    ],
  },

  // Cushing's Syndrome - DC 7907
  CUSHINGS_SYNDROME: {
    name: "Cushing's Syndrome",
    code: 'CUSHINGS_SYNDROME',
    diagnosticCode: '7907',
    cfrReference: '38 CFR 4.119',
    description: "Condition caused by prolonged exposure to high cortisol levels",
    symptomIds: [
      'cushings-weight-gain', 'cushings-moon-face', 'cushings-buffalo-hump',
      'cushings-striae', 'cushings-thin-skin', 'cushings-bruising',
      'cushings-muscle-weakness', 'cushings-muscle-wasting', 'cushings-fatigue',
      'cushings-hypertension', 'cushings-glucose', 'cushings-osteoporosis',
      'cushings-mood', 'cushings-insomnia', 'cushings-infections',
      'cushings-acne', 'cushings-hirsutism', 'cushings-menstrual', 'cushings-erectile'
    ],
  },

  // Diabetes Insipidus - DC 7909
  DIABETES_INSIPIDUS: {
    name: 'Diabetes Insipidus',
    code: 'DIABETES_INSIPIDUS',
    diagnosticCode: '7909',
    cfrReference: '38 CFR 4.119',
    description: "Condition characterized by excretion of large amounts of dilute urine due to inadequate ADH",
    symptomIds: [
      'di-polyuria', 'di-polydipsia', 'di-nocturia', 'di-dehydration',
      'di-fatigue', 'di-dizziness', 'di-headache', 'di-muscle-cramps',
      'di-constipation', 'di-weight-loss'
    ],
  },

  // Hyperaldosteronism (Conn's Syndrome) - DC 7917
  HYPERALDOSTERONISM: {
    name: 'Hyperaldosteronism',
    code: 'HYPERALDOSTERONISM',
    diagnosticCode: '7917',
    cfrReference: '38 CFR 4.119',
    description: "Excessive aldosterone production causing hypertension and hypokalemia",
    symptomIds: [
      'haldo-hypertension', 'haldo-muscle-weakness', 'haldo-muscle-cramps',
      'haldo-fatigue', 'haldo-headaches', 'haldo-polyuria', 'haldo-polydipsia',
      'haldo-numbness', 'haldo-palpitations', 'haldo-constipation', 'haldo-mood'
    ],
  },
  RAYNAUDS: {
    id: 'raynauds',
    name: "Raynaud's Syndrome",
    diagnosticCode: '7117',
    cfrReference: '38 CFR 4.104',
    symptomIds: [ 'raynauds-attack', 'raynauds-numbness', 'raynauds-pain', 'raynauds-ulcer', 'raynauds-cold-trigger',
    ],
  },
  VARICOSE_VEINS: {
    id: 'varicose-veins',
    name: 'Varicose Veins',
    diagnosticCode: '7120/7121',
    cfrReference: '38 CFR 4.104',
    symptomIds: [ 'varicose-aching', 'varicose-edema', 'varicose-pigmentation', 'varicose-ulcer', 'varicose-pain',
    ],
  },
  CHRONIC_URTICARIA: {
    id: 'chronic-urticaria',
    name: 'Chronic Urticaria',
    diagnosticCode: '7825',
    cfrReference: '38 CFR 4.118',
    symptomIds: [ 'urticaria-outbreak', 'urticaria-itching', 'urticaria-swelling', 'urticaria-medication',
    ],
  },
  TINNITUS: {
    id: 'tinnitus',
    name: 'Tinnitus',
    diagnosticCode: '6260',
    cfrReference: '38 CFR 4.87',
    symptomIds: ['tinnitus'],
  },
  FIBROMYALGIA: {
    id: 'fibromyalgia',
    name: 'Fibromyalgia',
    diagnosticCode: '5025',
    cfrReference: '38 CFR 4.71a',
    symptomIds: ['fibro-widespread-pain', 'fibro-tender-points', 'fibro-fatigue', 'fibro-sleep', 'fibro-stiffness', 'fibro-cognitive'
    ],
  },
  // Phase 3: Additional Mental Health Conditions
  SOCIAL_ANXIETY: {
    id: 'social-anxiety',
    name: 'Social Anxiety Disorder',
    diagnosticCode: '9403',
    cfrReference: '38 CFR 4.130',
    symptomIds: [ 'social-anxiety-fear', 'social-anxiety-avoidance', 'social-anxiety-performance', 'social-anxiety-physical', 'social-anxiety-anticipatory', 'anxiety', // Include general anxiety for backward compatibility
    ],
  },
  OCD: {
    id: 'ocd',
    name: 'Obsessive-Compulsive Disorder',
    diagnosticCode: '9404',
    cfrReference: '38 CFR 4.130',
    symptomIds: [ 'ocd-obsessions', 'ocd-compulsions', 'ocd-checking', 'ocd-contamination', 'ocd-time-spent',
    ],
  },
  PERSISTENT_DEPRESSIVE: {
    id: 'persistent-depressive',
    name: 'Persistent Depressive Disorder (Dysthymia)',
    diagnosticCode: '9433',
    cfrReference: '38 CFR 4.130',
    symptomIds: [ 'depression', 'mdd-episode', 'mdd-anhedonia', 'mdd-hopelessness',
    ],
  },
  ADJUSTMENT_DISORDER: {
    id: 'adjustment-disorder',
    name: 'Chronic Adjustment Disorder',
    diagnosticCode: '9440',
    cfrReference: '38 CFR 4.130',
    symptomIds: [ 'adjustment-depressed-mood', 'adjustment-anxiety', 'adjustment-disturbance-conduct', 'adjustment-work-difficulty', 'adjustment-relationship-problems', 'anxiety', 'depression',
    ],
  },
  UNSPECIFIED_ANXIETY: {
    id: 'unspecified-anxiety',
    name: 'Unspecified Anxiety Disorder',
    diagnosticCode: '9413',
    cfrReference: '38 CFR 4.130',
    symptomIds: [ 'anxiety', 'gad-worry', 'gad-restlessness', 'gad-muscle-tension',
    ],
  },
  UNSPECIFIED_DEPRESSIVE: {
    id: 'unspecified-depressive',
    name: 'Unspecified Depressive Disorder',
    diagnosticCode: '9435',
    cfrReference: '38 CFR 4.130',
    symptomIds: [
      'depression',
      'mdd-episode',
      'mdd-anhedonia',
      'mdd-hopelessness',
    ],
  },
  // PHASE 2: Eye & Vision Conditions
  VISION_LOSS: {
    id: 'vision-loss',
    name: 'Vision Loss',
    diagnosticCode: '6061-6079',
    cfrReference: '38 CFR 4.75-4.79',
    symptomIds: [ 'vision-loss', 'peripheral-vision-loss', 'night-blindness', 'color-vision-changes',
    ],
  },
  GLAUCOMA: {
    id: 'glaucoma',
    name: 'Glaucoma',
    diagnosticCode: '6067',
    cfrReference: '38 CFR 4.76',
    symptomIds: [ 'glaucoma-symptoms', 'eye-pain', 'vision-loss',
    ],
  },
  DIABETIC_RETINOPATHY: {
    id: 'diabetic-retinopathy',
    name: 'Diabetic Retinopathy',
    diagnosticCode: '6066',
    cfrReference: '38 CFR 4.79',
    symptomIds: [ 'diabetic-retinopathy', 'vision-loss', 'floaters',
    ],
  },
  MACULAR_DEGENERATION: {
    id: 'macular-degeneration',
    name: 'Macular Degeneration',
    diagnosticCode: '6062',
    cfrReference: '38 CFR 4.79',
    symptomIds: [ 'macular-degeneration', 'vision-loss',
    ],
  },
  EYE_CONDITIONS: {
    id: 'eye-conditions',
    name: 'Eye Conditions (General)',
    diagnosticCode: 'Various',
    cfrReference: '38 CFR 4.75-4.84',
    symptomIds: [ 'eye-pain', 'light-sensitivity', 'double-vision', 'floaters', 'dry-eyes', 'eye-strain',
    ],
  },
  // Phase 3: Genitourinary Conditions
  KIDNEY_STONES: {
    id: 'kidney-stones',
    name: 'Kidney Stones (Nephrolithiasis)',
    diagnosticCode: '7508',
    cfrReference: '38 CFR 4.115b',
    symptomIds: [ 'kidney-stones', 'kidney-pain', 'blood-in-urine',
    ],
  },
  CHRONIC_RENAL_DISEASE: {
    id: 'chronic-renal-disease',
    name: 'Chronic Renal Disease (Chronic Kidney Disease)',
    diagnosticCode: '7530',
    cfrReference: '38 CFR 4.115a',
    symptomIds: [ 'kidney-infection', 'renal-swelling', 'renal-fatigue', 'renal-nausea', 'decreased-urination', 'foamy-urine',
    ],
  },
  CHRONIC_CYSTITIS: {
    id: 'chronic-cystitis',
    name: 'Chronic Cystitis (Bladder Infection/Inflammation)',
    diagnosticCode: '7512',
    cfrReference: '38 CFR 4.115a',
    symptomIds: [ 'bladder-pain', 'recurrent-uti', 'painful-urination', 'urinary-frequency', 'urinary-urgency',
    ],
  },
  NEUROGENIC_BLADDER: {
    id: 'neurogenic-bladder',
    name: 'Neurogenic Bladder',
    diagnosticCode: '7542',
    cfrReference: '38 CFR 4.115a',
    symptomIds: [ 'urinary-incontinence', 'urine-retention', 'incomplete-emptying',
    ],
  },
  PROSTATE_CONDITIONS: {
    id: 'prostate-conditions',
    name: 'Prostate Conditions (BPH, Prostatitis)',
    diagnosticCode: '7527',
    cfrReference: '38 CFR 4.115a',
    symptomIds: [ 'prostate-symptoms', 'prostate-pain', 'weak-stream', 'hesitancy', 'nocturia',
    ],
  },
  URETHRAL_STRICTURE: {
    id: 'urethral-stricture',
    name: 'Urethral Stricture',
    diagnosticCode: '7518',
    cfrReference: '38 CFR 4.115a',
    symptomIds: [ 'weak-stream', 'hesitancy', 'incomplete-emptying',
    ],
  },
  SPHINCTER_IMPAIRMENT: {
    id: 'sphincter-impairment',
    name: 'Sphincter Impairment (Fecal Incontinence)',
    diagnosticCode: '7332',
    cfrReference: '38 CFR 4.114',
    symptomIds: [ 'fecal-incontinence', 'bowel-urgency', 'bowel-frequency',
    ],
  },
  ERECTILE_DYSFUNCTION: {
    id: 'erectile-dysfunction',
    name: 'Erectile Dysfunction',
    diagnosticCode: '7522',
    cfrReference: '38 CFR 4.115b',
    symptomIds: [ 'erectile-dysfunction',
    ],
  },// Phase 4: Gynecological Conditions
  ENDOMETRIOSIS: {
    id: 'endometriosis',
    name: 'Endometriosis',
    diagnosticCode: '7629',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'endometriosis-pain',
      'endometriosis-bowel',
      'endometriosis-bladder',
      'chronic-pelvic-pain',
    ],
  },
  VULVA_CLITORIS_DISEASE: {
    id: 'vulva-clitoris-disease',
    name: 'Vulva or Clitoris Disease/Injury',
    diagnosticCode: '7610',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'vulvovaginitis',
      'vaginal-irritation',
    ],
  },
  VAGINA_DISEASE: {
    id: 'vagina-disease',
    name: 'Vagina Disease/Injury',
    diagnosticCode: '7611',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'vaginal-irritation',
      'abnormal-discharge',
    ],
  },
  CERVIX_DISEASE: {
    id: 'cervix-disease',
    name: 'Cervix Disease/Injury',
    diagnosticCode: '7612',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'cervicitis',
      'abnormal-discharge',
    ],
  },
  UTERUS_DISEASE: {
    id: 'uterus-disease',
    name: 'Uterus Disease/Injury/Adhesions',
    diagnosticCode: '7613',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'uterine-cramping',
      'chronic-pelvic-pain',
      'lower-abdominal-pain',
    ],
  },
  FALLOPIAN_TUBE_PID: {
    id: 'fallopian-tube-pid',
    name: 'Fallopian Tube Disease/PID',
    diagnosticCode: '7614',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'pid-symptoms',
      'abnormal-discharge',
      'chronic-pelvic-pain',
      'lower-abdominal-pain',
    ],
  },
  OVARY_DISEASE: {
    id: 'ovary-disease',
    name: 'Ovary Disease (includes PCOS, Dysmenorrhea)',
    diagnosticCode: '7615',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'ovarian-cysts',
      'polycystic-ovaries',
      'ovulation-pain',
      'anovulation',
      'painful-periods',
      'heavy-menstrual-bleeding',
      'irregular-periods',
      'absent-periods',
      'hirsutism',
      'hormonal-acne',
      'pcos-weight-changes',
    ],
  },
  PELVIC_PROLAPSE: {
    id: 'pelvic-prolapse',
    name: 'Pelvic Organ Prolapse',
    diagnosticCode: '7621',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'pelvic-pressure',
      'vaginal-bulge',
      'incomplete-bladder-emptying',
      'bowel-dysfunction-prolapse',
    ],
  },
  FEMALE_SEXUAL_AROUSAL_DISORDER: {
    id: 'female-sexual-arousal-disorder',
    name: 'Female Sexual Arousal Disorder (FSAD)',
    diagnosticCode: '7632',
    cfrReference: '38 CFR 4.116',
    symptomIds: [
      'sexual-dysfunction',
      'decreased-libido',
      'arousal-difficulty',
      'dyspareunia',
    ],
  },
  // Phase 5: Hemic and Lymphatic Conditions
  IRON_DEFICIENCY_ANEMIA: {
    id: 'iron-deficiency-anemia',
    name: 'Iron Deficiency Anemia',
    diagnosticCode: '7720',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['fatigue-anemia', 'shortness-of-breath-anemia', 'pale-skin', 'cold-extremities'],
  },
  FOLATE_DEFICIENCY_ANEMIA: {
    id: 'folate-deficiency-anemia',
    name: 'Folate Deficiency Anemia',
    diagnosticCode: '7721',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['fatigue-anemia', 'shortness-of-breath-anemia', 'pale-skin'],
  },
  PERNICIOUS_ANEMIA: {
    id: 'pernicious-anemia',
    name: 'Pernicious Anemia (B12 Deficiency)',
    diagnosticCode: '7722',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['fatigue-anemia', 'pale-skin', 'balance-problems', 'confusion', 'weakness'],
  },
  HEMOLYTIC_ANEMIA: {
    id: 'hemolytic-anemia',
    name: 'Acquired Hemolytic Anemia',
    diagnosticCode: '7723',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['fatigue-anemia', 'jaundice', 'dark-urine'],
  },
  SICKLE_CELL_ANEMIA: {
    id: 'sickle-cell-anemia',
    name: 'Sickle Cell Anemia',
    diagnosticCode: '7714',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['pain-crisis', 'fatigue-anemia', 'jaundice'],
  },
  APLASTIC_ANEMIA: {
    id: 'aplastic-anemia',
    name: 'Aplastic Anemia',
    diagnosticCode: '7716',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['fatigue-anemia', 'frequent-infections', 'easy-bruising'],
  },
  POLYCYTHEMIA_VERA: {
    id: 'polycythemia-vera',
    name: 'Polycythemia Vera',
    diagnosticCode: '7704',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['headache-polycythemia', 'itching-after-shower', 'redness-face'],
  },
  IMMUNE_THROMBOCYTOPENIA: {
    id: 'immune-thrombocytopenia',
    name: 'Immune Thrombocytopenia (ITP)',
    diagnosticCode: '7705',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['easy-bruising', 'prolonged-bleeding', 'petechiae'],
  },
  LEUKEMIA: {
    id: 'leukemia',
    name: 'Leukemia',
    diagnosticCode: '7703',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['bone-pain-leukemia', 'night-sweats-blood', 'frequent-infections', 'fatigue-anemia'],
  },
  HODGKINS_LYMPHOMA: {
    id: 'hodgkins-lymphoma',
    name: "Hodgkin's Lymphoma",
    diagnosticCode: '7709',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['swollen-lymph-nodes', 'night-sweats-blood', 'weight-loss-unexplained'],
  },
  MULTIPLE_MYELOMA: {
    id: 'multiple-myeloma',
    name: 'Multiple Myeloma',
    diagnosticCode: '7712',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['bone-pain-leukemia', 'fatigue-anemia', 'kidney-problems'],
  },
  NON_HODGKINS_LYMPHOMA: {
    id: 'non-hodgkins-lymphoma',
    name: "Non-Hodgkin's Lymphoma",
    diagnosticCode: '7715',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['swollen-lymph-nodes', 'night-sweats-blood', 'weight-loss-unexplained'],
  },
  ESSENTIAL_THROMBOCYTHEMIA: {
    id: 'essential-thrombocythemia',
    name: 'Essential Thrombocythemia / Primary Myelofibrosis',
    diagnosticCode: '7718',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['headache-polycythemia', 'abdominal-fullness', 'easy-bruising'],
  },
  CHRONIC_MYELOGENOUS_LEUKEMIA: {
    id: 'chronic-myelogenous-leukemia',
    name: 'Chronic Myelogenous Leukemia (CML)',
    diagnosticCode: '7719',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['bone-pain-leukemia', 'fatigue-anemia', 'weight-loss-unexplained'],
  },
  SOLITARY_PLASMACYTOMA: {
    id: 'solitary-plasmacytoma',
    name: 'Solitary Plasmacytoma',
    diagnosticCode: '7724',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['bone-pain-leukemia'],
  },
  MYELODYSPLASTIC_SYNDROMES: {
    id: 'myelodysplastic-syndromes',
    name: 'Myelodysplastic Syndromes (MDS)',
    diagnosticCode: '7725',
    cfrReference: '38 CFR 4.117',
    symptomIds: ['fatigue-anemia', 'frequent-infections', 'easy-bruising'],
  },
  // ============================================
  // PHASE 6: INFECTIOUS DISEASES (DC 6300 series)
  // ============================================
  HIV_AIDS: {
    id: 'hiv-aids',
    name: 'HIV-Related Illness',
    diagnosticCode: '6351',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'hiv-opportunistic-infection',
      'hiv-night-sweats',
      'hiv-persistent-fever',
      'hiv-weight-loss',
      'hiv-chronic-diarrhea',
      'hiv-oral-thrush',
      'hiv-skin-lesions',
      'hiv-lymphadenopathy',
      'hiv-fatigue',
      'hiv-cognitive-impairment'
    ],
  },
  HEPATITIS_C: {
    id: 'hepatitis-c',
    name: 'Hepatitis C',
    diagnosticCode: '7354',
    cfrReference: '38 CFR 4.114',
    symptomIds: [
      'hep-fatigue',
      'hep-malaise',
      'hep-nausea',
      'hep-abdominal-pain',
      'hep-jaundice',
      'hep-dark-urine',
      'hep-appetite-loss',
      'hep-joint-pain',
      'hep-cognitive-issues',
      'hep-liver-tenderness'
    ],
  },
  HEPATITIS_B: {
    id: 'hepatitis-b',
    name: 'Hepatitis B',
    diagnosticCode: '7314',
    cfrReference: '38 CFR 4.114',
    symptomIds: [
      'hep-fatigue',
      'hep-malaise',
      'hep-nausea',
      'hep-abdominal-pain',
      'hep-jaundice',
      'hep-dark-urine',
      'hep-appetite-loss',
      'hep-joint-pain',
      'hep-cognitive-issues',
      'hep-liver-tenderness'
    ],
  },
  LYME_DISEASE: {
    id: 'lyme-disease',
    name: 'Lyme Disease',
    diagnosticCode: '6319',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'lyme-rash',
      'lyme-fever',
      'lyme-headache',
      'lyme-fatigue',
      'lyme-joint-pain',
      'lyme-muscle-aches',
      'lyme-nerve-pain',
      'lyme-cognitive',
      'lyme-heart-palpitations',
      'lyme-facial-paralysis'
    ],
  },
  MALARIA: {
    id: 'malaria',
    name: 'Malaria',
    diagnosticCode: '6304',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'malaria-fever',
      'malaria-chills',
      'malaria-sweats',
      'malaria-headache',
      'malaria-muscle-aches',
      'malaria-nausea',
      'malaria-fatigue',
      'malaria-jaundice',
      'malaria-anemia',
      'malaria-enlarged-spleen'
    ],
  },
  BRUCELLOSIS: {
    id: 'brucellosis',
    name: 'Brucellosis',
    diagnosticCode: '6316',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'brucellosis-fever',
      'brucellosis-night-sweats',
      'brucellosis-fatigue',
      'brucellosis-joint-pain',
      'brucellosis-muscle-aches',
      'brucellosis-headache',
      'brucellosis-back-pain',
      'brucellosis-weight-loss',
      'brucellosis-depression',
      'brucellosis-liver-spleen'
    ],
  },
  CAMPYLOBACTER: {
    id: 'campylobacter',
    name: 'Campylobacter jejuni Infection',
    diagnosticCode: '6330',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'campylobacter-diarrhea',
      'campylobacter-abdominal-pain',
      'campylobacter-fever',
      'campylobacter-nausea',
      'campylobacter-vomiting',
      'campylobacter-bloody-stool',
      'campylobacter-fatigue',
      'campylobacter-joint-pain',
      'campylobacter-muscle-weakness',
      'campylobacter-nerve-symptoms'
    ],
  },
  Q_FEVER: {
    id: 'q-fever',
    name: 'Q Fever',
    diagnosticCode: '6331',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'q-fever-fever',
      'q-fever-headache',
      'q-fever-fatigue',
      'q-fever-muscle-aches',
      'q-fever-cough',
      'q-fever-chest-pain',
      'q-fever-night-sweats',
      'q-fever-chills',
      'q-fever-shortness-breath',
      'q-fever-joint-pain'
    ],
  },
  SALMONELLA: {
    id: 'salmonella',
    name: 'Nontyphoid Salmonella Infection',
    diagnosticCode: '6333',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'salmonella-diarrhea',
      'salmonella-fever',
      'salmonella-abdominal-cramps',
      'salmonella-nausea',
      'salmonella-vomiting',
      'salmonella-bloody-stool',
      'salmonella-joint-pain',
      'salmonella-bacteremia',
      'salmonella-dehydration',
      'salmonella-fatigue'
    ],
  },
  SHIGELLA: {
    id: 'shigella',
    name: 'Shigella Infection',
    diagnosticCode: '6334',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'shigella-diarrhea',
      'shigella-bloody-stool',
      'shigella-abdominal-cramps',
      'shigella-fever',
      'shigella-tenesmus',
      'shigella-nausea',
      'shigella-vomiting',
      'shigella-dehydration',
      'shigella-reactive-arthritis',
      'shigella-seizures'
    ],
  },
  WEST_NILE: {
    id: 'west-nile',
    name: 'West Nile Virus',
    diagnosticCode: '6335',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'west-nile-fever',
      'west-nile-headache',
      'west-nile-body-aches',
      'west-nile-fatigue',
      'west-nile-weakness',
      'west-nile-cognitive',
      'west-nile-tremors',
      'west-nile-vision-problems',
      'west-nile-numbness',
      'west-nile-paralysis'
    ],
  },
  NTM: {
    id: 'ntm',
    name: 'Nontuberculous Mycobacterium',
    diagnosticCode: '6312',
    cfrReference: '38 CFR 4.88b',
    symptomIds: [
      'ntm-cough',
      'ntm-sputum',
      'ntm-fatigue',
      'ntm-fever',
      'ntm-night-sweats',
      'ntm-weight-loss',
      'ntm-chest-pain',
      'ntm-shortness-breath',
      'ntm-hemoptysis',
      'ntm-lymph-nodes'
    ],
  },
  // ============================================
  // Phase 7: Dental/ORAL CONDITIONS (DC 9900 series)
  // ============================================
  TMJ_DISORDER: {
    id: 'tmj-disorder',
    name: 'Temporomandibular Joint (TMJ) Disorder',
    diagnosticCode: '9905',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['jaw-pain', 'jaw-stiffness', 'limited-mouth-opening', 'jaw-clicking', 'jaw-locking', 'chewing-difficulty'],
  },
  MAXILLA_MANDIBLE_BONE_DISEASE: {
    id: 'maxilla-mandible-bone-disease',
    name: 'Maxilla or Mandible Osteomyelitis/Osteonecrosis',
    diagnosticCode: '9900',
    cfrReference: '38 CFR 4.150 (rates as DC 5000)',
    symptomIds: ['jaw-infection', 'bone-pain-jaw', 'osteomyelitis-symptoms', 'bone-exposure', 'jaw-drainage'],
  },
  MANDIBLE_NONUNION: {
    id: 'mandible-nonunion',
    name: 'Mandible Nonunion',
    diagnosticCode: '9903',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['jaw-pain', 'jaw-instability', 'chewing-difficulty', 'facial-asymmetry'],
  },
  MANDIBLE_MALUNION: {
    id: 'mandible-malunion',
    name: 'Mandible Malunion',
    diagnosticCode: '9904',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['jaw-pain', 'bite-problems', 'chewing-difficulty', 'facial-asymmetry'],
  },
  MAXILLA_MALUNION: {
    id: 'maxilla-malunion',
    name: 'Maxilla Malunion or Nonunion',
    diagnosticCode: '9916',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['jaw-pain', 'bite-problems', 'chewing-difficulty', 'facial-asymmetry'],
  },
  BENIGN_ORAL_NEOPLASM: {
    id: 'benign-oral-neoplasm',
    name: 'Benign Neoplasm of Oral Cavity',
    diagnosticCode: '9917',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['oral-mass', 'oral-growth', 'tissue-thickening'],
  },
  MALIGNANT_ORAL_NEOPLASM: {
    id: 'malignant-oral-neoplasm',
    name: 'Malignant Neoplasm of Oral Cavity',
    diagnosticCode: '9918',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['oral-mass', 'oral-growth', 'tissue-thickening'],
  },
  TOOTH_LOSS: {
    id: 'tooth-loss',
    name: 'Loss of Teeth Due to Bone Loss',
    diagnosticCode: '9913',
    cfrReference: '38 CFR 4.150',
    symptomIds: ['missing-teeth', 'tooth-loss-pain', 'chewing-difficulty', 'prosthesis-pain'],
  },
  // Phase 8A: Somatic Symptom Disorders
  SOMATIC_SYMPTOM_DISORDER: {
    name: 'Somatic Symptom Disorder',
    symptomIds: [
      'somatic-pain',
      'somatic-excessive-worry',
      'somatic-multiple-symptoms',
      'somatic-doctor-visits',
      'somatic-functional-impairment',
    ],
  },
  OTHER_SPECIFIED_SOMATIC: {
    name: 'Other Specified Somatic Symptom Disorder',
    symptomIds: [
      'somatic-pain',
      'somatic-excessive-worry',
      'somatic-multiple-symptoms',
      'somatic-doctor-visits',
      'somatic-functional-impairment',
    ],
  },
  UNSPECIFIED_SOMATIC: {
    name: 'Unspecified Somatic Symptom Disorder',
    symptomIds: [
      'somatic-pain',
      'somatic-excessive-worry',
      'somatic-multiple-symptoms',
      'somatic-doctor-visits',
      'somatic-functional-impairment',
    ],
  },
  ILLNESS_ANXIETY: {
    name: 'Illness Anxiety Disorder',
    symptomIds: [
      'illness-anxiety-fear',
      'illness-anxiety-body-checking',
      'illness-anxiety-reassurance',
      'illness-anxiety-avoidance',
      'illness-anxiety-distress',
    ],
  },
  // Phase 8A: Other Anxiety/Mood
  OTHER_SPECIFIED_ANXIETY: {
    name: 'Other Specified Anxiety Disorder',
    symptomIds: [
      'anxiety',
      'gad-worry',
      'gad-restlessness',
      'gad-muscle-tension',
    ],
  },
  DEPERSONALIZATION_DEREALIZATION: {
    name: 'Depersonalization/Derealization Disorder',
    symptomIds: [
      'depersonalization-detachment',
      'derealization-unreality',
      'depersonalization-robot',
      'depersonalization-distress',
    ],
  },
  CYCLOTHYMIC: {
    name: 'Cyclothymic Disorder',
    symptomIds: [
      'cyclothymic-hypomanic',
      'cyclothymic-depressive',
      'cyclothymic-mood-swing',
      'cyclothymic-irritability',
    ],
  },
  // Phase 8A: Eating Disorders
  ANOREXIA_NERVOSA: {
    name: 'Anorexia Nervosa',
    symptomIds: [
      'anorexia-restricted-eating',
      'anorexia-weight-loss',
      'anorexia-fear-weight-gain',
      'anorexia-body-image',
      'anorexia-incapacitating-episode',
      'anorexia-hospitalization',
    ],
  },
  BULIMIA_NERVOSA: {
    name: 'Bulimia Nervosa',
    symptomIds: [
      'bulimia-binge-eating',
      'bulimia-purging',
      'bulimia-compensatory',
      'bulimia-body-image',
      'bulimia-incapacitating-episode',
      'bulimia-hospitalization',
    ],
  },
  // Schizophrenia Spectrum (DC 9201-9205)
  SCHIZOPHRENIA: {
    id: 'schizophrenia',
    name: 'Schizophrenia',
    diagnosticCode: '9201',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['schizophrenia-hallucinations', 'schizophrenia-delusions', 'schizophrenia-disorganized-speech', 'schizophrenia-disorganized-behavior', 'schizophrenia-negative-symptoms'],
  },
  SCHIZOAFFECTIVE_DISORDER: {
    id: 'schizoaffective-disorder',
    name: 'Schizoaffective Disorder',
    diagnosticCode: '9202',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['schizophrenia-hallucinations', 'schizophrenia-delusions', 'schizoaffective-mood-episodes', 'psychotic-episode'],
  },
  DELUSIONAL_DISORDER: {
    id: 'delusional-disorder',
    name: 'Delusional Disorder',
    diagnosticCode: '9203',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['schizophrenia-delusions', 'psychotic-episode'],
  },
  PSYCHOTIC_DISORDER_NOS: {
    id: 'psychotic-disorder-nos',
    name: 'Psychotic Disorder NOS',
    diagnosticCode: '9204',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['psychotic-episode', 'schizophrenia-hallucinations', 'schizophrenia-delusions'],
  },
  BRIEF_PSYCHOTIC_DISORDER: {
    id: 'brief-psychotic-disorder',
    name: 'Brief Psychotic Disorder',
    diagnosticCode: '9205',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['brief-psychotic-episode', 'schizophrenia-hallucinations', 'schizophrenia-delusions'],
  },

  // Binge Eating Disorder (DC 9520)
  BINGE_EATING_DISORDER: {
    id: 'binge-eating-disorder',
    name: 'Binge Eating Disorder',
    diagnosticCode: '9520',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['binge-eating-episode', 'binge-eating-loss-of-control', 'binge-eating-distress'],
  },

  // Dissociative Disorders (DC 9416-9417)
  DISSOCIATIVE_IDENTITY_DISORDER: {
    id: 'dissociative-identity-disorder',
    name: 'Dissociative Identity Disorder',
    diagnosticCode: '9416',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['dissociative-identity-switching', 'dissociative-amnesia-episode', 'dissociative-fugue', 'dissociative-time-loss'],
  },
  DISSOCIATIVE_AMNESIA: {
    id: 'dissociative-amnesia',
    name: 'Dissociative Amnesia',
    diagnosticCode: '9417',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['dissociative-amnesia-episode', 'dissociative-fugue', 'dissociative-time-loss'],
  },

  // Acute Stress Disorder (DC 9413)
  ACUTE_STRESS_DISORDER: {
    id: 'acute-stress-disorder',
    name: 'Acute Stress Disorder',
    diagnosticCode: '9413',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['acute-stress-intrusion', 'acute-stress-avoidance', 'acute-stress-arousal', 'acute-stress-dissociation'],
  },

  // Personality Disorders (DC 9301)
  ANTISOCIAL_PERSONALITY_DISORDER: {
    id: 'antisocial-personality-disorder',
    name: 'Antisocial Personality Disorder',
    diagnosticCode: '9301',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['personality-antisocial-behaviors', 'personality-disorder-occupational-impairment', 'personality-disorder-social-impairment'],
  },
  BORDERLINE_PERSONALITY_DISORDER: {
    id: 'borderline-personality-disorder',
    name: 'Borderline Personality Disorder',
    diagnosticCode: '9301',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['personality-borderline-instability', 'personality-borderline-fear-abandonment', 'personality-borderline-self-harm', 'personality-disorder-occupational-impairment', 'personality-disorder-social-impairment'],
  },
  NARCISSISTIC_PERSONALITY_DISORDER: {
    id: 'narcissistic-personality-disorder',
    name: 'Narcissistic Personality Disorder',
    diagnosticCode: '9301',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['personality-narcissistic-grandiosity', 'personality-narcissistic-lack-empathy', 'personality-disorder-occupational-impairment', 'personality-disorder-social-impairment'],
  },
  AVOIDANT_PERSONALITY_DISORDER: {
    id: 'avoidant-personality-disorder',
    name: 'Avoidant Personality Disorder',
    diagnosticCode: '9301',
    cfrReference: '38 CFR 4.130',
    symptomIds: ['personality-avoidant-social-inhibition', 'personality-avoidant-fear-rejection', 'personality-disorder-occupational-impairment', 'personality-disorder-social-impairment'],
  },
  // Phase 9: Cardiovascular Conditions
  CARDIOMYOPATHY: {
    id: 'cardiomyopathy',
    name: 'Cardiomyopathy',
    diagnosticCode: '7020',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'cardiomyopathy-breathlessness', 'cardiomyopathy-fatigue', 'cardiomyopathy-edema',
      'cardiomyopathy-palpitations', 'cardiomyopathy-chest-pain', 'cardiomyopathy-dizziness',
      'cardiomyopathy-syncope', 'cardiomyopathy-activity-limitation',
      'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
      'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea',
    ],
  },
  SVT: {
    id: 'svt',
    name: 'Supraventricular Tachycardia',
    diagnosticCode: '7010',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'svt-episode', 'svt-treatment-iv', 'svt-treatment-cardioversion', 'svt-treatment-ablation',
      'svt-vagal-maneuver', 'svt-oral-medication',
      'arrhythmia-palpitations', 'arrhythmia-racing-heart', 'arrhythmia-skipped-beats',
      'arrhythmia-dizziness', 'arrhythmia-syncope', 'arrhythmia-chest-discomfort',
    ],
  },
  VENTRICULAR_ARRHYTHMIA: {
    id: 'ventricular-arrhythmia',
    name: 'Ventricular Arrhythmias',
    diagnosticCode: '7011',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'ventricular-arrhythmia-episode', 'ventricular-arrhythmia-hospitalization',
      'aicd-implant', 'aicd-shock',
      'arrhythmia-palpitations', 'arrhythmia-racing-heart', 'arrhythmia-syncope',
    ],
  },
  PERICARDITIS: {
    id: 'pericarditis',
    name: 'Pericarditis',
    diagnosticCode: '7002',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'pericarditis-chest-pain', 'pericarditis-pain-breathing', 'pericarditis-pain-lying-down',
      'pericarditis-fever', 'pericarditis-palpitations', 'pericarditis-shortness-breath',
      'pericarditis-active-infection', 'pericarditis-effusion',
    ],
  },
  POST_PHLEBITIC: {
    id: 'post-phlebitic',
    name: 'Post-Phlebitic Syndrome',
    diagnosticCode: '7121',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'post-phlebitic-edema', 'post-phlebitic-pain', 'post-phlebitic-aching',
      'post-phlebitic-pigmentation', 'post-phlebitic-eczema', 'post-phlebitic-ulcer',
      'post-phlebitic-induration', 'post-phlebitic-pain-rest',
    ],
  },
  // Phase 2A: Major Cardiac Conditions (METs-based)
  CAD: {
    id: 'cad',
    name: 'Coronary Artery Disease',
    diagnosticCode: '7005',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'cad-angina-stable', 'cad-angina-unstable', 'cad-dyspnea-exertion', 'cad-dyspnea-rest',
      'cad-fatigue', 'cad-dizziness', 'cad-syncope', 'cad-palpitations', 'cad-diaphoresis',
      'cad-nausea', 'cad-activity-limitation', 'cad-nitroglycerin-use', 'cad-hospitalization',
      'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
      'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea',
    ],
  },
  POST_MI: {
    id: 'post-mi',
    name: 'Myocardial Infarction (Post-MI)',
    diagnosticCode: '7006',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'post-mi-chest-pain', 'post-mi-dyspnea-exertion', 'post-mi-dyspnea-rest', 'post-mi-fatigue',
      'post-mi-weakness', 'post-mi-dizziness', 'post-mi-syncope', 'post-mi-palpitations',
      'post-mi-edema', 'post-mi-activity-limitation', 'post-mi-anxiety', 'post-mi-hospitalization',
      'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
      'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea',
    ],
  },
  HYPERTENSIVE_HEART: {
    id: 'hypertensive-heart',
    name: 'Hypertensive Heart Disease',
    diagnosticCode: '7007',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'hhd-dyspnea-exertion', 'hhd-dyspnea-rest', 'hhd-orthopnea', 'hhd-pnd', 'hhd-fatigue',
      'hhd-edema', 'hhd-weight-gain', 'hhd-chest-discomfort', 'hhd-palpitations', 'hhd-dizziness',
      'hhd-syncope', 'hhd-activity-limitation', 'hhd-hospitalization',
      'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
      'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea',
    ],
  },
  // Phase 2B: Vascular Conditions
  COLD_INJURY: {
    id: 'cold-injury',
    name: 'Cold Injury Residuals (Frostbite)',
    diagnosticCode: '7122',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'cold-injury-pain', 'cold-injury-numbness', 'cold-injury-cold-sensitivity',
      'cold-injury-tingling', 'cold-injury-color-changes', 'cold-injury-tissue-loss',
      'cold-injury-nail-abnormalities', 'cold-injury-impaired-sensation',
      'cold-injury-hyperhidrosis', 'cold-injury-stiffness', 'cold-injury-swelling',
      'cold-injury-xray-abnormality',
    ],
  },
  PERIPHERAL_ARTERIAL_DISEASE: {
    id: 'peripheral-arterial-disease',
    name: 'Peripheral Arterial Disease (PAD)',
    diagnosticCode: '7114',
    cfrReference: '38 CFR 4.104',
    symptomIds: [
      'pad-claudication-mild', 'pad-claudication-moderate', 'pad-claudication-severe',
      'pad-rest-pain', 'pad-coldness', 'pad-numbness',
      'pad-trophic-thin-skin', 'pad-trophic-hair-loss', 'pad-trophic-nail-changes',
      'pad-diminished-pulses', 'pad-color-changes', 'pad-ulceration',
      'pad-slow-healing', 'pad-gangrene',
    ],
  },
  // Phase 10: Digestive Completion
  CIRRHOSIS: {
    id: 'cirrhosis',
    name: 'Cirrhosis of the Liver',
    diagnosticCode: '7312',
    cfrReference: '38 CFR 4.114',
    symptomIds: [
      'cirrhosis-fatigue', 'cirrhosis-ascites', 'cirrhosis-edema', 'cirrhosis-jaundice',
      'cirrhosis-encephalopathy', 'cirrhosis-variceal-bleed', 'cirrhosis-sbp', 'cirrhosis-coagulopathy',
      'cirrhosis-splenomegaly', 'cirrhosis-anorexia', 'cirrhosis-malaise', 'cirrhosis-abdominal-pain',
      'cirrhosis-itching', 'cirrhosis-hospitalization',
    ],
  },
  GASTRITIS: {
    id: 'gastritis',
    name: 'Gastritis, Chronic',
    diagnosticCode: '7307',
    cfrReference: '38 CFR 4.114',
    symptomIds: [
      'gastritis-abdominal-pain', 'gastritis-nausea', 'gastritis-vomiting', 'gastritis-bloating',
      'gastritis-indigestion', 'gastritis-hematemesis', 'gastritis-melena', 'gastritis-hospitalization',
    ],
  },
  PANCREATITIS: {
    id: 'pancreatitis',
    name: 'Pancreatitis, Chronic',
    diagnosticCode: '7347',
    cfrReference: '38 CFR 4.114',
    symptomIds: [
      'pancreatitis-abdominal-pain', 'pancreatitis-back-pain', 'pancreatitis-nausea', 'pancreatitis-vomiting',
      'pancreatitis-maldigestion', 'pancreatitis-weight-loss', 'pancreatitis-enzyme-use',
      'pancreatitis-dietary-restriction', 'pancreatitis-tube-feeding', 'pancreatitis-cyst',
      'pancreatitis-hospitalization',
    ],
  },
  BILIARY_TRACT: {
    id: 'biliary-tract',
    name: 'Chronic Biliary Tract Disease',
    diagnosticCode: '7314',
    cfrReference: '38 CFR 4.114',
    symptomIds: [
      'biliary-ruq-pain', 'biliary-nausea', 'biliary-vomiting', 'biliary-jaundice',
      'biliary-fever', 'biliary-dilation', 'biliary-attack',
    ],
  },
  // ============================================
  // PHASE 1A: MAJOR NEUROLOGICAL CONDITIONS
  // ============================================
  MULTIPLE_SCLEROSIS: {
    id: 'multiple-sclerosis',
    name: 'Multiple Sclerosis',
    diagnosticCode: '8018',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [
      'ms-fatigue', 'ms-numbness-tingling', 'ms-vision-problems', 'ms-double-vision',
      'ms-muscle-weakness', 'ms-spasticity', 'ms-balance-problems', 'ms-cognitive-fog',
      'ms-bladder-dysfunction', 'ms-bowel-dysfunction', 'ms-heat-sensitivity',
      'ms-lhermittes-sign', 'ms-pain', 'ms-tremor', 'ms-speech-difficulty',
      'ms-swallowing-difficulty', 'ms-relapse', 'ms-vertigo', 'ms-depression',
      'ms-walking-difficulty',
    ],
  },
  PARKINSONS_DISEASE: {
    id: 'parkinsons-disease',
    name: "Parkinson's Disease",
    diagnosticCode: '8004',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [
      'pd-resting-tremor', 'pd-rigidity', 'pd-bradykinesia', 'pd-postural-instability',
      'pd-freezing-gait', 'pd-shuffling-walk', 'pd-masked-face', 'pd-soft-speech',
      'pd-micrographia', 'pd-sleep-disturbance', 'pd-rem-sleep-disorder', 'pd-depression',
      'pd-anxiety', 'pd-cognitive-changes', 'pd-constipation', 'pd-urinary-problems',
      'pd-swallowing-difficulty', 'pd-drooling', 'pd-loss-smell', 'pd-fatigue',
      'pd-pain', 'pd-falls', 'pd-off-episodes', 'pd-dyskinesia',
    ],
  },
  MYASTHENIA_GRAVIS: {
    id: 'myasthenia-gravis',
    name: 'Myasthenia Gravis',
    diagnosticCode: '8025',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [
      'mg-ptosis', 'mg-diplopia', 'mg-facial-weakness', 'mg-difficulty-chewing',
      'mg-difficulty-swallowing', 'mg-slurred-speech', 'mg-limb-weakness',
      'mg-neck-weakness', 'mg-respiratory-weakness', 'mg-fatigue-activity',
      'mg-improvement-rest', 'mg-crisis', 'mg-hospitalization', 'mg-voice-fatigue',
      'mg-arm-elevation-difficulty',
    ],
  },
  // ============================================
  // PHASE 1B: ADDITIONAL NEUROLOGICAL CONDITIONS
  // ============================================

  NARCOLEPSY: {
    id: 'narcolepsy',
    name: 'Narcolepsy',
    diagnosticCode: '8108',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [
      'narco-sleep-attack', 'narco-excessive-sleepiness', 'narco-cataplexy',
      'narco-sleep-paralysis', 'narco-hypnagogic-hallucination', 'narco-hypnopompic-hallucination',
      'narco-disrupted-sleep', 'narco-automatic-behavior', 'narco-memory-problems',
      'narco-difficulty-concentrating', 'narco-microsleep',
    ],
  },

  ALS: {
    id: 'als',
    name: 'Amyotrophic Lateral Sclerosis (ALS)',
    diagnosticCode: '8017',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [
      'als-muscle-weakness', 'als-fasciculations', 'als-muscle-cramps', 'als-spasticity',
      'als-difficulty-speaking', 'als-difficulty-swallowing', 'als-respiratory-difficulty',
      'als-fatigue', 'als-muscle-atrophy', 'als-hand-weakness', 'als-foot-drop',
      'als-tripping-falling', 'als-emotional-lability', 'als-drooling', 'als-weight-loss',
    ],
  },

  SYRINGOMYELIA: {
    id: 'syringomyelia',
    name: 'Syringomyelia',
    diagnosticCode: '8024',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [
      'syring-pain', 'syring-weakness', 'syring-sensory-loss', 'syring-temp-insensitivity',
      'syring-pain-insensitivity', 'syring-muscle-wasting', 'syring-stiffness',
      'syring-headache', 'syring-numbness-tingling', 'syring-bowel-bladder', 'syring-scoliosis',
    ],
  },

  MYELITIS: {
    id: 'myelitis',
    name: 'Myelitis',
    diagnosticCode: '8010',
    cfrReference: '38 CFR 4.124a',
    symptomIds: [
      'myel-weakness', 'myel-sensory-changes', 'myel-bladder-dysfunction',
      'myel-bowel-dysfunction', 'myel-pain', 'myel-spasticity', 'myel-fatigue',
      'myel-numbness', 'myel-tingling', 'myel-band-sensation', 'myel-sexual-dysfunction',
      'myel-paralysis',
    ],
  },

  // ============================================
  // PHASE 1C: PERIPHERAL NERVE CONDITIONS
  // DC 8510-8530 (Paralysis), 8610-8630 (Neuritis), 8710-8730 (Neuralgia)
  // 38 CFR 4.124a
  // ============================================

  // UPPER EXTREMITY NERVES

  UPPER_RADICULAR_GROUP: {
    id: 'upper-radicular-nerve',
    name: 'Upper Radicular Group (C5-C6)',
    diagnosticCodes: { paralysis: '8510', neuritis: '8610', neuralgia: '8710' },
    symptomIds: [
      'uprn-shoulder-weakness', 'uprn-elbow-weakness', 'uprn-shoulder-movement-loss',
      'uprn-elbow-movement-loss', 'uprn-numbness', 'uprn-tingling', 'uprn-pain',
      'uprn-muscle-atrophy', 'uprn-reflex-loss'
    ]
  },

  MIDDLE_RADICULAR_GROUP: {
    id: 'middle-radicular-nerve',
    name: 'Middle Radicular Group (C7)',
    diagnosticCodes: { paralysis: '8511', neuritis: '8611', neuralgia: '8711' },
    symptomIds: [
      'mdrn-arm-weakness', 'mdrn-wrist-extension-weakness', 'mdrn-elbow-extension-weakness',
      'mdrn-finger-extension-weakness', 'mdrn-numbness', 'mdrn-tingling', 'mdrn-pain',
      'mdrn-muscle-atrophy', 'mdrn-reflex-loss'
    ]
  },

  LOWER_RADICULAR_GROUP: {
    id: 'lower-radicular-nerve',
    name: 'Lower Radicular Group (C8-T1)',
    diagnosticCodes: { paralysis: '8512', neuritis: '8612', neuralgia: '8712' },
    symptomIds: [
      'lwrn-hand-weakness', 'lwrn-grip-weakness', 'lwrn-finger-flexion-weakness',
      'lwrn-intrinsic-muscle-weakness', 'lwrn-numbness', 'lwrn-tingling', 'lwrn-pain',
      'lwrn-muscle-atrophy', 'lwrn-clumsiness'
    ]
  },

  ALL_RADICULAR_GROUPS: {
    id: 'all-radicular-nerve',
    name: 'All Radicular Groups (Brachial Plexus)',
    diagnosticCodes: { paralysis: '8513', neuritis: '8613', neuralgia: '8713' },
    symptomIds: [
      'alrn-complete-arm-paralysis', 'alrn-arm-weakness', 'alrn-shoulder-weakness',
      'alrn-elbow-weakness', 'alrn-wrist-weakness', 'alrn-hand-weakness',
      'alrn-numbness', 'alrn-tingling', 'alrn-pain', 'alrn-muscle-atrophy'
    ]
  },

  RADIAL_NERVE: {
    id: 'radial-nerve',
    name: 'Radial Nerve (Musculospiral)',
    diagnosticCodes: { paralysis: '8514', neuritis: '8614', neuralgia: '8714' },
    symptomIds: [
      'radn-wrist-drop', 'radn-finger-drop', 'radn-extension-weakness',
      'radn-supination-weakness', 'radn-thumb-extension-loss', 'radn-grip-weakness',
      'radn-numbness', 'radn-tingling', 'radn-pain', 'radn-muscle-atrophy'
    ]
  },

  MEDIAN_NERVE: {
    id: 'median-nerve',
    name: 'Median Nerve (Carpal Tunnel)',
    diagnosticCodes: { paralysis: '8515', neuritis: '8615', neuralgia: '8715' },
    symptomIds: [
      'medn-numbness', 'medn-tingling', 'medn-pain', 'medn-night-symptoms',
      'medn-thenar-weakness', 'medn-thenar-atrophy', 'medn-grip-weakness',
      'medn-dropping-objects', 'medn-opposition-weakness', 'medn-pronation-weakness',
      'medn-ape-hand', 'medn-trophic-changes'
    ]
  },

  ULNAR_NERVE: {
    id: 'ulnar-nerve',
    name: 'Ulnar Nerve (Cubital Tunnel)',
    diagnosticCodes: { paralysis: '8516', neuritis: '8616', neuralgia: '8716' },
    symptomIds: [
      'ulnn-numbness', 'ulnn-tingling', 'ulnn-pain', 'ulnn-elbow-pain',
      'ulnn-grip-weakness', 'ulnn-pinch-weakness', 'ulnn-finger-spread-weakness',
      'ulnn-claw-hand', 'ulnn-interossei-atrophy', 'ulnn-hypothenar-atrophy',
      'ulnn-thumb-adduction-weakness', 'ulnn-wrist-flexion-weakness'
    ]
  },

  MUSCULOCUTANEOUS_NERVE: {
    id: 'musculocutaneous-nerve',
    name: 'Musculocutaneous Nerve',
    diagnosticCodes: { paralysis: '8517', neuritis: '8617', neuralgia: '8717' },
    symptomIds: [
      'mscn-biceps-weakness', 'mscn-elbow-flexion-weakness', 'mscn-supination-weakness',
      'mscn-numbness', 'mscn-tingling', 'mscn-pain', 'mscn-muscle-atrophy'
    ]
  },

  CIRCUMFLEX_NERVE: {
    id: 'circumflex-nerve',
    name: 'Circumflex (Axillary) Nerve',
    diagnosticCodes: { paralysis: '8518', neuritis: '8618', neuralgia: '8718' },
    symptomIds: [
      'crcn-shoulder-abduction-weakness', 'crcn-arm-raise-difficulty',
      'crcn-external-rotation-weakness', 'crcn-deltoid-weakness', 'crcn-deltoid-atrophy',
      'crcn-numbness', 'crcn-tingling', 'crcn-pain'
    ]
  },

  LONG_THORACIC_NERVE: {
    id: 'long-thoracic-nerve',
    name: 'Long Thoracic Nerve',
    diagnosticCodes: { paralysis: '8519', neuritis: '8619', neuralgia: '8719' },
    symptomIds: [
      'ltn-winged-scapula', 'ltn-arm-elevation-difficulty', 'ltn-shoulder-weakness',
      'ltn-pushing-difficulty', 'ltn-serratus-weakness', 'ltn-pain', 'ltn-fatigue'
    ]
  },

  // LOWER EXTREMITY NERVES

  SCIATIC_NERVE: {
    id: 'sciatic-nerve',
    name: 'Sciatic Nerve',
    diagnosticCodes: { paralysis: '8520', neuritis: '8620', neuralgia: '8720' },
    symptomIds: [
      'scin-radiating-pain', 'scin-leg-weakness', 'scin-foot-drop',
      'scin-knee-flexion-weakness', 'scin-numbness', 'scin-tingling', 'scin-burning',
      'scin-muscle-atrophy', 'scin-difficulty-walking', 'scin-sitting-pain'
    ]
  },

  COMMON_PERONEAL_NERVE: {
    id: 'common-peroneal-nerve',
    name: 'Common Peroneal (External Popliteal) Nerve',
    diagnosticCodes: { paralysis: '8521', neuritis: '8621', neuralgia: '8721' },
    symptomIds: [
      'cpn-foot-drop', 'cpn-dorsiflexion-weakness', 'cpn-toe-extension-weakness',
      'cpn-eversion-weakness', 'cpn-steppage-gait', 'cpn-tripping',
      'cpn-numbness', 'cpn-tingling', 'cpn-pain', 'cpn-muscle-atrophy'
    ]
  },

  SUPERFICIAL_PERONEAL_NERVE: {
    id: 'superficial-peroneal-nerve',
    name: 'Superficial Peroneal (Musculocutaneous) Nerve',
    diagnosticCodes: { paralysis: '8522', neuritis: '8622', neuralgia: '8722' },
    symptomIds: [
      'spn-eversion-weakness', 'spn-ankle-instability', 'spn-numbness',
      'spn-tingling', 'spn-pain', 'spn-muscle-atrophy'
    ]
  },

  DEEP_PERONEAL_NERVE: {
    id: 'deep-peroneal-nerve',
    name: 'Deep Peroneal (Anterior Tibial) Nerve',
    diagnosticCodes: { paralysis: '8523', neuritis: '8623', neuralgia: '8723' },
    symptomIds: [
      'dpn-dorsiflexion-loss', 'dpn-toe-extension-weakness', 'dpn-foot-drop',
      'dpn-numbness', 'dpn-tingling', 'dpn-pain', 'dpn-muscle-atrophy'
    ]
  },

  TIBIAL_NERVE: {
    id: 'tibial-nerve',
    name: 'Tibial (Internal Popliteal) Nerve',
    diagnosticCodes: { paralysis: '8524', neuritis: '8624', neuralgia: '8724' },
    symptomIds: [
      'tibn-plantar-flexion-weakness', 'tibn-toe-flexion-weakness',
      'tibn-foot-inversion-weakness', 'tibn-calf-weakness', 'tibn-difficulty-walking-tiptoe',
      'tibn-numbness', 'tibn-tingling', 'tibn-burning', 'tibn-muscle-atrophy'
    ]
  },

  POSTERIOR_TIBIAL_NERVE: {
    id: 'posterior-tibial-nerve',
    name: 'Posterior Tibial Nerve',
    diagnosticCodes: { paralysis: '8525', neuritis: '8625', neuralgia: '8725' },
    symptomIds: [
      'ptn-sole-paralysis', 'ptn-toe-flexion-weakness', 'ptn-foot-adduction-weakness',
      'ptn-numbness', 'ptn-tingling', 'ptn-burning', 'ptn-tarsal-tunnel', 'ptn-muscle-atrophy'
    ]
  },

  FEMORAL_NERVE: {
    id: 'femoral-nerve',
    name: 'Femoral (Anterior Crural) Nerve',
    diagnosticCodes: { paralysis: '8526', neuritis: '8626', neuralgia: '8726' },
    symptomIds: [
      'femn-quadriceps-weakness', 'femn-knee-extension-weakness', 'femn-knee-buckling',
      'femn-difficulty-stairs', 'femn-difficulty-rising', 'femn-numbness',
      'femn-tingling', 'femn-pain', 'femn-muscle-atrophy'
    ]
  },

  SAPHENOUS_NERVE: {
    id: 'saphenous-nerve',
    name: 'Saphenous (Internal Saphenous) Nerve',
    diagnosticCodes: { paralysis: '8527', neuritis: '8627', neuralgia: '8727' },
    symptomIds: [
      'sapn-numbness', 'sapn-tingling', 'sapn-pain', 'sapn-burning', 'sapn-hypersensitivity'
    ]
  },

  OBTURATOR_NERVE: {
    id: 'obturator-nerve',
    name: 'Obturator Nerve',
    diagnosticCodes: { paralysis: '8528', neuritis: '8628', neuralgia: '8728' },
    symptomIds: [
      'obtn-thigh-adduction-weakness', 'obtn-groin-pain', 'obtn-medial-thigh-pain',
      'obtn-numbness', 'obtn-tingling', 'obtn-gait-instability', 'obtn-muscle-atrophy'
    ]
  },

  LATERAL_FEMORAL_CUTANEOUS_NERVE: {
    id: 'lateral-femoral-cutaneous-nerve',
    name: 'Lateral Femoral Cutaneous Nerve (Meralgia Paresthetica)',
    diagnosticCodes: { paralysis: '8529', neuritis: '8629', neuralgia: '8729' },
    symptomIds: [
      'lfcn-numbness', 'lfcn-tingling', 'lfcn-burning', 'lfcn-hypersensitivity',
      'lfcn-pain-standing', 'lfcn-pain-walking'
    ]
  },

  ILIOINGUINAL_NERVE: {
    id: 'ilioinguinal-nerve',
    name: 'Ilio-inguinal Nerve',
    diagnosticCodes: { paralysis: '8530', neuritis: '8630', neuralgia: '8730' },
    symptomIds: [
      'iin-groin-numbness', 'iin-genital-numbness', 'iin-inner-thigh-numbness',
      'iin-groin-pain', 'iin-burning', 'iin-hypersensitivity', 'iin-pain-movement'
    ]
  },
  // ============================================
  // PHASE 4D: FOOT CONDITIONS
  // ============================================

  // Weak Foot - DC 5277
  WEAK_FOOT: {
    id: 'weak-foot',
    name: 'Weak Foot (Bilateral)',
    diagnosticCode: '5277',
    cfrReference: '38 CFR 4.71a',
    description: 'Symptomatic condition secondary to constitutional conditions, characterized by atrophy of musculature, disturbed circulation, and weakness',
    symptomIds: [
      'wf-muscle-atrophy', 'wf-weakness', 'wf-circulation-problems', 'wf-numbness',
      'wf-fatigue', 'wf-instability', 'wf-balance-difficulty', 'wf-gait-changes',
      'wf-cramping', 'wf-functional-loss'
    ],
  },

  // Claw Foot (Pes Cavus) - DC 5278
  CLAW_FOOT: {
    id: 'claw-foot',
    name: 'Claw Foot (Pes Cavus)',
    diagnosticCode: '5278',
    cfrReference: '38 CFR 4.71a',
    description: 'Acquired foot deformity with high arch, hammer toes, and structural abnormalities',
    symptomIds: [
      'cf-high-arch', 'cf-hammer-toes', 'cf-toe-dorsiflexion', 'cf-plantar-fascia',
      'cf-dropped-forefoot', 'cf-callosities', 'cf-metatarsal-tenderness', 'cf-varus-deformity',
      'cf-ankle-dorsiflexion-limited', 'cf-shoe-fitting', 'cf-instability', 'cf-functional-loss'
    ],
  },

  // Metatarsalgia (Morton's Disease) - DC 5279
  METATARSALGIA: {
    id: 'metatarsalgia',
    name: "Metatarsalgia (Morton's Disease)",
    diagnosticCode: '5279',
    cfrReference: '38 CFR 4.71a',
    description: 'Anterior metatarsalgia with pain in ball of foot, often including Morton neuroma',
    symptomIds: [
      'mt-ball-foot-pain', 'mt-numbness-toes', 'mt-burning', 'mt-shooting-pain',
      'mt-walking-pain', 'mt-standing-pain', 'mt-pebble-feeling', 'mt-relief-rest',
      'mt-swelling', 'mt-functional-loss'
    ],
  },

  // Hallux Valgus (Bunion) - DC 5280
  HALLUX_VALGUS: {
    id: 'hallux-valgus',
    name: 'Hallux Valgus (Bunion)',
    diagnosticCode: '5280',
    cfrReference: '38 CFR 4.71a',
    description: 'Big toe angling toward other toes with bunion deformity at MTP joint',
    symptomIds: [
      'hv-bunion-pain', 'hv-deformity', 'hv-redness', 'hv-callus',
      'hv-shoe-pain', 'hv-limited-motion', 'hv-progressive', 'hv-second-toe',
      'hv-post-surgical', 'hv-functional-loss'
    ],
  },

  // Hallux Rigidus - DC 5281
  HALLUX_RIGIDUS: {
    id: 'hallux-rigidus',
    name: 'Hallux Rigidus',
    diagnosticCode: '5281',
    cfrReference: '38 CFR 4.71a',
    description: 'Stiffness and limited motion of big toe joint (MTP arthritis)',
    symptomIds: [
      'hr-toe-stiffness', 'hr-toe-pain', 'hr-limited-motion', 'hr-bone-spur',
      'hr-walking-pain', 'hr-swelling', 'hr-grinding', 'hr-cold-weather',
      'hr-shoe-difficulty', 'hr-functional-loss'
    ],
  },
  // ========== PHASE 5A: DIGESTIVE SYSTEM - HERNIA & STRUCTURAL ==========
  // Hernia (All Types) - DC 7338
  HERNIA: {
    id: 'hernia',
    name: 'Hernia',
    diagnosticCode: '7338',
    cfrReference: '38 CFR 4.114',
    description: 'Includes inguinal, femoral, umbilical, ventral, incisional, and other hernias (not hiatal)',
    symptomIds: [
      'hernia-groin-bulge', 'hernia-abdominal-bulge', 'hernia-umbilical-bulge',
      'hernia-pain-bending', 'hernia-pain-adl', 'hernia-pain-walking', 'hernia-pain-stairs',
      'hernia-pain-straining', 'hernia-pain-standing', 'hernia-reducible', 'hernia-irreducible',
      'hernia-truss-required', 'hernia-size-small', 'hernia-size-medium', 'hernia-size-large',
      'hernia-recurrent', 'hernia-post-surgical', 'hernia-strangulation-risk', 'hernia-functional-limitation'
    ],
  },
  // Peritoneal Adhesions - DC 7301
  PERITONEAL_ADHESIONS: {
    id: 'peritoneal-adhesions',
    name: 'Peritoneal Adhesions',
    diagnosticCode: '7301',
    cfrReference: '38 CFR 4.114',
    description: 'Adhesions of peritoneum due to surgery, trauma, disease, or infection',
    symptomIds: [
      'pa-abdominal-pain', 'pa-nausea', 'pa-vomiting', 'pa-colic', 'pa-constipation',
      'pa-diarrhea', 'pa-distension', 'pa-obstruction-partial', 'pa-obstruction-complete',
      'pa-hospitalization', 'pa-dietary-modification', 'pa-tpn-required', 'pa-post-surgical',
      'pa-post-trauma', 'pa-inflammatory', 'pa-recurrent', 'pa-inoperable'
    ],
  },

  // ========== PHASE 5B: DIGESTIVE SYSTEM - ESOPHAGEAL & POST-SURGICAL ==========

  // Esophageal Stricture - DC 7203
  ESOPHAGEAL_STRICTURE: {
    id: 'esophageal-stricture',
    name: 'Esophageal Stricture',
    diagnosticCode: '7203',
    cfrReference: '38 CFR 4.114',
    description: 'Narrowing of the esophagus causing swallowing difficulties',
    symptomIds: [
      'es-dysphagia-solids', 'es-dysphagia-liquids', 'es-dysphagia-pills', 'es-food-impaction',
      'es-regurgitation', 'es-aspiration', 'es-weight-loss', 'es-undernutrition',
      'es-dilatation', 'es-dilatation-steroids', 'es-stent', 'es-peg-tube',
      'es-daily-medication', 'es-recurrent', 'es-refractory'
    ],
  },

  // Esophageal Spasm/Motility Disorder - DC 7204 (rates as DC 7203)
  ESOPHAGEAL_SPASM: {
    id: 'esophageal-spasm',
    name: 'Esophageal Spasm/Motility Disorder',
    diagnosticCode: '7204',
    cfrReference: '38 CFR 4.114',
    description: 'Esophageal motility disorders including achalasia, diffuse spasm, nutcracker esophagus',
    symptomIds: [
      'esp-chest-pain', 'esp-dysphagia', 'esp-food-sticking', 'esp-regurgitation',
      'esp-heartburn', 'esp-triggered-hot-cold', 'esp-triggered-stress', 'esp-nocturnal',
      'esp-weight-loss', 'esp-achalasia'
    ],
  },

  // Postgastrectomy Syndrome - DC 7308 (rates as DC 7303)
  POSTGASTRECTOMY: {
    id: 'postgastrectomy',
    name: 'Postgastrectomy Syndrome',
    diagnosticCode: '7308',
    cfrReference: '38 CFR 4.114',
    description: 'Chronic complications following stomach surgery including dumping syndrome',
    symptomIds: [
      'pgs-dumping-early', 'pgs-dumping-late', 'pgs-nausea', 'pgs-vomiting', 'pgs-vomiting-daily',
      'pgs-diarrhea', 'pgs-diarrhea-explosive', 'pgs-syncope', 'pgs-sweating',
      'pgs-abdominal-pain', 'pgs-dietary-modification', 'pgs-medication',
      'pgs-tpn', 'pgs-tube-feeding', 'pgs-weight-loss'
    ],
  },

  // Intestinal Fistula - DC 7330
  INTESTINAL_FISTULA: {
    id: 'intestinal-fistula',
    name: 'Intestinal Fistula',
    diagnosticCode: '7330',
    cfrReference: '38 CFR 4.114',
    description: 'External fistula of the intestine',
    symptomIds: [
      'if-drainage-minimal', 'if-drainage-moderate', 'if-drainage-heavy', 'if-fecal-discharge',
      'if-persistent-drainage', 'if-skin-irritation', 'if-infection', 'if-pain',
      'if-enteral-nutrition', 'if-tpn', 'if-low-bmi', 'if-very-low-bmi',
      'if-post-surgical', 'if-post-radiation', 'if-post-trauma'
    ],
  },

  // ========== PHASE 6A: SKIN CONDITIONS - COMMON ==========

  ACNE: {
    id: 'acne',
    name: 'Acne',
    diagnosticCode: '7828',
    cfrReference: '38 CFR 4.118',
    description: 'Deep and superficial acne affecting face, neck, or body',
    symptomIds: [
      'acne-superficial-comedones', 'acne-superficial-papules', 'acne-superficial-pustules',
      'acne-deep-nodules', 'acne-deep-cysts', 'acne-face-neck-under40', 'acne-face-neck-40plus',
      'acne-body-other', 'acne-scarring', 'acne-disfigurement', 'acne-topical-treatment',
      'acne-oral-antibiotics', 'acne-isotretinoin', 'acne-hormonal-therapy', 'acne-flare-frequency'
    ],
  },

  CHLORACNE: {
    id: 'chloracne',
    name: 'Chloracne',
    diagnosticCode: '7829',
    cfrReference: '38 CFR 4.118',
    description: 'Acne-like skin condition caused by exposure to dioxin or Agent Orange',
    symptomIds: [
      'chloracne-comedones', 'chloracne-papules', 'chloracne-pustules',
      'chloracne-deep-nodules', 'chloracne-deep-cysts', 'chloracne-face-neck-under40',
      'chloracne-face-neck-40plus', 'chloracne-intertriginous', 'chloracne-body-other',
      'chloracne-scarring', 'chloracne-disfigurement', 'chloracne-agent-orange',
      'chloracne-dioxin-exposure', 'chloracne-onset-within-year'
    ],
  },

  ALOPECIA_AREATA: {
    id: 'alopecia-areata',
    name: 'Alopecia Areata',
    diagnosticCode: '7831',
    cfrReference: '38 CFR 4.118',
    description: 'Autoimmune hair loss condition affecting scalp, face, or body',
    symptomIds: [
      'aa-patchy-scalp', 'aa-complete-scalp', 'aa-eyebrow-loss', 'aa-eyelash-loss',
      'aa-beard-loss', 'aa-body-hair-loss', 'aa-all-body-hair', 'aa-nail-changes',
      'aa-exclamation-hairs', 'aa-regrowth', 'aa-recurrent', 'aa-steroid-injections',
      'aa-topical-treatment', 'aa-immunotherapy'
    ],
  },

  HYPERHIDROSIS: {
    id: 'hyperhidrosis',
    name: 'Hyperhidrosis',
    diagnosticCode: '7832',
    cfrReference: '38 CFR 4.118',
    description: 'Excessive sweating affecting hands, feet, underarms, or generalized',
    symptomIds: [
      'hh-palmar', 'hh-plantar', 'hh-axillary', 'hh-facial', 'hh-generalized',
      'hh-dripping-sweat', 'hh-paper-handling', 'hh-tool-handling', 'hh-keyboard-difficulty',
      'hh-handshake-avoidance', 'hh-clothing-changes', 'hh-skin-maceration', 'hh-fungal-infections',
      'hh-antiperspirant', 'hh-iontophoresis', 'hh-botox', 'hh-oral-medication', 'hh-surgery',
      'hh-therapy-responsive', 'hh-therapy-unresponsive', 'hh-occupational-impact'
    ],
  },

  // ========== PHASE 6B: SKIN CONDITIONS - ADDITIONAL ==========

  DISCOID_LUPUS: {
    id: 'discoid-lupus',
    name: 'Discoid Lupus Erythematosus',
    diagnosticCode: '7809',
    cfrReference: '38 CFR 4.118',
    description: 'Chronic skin condition causing discoid lesions, scarring, and photosensitivity',
    symptomIds: [
      'dle-discoid-lesions', 'dle-erythematous-plaques', 'dle-scarring', 'dle-hyperpigmentation',
      'dle-hypopigmentation', 'dle-scalp-involvement', 'dle-ear-involvement', 'dle-face-involvement',
      'dle-photosensitivity', 'dle-follicular-plugging', 'dle-under5-body', 'dle-5to20-body',
      'dle-20to40-body', 'dle-over40-body', 'dle-topical-only', 'dle-systemic-intermittent',
      'dle-systemic-6weeks', 'dle-systemic-constant'
    ],
  },

  BULLOUS_DISORDERS: {
    id: 'bullous-disorders',
    name: 'Bullous Disorders',
    diagnosticCode: '7815',
    cfrReference: '38 CFR 4.118',
    description: 'Blistering skin conditions including pemphigus, bullous pemphigoid, dermatitis herpetiformis',
    symptomIds: [
      'bullous-blisters', 'bullous-erosions', 'bullous-crusting', 'bullous-nikolsky-sign',
      'bullous-oral-mucosal', 'bullous-ocular', 'bullous-gi-involvement', 'bullous-genital',
      'bullous-itching', 'bullous-burning', 'bullous-scarring', 'bullous-under5-body',
      'bullous-5to20-body', 'bullous-20to40-body', 'bullous-over40-body', 'bullous-topical-only',
      'bullous-systemic-intermittent', 'bullous-systemic-6weeks', 'bullous-systemic-constant'
    ],
  },

  CUTANEOUS_VASCULITIS: {
    id: 'cutaneous-vasculitis',
    name: 'Primary Cutaneous Vasculitis',
    diagnosticCode: '7826',
    cfrReference: '38 CFR 4.118',
    description: 'Inflammation of blood vessels in skin causing purpura, ulcers, and tissue damage',
    symptomIds: [
      'cv-purpura', 'cv-petechiae', 'cv-ulcers', 'cv-nodules', 'cv-livedo-reticularis',
      'cv-necrosis', 'cv-episode-documented', 'cv-episodes-1to3', 'cv-episodes-4plus',
      'cv-no-systemic-med', 'cv-continuous-systemic', 'cv-intermittent-immuno',
      'cv-refractory', 'cv-scarring', 'cv-disfigurement'
    ],
  },

  DERMATOPHYTOSIS: {
    id: 'dermatophytosis',
    name: 'Dermatophytosis',
    diagnosticCode: '7813',
    cfrReference: '38 CFR 4.118',
    description: 'Fungal skin infections including ringworm, athlete\'s foot, jock itch, nail fungus',
    symptomIds: [
      'derm-tinea-corporis', 'derm-tinea-capitis', 'derm-tinea-pedis', 'derm-tinea-cruris',
      'derm-tinea-barbae', 'derm-onychomycosis', 'derm-tinea-versicolor', 'derm-scaling',
      'derm-itching', 'derm-ring-pattern', 'derm-hair-loss', 'derm-nail-thickening',
      'derm-recurrent', 'derm-under5-body', 'derm-5to20-body', 'derm-20to40-body',
      'derm-over40-body', 'derm-topical-only', 'derm-systemic-intermittent',
      'derm-systemic-6weeks', 'derm-systemic-constant'
    ],
  },

  SKIN_INFECTIONS: {
    id: 'skin-infections',
    name: 'Skin Infections',
    diagnosticCode: '7820',
    cfrReference: '38 CFR 4.118',
    description: 'Bacterial, viral, fungal, or parasitic skin infections not listed elsewhere',
    symptomIds: [
      'skinf-bacterial', 'skinf-cellulitis', 'skinf-abscess', 'skinf-impetigo',
      'skinf-folliculitis', 'skinf-viral', 'skinf-herpes-simplex', 'skinf-herpes-zoster',
      'skinf-warts', 'skinf-molluscum', 'skinf-parasitic', 'skinf-recurrent',
      'skinf-under5-body', 'skinf-5to20-body', 'skinf-20to40-body', 'skinf-over40-body',
      'skinf-topical-only', 'skinf-systemic-intermittent', 'skinf-systemic-6weeks',
      'skinf-systemic-constant'
    ],
  },
  // ============================================
  // PHASE 7A: EYE CONDITIONS
  // ============================================

  // DC 6000: Uveitis / Choroidopathy
  // Includes: uveitis, iritis, cyclitis, choroiditis
  // Rated under General Rating Formula for Diseases of the Eye
  UVEITIS: {
    id: 'uveitis',
    name: 'Uveitis / Choroidopathy',
    diagnosticCode: '6000',
    cfrReference: '38 CFR 4.79',
    symptomIds: [
      'uveitis-eye-pain', 'uveitis-redness', 'uveitis-light-sensitivity', 'uveitis-floaters',
      'uveitis-blurred-vision', 'uveitis-vision-changes', 'uveitis-tearing', 'uveitis-small-pupil',
      'uveitis-anterior', 'uveitis-intermediate', 'uveitis-posterior', 'uveitis-panuveitis',
      'uveitis-unilateral', 'uveitis-bilateral',
      'uveitis-treatment-visit', 'uveitis-episodes-1to2', 'uveitis-episodes-3to4',
      'uveitis-episodes-5to6', 'uveitis-episodes-7plus',
      'uveitis-steroid-drops', 'uveitis-dilating-drops', 'uveitis-oral-steroids',
      'uveitis-immunosuppressants', 'uveitis-biologic-agents', 'uveitis-intravitreal-injection',
      'uveitis-periocular-injection', 'uveitis-laser-treatment', 'uveitis-surgery',
      'uveitis-glaucoma', 'uveitis-cataract', 'uveitis-macular-edema', 'uveitis-synechiae',
      'uveitis-chronic', 'uveitis-visual-acuity-decreased', 'uveitis-visual-field-loss',
    ],
  },

  // DC 6001: Keratitis / Keratopathy
  // Corneal inflammation/disease
  // Rated under General Rating Formula for Diseases of the Eye
  KERATITIS: {
    id: 'keratitis',
    name: 'Keratitis / Keratopathy',
    diagnosticCode: '6001',
    cfrReference: '38 CFR 4.79',
    symptomIds: [
      'keratitis-eye-pain', 'keratitis-redness', 'keratitis-light-sensitivity', 'keratitis-tearing',
      'keratitis-blurred-vision', 'keratitis-foreign-body', 'keratitis-discharge',
      'keratitis-eyelid-swelling', 'keratitis-difficulty-opening',
      'keratitis-bacterial', 'keratitis-viral', 'keratitis-fungal', 'keratitis-acanthamoeba',
      'keratitis-exposure', 'keratitis-neurotrophic',
      'keratitis-unilateral', 'keratitis-bilateral',
      'keratitis-treatment-visit', 'keratitis-episodes-1to2', 'keratitis-episodes-3to4',
      'keratitis-episodes-5to6', 'keratitis-episodes-7plus',
      'keratitis-antibiotic-drops', 'keratitis-antiviral-drops', 'keratitis-antifungal-drops',
      'keratitis-steroid-drops', 'keratitis-oral-antivirals', 'keratitis-bandage-lens',
      'keratitis-corneal-scraping', 'keratitis-corneal-transplant',
      'keratitis-corneal-ulcer', 'keratitis-corneal-scarring', 'keratitis-corneal-perforation',
      'keratitis-chronic-recurrent', 'keratitis-visual-acuity-decreased', 'keratitis-glare-sensitivity',
    ],
  },

  // DC 6018: Chronic Conjunctivitis (Nontrachomatous)
  // Active: General Rating Formula, minimum 10%
  // Inactive: Rate based on residuals (visual impairment, disfigurement)
  CHRONIC_CONJUNCTIVITIS: {
    id: 'chronic-conjunctivitis',
    name: 'Chronic Conjunctivitis',
    diagnosticCode: '6018',
    cfrReference: '38 CFR 4.79',
    symptomIds: [
      'conj-redness', 'conj-discharge', 'conj-itching', 'conj-burning', 'conj-gritty',
      'conj-tearing', 'conj-crusting', 'conj-swelling', 'conj-light-sensitivity', 'conj-blurred-vision',
      'conj-allergic', 'conj-bacterial', 'conj-viral', 'conj-giant-papillary', 'conj-atopic',
      'conj-active', 'conj-inactive', 'conj-chronic', 'conj-recurrent',
      'conj-unilateral', 'conj-bilateral',
      'conj-treatment-visit', 'conj-episodes-1to2', 'conj-episodes-3to4',
      'conj-episodes-5to6', 'conj-episodes-7plus',
      'conj-artificial-tears', 'conj-antihistamine-drops', 'conj-mast-cell-stabilizer',
      'conj-antibiotic-drops', 'conj-steroid-drops', 'conj-immunomodulator', 'conj-oral-antihistamines',
      'conj-scarring', 'conj-symblepharon', 'conj-dry-eye', 'conj-disfigurement', 'conj-visual-impairment',
    ],
  },

  // DC 6002: Scleritis
  // Inflammation of the sclera
  // Rated under General Rating Formula for Diseases of the Eye
  SCLERITIS: {
    id: 'scleritis',
    name: 'Scleritis',
    diagnosticCode: '6002',
    cfrReference: '38 CFR 4.79',
    symptomIds: [
      'scleritis-deep-pain', 'scleritis-redness', 'scleritis-tenderness', 'scleritis-pain-radiating',
      'scleritis-pain-at-night', 'scleritis-light-sensitivity', 'scleritis-tearing',
      'scleritis-blurred-vision', 'scleritis-vision-changes',
      'scleritis-anterior-diffuse', 'scleritis-anterior-nodular', 'scleritis-necrotizing', 'scleritis-posterior',
      'scleritis-unilateral', 'scleritis-bilateral',
      'scleritis-autoimmune', 'scleritis-infectious',
      'scleritis-treatment-visit', 'scleritis-episodes-1to2', 'scleritis-episodes-3to4',
      'scleritis-episodes-5to6', 'scleritis-episodes-7plus',
      'scleritis-nsaid-oral', 'scleritis-oral-steroids', 'scleritis-immunosuppressants',
      'scleritis-biologic-agents', 'scleritis-subconjunctival-injection', 'scleritis-surgery',
      'scleritis-scleral-thinning', 'scleritis-scleromalacia', 'scleritis-uveitis',
      'scleritis-glaucoma', 'scleritis-cataract', 'scleritis-chronic-recurrent',
      'scleritis-visual-acuity-decreased', 'scleritis-vision-loss-permanent',
    ],
  },

  // ============================================
  // PHASE 7B: EAR CONDITIONS
  // ============================================

  PERIPHERAL_VESTIBULAR: {
    id: 'peripheral-vestibular',
    name: 'Peripheral Vestibular Disorders',
    diagnosticCode: '6204',
    cfrReference: '38 CFR 4.87',
    description: 'Peripheral vestibular disorders causing dizziness and balance problems',
    symptomIds: [
      'vest-vertigo', 'vest-dizziness', 'vest-staggering', 'vest-imbalance', 'vest-nausea',
      'vest-nystagmus', 'vest-spatial-disorientation', 'vest-motion-sensitivity', 'vest-occasional',
      'vest-frequent', 'vest-with-staggering', 'vest-fall-risk', 'vest-driving-affected',
      'vest-work-affected', 'vest-daily-activities', 'vest-position-triggered', 'vest-standing-triggered',
      'vest-visual-trigger', 'vest-medication', 'vest-physical-therapy', 'vest-procedure'
    ],
  },

  CHRONIC_SUPPURATIVE_OTITIS_MEDIA: {
    id: 'chronic-suppurative-otitis-media',
    name: 'Chronic Suppurative Otitis Media',
    diagnosticCode: '6200',
    cfrReference: '38 CFR 4.87',
    description: 'Chronic middle ear infection with drainage - includes mastoiditis and cholesteatoma',
    symptomIds: [
      'csom-ear-drainage', 'csom-suppuration', 'csom-aural-polyp', 'csom-ear-pain', 'csom-hearing-change',
      'csom-ear-fullness', 'csom-foul-odor', 'csom-tympanic-perforation', 'csom-right-ear', 'csom-left-ear',
      'csom-bilateral', 'csom-labyrinthitis', 'csom-tinnitus', 'csom-facial-paralysis', 'csom-bone-loss',
      'csom-cholesteatoma', 'csom-mastoiditis', 'csom-ear-drops', 'csom-oral-antibiotics', 'csom-ear-cleaning',
      'csom-surgery', 'csom-tube-placement'
    ],
  },

  CHRONIC_OTITIS_EXTERNA: {
    id: 'chronic-otitis-externa',
    name: 'Chronic Otitis Externa',
    diagnosticCode: '6210',
    cfrReference: '38 CFR 4.87',
    description: 'Chronic inflammation of the external ear canal',
    symptomIds: [
      'coe-swelling', 'coe-dry-scaly', 'coe-serous-discharge', 'coe-itching', 'coe-ear-pain',
      'coe-tenderness', 'coe-redness', 'coe-debris', 'coe-right-ear', 'coe-left-ear', 'coe-bilateral',
      'coe-frequent-treatment', 'coe-prolonged-treatment', 'coe-ear-drops', 'coe-oral-medication',
      'coe-ear-cleaning', 'coe-bacterial', 'coe-fungal', 'coe-eczematous', 'coe-chronic'
    ],
  },

  CHRONIC_NONSUPPURATIVE_OTITIS_MEDIA: {
    id: 'chronic-nonsuppurative-otitis-media',
    name: 'Chronic Nonsuppurative Otitis Media',
    diagnosticCode: '6201',
    cfrReference: '38 CFR 4.87',
    description: 'Chronic middle ear effusion (serous otitis media) - rate hearing impairment',
    symptomIds: [
      'cnsom-ear-fullness', 'cnsom-fluid-sensation', 'cnsom-hearing-loss', 'cnsom-muffled-hearing',
      'cnsom-popping-clicking', 'cnsom-ear-discomfort', 'cnsom-balance-issues', 'cnsom-tinnitus',
      'cnsom-right-ear', 'cnsom-left-ear', 'cnsom-bilateral', 'cnsom-chronic', 'cnsom-recurrent',
      'cnsom-persistent', 'cnsom-decongestants', 'cnsom-antihistamines', 'cnsom-nasal-steroids',
      'cnsom-tubes', 'cnsom-monitoring'
    ],
  },

};
// ============================================
// MIGRAINE RATING CRITERIA (DC 8100)
// ============================================

export const MIGRAINE_CRITERIA = {
  diagnosticCode: '8100',
  condition: 'Migraine',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8100',

  ratings: [
    {
      percent: 50,
      summary: 'Very frequent, completely prostrating and prolonged attacks with severe economic inadaptability',
      criteria: {
        prostrating: true,
        prolonged: true,
        frequencyPerMonth: 4,
        economicImpact: 'severe',
      },
      criteriaDescription: [
        'Very frequent attacks (typically 4+ per month)',
        'Completely prostrating (unable to function)',
        'Prolonged duration (4+ hours)',
        'Productive of severe economic inadaptability',
      ],
      evidenceNeeded: [
        'Consistent logging of prostrating migraines',
        'Duration recorded as 4+ hours',
        'Frequency of approximately weekly or more',
        'Documentation of work impact (missed days, reduced productivity)',
      ],
    },
    {
      percent: 30,
      summary: 'Characteristic prostrating attacks averaging once a month',
      criteria: {
        prostrating: true,
        minAttacksPerMonth: 1,
        maxAttacksPerMonth: 3.99,
        evaluationPeriodMonths: 3,
      },
      criteriaDescription: [
        'Characteristic prostrating attacks',
        'Occurring on average once a month',
        'Pattern sustained over several months',
      ],
      evidenceNeeded: [
        'Prostrating migraines logged at least once per month',
        'Consistent pattern over 3+ months',
        'Clear documentation that attacks are incapacitating',
      ],
    },
    {
      percent: 10,
      summary: 'Characteristic prostrating attacks averaging one in 2 months',
      criteria: {
        prostrating: true,
        minAttacksPerMonth: 0.5,
        maxAttacksPerMonth: 0.99,
        evaluationPeriodMonths: 3,
      },
      criteriaDescription: [
        'Characteristic prostrating attacks',
        'Averaging one attack every 2 months',
        'Pattern sustained over several months',
      ],
      evidenceNeeded: [
        'Prostrating migraines logged at least every other month',
        'Consistent pattern over evaluation period',
      ],
    },
    {
      percent: 0,
      summary: 'Less frequent attacks',
      criteria: {
        prostrating: false,
      },
      criteriaDescription: [
        'Non-prostrating migraines, OR',
        'Prostrating attacks less than once every 2 months',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    prostrating: {
      term: 'Prostrating',
      definition: 'An attack severe enough that you cannot perform normal daily activities. You may need to lie down in a dark room, miss work, or be unable to care for yourself or family during the episode.',
      examples: [
        'Unable to go to work',
        'Had to leave work early',
        'Could not care for children',
        'Confined to bed or dark room',
      ],
    },
    prolonged: {
      term: 'Prolonged',
      definition: 'An attack lasting an extended period of time, typically 4 or more hours.',
      threshold: '4+ hours',
    },
    economicInadaptability: {
      term: 'Severe Economic Inadaptability',
      definition: 'The migraines significantly interfere with your ability to work and earn income. This does not require total unemployability, but shows substantial impact on work capacity.',
      examples: [
        'Frequent missed work days',
        'Unable to maintain full-time employment',
        'Required job accommodations',
        'Lost job opportunities due to condition',
        'Reduced hours or income',
      ],
    },
    characteristicAttack: {
      term: 'Characteristic Attack',
      definition: 'A migraine with typical features such as throbbing pain, sensitivity to light/sound, nausea, or aura that is recognizably a migraine episode.',
    },
  },
};

// ============================================
// SLEEP APNEA RATING CRITERIA (DC 6847)
// ============================================

export const SLEEP_APNEA_CRITERIA = {
  diagnosticCode: '6847',
  condition: 'Sleep Apnea Syndromes (Obstructive, Central, Mixed)',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6847',

  ratings: [
    {
      percent: 100,
      summary: 'Chronic respiratory failure with carbon dioxide retention or cor pulmonale, or requires tracheostomy',
      criteria: {
        hasRespiratoryFailure: true,
        // OR
        hasCorPulmonale: true,
        // OR
        requiresTracheostomy: true,
      },
      criteriaDescription: [
        'Chronic respiratory failure with carbon dioxide retention, OR',
        'Cor pulmonale (right heart failure from lung disease), OR',
        'Requires tracheostomy',
      ],
      evidenceNeeded: [
        'Medical diagnosis of chronic respiratory failure',
        'Documentation of carbon dioxide retention',
        'Diagnosis of cor pulmonale',
        'Tracheostomy procedure records',
      ],
    },
    {
      percent: 50,
      summary: 'Requires use of breathing assistance device such as CPAP machine',
      criteria: {
        usesBreathingDevice: true,
      },
      criteriaDescription: [
        'Requires use of breathing assistance device',
        'Examples: CPAP, BiPAP, APAP, or similar',
        'Device prescribed for sleep apnea treatment',
      ],
      evidenceNeeded: [
        'CPAP/BiPAP prescription from physician',
        'Sleep study (polysomnography) results',
        'Documentation of regular device usage',
        'Equipment records from DME provider',
      ],
    },
    {
      percent: 30,
      summary: 'Persistent daytime hypersomnolence',
      criteria: {
        hasDaytimeHypersomnolence: true,
        usesBreathingDevice: false,
      },
      criteriaDescription: [
        'Persistent daytime sleepiness/hypersomnolence',
        'Not currently using breathing assistance device',
        'Sleepiness interferes with daily activities',
      ],
      evidenceNeeded: [
        'Documentation of excessive daytime sleepiness',
        'Sleep study confirming sleep apnea diagnosis',
        'Records showing impact on daily functioning',
        'Epworth Sleepiness Scale scores if available',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic but with documented sleep disorder breathing',
      criteria: {
        hasDiagnosis: true,
        isAsymptomatic: true,
      },
      criteriaDescription: [
        'Sleep apnea diagnosed via sleep study',
        'Currently asymptomatic',
        'No daytime sleepiness',
        'Not requiring breathing device',
      ],
      evidenceNeeded: [
        'Sleep study documenting sleep disorder breathing',
      ],
    },
  ],

  definitions: {
    breathingDevice: {
      term: 'Breathing Assistance Device',
      definition: 'A medical device prescribed to maintain open airways during sleep. The most common is a CPAP (Continuous Positive Airway Pressure) machine.',
      examples: [
        'CPAP (Continuous Positive Airway Pressure)',
        'BiPAP (Bilevel Positive Airway Pressure)',
        'APAP (Automatic Positive Airway Pressure)',
        'ASV (Adaptive Servo-Ventilation)',
        'Inspire implant (hypoglossal nerve stimulator)',
      ],
    },
    hypersomnolence: {
      term: 'Persistent Daytime Hypersomnolence',
      definition: 'Excessive daytime sleepiness that persists despite adequate opportunity for sleep. This goes beyond normal tiredness and significantly impacts daily functioning.',
      examples: [
        'Difficulty staying awake during work or driving',
        'Falling asleep during conversations or meetings',
        'Needing frequent naps to function',
        'Feeling unrefreshed despite sleeping',
        'Difficulty concentrating due to sleepiness',
      ],
    },
    corPulmonale: {
      term: 'Cor Pulmonale',
      definition: 'Right-sided heart failure caused by lung disease or pulmonary hypertension. This is a serious complication that can result from severe, untreated sleep apnea.',
    },
    respiratoryFailure: {
      term: 'Chronic Respiratory Failure',
      definition: 'A condition where the respiratory system cannot maintain adequate gas exchange, resulting in abnormal oxygen or carbon dioxide levels in the blood.',
    },
    sleepStudy: {
      term: 'Sleep Study (Polysomnography)',
      definition: 'An overnight test that records brain activity, eye movements, heart rate, blood pressure, oxygen levels, and breathing patterns to diagnose sleep disorders.',
    },
  },
};

// ============================================
// SHARED MENTAL HEALTH RATING CRITERIA
// ============================================
// All mental health conditions (DC 9201-9440) use the same General Rating Formula
// This shared criteria is referenced by PTSD, Depression, Anxiety, Bipolar, etc.

export const MENTAL_HEALTH_SHARED_CRITERIA = {
  ratingFormula: 'General Rating Formula for Mental Disorders',
  cfrReference: '38 CFR 4.130',
  ratingNote: 'All mental health conditions are rated under the General Rating Formula for Mental Disorders. Ratings consider the frequency, severity, and duration of symptoms, along with capacity for adjustment during remissions.',

  ratings: [
    {
      percent: 100,
      summary: 'Total occupational and social impairment',
      criteria: {
        level: 'total',
        functionalImpairment: 'severe',
      },
      criteriaDescription: [
        'Total occupational and social impairment due to symptoms such as:',
        ' Gross impairment in thought processes or communication',
        ' Persistent delusions or hallucinations',
        ' Grossly inappropriate behavior',
        ' Persistent danger of hurting self or others',
        ' Intermittent inability to perform activities of daily living',
        ' Disorientation to time or place',
        ' Memory loss for names of close relatives, own occupation, or own name',
      ],
    },
    {
      percent: 70,
      summary: 'Occupational and social impairment, with deficiencies in most areas',
      criteria: {
        level: 'severe',
        functionalImpairment: 'significant',
      },
      criteriaDescription: [
        'Occupational and social impairment with deficiencies in most areas such as:',
        ' Work, school, family relations, judgment, thinking, or mood',
        'Due to symptoms such as:',
        ' Suicidal ideation',
        ' Obsessional rituals which interfere with routine activities',
        ' Speech intermittently illogical, obscure, or irrelevant',
        ' Near-continuous panic or depression affecting ability to function',
        ' Impaired impulse control (unprovoked irritability with periods of violence)',
        ' Spatial disorientation',
        ' Neglect of personal appearance and hygiene',
        ' Difficulty adapting to stressful circumstances (including work)',
        ' Inability to establish and maintain effective relationships',
      ],
    },
    {
      percent: 50,
      summary: 'Occupational and social impairment with reduced reliability and productivity',
      criteria: {
        level: 'moderate',
        functionalImpairment: 'moderate',
      },
      criteriaDescription: [
        'Occupational and social impairment with reduced reliability and productivity due to symptoms such as:',
        ' Flattened affect',
        ' Circumstantial, circumlocutory, or stereotyped speech',
        ' Panic attacks more than once a week',
        ' Difficulty in understanding complex commands',
        ' Impairment of short- and long-term memory',
        ' Impaired judgment',
        ' Impaired abstract thinking',
        ' Disturbances of motivation and mood',
        ' Difficulty in establishing and maintaining effective work and social relationships',
      ],
    },
    {
      percent: 30,
      summary: 'Occupational and social impairment with occasional decrease in work efficiency',
      criteria: {
        level: 'mild-to-moderate',
        functionalImpairment: 'intermittent',
      },
      criteriaDescription: [
        'Occupational and social impairment with occasional decrease in work efficiency',
        'Intermittent periods of inability to perform occupational tasks',
        '(Generally functioning satisfactorily with routine behavior, self-care, and conversation normal)',
        'Due to symptoms such as:',
        ' Depressed mood, anxiety, suspiciousness',
        ' Panic attacks (weekly or less often)',
        ' Chronic sleep impairment',
        ' Mild memory loss (forgetting names, directions, recent events)',
      ],
    },
    {
      percent: 10,
      summary: 'Occupational and social impairment due to mild or transient symptoms',
      criteria: {
        level: 'mild',
        functionalImpairment: 'minimal',
      },
      criteriaDescription: [
        'Occupational and social impairment due to mild or transient symptoms which:',
        ' Decrease work efficiency and ability to perform tasks only during significant stress',
        'OR',
        ' Symptoms controlled by continuous medication',
      ],
    },
    {
      percent: 0,
      summary: 'Mental condition formally diagnosed, but symptoms not severe enough to interfere',
      criteria: {
        level: 'minimal-none',
        functionalImpairment: 'none',
      },
      criteriaDescription: [
        'A mental condition has been formally diagnosed, but symptoms are not severe enough either to:',
        ' Interfere with occupational and social functioning',
        'OR',
        ' Require continuous medication',
      ],
    },
  ],

  definitions: {
    generalRatingFormula: {
      term: 'General Rating Formula for Mental Disorders',
      definition: 'All mental health conditions are rated based on level of functional impairment in occupational and social settings, not just by counting symptoms. The VA considers frequency, severity, duration of symptoms, and capacity for adjustment.',
    },
    occupationalImpairment: {
      term: 'Occupational Impairment',
      definition: 'Difficulty maintaining employment, reduced productivity, problems with attendance, inability to complete tasks, or difficulty working with others.',
    },
    socialImpairment: {
      term: 'Social Impairment',
      definition: 'Difficulty maintaining relationships, social isolation, problems with family interactions, inability to participate in social activities, or inappropriate social behavior.',
    },
    suicidalIdeation: {
      term: 'Suicidal Ideation',
      definition: 'Thoughts about suicide or self-harm. This is a serious symptom requiring immediate professional attention. If experiencing suicidal thoughts, call the Veterans Crisis Line: 988 then Press 1.',
    },
  },

  importantNotes: [
    'Mental health ratings are based on overall functional impairment, not symptom count',
    'The VA considers how symptoms affect work and social functioning',
    'Higher ratings require persistent symptoms, not just occasional episodes',
    'Medical documentation from mental health providers is critical',
    'Treatment records should demonstrate consistency of symptoms over time',
    'A formal diagnosis from a qualified provider is required',
  ],
};

// ============================================
// PTSD RATING CRITERIA (DC 9411)
// ============================================
// PTSD is rated using the General Rating Formula for Mental Disorders
// Focus is on occupational and social impairment, not just symptom frequency

export const PTSD_CRITERIA = {
  diagnosticCode: '9411',
  condition: 'Posttraumatic Stress Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9411',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,

  // PTSD-specific ratings reference shared criteria
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings.map(rating => ({
    ...rating,
    evidenceNeeded: getPTSDEvidenceNeeded(rating.percent),
    gaps: getPTSDGaps(rating.percent),
  })),

  // PTSD-specific definitions (in addition to shared ones)
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    panicAttack: {
      term: 'Panic Attack',
      definition: 'A discrete period of intense fear or discomfort with physical symptoms such as rapid heartbeat, sweating, trembling, shortness of breath, chest pain, nausea, dizziness, or fear of losing control.',
    },
  },

  importantNotes: MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
};

// Helper function for PTSD evidence needed
function getPTSDEvidenceNeeded(percent) {
  const evidenceMap = {
    100: [
      'Medical documentation of severe functional impairment',
      'Treatment records showing persistence of severe symptoms',
      'Evidence of inability to maintain employment',
      'Documentation of impact on self-care and daily activities',
      'Mental health provider statements on level of impairment',
      'Hospitalization records if applicable',
    ],
    70: [
      'Medical records documenting specific symptoms from criteria list',
      'Treatment records showing frequency and severity of symptoms',
      'Documentation of work difficulties or inability to maintain employment',
      'Evidence of relationship problems or social isolation',
      'Mental health provider statements on functional limitations',
      'Logged symptoms showing pattern of severe impairment',
    ],
    50: [
      'Documentation of panic attacks (weekly or more frequent)',
      'Medical records noting memory, judgment, or cognitive issues',
      'Evidence of reduced work productivity',
      'Treatment records showing consistent symptom pattern',
      'Statements from providers about functional limitations',
      'Logged symptoms demonstrating frequency and impact',
    ],
    30: [
      'Medical documentation of PTSD diagnosis',
      'Treatment records showing ongoing symptoms',
      'Documentation of occasional work difficulties',
      'Evidence of panic attacks (up to weekly)',
      'Sleep logs showing chronic impairment',
      'Provider statements on functional impact',
    ],
    10: [
      'Medical documentation of PTSD diagnosis',
      'Treatment records',
      'Medication management records',
      'Documentation that symptoms are mild or medication-controlled',
    ],
    0: ['Formal diagnosis documentation'],
  };
  return evidenceMap[percent] || [];
}

// Helper function for PTSD documentation gaps
function getPTSDGaps(percent) {
  const gapsMap = {
    100: {
      treatmentRecords: 'Regular mental health treatment records documenting severity',
      functionalAssessment: 'Detailed assessment of work and social functioning limitations',
      persistentSymptoms: 'Documentation showing symptoms are persistent, not episodic',
    },
    70: {
      specificSymptoms: 'Document which specific symptoms from the criteria are present',
      workImpact: 'Evidence of how symptoms affect work performance',
      socialImpact: 'Documentation of relationship and social functioning difficulties',
      continuity: 'Continuous treatment records showing persistent symptoms',
    },
    50: {
      panicFrequency: 'Log panic attacks to show they occur more than once weekly',
      cognitiveIssues: 'Document memory, concentration, or judgment difficulties',
      workReliability: 'Evidence of reduced productivity or attendance issues',
      relationshipImpact: 'Documentation of difficulty maintaining relationships',
    },
    30: {
      diagnosis: 'Formal PTSD diagnosis from qualified mental health provider',
      treatment: 'Regular mental health treatment records',
      sleepImpact: 'Consistent logging of sleep disturbances',
      workImpact: 'Documentation of occasional work performance issues',
    },
    10: {
      diagnosis: 'Formal PTSD diagnosis documentation',
      treatment: 'Ongoing treatment or medication management records',
    },
    0: {},
  };
  return gapsMap[percent] || {};
}

// ============================================
// MAJOR DEPRESSIVE DISORDER CRITERIA (DC 9434)
// ============================================

export const MAJOR_DEPRESSION_CRITERIA = {
  diagnosticCode: '9434',
  condition: 'Major Depressive Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9434',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: MENTAL_HEALTH_SHARED_CRITERIA.definitions,
  importantNotes: MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
};

// ============================================
// GENERALIZED ANXIETY DISORDER CRITERIA (DC 9400)
// ============================================

export const GENERALIZED_ANXIETY_CRITERIA = {
  diagnosticCode: '9400',
  condition: 'Generalized Anxiety Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9400',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: MENTAL_HEALTH_SHARED_CRITERIA.definitions,
  importantNotes: MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
};

// ============================================
// PANIC DISORDER CRITERIA (DC 9412)
// ============================================

export const PANIC_DISORDER_CRITERIA = {
  diagnosticCode: '9412',
  condition: 'Panic Disorder and/or Agoraphobia',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9412',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    panicAttack: {
      term: 'Panic Attack',
      definition: 'A discrete period of intense fear or discomfort with physical symptoms such as rapid heartbeat, sweating, trembling, shortness of breath, chest pain, nausea, dizziness, or fear of losing control.',
    },
    agoraphobia: {
      term: 'Agoraphobia',
      definition: 'Fear or anxiety about situations where escape might be difficult or help unavailable if panic symptoms occur. Often leads to avoidance of places like crowds, public transportation, or open spaces.',
    },
  },
  importantNotes: MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
};

// ============================================
// BIPOLAR DISORDER CRITERIA (DC 9432)
// ============================================

export const BIPOLAR_CRITERIA = {
  diagnosticCode: '9432',
  condition: 'Bipolar Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9432',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    manicEpisode: {
      term: 'Manic Episode',
      definition: 'A distinct period of abnormally and persistently elevated, expansive, or irritable mood and increased energy, lasting at least one week, causing significant impairment in functioning.',
    },
    depressiveEpisode: {
      term: 'Depressive Episode',
      definition: 'A period of depressed mood or loss of interest/pleasure in activities, along with other symptoms like sleep changes, energy loss, or concentration difficulties, lasting at least two weeks.',
    },
  },
  importantNotes: MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
};

// ============================================
// SOCIAL ANXIETY DISORDER CRITERIA (DC 9403)
// ============================================

export const SOCIAL_ANXIETY_CRITERIA = {
    diagnosticCode: '9403',
    condition: 'Social Anxiety Disorder',
    cfrReference: '38 CFR 4.130, Diagnostic Code 9403',
    usesSharedCriteria: true,
    sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
    ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
    definitions: {
        ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
        socialAnxiety: {
            term: 'Social Anxiety',
            definition: 'Marked fear or anxiety about social situations where the individual may be scrutinized by others, leading to avoidance or endured with intense distress.',
        },
        performanceAnxiety: {
            term: 'Performance Anxiety',
            definition: 'Fear specifically related to performing or being observed during activities like public speaking, eating, or writing in front of others.',
        },
    },
    importantNotes: MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
};

// ============================================
// OBSESSIVE-COMPULSIVE DISORDER CRITERIA (DC 9404)
// ============================================

export const OCD_CRITERIA = {
    diagnosticCode: '9404',
    condition: 'Obsessive-Compulsive Disorder',
    cfrReference: '38 CFR 4.130, Diagnostic Code 9404',
    usesSharedCriteria: true,
    sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
    ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
    definitions: {
        ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
        obsessions: {
            term: 'Obsessions',
            definition: 'Recurrent, persistent, intrusive thoughts, urges, or images that cause marked anxiety or distress. The individual attempts to ignore, suppress, or neutralize them.',
        },
        compulsions: {
            term: 'Compulsions',
            definition: 'Repetitive behaviors or mental acts performed in response to obsessions or according to rigid rules, aimed at reducing anxiety or preventing a dreaded event.',
        },
        rituals: {
            term: 'Rituals',
            definition: 'Repetitive, stereotyped behaviors that interfere with routine activities. VA criteria specifically note "obsessional rituals which interfere with routine activities" as a 70% criterion.',
        },
    },
    importantNotes: [
        ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
        'OCD rituals that interfere with routine activities are specifically mentioned in the 70% criteria',
        'Time spent on obsessions/compulsions is important documentation',
    ],
};

// ============================================
// PERSISTENT DEPRESSIVE DISORDER (DYSTHYMIA) CRITERIA (DC 9433)
// ============================================

export const PERSISTENT_DEPRESSIVE_CRITERIA = {
    diagnosticCode: '9433',
    condition: 'Persistent Depressive Disorder (Dysthymia)',
    cfrReference: '38 CFR 4.130, Diagnostic Code 9433',
    usesSharedCriteria: true,
    sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
    ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
    definitions: {
        ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
        dysthymia: {
            term: 'Dysthymia/Persistent Depressive Disorder',
            definition: 'Chronic depressed mood occurring more days than not for at least 2 years. Less severe than major depression but more chronic and persistent.',
        },
    },
    importantNotes: [
        ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
        'Dysthymia is characterized by chronic, persistent symptoms rather than discrete episodes',
        'Documentation showing consistent symptoms over 2+ years strengthens claims',
    ],
};

// ============================================
// CHRONIC ADJUSTMENT DISORDER CRITERIA (DC 9440)
// ============================================

export const ADJUSTMENT_DISORDER_CRITERIA = {
    diagnosticCode: '9440',
    condition: 'Chronic Adjustment Disorder',
    cfrReference: '38 CFR 4.130, Diagnostic Code 9440',
    usesSharedCriteria: true,
    sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
    ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
    definitions: {
        ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
        adjustmentDisorder: {
            term: 'Adjustment Disorder',
            definition: 'Emotional or behavioral symptoms in response to an identifiable stressor, occurring within 3 months of the stressor. Symptoms are clinically significant and out of proportion to the stressor.',
        },
        chronicAdjustment: {
            term: 'Chronic Adjustment Disorder',
            definition: 'Adjustment disorder lasting 6 months or longer after the stressor or its consequences have ended. Often service-connected due to ongoing adjustment to post-military life.',
        },
    },
    importantNotes: [
        ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
        'Chronic adjustment disorder persists 6+ months after stressor',
        'Common in Veterans adjusting to civilian life or dealing with service-related changes',
    ],
};

// ============================================
// UNSPECIFIED ANXIETY DISORDER CRITERIA (DC 9413)
// ============================================

export const UNSPECIFIED_ANXIETY_CRITERIA = {
    diagnosticCode: '9413',
    condition: 'Unspecified Anxiety Disorder',
    cfrReference: '38 CFR 4.130, Diagnostic Code 9413',
    usesSharedCriteria: true,
    sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
    ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
    definitions: MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    importantNotes: [
        ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
        'Used when anxiety symptoms are present but do not meet full criteria for a specific anxiety disorder',
        'Rated using the same General Rating Formula as other anxiety disorders',
    ],
};

// ============================================
// UNSPECIFIED DEPRESSIVE DISORDER CRITERIA (DC 9435)
// ============================================

export const UNSPECIFIED_DEPRESSIVE_CRITERIA = {
    diagnosticCode: '9435',
    condition: 'Unspecified Depressive Disorder',
    cfrReference: '38 CFR 4.130, Diagnostic Code 9435',
    usesSharedCriteria: true,
    sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
    ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
    definitions: MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    importantNotes: [
        ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
        'Used when depressive symptoms are present but do not meet full criteria for a specific depressive disorder',
        'Rated using the same General Rating Formula as other depressive disorders',
    ],
};

// ============================================
// LUMBOSACRAL STRAIN / LOW BACK PAIN (DC 5237)
// ============================================

export const LUMBOSACRAL_STRAIN_CRITERIA = {
  diagnosticCode: '5237',
  condition: 'Lumbosacral Strain (Low Back Pain)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5237',

  ratings: [
    {
      percent: 100,
      summary: 'Unfavorable ankylosis of the entire spine',
      criteriaDescription: [
        'Complete fusion of the spine in an unfavorable position',
        'Extremely severe and disabling condition',
      ],
      evidenceNeeded: [
        'Medical imaging (X-ray, CT, MRI) showing complete spinal fusion',
        'Clinical examination documenting complete loss of spinal motion',
        'Inability to perform basic activities of daily living',
      ],
    },
    {
      percent: 50,
      summary: 'Unfavorable ankylosis of the entire thoracolumbar spine',
      criteriaDescription: [
        'Complete fusion of the low and mid back in unfavorable position',
        'Severe limitation of mobility',
      ],
      evidenceNeeded: [
        'Imaging showing thoracolumbar ankylosis',
        'Clinical ROM measurements showing no motion',
        'Documentation of significant functional impairment',
      ],
    },
    {
      percent: 40,
      summary: 'Forward flexion of thoracolumbar spine 30 degrees or less, OR favorable ankylosis',
      criteriaDescription: [
        'Forward flexion 30 or less (normal is 90)',
        'OR complete fusion in favorable (functional) position',
        'Significant but manageable limitation',
      ],
      evidenceNeeded: [
        'Range of motion measurements by healthcare provider',
        'Goniometer readings documenting limitation',
        'Consistent documentation over time',
      ],
    },
    {
      percent: 20,
      summary: 'Forward flexion 30-60 degrees, OR muscle spasm/guarding causing abnormal gait/spinal contour',
      criteriaDescription: [
        'Forward flexion between 30-60 (vs normal 90)',
        'OR combined ROM 120 or less (vs normal 240)',
        'OR muscle spasm severe enough to cause abnormal gait, scoliosis, or abnormal curvature',
      ],
      evidenceNeeded: [
        'ROM measurements showing limitation',
        'Clinical notes documenting muscle spasm or guarding',
        'Observation of abnormal gait or spinal contour',
        'Functional impact on daily activities',
      ],
    },
    {
      percent: 10,
      summary: 'Forward flexion 60-85 degrees, OR localized tenderness not causing abnormal gait',
      criteriaDescription: [
        'Forward flexion between 60-85 (vs normal 90)',
        'OR combined ROM 120-235 (vs normal 240)',
        'OR muscle spasm/guarding/tenderness without abnormal gait',
        'OR vertebral fracture with 50%+ height loss',
      ],
      evidenceNeeded: [
        'ROM measurements in the specified range',
        'Clinical examination notes',
        'Documentation of pain and functional limitations',
      ],
    },
    {
      percent: 0,
      summary: 'Mild limitation or symptoms controlled',
      criteriaDescription: [
        'Forward flexion greater than 85',
        'Minimal functional impact',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    forwardFlexion: {
      term: 'Forward Flexion',
      definition: 'Bending forward at the waist. Normal is 90 degrees (touching toes). Measured by healthcare provider using goniometer.',
    },
    ankylosis: {
      term: 'Ankylosis',
      definition: 'Complete fusion or fixation of a joint/spine segment. "Favorable" means in a functional position; "unfavorable" means in a non-functional position.',
    },
    muscleSpasm: {
      term: 'Muscle Spasm/Guarding',
      definition: 'Involuntary muscle contraction or protective muscle tensing. Severe enough to cause abnormal walking pattern or visible spinal curvature.',
    },
  },
};

// ============================================
// INTERVERTEBRAL DISC SYNDROME (DC 5243)
// ============================================

export const INTERVERTEBRAL_DISC_CRITERIA = {
  diagnosticCode: '5243',
  condition: 'Intervertebral Disc Syndrome',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5243',

  note: 'Assigned only when there is disc herniation with compression/irritation of adjacent nerve root. Evaluated either under General Rating Formula for Spine OR based on Incapacitating Episodes, whichever is higher.',

  ratingsIncapacitatingEpisodes: [
    {
      percent: 60,
      summary: '6+ weeks of incapacitating episodes in past 12 months',
      criteriaDescription: [
        'Total duration of incapacitating episodes: 6 weeks or more in past year',
        'Episodes require bed rest prescribed by physician',
        'Episodes require treatment by physician',
      ],
      evidenceNeeded: [
        'Medical records documenting each incapacitating episode',
        'Physician notes prescribing bed rest',
        'Treatment records for each episode',
        'Clear documentation of episode duration',
      ],
    },
    {
      percent: 40,
      summary: '4-6 weeks (but less than 6) of incapacitating episodes in past 12 months',
      criteriaDescription: [
        'Total duration: 4 weeks to less than 6 weeks in past year',
        'Requires physician-prescribed bed rest and treatment',
      ],
      evidenceNeeded: [
        'Documentation of each episode',
        'Physician orders for bed rest',
        'Treatment records',
      ],
    },
    {
      percent: 20,
      summary: '2-4 weeks (but less than 4) of incapacitating episodes in past 12 months',
      criteriaDescription: [
        'Total duration: 2 weeks to less than 4 weeks in past year',
        'Physician-prescribed bed rest and treatment required',
      ],
      evidenceNeeded: [
        'Episode documentation',
        'Bed rest orders',
        'Treatment records',
      ],
    },
    {
      percent: 10,
      summary: '1-2 weeks (but less than 2) of incapacitating episodes in past 12 months',
      criteriaDescription: [
        'Total duration: 1 week to less than 2 weeks in past year',
        'Physician-prescribed bed rest and treatment',
      ],
      evidenceNeeded: [
        'Episode documentation',
        'Physician orders',
        'Treatment records',
      ],
    },
  ],

  // Can also be rated under General Rating Formula for Spine (same as DC 5237)
  ratingsGeneralFormula: LUMBOSACRAL_STRAIN_CRITERIA.ratings,

  definitions: {
    incapacitatingEpisode: {
      term: 'Incapacitating Episode',
      definition: 'A period of acute signs and symptoms due to disc syndrome that requires bed rest prescribed by a physician AND treatment by a physician. Both requirements must be met.',
      emphasis: 'CRITICAL: Episodes are only counted if BOTH bed rest was prescribed AND treatment was provided by a physician.',
    },
    discHerniation: {
      term: 'Disc Herniation',
      definition: 'Bulging or rupture of the intervertebral disc causing compression or irritation of the adjacent nerve root. Must be confirmed by imaging (MRI/CT).',
    },
  },
};

// ============================================
// KNEE INSTABILITY (DC 5257)
// ============================================

export const KNEE_INSTABILITY_CRITERIA = {
  diagnosticCode: '5257',
  condition: 'Knee, Other Impairment (Instability)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5257',

  ratings: [
    {
      percent: 30,
      summary: 'Unrepaired/failed complete ligament tear + medical provider prescribes BOTH assistive device AND bracing',
      criteriaDescription: [
        'Complete ligament tear (unrepaired OR failed repair)',
        'Causing persistent instability',
        'Medical provider prescribes BOTH:',
        '  - Assistive device (cane, crutches, or walker) for ambulation',
        '  - AND knee brace for ambulation',
      ],
      evidenceNeeded: [
        'MRI or surgical records confirming complete ligament tear',
        'Documentation of failed repair (if applicable)',
        'Written prescription for assistive device',
        'Written prescription for knee brace',
        'Clinical notes documenting persistent instability',
      ],
    },
    {
      percent: 20,
      summary: 'Ligament injury + prescribed brace OR assistive device (but not both)',
      criteriaDescription: [
        'Sprain, incomplete tear, OR repaired complete tear causing persistent instability',
        'Medical provider prescribes brace OR assistive device',
        'OR: Unrepaired/failed complete tear + prescribed brace OR device (but not both)',
      ],
      evidenceNeeded: [
        'Imaging/surgical documentation of ligament injury',
        'Prescription for either brace OR assistive device',
        'Clinical documentation of instability',
      ],
    },
    {
      percent: 10,
      summary: 'Ligament injury with persistent instability, no prescription for brace/device required',
      criteriaDescription: [
        'Sprain, incomplete tear, OR complete tear (any repair status)',
        'Causing persistent instability',
        'No requirement for prescribed brace or assistive device',
      ],
      evidenceNeeded: [
        'Documentation of ligament injury',
        'Clinical examination showing instability',
        'Functional limitations documented',
      ],
    },
  ],

  definitions: {
    completeLigamentTear: {
      term: 'Complete Ligament Tear',
      definition: 'Full-thickness rupture of ligament (typically ACL, PCL, MCL, or LCL). Confirmed by MRI or surgical findings.',
    },
    persistentInstability: {
      term: 'Persistent Instability',
      definition: 'Ongoing knee giving way, buckling, or feeling unstable despite treatment. Documented by clinical examination showing positive instability tests (Lachman, drawer, etc.).',
    },
    assistiveDevice: {
      term: 'Assistive Device',
      definition: 'Cane(s), crutch(es), or walker prescribed by medical provider to aid in walking.',
    },
  },
};

// ============================================
// TRAUMATIC BRAIN INJURY (DC 8045)
// ============================================

export const TBI_CRITERIA = {
  diagnosticCode: '8045',
  condition: 'Residuals of Traumatic Brain Injury (TBI)',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8045',

  note: 'TBI is rated based on 3 main areas: (1) Cognitive impairment, (2) Emotional/behavioral (rated under mental disorders), (3) Physical residuals (rated under specific codes). This addresses cognitive impairment and subjective symptoms only.',

  ratings: [
    {
      percent: 100,
      summary: 'Total impairment - ANY facet rated as "Total"',
      criteriaDescription: [
        'If ANY of the 10 facets is rated as "Total," assign 100%',
        'Examples: Total occupational/social inadaptability, requires 24-hour supervision, completely unable to communicate',
      ],
      evidenceNeeded: [
        'Neuropsychological evaluation',
        'Comprehensive cognitive assessment',
        'Functional capacity evaluation',
        'Documentation of total impairment in at least one area',
      ],
    },
    {
      percent: 70,
      summary: 'Severe impairment - Highest facet rated as "3"',
      criteriaDescription: [
        'If highest facet level is "3" (and none are "Total")',
        'Examples: Severe memory impairment, severe difficulty with executive functions, requires supervision for safety',
      ],
      evidenceNeeded: [
        'Neuropsych testing showing severe deficits',
        'Documentation of functional limitations',
        'Clinical notes supporting severity',
      ],
    },
    {
      percent: 40,
      summary: 'Moderate impairment - Highest facet rated as "2"',
      criteriaDescription: [
        'If highest facet level is "2" (and none are "3" or "Total")',
        'Examples: Moderate memory problems, difficulty with complex tasks, some assistance needed',
      ],
      evidenceNeeded: [
        'Neuropsych testing showing moderate deficits',
        'Functional limitations documented',
        'Impact on daily activities',
      ],
    },
    {
      percent: 10,
      summary: 'Mild impairment - Highest facet rated as "1"',
      criteriaDescription: [
        'If highest facet level is "1" (and none are higher)',
        'Examples: Mild memory issues, occasional difficulty concentrating, minimal impact',
      ],
      evidenceNeeded: [
        'Clinical documentation of mild symptoms',
        'Some objective findings',
        'Minimal functional impact',
      ],
    },
    {
      percent: 0,
      summary: 'No compensable impairment - All facets rated as "0"',
      criteriaDescription: [
        'Diagnosed TBI but no current impairment in any facet',
        'Or symptoms not attributable to TBI',
      ],
      evidenceNeeded: [],
    },
  ],

  facets: {
    description: 'TBI is evaluated across 10 facets. Each facet is rated 0-3 or "Total". The highest single facet determines the overall rating.',
    list: [
      'Memory, attention, concentration, executive functions',
      'Judgment',
      'Social interaction',
      'Orientation',
      'Motor activity',
      'Visual-spatial orientation',
      'Subjective symptoms',
      'Neurobehavioral effects',
      'Communication',
      'Consciousness',
    ],
  },

  definitions: {
    cognitiveImpairment: {
      term: 'Cognitive Impairment',
      definition: 'Decreased memory, concentration, attention, and executive functions (goal setting, planning, organizing, problem solving, judgment, decision making).',
    },
    executiveFunctions: {
      term: 'Executive Functions',
      definition: 'Higher-level brain functions: goal setting, speed of processing, planning, organizing, prioritizing, self-monitoring, problem solving, judgment, decision making, spontaneity, flexibility.',
    },
    subjectiveSymptoms: {
      term: 'Subjective Symptoms',
      definition: 'Symptoms that may be the only residual of TBI: headaches, dizziness, fatigue, insomnia, mood changes. If these have a distinct diagnosis (e.g., migraine), rate under that specific code instead.',
    },
  },
};

// ============================================
// HYPERTENSION (DC 7101)
// ============================================

export const HYPERTENSION_CRITERIA = {
  diagnosticCode: '7101',
  condition: 'Hypertensive Vascular Disease (Hypertension)',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7101',

  note: 'Hypertension must be confirmed by readings taken 2+ times on at least 3 different days. "Predominantly" means more than half the time during the evaluation period.',

  ratings: [
    {
      percent: 60,
      summary: 'Diastolic pressure predominantly 130 or more',
      criteriaDescription: [
        'Diastolic (bottom number) 130+ mmHg',
        'Sustained over evaluation period',
        'More than half of readings show this level',
      ],
      evidenceNeeded: [
        'Multiple BP readings over time',
        'Readings from at least 3 different days',
        'Documentation showing sustained elevation',
        'Treatment records',
      ],
    },
    {
      percent: 40,
      summary: 'Diastolic pressure predominantly 120 or more',
      criteriaDescription: [
        'Diastolic 120+ mmHg',
        'More than half of readings at this level',
      ],
      evidenceNeeded: [
        'Serial BP measurements',
        'Readings from multiple dates',
        'Treatment documentation',
      ],
    },
    {
      percent: 20,
      summary: 'Diastolic predominantly 110+, OR systolic predominantly 200+',
      criteriaDescription: [
        'Diastolic 110+ mmHg, OR',
        'Systolic (top number) 200+ mmHg',
        'Sustained over evaluation period',
      ],
      evidenceNeeded: [
        'Multiple BP readings documenting elevation',
        'Treatment records',
      ],
    },
    {
      percent: 10,
      summary: 'Diastolic predominantly 100+, OR systolic predominantly 160+, OR requires continuous medication',
      criteriaDescription: [
        'Diastolic 100+ mmHg, OR',
        'Systolic 160+ mmHg, OR',
        'History of diastolic 100+ requiring continuous medication for control',
      ],
      evidenceNeeded: [
        'BP readings showing elevation',
        'Prescription records for antihypertensive medication',
        'Documentation of continuous medication requirement',
      ],
    },
    {
      percent: 0,
      summary: 'Controlled or below threshold',
      criteriaDescription: [
        'BP controlled below rating thresholds',
        'May be on medication but BP well-controlled',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    diastolic: {
      term: 'Diastolic Blood Pressure',
      definition: 'The bottom number in a BP reading (e.g., 120/80 - the "80"). Represents pressure when heart is resting between beats. Normal is below 80.',
    },
    systolic: {
      term: 'Systolic Blood Pressure',
      definition: 'The top number in a BP reading (e.g., 120/80 - the "120"). Represents pressure when heart contracts. Normal is below 120.',
    },
    predominantly: {
      term: 'Predominantly',
      definition: 'More than half the time during the evaluation period. For VA purposes, must be confirmed by readings taken 2+ times on at least 3 different days.',
    },
    continuousMedication: {
      term: 'Continuous Medication',
      definition: 'Ongoing daily medication to control blood pressure. Missing doses typically results in elevated readings.',
    },
  },
};

export const DIABETES_CRITERIA = {
  diagnosticCode: '7913',
  condition: 'Diabetes Mellitus',
  cfrReference: '38 CFR 4.119, Diagnostic Code 7913',

  ratings: [
    {
      percent: 100,
      summary: 'Requires more than one daily insulin injection with episodes requiring hospitalizations',
      criteria: {
        requiresInsulin: true,
        dailyInjections: 'multiple',
        restrictedDiet: true,
        ketoacidosisEpisodes: true,
        hospitalizationsPerYear: 3,
        progressiveLoss: true,
      },
      criteriaDescription: [
        'Requires more than one daily insulin injection',
        'Restricted diet required',
        'Episodes of ketoacidosis or hypoglycemic reactions requiring at least three hospitalizations per year OR weekly visits to diabetic care provider',
        'Progressive loss of weight and strength OR complications that would be compensable if separately evaluated',
      ],
      evidenceNeeded: [
        'Documentation of multiple daily insulin injections',
        'Record of hospitalizations for ketoacidosis or hypoglycemia',
        'Evidence of progressive weight loss or strength decline',
        'Glucose logs showing poor control despite treatment',
        'HbA1c consistently >9% indicating poor control',
      ],
    },
    {
      percent: 60,
      summary: 'Requires insulin with regulation of activities and episodes requiring hospitalization',
      criteria: {
        requiresInsulin: true,
        restrictedDiet: true,
        activityRegulation: true,
        ketoacidosisEpisodes: true,
        hospitalizationsPerYear: 1,
        complications: 'non-compensable',
      },
      criteriaDescription: [
        'Requires insulin and restricted diet',
        'Regulation of activities (avoidance of strenuous occupational and recreational activities)',
        'Episodes of ketoacidosis or hypoglycemic reactions requiring one or two hospitalizations per year OR twice monthly visits to diabetic care provider',
        'Plus complications that would not be compensable if separately evaluated',
      ],
      evidenceNeeded: [
        'Documentation of insulin requirement',
        'Record of 1-2 hospitalizations per year for diabetes complications',
        'Evidence of activity restrictions',
        'Glucose logs showing episodes of poor control',
        'HbA1c 7.5-9% indicating suboptimal control',
      ],
    },
    {
      percent: 40,
      summary: 'Requires insulin, restricted diet, and regulation of activities',
      criteria: {
        requiresInsulin: true,
        restrictedDiet: true,
        activityRegulation: true,
      },
      criteriaDescription: [
        'Requires insulin for control',
        'Requires restricted diet',
        'Requires regulation of activities (avoidance of strenuous work/exercise)',
      ],
      evidenceNeeded: [
        'Documentation of daily insulin use',
        'Evidence of dietary restrictions',
        'Documentation of activity limitations',
        'Glucose logs showing need for insulin',
        'HbA1c 7-7.5% with insulin therapy',
      ],
    },
    {
      percent: 20,
      summary: 'Requires insulin and restricted diet, OR oral medication and restricted diet',
      criteria: {
        requiresTreatment: true,
        restrictedDiet: true,
        options: ['insulin', 'oral-medication'],
      },
      criteriaDescription: [
        'Option 1: Requires insulin and restricted diet, OR',
        'Option 2: Requires oral hypoglycemic agent and restricted diet',
      ],
      evidenceNeeded: [
        'Documentation of insulin OR oral medication requirement',
        'Evidence of dietary restrictions',
        'Glucose logs showing medication is necessary',
        'HbA1c 6.5-7% with medication',
      ],
    },
    {
      percent: 10,
      summary: 'Requires restricted diet only',
      criteria: {
        restrictedDiet: true,
        noMedication: true,
      },
      criteriaDescription: [
        'Manageable by restricted diet alone',
        'Does not require medication for control',
      ],
      evidenceNeeded: [
        'Documentation of diabetes diagnosis',
        'Evidence of dietary modifications',
        'Glucose logs showing control with diet alone',
        'HbA1c <6.5% with diet only',
      ],
    },
    {
      percent: 0,
      compensable: true,
      summary: 'Requires evaluation - controlled by diet or medication',
      criteria: {
        diagnosed: true,
        controlled: true,
        requiresEvaluation: true,
      },
      criteriaDescription: [
        'Diabetes controlled by diet alone or diet with oral medication',
        'No documented episodes of hypoglycemia or hyperglycemia requiring medical attention',
      ],
      evidenceNeeded: [
        'Diagnosis documentation',
        'Treatment plan (diet/medication)',
        'Stable glucose control documented',
      ],
    },
    {
      percent: 0,
      compensable: false,
      summary: 'Diagnosed but asymptomatic',
      criteria: {
        diagnosed: true,
        asymptomatic: true,
      },
      criteriaDescription: [
        'Diabetes diagnosed but currently asymptomatic',
        'May not require treatment or only minimal intervention',
      ],
      evidenceNeeded: [
        'Diagnosis documentation',
      ],
    },
  ],

  definitions: {
    insulin: {
      term: 'Insulin Requirement',
      definition: 'Requires regular insulin injections (not oral medication) to control blood glucose. This is typically Type 1 diabetes or advanced Type 2 diabetes where oral medications are insufficient.',
      examples: [
        'Multiple daily injections (basal-bolus regimen)',
        'Single daily long-acting insulin',
        'Insulin pump therapy',
      ],
    },
    restrictedDiet: {
      term: 'Restricted Diet',
      definition: 'Requires adherence to specific dietary guidelines including carbohydrate counting, portion control, meal timing, and avoidance of certain foods to maintain glucose control.',
      examples: [
        'Carbohydrate counting for insulin dosing',
        'Consistent meal timing',
        'Limited simple sugars and refined carbohydrates',
        'Portion control requirements',
      ],
    },
    activityRegulation: {
      term: 'Regulation of Activities',
      definition: 'Must avoid strenuous occupational and recreational activities that could trigger severe hypoglycemia or hyperglycemia. Requires careful planning around physical exertion.',
      examples: [
        'Cannot perform heavy labor or intense exercise without medical supervision',
        'Must check glucose before, during, and after physical activity',
        'Limited ability to participate in strenuous sports',
        'Workplace accommodations needed for physical tasks',
      ],
    },
    ketoacidosis: {
      term: 'Ketoacidosis',
      definition: 'Diabetic ketoacidosis (DKA) is a serious complication where the body produces excess blood acids (ketones). Typically requires hospitalization for treatment with insulin and fluids.',
      examples: [
        'Blood glucose >250 mg/dL with ketones',
        'Symptoms: nausea, vomiting, abdominal pain, confusion',
        'Requires emergency medical treatment',
        'More common in Type 1 diabetes',
      ],
    },
    hypoglycemia: {
      term: 'Hypoglycemic Reactions',
      definition: 'Severe low blood sugar episodes requiring assistance from others or medical intervention. Not just feeling shaky or eating a snack - these are serious events.',
      examples: [
        'Blood glucose <40 mg/dL requiring glucagon injection',
        'Loss of consciousness or seizure from low blood sugar',
        'Requiring emergency room visit or hospitalization',
        'Unable to self-treat, needed assistance',
      ],
    },
    poorControl: {
      term: 'Poor Glycemic Control',
      definition: 'Consistently elevated blood glucose and HbA1c levels despite treatment efforts. HbA1c >9% indicates very poor control, 7.5-9% indicates suboptimal control.',
      examples: [
        'HbA1c >9% (very poor control)',
        'HbA1c 7.5-9% (suboptimal control)',
        'Frequent glucose readings >200 mg/dL',
        'Wide glucose variability (frequent highs and lows)',
      ],
    },
    goodControl: {
      term: 'Good Glycemic Control',
      definition: 'HbA1c <7% with most glucose readings in target range (70-180 mg/dL). Achieved through medication, diet, and lifestyle management.',
      examples: [
        'HbA1c <6.5% (excellent control)',
        'HbA1c 6.5-7% (good control)',
        'Most glucose readings 70-180 mg/dL',
        'Minimal glucose variability',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged glucose and HbA1c measurements. VA diabetes ratings consider insulin requirement, dietary restrictions, activity limitations, hospitalizations, and complications. A formal VA rating requires C&P examination and complete medical records review. Continue regular endocrinology care and glucose monitoring.',
};

export const IBS_CRITERIA = {
  diagnosticCode: '7319',
  condition: 'Irritable Bowel Syndrome',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7319',

  ratings: [
    {
      percent: 30,
      summary: 'Severe symptoms with diarrhea or alternating diarrhea and constipation, with frequent episodes of bowel disturbance and abdominal distress',
      criteria: {
        frequentEpisodes: true,
        severity: 'severe',
        bowelDisturbance: true,
        abdominalDistress: true,
      },
      criteriaDescription: [
        'Diarrhea, or alternating diarrhea and constipation',
        'Frequent episodes (multiple times per week)',
        'Bowel disturbance is persistent',
        'Associated abdominal distress',
      ],
      evidenceNeeded: [
        'Log diarrhea episodes multiple times per week',
        'Document alternating patterns if applicable',
        'Track abdominal pain/distress frequency',
        'Note impact on daily activities',
      ],
    },
    {
      percent: 10,
      summary: 'Moderate symptoms with disturbances of bowel function with occasional episodes',
      criteria: {
        occasionalEpisodes: true,
        severity: 'moderate',
        bowelDisturbance: true,
      },
      criteriaDescription: [
        'Disturbances of bowel function',
        'Occasional episodes (less frequent than severe)',
        'Moderate impact on daily life',
      ],
      evidenceNeeded: [
        'Log bowel disturbance episodes regularly',
        'Document frequency (at least weekly)',
        'Track associated symptoms',
      ],
    },
    {
      percent: 0,
      summary: 'Mild symptoms that are diet-controlled',
      criteria: {
        mildSymptoms: true,
        dietControlled: true,
      },
      criteriaDescription: [
        'Symptoms controlled with diet modifications',
        'Minimal impact on daily activities',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    frequentEpisodes: {
      term: 'Frequent Episodes',
      definition: 'Episodes occurring multiple times per week on a regular basis. Not isolated or rare occurrences.',
      examples: [
        '3-4 diarrhea episodes per week',
        'Daily alternating constipation/diarrhea',
        'Multiple bowel disturbances weekly',
      ],
    },
    diarrhea: {
      term: 'Diarrhea',
      definition: 'Loose or watery stools occurring frequently. For IBS rating, this must be a persistent pattern, not isolated incidents.',
      examples: [
        'Loose stools 3+ times daily',
        'Urgent bowel movements',
        'Inability to control bowel movements',
      ],
    },
    abdominalDistress: {
      term: 'Abdominal Distress',
      definition: 'Pain, cramping, bloating, or discomfort in the abdomen associated with bowel disturbances.',
      examples: [
        'Cramping before bowel movements',
        'Persistent bloating',
        'Abdominal pain relieved by bowel movement',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged IBS symptoms. VA rating requires documented diagnosis and pattern of symptoms over time. Continue gastroenterology care and maintain symptom diary for claim support.',
};

// ============================================
// GERD RATING CRITERIA (DC 7346)
// ============================================

export const GERD_CRITERIA = {
  diagnosticCode: '7346',
  condition: 'Gastroesophageal Reflux Disease (GERD)',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7346',

  ratings: [
    {
      percent: 60,
      summary: 'Symptoms of pain, vomiting, material weight loss and hematemesis or melena with moderate anemia; or other symptom combinations productive of severe impairment of health',
      criteria: {
        pain: true,
        vomiting: true,
        weightLoss: true,
        bleeding: true, // hematemesis or melena
        anemia: true,
        severeImpairment: true,
      },
      criteriaDescription: [
        'Persistent pain',
        'Frequent vomiting',
        'Material weight loss documented',
        'Evidence of bleeding (hematemesis or melena)',
        'Moderate anemia present',
        'Severe impairment of overall health',
      ],
      evidenceNeeded: [
        'Medical documentation of weight loss',
        'Evidence of bleeding complications',
        'Lab results showing anemia',
        'Frequent symptom logging',
        'Documentation of treatment failure',
      ],
    },
    {
      percent: 30,
      summary: 'Persistently recurrent epigastric distress with dysphagia, pyrosis, and regurgitation, accompanied by substernal or arm or shoulder pain, productive of considerable impairment of health',
      criteria: {
        persistentSymptoms: true,
        dysphagia: true,
        pyrosis: true,
        regurgitation: true,
        chestPain: true,
        considerableImpairment: true,
      },
      criteriaDescription: [
        'Persistently recurrent epigastric distress',
        'Dysphagia (difficulty swallowing)',
        'Pyrosis (heartburn)',
        'Regurgitation',
        'Substernal, arm, or shoulder pain',
        'Considerable impairment of health',
      ],
      evidenceNeeded: [
        'Frequent heartburn episodes logged',
        'Document difficulty swallowing',
        'Track regurgitation frequency',
        'Note chest/shoulder pain',
        'Show persistent pattern over months',
      ],
    },
    {
      percent: 10,
      summary: 'Two or more of the symptoms for the 30% evaluation of less severity',
      criteria: {
        multipleSymptoms: true,
        lessSevere: true,
        minSymptoms: 2,
      },
      criteriaDescription: [
        'Two or more symptoms present',
        'Less severe than 30% criteria',
        'May include heartburn, regurgitation, dysphagia',
      ],
      evidenceNeeded: [
        'Log at least 2 different GERD symptoms regularly',
        'Document frequency and severity',
        'Show consistent pattern',
      ],
    },
    {
      percent: 0,
      summary: 'Symptoms controlled by medication',
      criteria: {
        controlled: true,
        onMedication: true,
      },
      criteriaDescription: [
        'Symptoms managed with medication',
        'Minimal breakthrough symptoms',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    pyrosis: {
      term: 'Pyrosis (Heartburn)',
      definition: 'Burning sensation in the chest or throat caused by stomach acid refluxing into the esophagus. A hallmark symptom of GERD.',
      examples: [
        'Burning sensation behind breastbone',
        'Sour or bitter taste in mouth',
        'Worsens when lying down or bending over',
      ],
    },
    dysphagia: {
      term: 'Dysphagia',
      definition: 'Difficulty swallowing. Can be a symptom of esophageal damage from chronic GERD.',
      examples: [
        'Food feels stuck in throat or chest',
        'Painful swallowing',
        'Difficulty swallowing solids or liquids',
      ],
    },
    regurgitation: {
      term: 'Regurgitation',
      definition: 'Backflow of stomach contents into the throat or mouth. Different from vomiting as it occurs without nausea or retching.',
      examples: [
        'Sour liquid coming up into throat',
        'Undigested food returning to mouth',
        'Occurs especially when lying down',
      ],
    },
    hematemesis: {
      term: 'Hematemesis',
      definition: 'Vomiting blood, indicating bleeding in the upper gastrointestinal tract. This is a serious complication requiring medical attention.',
      examples: [
        'Vomiting bright red blood',
        'Vomiting "coffee ground" material',
        'Requires emergency evaluation',
      ],
    },
    melena: {
      term: 'Melena',
      definition: 'Black, tarry stools indicating upper GI bleeding. Blood has been digested, turning it black.',
      examples: [
        'Black, sticky stools',
        'Tar-like appearance',
        'Indicates significant bleeding',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged GERD symptoms. Higher ratings (30-60%) require medical documentation of complications and examination findings. Continue gastroenterology care and medication compliance.',
};

// ============================================
// RADICULOPATHY RATING CRITERIA (DC 8520)
// ============================================

export const RADICULOPATHY_CRITERIA = {
  diagnosticCode: '8520',
  condition: 'Radiculopathy',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8520',

  ratings: [
    {
      percent: 40,
      summary: 'Severe radiculopathy with pronounced motor loss and significant muscle atrophy',
      criteria: {
        severity: 'severe',
        motorLoss: 'pronounced',
        muscleAtrophy: true,
        functionLoss: 'significant',
      },
      criteriaDescription: [
        'Severe radiculopathy symptoms',
        'Pronounced motor loss (significant weakness)',
        'Visible or measurable muscle atrophy',
        'Significant functional limitation',
      ],
      evidenceNeeded: [
        'Clinical documentation of motor weakness',
        'Evidence of muscle atrophy',
        'EMG/nerve conduction studies showing severe nerve damage',
        'Functional limitation documentation',
      ],
    },
    {
      percent: 20,
      summary: 'Moderate radiculopathy with definite muscle weakness and some muscle atrophy',
      criteria: {
        severity: 'moderate',
        muscleWeakness: 'definite',
        muscleAtrophy: 'some',
        functionLoss: 'moderate',
      },
      criteriaDescription: [
        'Moderate radiculopathy symptoms',
        'Definite muscle weakness present',
        'Some measurable muscle atrophy',
        'Moderate functional impact',
      ],
      evidenceNeeded: [
        'Documentation of weakness',
        'Evidence of some atrophy',
        'Regular symptom logging',
        'Impact on daily activities',
      ],
    },
    {
      percent: 10,
      summary: 'Mild radiculopathy with intermittent pain and paresthesia without motor loss',
      criteria: {
        severity: 'mild',
        intermittentPain: true,
        paresthesia: true,
        noMotorLoss: true,
      },
      criteriaDescription: [
        'Mild radiculopathy symptoms',
        'Intermittent pain along nerve pathway',
        'Paresthesia (numbness, tingling, burning)',
        'No significant motor weakness',
      ],
      evidenceNeeded: [
        'Regular logging of pain episodes',
        'Document paresthesia frequency',
        'Track pain location and radiation pattern',
        'Note triggering activities',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic or minimal symptoms',
      criteria: {
        severity: 'minimal',
        asymptomatic: true,
      },
      criteriaDescription: [
        'Diagnosis present but minimal symptoms',
        'No functional limitation',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    radiculopathy: {
      term: 'Radiculopathy',
      definition: 'A condition caused by compression, inflammation, or injury to a spinal nerve root. Results in pain, numbness, tingling, or weakness that radiates along the nerve pathway.',
      examples: [
        'Sciatica (lumbar radiculopathy)',
        'Cervical radiculopathy causing arm pain',
        'Pain radiating down leg from compressed nerve',
      ],
    },
    paresthesia: {
      term: 'Paresthesia',
      definition: 'Abnormal sensations such as tingling, numbness, burning, or "pins and needles" along a nerve distribution.',
      examples: [
        'Numbness in specific fingers or toes',
        'Tingling down arm or leg',
        'Burning sensation in hand or foot',
      ],
    },
    motorLoss: {
      term: 'Motor Loss',
      definition: 'Weakness in muscles controlled by the affected nerve. Can range from mild weakness to complete paralysis.',
      examples: [
        'Difficulty lifting arm overhead',
        'Foot drop when walking',
        'Weak grip strength',
        'Difficulty rising from seated position',
      ],
    },
    muscleAtrophy: {
      term: 'Muscle Atrophy',
      definition: 'Visible wasting or shrinking of muscle tissue due to nerve damage preventing proper muscle activation.',
      examples: [
        'Noticeably smaller calf on one side',
        'Wasting of hand muscles',
        'Measurable difference in limb circumference',
      ],
    },
    dermatome: {
      term: 'Dermatome',
      definition: 'Specific area of skin supplied by a single spinal nerve. Radiculopathy symptoms typically follow dermatome patterns.',
      examples: [
        'L5 radiculopathy affects outer calf and top of foot',
        'C6 radiculopathy affects thumb and index finger',
        'S1 radiculopathy affects bottom of foot and little toe',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged radiculopathy symptoms. Higher ratings require clinical documentation of motor weakness and muscle atrophy. Continue orthopedic/neurology care and imaging studies (MRI, EMG) as recommended.',
};

// ============================================
// CHRONIC FATIGUE SYNDROME RATING CRITERIA (DC 6354)
// ============================================

export const CHRONIC_FATIGUE_CRITERIA = {
  diagnosticCode: '6354',
  condition: 'Chronic Fatigue Syndrome',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6354',

  ratings: [
    {
      percent: 100,
      summary: 'Incapacitating fatigue with substantially all of the following: cognitive impairment, sleep disturbance, chronic pain, loss of function',
      criteria: {
        incapacitating: true,
        cognitiveImpairment: true,
        sleepDisturbance: true,
        chronicPain: true,
        lossOfFunction: true,
      },
      criteriaDescription: [
        'Incapacitating fatigue substantially all of the time',
        'Cognitive impairment (memory, concentration)',
        'Sleep disturbance',
        'Chronic pain in multiple areas',
        'Loss of function and productivity',
        'Bed/house-bound most of the time',
      ],
      evidenceNeeded: [
        'Frequent episodes of debilitating fatigue (daily or near-daily)',
        'Document cognitive difficulties',
        'Log sleep problems',
        'Track chronic pain',
        'Show inability to work or perform daily activities',
      ],
    },
    {
      percent: 60,
      summary: 'Near-constant debilitating fatigue with most additional symptoms (cognitive, sleep, pain)',
      criteria: {
        nearConstant: true,
        debilitating: true,
        multipleSymptoms: true,
        significantImpairment: true,
      },
      criteriaDescription: [
        'Near-constant debilitating fatigue',
        'Significant cognitive impairment',
        'Chronic sleep disturbance',
        'Widespread chronic pain',
        'Significant impairment of daily activities',
      ],
      evidenceNeeded: [
        'Log fatigue episodes multiple times per week',
        'Document cognitive fog frequency',
        'Track sleep quality',
        'Show pattern of severe impairment',
      ],
    },
    {
      percent: 40,
      summary: 'Constant fatigue with some additional symptoms affecting daily activities',
      criteria: {
        constant: true,
        additionalSymptoms: true,
        dailyImpairment: true,
      },
      criteriaDescription: [
        'Constant fatigue not relieved by rest',
        'Some cognitive impairment or sleep disturbance',
        'Some chronic pain',
        'Moderate impairment of daily activities',
      ],
      evidenceNeeded: [
        'Log fatigue episodes weekly',
        'Document at least 2 additional symptoms regularly',
        'Show consistent pattern over months',
      ],
    },
    {
      percent: 20,
      summary: 'Frequent fatigue with mild additional symptoms',
      criteria: {
        frequent: true,
        mildAdditional: true,
      },
      criteriaDescription: [
        'Frequent episodes of fatigue',
        'Mild cognitive or sleep issues',
        'Occasional pain',
        'Mild impairment of activities',
      ],
      evidenceNeeded: [
        'Log fatigue episodes regularly',
        'Document frequency and severity',
        'Show pattern of impairment',
      ],
    },
    {
      percent: 10,
      summary: 'Intermittent fatigue with minimal additional symptoms',
      criteria: {
        intermittent: true,
        minimalAdditional: true,
      },
      criteriaDescription: [
        'Intermittent episodes of fatigue',
        'Minimal additional symptoms',
        'Slight impairment',
      ],
      evidenceNeeded: [
        'Log fatigue episodes',
        'Document triggers if known',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Diagnosis present but symptoms controlled',
        'No significant functional impairment',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    debilitatingFatigue: {
      term: 'Debilitating Fatigue',
      definition: 'Severe exhaustion that is not relieved by rest and significantly limits ability to perform daily activities. This is beyond normal tiredness.',
      examples: [
        'Unable to complete basic tasks without extended rest',
        'Must spend significant time in bed',
        'Cannot maintain employment due to fatigue',
        'Post-exertional malaise lasting days',
      ],
    },
    cognitiveImpairment: {
      term: 'Cognitive Impairment ("Brain Fog")',
      definition: 'Difficulty with memory, concentration, information processing, or word-finding. Often called "fibro fog" or "CFS brain fog".',
      examples: [
        'Forgetting conversations or appointments',
        'Difficulty reading or following complex information',
        'Trouble finding words mid-sentence',
        'Inability to multitask',
      ],
    },
    postExertionalMalaise: {
      term: 'Post-Exertional Malaise',
      definition: 'Worsening of symptoms following physical or mental exertion, often lasting 24-48 hours or longer.',
      examples: [
        'Severe fatigue after light exercise',
        'Crash after mental tasks',
        'Need for extended recovery after activity',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged CFS symptoms. VA rating requires medical diagnosis of Chronic Fatigue Syndrome and documentation of functional impairment. Continue medical care and document all symptoms comprehensively.',
};

// ============================================
// PERIPHERAL NEUROPATHY RATING CRITERIA (DC 8999)
// ============================================

export const PERIPHERAL_NEUROPATHY_CRITERIA = {
  diagnosticCode: '8999',
  condition: 'Peripheral Neuropathy',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8999',

  ratings: [
    {
      percent: 40,
      summary: 'Severe neuropathy with pronounced sensory loss and significant motor weakness affecting multiple extremities',
      criteria: {
        severity: 'severe',
        sensoryLoss: 'pronounced',
        motorWeakness: 'significant',
        multipleExtremities: true,
      },
      criteriaDescription: [
        'Severe sensory loss in multiple extremities',
        'Significant motor weakness',
        'Marked functional impairment',
        'May include loss of protective sensation',
      ],
      evidenceNeeded: [
        'Clinical documentation of sensory testing',
        'EMG/nerve conduction studies showing severe damage',
        'Documentation of motor weakness',
        'Evidence of functional limitations',
      ],
    },
    {
      percent: 30,
      summary: 'Moderate neuropathy with definite sensory loss and some motor involvement',
      criteria: {
        severity: 'moderate',
        sensoryLoss: 'definite',
        someMotorInvolvement: true,
      },
      criteriaDescription: [
        'Moderate sensory loss affecting daily function',
        'Some motor weakness or atrophy',
        'Moderate functional impairment',
      ],
      evidenceNeeded: [
        'Document numbness/tingling frequency',
        'Log areas affected (feet, hands, etc.)',
        'Note any weakness or balance issues',
        'EMG studies if available',
      ],
    },
    {
      percent: 20,
      summary: 'Mild to moderate neuropathy with sensory symptoms and minimal motor involvement',
      criteria: {
        severity: 'mild-moderate',
        sensorySymptoms: true,
        minimalMotor: true,
      },
      criteriaDescription: [
        'Persistent numbness, tingling, or burning',
        'Minimal motor weakness',
        'Some functional limitation',
      ],
      evidenceNeeded: [
        'Regular logging of paresthesia episodes',
        'Document distribution pattern',
        'Track pain or discomfort',
      ],
    },
    {
      percent: 10,
      summary: 'Mild neuropathy with intermittent sensory symptoms',
      criteria: {
        severity: 'mild',
        intermittent: true,
        sensoryOnly: true,
      },
      criteriaDescription: [
        'Intermittent numbness, tingling, or pain',
        'No motor weakness',
        'Minimal functional impact',
      ],
      evidenceNeeded: [
        'Log paresthesia episodes',
        'Document frequency and triggers',
        'Note affected areas',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Diagnosis present but symptoms mild or controlled',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    paresthesia: {
      term: 'Paresthesia',
      definition: 'Abnormal sensations such as numbness, tingling, burning, or "pins and needles" in the extremities.',
      examples: [
        'Numbness in feet or hands',
        'Tingling in toes or fingers',
        'Burning sensation in soles of feet',
        'Loss of feeling in affected areas',
      ],
    },
    stockingGlove: {
      term: 'Stocking-Glove Distribution',
      definition: 'Classic pattern of peripheral neuropathy where symptoms affect hands and feet in a pattern resembling gloves and stockings.',
      examples: [
        'Numbness in both feet up to ankles',
        'Tingling in both hands',
        'Symmetric involvement',
      ],
    },
    motorWeakness: {
      term: 'Motor Weakness',
      definition: 'Loss of muscle strength due to nerve damage affecting motor function.',
      examples: [
        'Difficulty walking or foot drop',
        'Weak grip strength',
        'Trouble with fine motor tasks (buttoning, writing)',
        'Balance problems',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged neuropathy symptoms. Higher ratings require clinical documentation including EMG/nerve conduction studies and sensory/motor testing. Common causes include diabetes, Agent Orange exposure, and various medications.',
};

// ============================================
// MENIERE'S DISEASE RATING CRITERIA (DC 6205)
// ============================================

export const MENIERES_CRITERIA = {
  diagnosticCode: '6205',
  condition: "Meniere's Disease",
  cfrReference: '38 CFR 4.85, Diagnostic Code 6205',

  ratings: [
    {
      percent: 100,
      summary: 'Hearing impairment with attacks of vertigo and tinnitus so severe and prolonged as to require bed rest most of the time',
      criteria: {
        severeVertigo: true,
        prolongedAttacks: true,
        requiresBedRest: true,
        mostOfTime: true,
        hearingImpairment: true,
        tinnitus: true,
      },
      criteriaDescription: [
        'Severe, prolonged vertigo attacks',
        'Requires bed rest most of the time',
        'Hearing impairment present',
        'Tinnitus present',
        'Essentially incapacitated',
      ],
      evidenceNeeded: [
        'Frequent severe vertigo attacks (multiple times per week)',
        'Document duration of attacks (hours/days)',
        'Audiometry showing hearing loss',
        'Medical documentation of diagnosis',
      ],
    },
    {
      percent: 60,
      summary: 'Hearing impairment with attacks of vertigo and tinnitus so severe as to require bed rest during attacks',
      criteria: {
        severeVertigo: true,
        requiresBedRest: true,
        duringAttacks: true,
        hearingImpairment: true,
        tinnitus: true,
      },
      criteriaDescription: [
        'Severe vertigo attacks requiring bed rest',
        'Attacks are disabling during episodes',
        'Hearing impairment documented',
        'Tinnitus present',
      ],
      evidenceNeeded: [
        'Log vertigo attacks requiring bed rest',
        'Document frequency (weekly or more)',
        'Audiometry results',
        'ENT documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Hearing impairment with vertigo and tinnitus less than severe',
      criteria: {
        hearingImpairment: true,
        vertigoPresent: true,
        tinnitusPresent: true,
        lessThanSevere: true,
      },
      criteriaDescription: [
        'Hearing impairment documented',
        'Vertigo episodes present but not incapacitating',
        'Tinnitus present',
        'Moderate impact on function',
      ],
      evidenceNeeded: [
        'Log vertigo episodes regularly',
        'Audiometry showing hearing loss',
        'Document tinnitus',
        'Show pattern of symptoms',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms or well-controlled',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Diagnosis present',
        'Symptoms controlled or minimal',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    vertigo: {
      term: 'Vertigo',
      definition: 'A sensation of spinning or movement when you are stationary. Different from general dizziness - true vertigo feels like the room is spinning.',
      examples: [
        'Room spinning sensation',
        'Feeling like you are rotating',
        'Severe imbalance',
        'Nausea and vomiting with spinning',
      ],
    },
    menieresTornade: {
      term: "Meniere's Attack",
      definition: "Sudden episode of severe vertigo, hearing loss, tinnitus, and ear fullness. Can last from 20 minutes to several hours.",
      examples: [
        'Sudden spinning vertigo',
        'Temporary hearing loss in one ear',
        'Roaring tinnitus',
        'Feeling of pressure in ear',
      ],
    },
    hearingLoss: {
      term: 'Hearing Loss (Meniere\'s)',
      definition: 'Progressive sensorineural hearing loss typically affecting low frequencies first. May fluctuate early but becomes permanent over time.',
      examples: [
        'Difficulty hearing during attacks',
        'Progressive hearing reduction',
        'Documented on audiometry',
      ],
    },
  },

  disclaimer: "This analysis is based on logged Meniere's symptoms. VA rating requires ENT evaluation with audiometry and documentation of attack frequency and severity. Meniere's is a vestibular disorder requiring clinical diagnosis.",
};

// ============================================
// RHINITIS RATING CRITERIA (DC 6522)
// ============================================

export const RHINITIS_CRITERIA = {
  diagnosticCode: '6522',
  condition: 'Rhinitis (Allergic or Vasomotor)',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6522',

  ratings: [
    {
      percent: 30,
      summary: 'With polyps',
      criteria: {
        polyps: true,
      },
      criteriaDescription: [
        'Nasal polyps present',
        'Documented on examination',
      ],
      evidenceNeeded: [
        'ENT documentation of nasal polyps',
        'Nasal endoscopy or imaging showing polyps',
        'Chronic symptom documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Without polyps but with chronic symptoms',
      criteria: {
        chronicSymptoms: true,
        noPolyps: true,
      },
      criteriaDescription: [
        'Chronic nasal congestion or drainage',
        'Frequent sneezing episodes',
        'Post-nasal drip',
        'No polyps present',
      ],
      evidenceNeeded: [
        'Log chronic congestion episodes',
        'Document post-nasal drainage',
        'Track sneezing/rhinorrhea frequency',
        'Show persistent pattern',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms or well-controlled',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Symptoms controlled with medication',
        'Minimal functional impact',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    allergicRhinitis: {
      term: 'Allergic Rhinitis',
      definition: 'Inflammation of nasal passages due to allergic reaction to environmental triggers (pollen, dust, mold, etc.).',
      examples: [
        'Seasonal allergies',
        'Year-round allergies',
        'Sneezing, congestion, runny nose',
        'Itchy nose/eyes',
      ],
    },
    vasomotorRhinitis: {
      term: 'Vasomotor Rhinitis',
      definition: 'Non-allergic rhinitis triggered by environmental irritants, weather changes, or other non-allergic factors.',
      examples: [
        'Congestion from temperature changes',
        'Reaction to strong odors',
        'Exercise-induced symptoms',
        'Humidity-triggered symptoms',
      ],
    },
    nasalPolyps: {
      term: 'Nasal Polyps',
      definition: 'Soft, non-cancerous growths in the nasal passages or sinuses. Can block airflow and drainage.',
      examples: [
        'Feeling of nasal obstruction',
        'Reduced sense of smell',
        'Visible on nasal endoscopy',
        'May require surgical removal',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged rhinitis symptoms. 30% rating requires ENT documentation of nasal polyps. Continue ENT care and document chronic symptoms.',
};

export const TMJ_CRITERIA = {
  diagnosticCode: '9905',
  condition: 'Temporomandibular Joint (TMJ) Disorder',
  cfrReference: '38 CFR 4.150, Diagnostic Code 9905',

  ratings: [
    {
      percent: 30,
      summary: 'Limitation of motion with severe pain on both sides or bilateral ankylosis',
      criteria: {
        bilateral: true,
        severePain: true,
        limitedMotion: true,
      },
      criteriaDescription: [
        'Limitation of motion on both sides',
        'Severe pain with jaw movement',
        'Or bilateral ankylosis (fusion)',
        'Significant functional impairment',
      ],
      evidenceNeeded: [
        'Document pain on both left and right TMJ',
        'Log pain with eating, talking, yawning',
        'Measure jaw opening (should be <35mm for limited motion)',
        'Dental/oral surgery documentation if available',
      ],
    },
    {
      percent: 20,
      summary: 'Limitation of motion with moderate pain on both sides or unilateral ankylosis',
      criteria: {
        bilateral: true,
        moderatePain: true,
        limitedMotion: true,
      },
      criteriaDescription: [
        'Moderate pain with jaw movement',
        'Limited opening on both sides',
        'Or unilateral ankylosis',
      ],
      evidenceNeeded: [
        'Document bilateral symptoms',
        'Track pain frequency and triggers',
        'Note clicking or popping sounds',
        'Jaw locking episodes',
      ],
    },
    {
      percent: 10,
      summary: 'Limitation of motion with mild pain',
      criteria: {
        limitedMotion: true,
        mildPain: true,
      },
      criteriaDescription: [
        'Mild pain with jaw movement',
        'Some limitation of opening',
        'May have clicking or popping',
      ],
      evidenceNeeded: [
        'Log jaw pain episodes',
        'Document clicking/popping',
        'Track difficulty with eating',
        'Note any headaches related to TMJ',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Diagnosis present but well-controlled',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    limitedOpening: {
      term: 'Limited Jaw Opening',
      definition: 'Reduced ability to open mouth measured from upper to lower incisors. Normal is 35-50mm; limited is <35mm.',
      examples: [
        'Difficulty eating large foods (apples, sandwiches)',
        'Trouble with dental work due to limited opening',
        'Cannot fit 2-3 fingers vertically between teeth',
      ],
    },
    clicking: {
      term: 'Clicking or Popping',
      definition: 'Audible sounds when opening or closing jaw due to disc displacement or joint irregularities.',
      examples: [
        'Click sound when opening mouth wide',
        'Pop when chewing',
        'Grinding sensation in jaw',
      ],
    },
    locking: {
      term: 'Jaw Locking',
      definition: 'Jaw becomes stuck in open or closed position temporarily, requiring manipulation to release.',
      examples: [
        'Jaw stuck open after yawning',
        'Cannot open mouth fully without manipulation',
        'Jaw catches or locks during movement',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged TMJ symptoms. VA rating requires dental/oral surgery examination with measurement of jaw opening. Document bilateral (both sides) involvement for higher ratings.',
};

// ============================================
// PLANTAR FASCIITIS RATING CRITERIA (DC 5276)
// ============================================

export const PLANTAR_FASCIITIS_CRITERIA = {
  diagnosticCode: '5276',
  condition: 'Plantar Fasciitis',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5276',

  ratings: [
    {
      percent: 30,
      summary: 'Bilateral severe plantar fasciitis with marked limitation of weight-bearing',
      criteria: {
        bilateral: true,
        severe: true,
        markedLimitation: true,
      },
      criteriaDescription: [
        'Severe plantar fasciitis affecting both feet',
        'Marked limitation of weight-bearing',
        'Significant functional impairment',
        'Unable to stand or walk for extended periods',
      ],
      evidenceNeeded: [
        'Document pain in both feet',
        'Log episodes affecting ability to walk/stand',
        'Track morning pain (first steps of day)',
        'Podiatry documentation if available',
      ],
    },
    {
      percent: 20,
      summary: 'Unilateral severe or bilateral moderate plantar fasciitis',
      criteria: {
        severe: true,
        functionalImpairment: true,
      },
      criteriaDescription: [
        'Severe plantar fasciitis in one foot, OR',
        'Moderate plantar fasciitis in both feet',
        'Noticeable functional limitation',
      ],
      evidenceNeeded: [
        'Log heel pain frequency',
        'Document impact on walking/standing',
        'Track pain with activity',
        'Note relief with rest',
      ],
    },
    {
      percent: 10,
      summary: 'Unilateral moderate or mild bilateral plantar fasciitis',
      criteria: {
        moderate: true,
        someImpairment: true,
      },
      criteriaDescription: [
        'Moderate pain in one foot, OR',
        'Mild pain in both feet',
        'Some functional limitation',
      ],
      evidenceNeeded: [
        'Regular logging of heel/arch pain',
        'Document morning pain',
        'Track duration of symptoms',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms or well-controlled',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Symptoms controlled with orthotics/treatment',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    plantarFasciitis: {
      term: 'Plantar Fasciitis',
      definition: 'Inflammation of the thick band of tissue (plantar fascia) that runs across the bottom of the foot, connecting heel to toes.',
      examples: [
        'Sharp heel pain with first steps in morning',
        'Pain after standing or sitting for long periods',
        'Pain improves with movement but returns after rest',
        'Tenderness on bottom of heel',
      ],
    },
    morningPain: {
      term: 'Morning Pain',
      definition: 'Characteristic sharp pain in heel with first steps of the day. Often the most severe symptom of plantar fasciitis.',
      examples: [
        'Stabbing pain when getting out of bed',
        'Pain improves after walking around',
        'Returns after sitting for extended periods',
      ],
    },
    bilateral: {
      term: 'Bilateral Plantar Fasciitis',
      definition: 'Plantar fasciitis affecting both feet. Higher ratings require bilateral involvement.',
      examples: [
        'Pain in both heels',
        'Morning stiffness in both feet',
        'Difficulty walking due to pain in both feet',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged plantar fasciitis symptoms. VA rating requires podiatry examination and documentation of bilateral involvement and functional limitation. Conservative treatment (orthotics, stretching, NSAIDs) should be documented.',
};

// ============================================
// INSOMNIA RATING CRITERIA (DC 8108)
// ============================================

export const INSOMNIA_CRITERIA = {
  diagnosticCode: '8108',
  condition: 'Insomnia (Sleep Disorder)',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8108',

  ratings: [
    {
      percent: 100,
      summary: 'Total occupational and social impairment due to sleep disorder symptoms',
      criteria: {
        totalImpairment: true,
        occupationalImpact: true,
        socialImpact: true,
      },
      criteriaDescription: [
        'Chronic sleep deprivation causing total impairment',
        'Unable to work or maintain relationships',
        'Persistent inability to sleep despite treatment',
        'Severe daytime dysfunction',
      ],
      evidenceNeeded: [
        'Daily or near-daily sleep disturbance',
        'Document inability to function at work',
        'Track severe daytime fatigue/irritability',
        'Sleep study results if available',
      ],
    },
    {
      percent: 50,
      summary: 'Occupational and social impairment with reduced reliability and productivity',
      criteria: {
        significantImpairment: true,
        reducedProductivity: true,
      },
      criteriaDescription: [
        'Chronic sleep problems affecting work performance',
        'Reduced reliability and productivity',
        'Difficulty maintaining social relationships',
        'Persistent daytime dysfunction',
      ],
      evidenceNeeded: [
        'Frequent sleep disturbance (4-5 nights/week)',
        'Document work performance issues',
        'Track daytime impairment',
      ],
    },
    {
      percent: 30,
      summary: 'Occupational and social impairment with occasional decrease in work efficiency',
      criteria: {
        moderateImpairment: true,
        occasionalImpact: true,
      },
      criteriaDescription: [
        'Regular sleep disturbance',
        'Occasional decrease in work efficiency',
        'Some social impairment',
        'Moderate daytime dysfunction',
      ],
      evidenceNeeded: [
        'Regular sleep problems (3-4 nights/week)',
        'Document impact on daily activities',
        'Track missed work or reduced performance',
      ],
    },
    {
      percent: 10,
      summary: 'Mild sleep impairment with some daytime dysfunction',
      criteria: {
        mild: true,
        someImpairment: true,
      },
      criteriaDescription: [
        'Intermittent sleep problems',
        'Mild daytime fatigue or irritability',
        'Minimal functional impact',
      ],
      evidenceNeeded: [
        'Log sleep disturbance episodes',
        'Document frequency (1-2 nights/week)',
        'Track daytime symptoms',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but controlled with treatment',
      criteria: {
        controlled: true,
      },
      criteriaDescription: [
        'Sleep disorder controlled with medication',
        'Minimal functional impact',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    insomnia: {
      term: 'Insomnia',
      definition: 'Persistent difficulty falling asleep, staying asleep, or early morning awakening despite adequate opportunity for sleep.',
      examples: [
        'Taking >30 minutes to fall asleep regularly',
        'Waking up multiple times during night',
        'Waking 2+ hours before desired time',
        'Non-restorative sleep',
      ],
    },
    sleepLatency: {
      term: 'Sleep Onset Latency',
      definition: 'Time it takes to fall asleep. Normal is 10-20 minutes; insomnia often >30 minutes.',
      examples: [
        'Lying awake for 1-2 hours',
        'Mind racing preventing sleep',
        'Anxiety about falling asleep',
      ],
    },
    daytimeDysfunction: {
      term: 'Daytime Dysfunction',
      definition: 'Impairment during waking hours due to poor sleep. Key factor in VA rating.',
      examples: [
        'Severe fatigue affecting work',
        'Irritability or mood changes',
        'Difficulty concentrating',
        'Microsleep episodes',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged insomnia symptoms. VA rating considers functional impairment and occupational/social impact. Sleep studies may be required. Often rated as secondary to PTSD, chronic pain, or other conditions.',
};

// ============================================
// SINUSITIS RATING CRITERIA (DC 6510)
// ============================================

export const SINUSITIS_CRITERIA = {
  diagnosticCode: '6510',
  condition: 'Chronic Sinusitis',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6510',

  ratings: [
    {
      percent: 50,
      summary: 'Following radical surgery with chronic osteomyelitis or marked incapacitating episodes',
      criteria: {
        radicalSurgery: true,
        chronicOsteomyelitis: true,
        markedEpisodes: true,
      },
      criteriaDescription: [
        'Status post radical sinus surgery, OR',
        'Chronic osteomyelitis (bone infection), OR',
        'Marked incapacitating episodes of sinusitis requiring prolonged treatment',
      ],
      evidenceNeeded: [
        'Surgical records if applicable',
        'Frequent severe episodes requiring antibiotics',
        'ENT documentation of chronic infection',
        'CT or MRI showing chronic changes',
      ],
    },
    {
      percent: 30,
      summary: 'Three or more incapacitating episodes per year requiring prolonged antibiotics',
      criteria: {
        frequentEpisodes: true,
        requiresAntibiotics: true,
        incapacitating: true,
      },
      criteriaDescription: [
        '3+ incapacitating episodes per year',
        'Each requiring prolonged antibiotic treatment',
        'Episodes are disabling',
      ],
      evidenceNeeded: [
        'Log severe sinusitis episodes (3+ per year)',
        'Document antibiotic courses',
        'Track duration of each episode',
        'ENT visits and treatments',
      ],
    },
    {
      percent: 10,
      summary: 'One or two incapacitating episodes per year requiring prolonged antibiotics, or chronic symptoms',
      criteria: {
        episodes: true,
        chronicSymptoms: true,
      },
      criteriaDescription: [
        '1-2 incapacitating episodes per year requiring antibiotics, OR',
        'Chronic symptoms (congestion, drainage, facial pain)',
      ],
      evidenceNeeded: [
        'Log acute episodes if any',
        'Document chronic symptoms',
        'Track facial pain/pressure',
        'Post-nasal drainage frequency',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms or well-controlled',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Symptoms controlled with medication',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    incapacitatingEpisode: {
      term: 'Incapacitating Episode',
      definition: 'Acute sinusitis episode severe enough to prevent normal activities and require medical treatment with prolonged antibiotics.',
      examples: [
        'Severe facial pain requiring bed rest',
        'High fever with sinus infection',
        'Unable to work for several days',
        'Requires 10-14 day antibiotic course',
      ],
    },
    chronicSinusitis: {
      term: 'Chronic Sinusitis',
      definition: 'Inflammation of sinuses lasting 12+ weeks despite treatment. Symptoms include facial pain/pressure, nasal congestion, and post-nasal drainage.',
      examples: [
        'Persistent facial pressure for months',
        'Chronic post-nasal drip',
        'Recurring sinus infections',
        'Chronic headaches from sinus pressure',
      ],
    },
    prolongedAntibiotics: {
      term: 'Prolonged Antibiotic Treatment',
      definition: 'Antibiotic course lasting 10-14 days or longer. Short 5-7 day courses do not qualify for VA rating purposes.',
      examples: [
        '10-14 day antibiotic prescription',
        'Multiple courses per year',
        'Resistant infections requiring stronger antibiotics',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged sinusitis symptoms. VA rating requires ENT evaluation and documentation of incapacitating episodes requiring prolonged antibiotics. CT imaging strengthens claim.',
};


// ============================================
// SHOULDER CONDITIONS RATING CRITERIA (DC 5201-5203)
// ============================================

export const SHOULDER_CRITERIA = {
  diagnosticCode: '5201-5203',
  condition: 'Shoulder Conditions',
  cfrReference: '38 CFR 4.71a, Diagnostic Codes 5201-5203',

  ratings: [
    {
      percent: 40,
      summary: 'Shoulder or arm, with severe limitation of motion (frozen shoulder)',
      criteria: {
        severeLimit: true,
        frozenShoulder: true,
      },
      criteriaDescription: [
        'Frozen shoulder or severe limitation',
        'Significant functional impairment',
        'ROM <90 degrees forward elevation or abduction',
      ],
      evidenceNeeded: [
        'Document severe pain limiting movement',
        'Track episodes preventing overhead reach',
        'Note difficulty with daily activities (dressing, reaching)',
        'ROM measurements if available',
      ],
    },
    {
      percent: 30,
      summary: 'Shoulder or arm, with moderate limitation of motion',
      criteria: {
        moderateLimit: true,
      },
      criteriaDescription: [
        'Moderate limitation of shoulder motion',
        'ROM 90-120 degrees forward elevation',
        'Noticeable functional impact',
      ],
      evidenceNeeded: [
        'Log pain with overhead activities',
        'Document limited range episodes',
        'Track impact on work/daily tasks',
      ],
    },
    {
      percent: 20,
      summary: 'Shoulder or arm, with slight to moderate limitation of motion',
      criteria: {
        slightLimit: true,
      },
      criteriaDescription: [
        'Slight to moderate limitation',
        'ROM 120-160 degrees',
        'Some functional limitation',
      ],
      evidenceNeeded: [
        'Regular pain episodes',
        'Document activities causing pain',
        'Track frequency and severity',
      ],
    },
    {
      percent: 10,
      summary: 'Shoulder or arm, with slight impairment or recurrent instability',
      criteria: {
        slightImpairment: true,
        recurrentInstability: true,
      },
      criteriaDescription: [
        'Slight impairment of function',
        'OR recurrent shoulder dislocations/subluxations',
        'Minimal but documented limitation',
      ],
      evidenceNeeded: [
        'Log pain episodes',
        'Document instability if present',
        'Track any giving way or weakness',
      ],
    },
    {
      percent: 0,
      summary: 'No significant limitation',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Full or near-full range of motion',
        'Minimal pain',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    rangeOfMotion: {
      term: 'Shoulder Range of Motion (ROM)',
      definition: 'Measured in degrees of forward elevation and abduction. Normal is 180 degrees; severe limitation is <90 degrees.',
      examples: [
        'Cannot raise arm above shoulder level (<90)',
        'Difficulty reaching overhead (90-120)',
        'Some limitation but can reach most areas (120-160)',
        'Near-normal motion (160-180)',
      ],
    },
    frozenShoulder: {
      term: 'Frozen Shoulder (Adhesive Capsulitis)',
      definition: 'Severe stiffness and pain in shoulder joint making movement very difficult or impossible.',
      examples: [
        'Cannot lift arm to comb hair',
        'Severe pain prevents reaching',
        'Stiffness limits all directions of movement',
      ],
    },
    instability: {
      term: 'Shoulder Instability',
      definition: 'Shoulder joint slides partially or completely out of position (subluxation or dislocation).',
      examples: [
        'Shoulder "pops out" with certain movements',
        'Feeling of shoulder about to dislocate',
        'History of multiple dislocations',
        'Apprehension with overhead activities',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged shoulder symptoms. VA rating requires orthopedic examination with ROM measurements. Higher ratings require documented ROM limitations in specific planes (forward elevation, abduction, internal/external rotation).',
};

// ============================================
// HIP CONDITIONS RATING CRITERIA (DC 5252-5255)
// ============================================

export const HIP_CRITERIA = {
  diagnosticCode: '5252-5255',
  condition: 'Hip Conditions',
  cfrReference: '38 CFR 4.71a, Diagnostic Codes 5252-5255',

  ratings: [
    {
      percent: 60,
      summary: 'Hip ankylosis (fusion) in favorable position',
      criteria: {
        ankylosis: true,
        favorablePosition: true,
      },
      criteriaDescription: [
        'Complete ankylosis (fusion) of hip joint',
        'In favorable position for function',
      ],
      evidenceNeeded: [
        'Surgical records of hip fusion',
        'X-ray showing fusion',
        'Complete lack of hip motion',
      ],
    },
    {
      percent: 50,
      summary: 'Hip ankylosis in unfavorable position or with muscle atrophy',
      criteria: {
        ankylosis: true,
        unfavorablePosition: true,
      },
      criteriaDescription: [
        'Complete fusion in poor position, OR',
        'Ankylosis with muscle atrophy/weakness',
      ],
      evidenceNeeded: [
        'Imaging showing fusion',
        'Clinical documentation of position',
        'Muscle atrophy if present',
      ],
    },
    {
      percent: 40,
      summary: 'Hip with marked limitation of motion and severe pain',
      criteria: {
        markedLimitation: true,
        severePain: true,
      },
      criteriaDescription: [
        'Marked limitation of hip motion',
        'Severe pain with movement',
        'Significant functional impairment',
      ],
      evidenceNeeded: [
        'Frequent severe pain episodes',
        'Difficulty walking, climbing stairs',
        'Limited ROM measurements',
      ],
    },
    {
      percent: 30,
      summary: 'Hip with moderate limitation of motion',
      criteria: {
        moderateLimitation: true,
      },
      criteriaDescription: [
        'Moderate limitation of motion',
        'Moderate pain',
        'Noticeable functional limitation',
      ],
      evidenceNeeded: [
        'Regular pain with activity',
        'Document walking limitations',
        'Track stiffness and pain frequency',
      ],
    },
    {
      percent: 20,
      summary: 'Hip with slight to moderate limitation of motion',
      criteria: {
        slightLimitation: true,
      },
      criteriaDescription: [
        'Slight to moderate limitation',
        'Some pain with activity',
        'Mild functional impact',
      ],
      evidenceNeeded: [
        'Log hip pain episodes',
        'Document activities causing pain',
        'Track any limping or gait changes',
      ],
    },
    {
      percent: 10,
      summary: 'Hip with slight limitation or mild symptoms',
      criteria: {
        mild: true,
      },
      criteriaDescription: [
        'Slight limitation of motion',
        'Mild intermittent pain',
        'Minimal functional impact',
      ],
      evidenceNeeded: [
        'Document pain episodes',
        'Track frequency and triggers',
      ],
    },
    {
      percent: 0,
      summary: 'No significant limitation',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Normal or near-normal ROM',
        'Minimal pain',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    ankylosis: {
      term: 'Hip Ankylosis',
      definition: 'Complete fusion or immobility of the hip joint, either from disease, injury, or surgical fusion.',
      examples: [
        'Hip joint does not move at all',
        'Surgical hip fusion',
        'Complete stiffness from arthritis',
      ],
    },
    hipROM: {
      term: 'Hip Range of Motion',
      definition: 'Movement of hip in flexion, extension, abduction, adduction, and rotation. Normal flexion is 120-125 degrees.',
      examples: [
        'Difficulty bending forward to tie shoes (flexion)',
        'Cannot spread legs apart (abduction)',
        'Pain with rotation (internal/external rotation)',
        'Stiffness limiting walking stride',
      ],
    },
    functionalImpairment: {
      term: 'Hip Functional Impairment',
      definition: 'Impact on daily activities: walking, climbing stairs, sitting, getting in/out of car, standing from seated position.',
      examples: [
        'Difficulty walking long distances',
        'Pain climbing stairs',
        'Limping or altered gait',
        'Cannot sit for extended periods',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged hip symptoms. VA rating requires orthopedic examination with ROM measurements and functional assessment. X-rays showing degenerative changes strengthen claims.',
};

// ============================================
// ANKLE CONDITIONS RATING CRITERIA (DC 5270-5271)
// ============================================

export const ANKLE_CRITERIA = {
  diagnosticCode: '5270-5271',
  condition: 'Ankle Conditions',
  cfrReference: '38 CFR 4.71a, Diagnostic Codes 5270-5271',

  ratings: [
    {
      percent: 40,
      summary: 'Ankle ankylosis in plantar flexion >40 or dorsiflexion >10 with deformity',
      criteria: {
        ankylosis: true,
        severePosition: true,
      },
      criteriaDescription: [
        'Complete ankylosis (fusion) of ankle',
        'Plantar flexion at more than 40, OR',
        'Dorsiflexion at more than 10, OR',
        'With abduction, adduction, inversion or eversion deformity',
      ],
      evidenceNeeded: [
        'Surgical fusion records',
        'X-ray showing complete fusion',
        'Orthopedic exam documenting position',
      ],
    },
    {
      percent: 30,
      summary: 'Ankle ankylosis in plantar flexion 30-40 or dorsiflexion 0-10',
      criteria: {
        ankylosis: true,
        moderatePosition: true,
      },
      criteriaDescription: [
        'Complete ankle ankylosis',
        'Plantar flexion between 30 and 40, OR',
        'Dorsiflexion between 0 and 10',
      ],
      evidenceNeeded: [
        'Documentation of complete fusion',
        'Position measurement by orthopedist',
      ],
    },
    {
      percent: 20,
      summary: 'Ankle ankylosis in plantar flexion <30 OR marked limited motion',
      criteria: {
        ankylosisOrMarked: true,
      },
      criteriaDescription: [
        'Ankle ankylosis in plantar flexion less than 30, OR',
        'Marked limitation of motion: less than 5 dorsiflexion or less than 10 plantar flexion',
      ],
      evidenceNeeded: [
        'ROM measurements showing marked limitation',
        'Frequent severe pain episodes',
        'Significant functional limitations',
      ],
    },
    {
      percent: 10,
      summary: 'Moderate limitation of ankle motion',
      criteria: {
        moderateLimitation: true,
      },
      criteriaDescription: [
        'Moderate limitation of motion',
        'Less than 15 dorsiflexion, OR',
        'Less than 30 plantar flexion',
      ],
      evidenceNeeded: [
        'Document ankle pain episodes',
        'Track ROM limitations',
        'Note functional impact (walking, stairs)',
      ],
    },
    {
      percent: 0,
      summary: 'Minimal symptoms or normal motion',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Normal or near-normal ROM',
        'Minimal pain or symptoms',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    ankylosis: {
      term: 'Ankle Ankylosis',
      definition: 'Complete fusion or immobility of the ankle joint, from disease, injury, or surgical fusion.',
      examples: [
        'Ankle joint does not move at all',
        'Surgical ankle fusion (arthrodesis)',
        'Complete stiffness from severe arthritis',
      ],
    },
    ankleROM: {
      term: 'Ankle Range of Motion',
      definition: 'Normal ankle ROM is 0-20 dorsiflexion (foot up) and 0-45 plantar flexion (foot down).',
      examples: [
        'Difficulty pulling foot upward (dorsiflexion)',
        'Cannot point toes down fully (plantar flexion)',
        'Pain with ankle movement in any direction',
      ],
    },
    markedLimitation: {
      term: 'Marked Limitation',
      definition: 'Less than 5 dorsiflexion OR less than 10 plantar flexion - severe restriction of motion.',
    },
    moderateLimitation: {
      term: 'Moderate Limitation',
      definition: 'Less than 15 dorsiflexion OR less than 30 plantar flexion.',
    },
  },

  disclaimer: 'This analysis is based on logged ankle symptoms. VA rating requires orthopedic examination with goniometer ROM measurements. X-rays showing degenerative changes or fusion strengthen claims.',
};

// ============================================
// WRIST CONDITIONS RATING CRITERIA (DC 5214-5215)
// ============================================

export const WRIST_CRITERIA = {
  diagnosticCode: '5214-5215',
  condition: 'Wrist Conditions',
  cfrReference: '38 CFR 4.71a, Diagnostic Codes 5214-5215',

  // Note: Wrist ratings differ for dominant (major) vs non-dominant (minor) hand
  majorMinorNote: 'Ratings shown are for dominant hand. Non-dominant hand ratings are 10% lower for ankylosis ratings (5040, 4030, 3020). Limitation of motion is 10% regardless of hand dominance.',

  ratings: [
    {
      percent: 50,
      summary: 'Unfavorable wrist ankylosis (dominant hand)',
      criteria: {
        ankylosis: true,
        unfavorable: true,
        dominantHand: true,
      },
      criteriaDescription: [
        'Complete ankylosis of wrist',
        'In any degree of palmar flexion, OR',
        'With ulnar or radial deviation',
        '(40% for non-dominant hand)',
      ],
      evidenceNeeded: [
        'Surgical fusion records',
        'X-ray confirming fusion',
        'Orthopedic documentation of position',
        'Document which hand is dominant',
      ],
    },
    {
      percent: 40,
      summary: 'Wrist ankylosis in other unfavorable position (dominant)',
      criteria: {
        ankylosis: true,
        otherPosition: true,
      },
      criteriaDescription: [
        'Complete ankylosis',
        'Any position except favorable',
        '(30% for non-dominant hand)',
      ],
      evidenceNeeded: [
        'Documentation of fusion',
        'Position measurement',
      ],
    },
    {
      percent: 30,
      summary: 'Favorable wrist ankylosis in 20-30 dorsiflexion (dominant)',
      criteria: {
        ankylosis: true,
        favorable: true,
      },
      criteriaDescription: [
        'Complete ankylosis in favorable position',
        '20 to 30 dorsiflexion',
        '(20% for non-dominant hand)',
      ],
      evidenceNeeded: [
        'Documentation of fusion',
        'Position in functional range',
      ],
    },
    {
      percent: 10,
      summary: 'Limited wrist motion: dorsiflexion <15 OR palmar flexion in line with forearm',
      criteria: {
        limitedMotion: true,
      },
      criteriaDescription: [
        'Dorsiflexion less than 15, OR',
        'Palmar flexion limited in line with forearm',
        '(Same rating for either hand)',
      ],
      evidenceNeeded: [
        'ROM measurements by healthcare provider',
        'Document pain and functional limitations',
        'Track activities affected',
      ],
    },
    {
      percent: 0,
      summary: 'Minimal symptoms or normal motion',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Normal or near-normal ROM',
        'Minimal symptoms',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    ankylosis: {
      term: 'Wrist Ankylosis',
      definition: 'Complete fusion or immobility of the wrist joint.',
      examples: [
        'Wrist does not bend at all',
        'Surgical wrist fusion',
        'Complete fusion from severe arthritis',
      ],
    },
    wristROM: {
      term: 'Wrist Range of Motion',
      definition: 'Normal wrist ROM is about 70 palmar flexion, 70 dorsiflexion (extension), 20 radial deviation, and 45 ulnar deviation.',
      examples: [
        'Cannot bend wrist up (extension)',
        'Cannot bend wrist down (flexion)',
        'Pain with wrist movement',
      ],
    },
    favorablePosition: {
      term: 'Favorable Position',
      definition: 'Wrist fused in 20 to 30 dorsiflexion - the functional position allowing grip.',
    },
    dominance: {
      term: 'Hand Dominance',
      definition: 'The hand you write with. Dominant hand injuries receive higher ratings for ankylosis.',
    },
  },

  disclaimer: 'This analysis is based on logged wrist symptoms. VA rating requires orthopedic examination with ROM measurements. Note whether condition affects dominant or non-dominant hand.',
};

// ============================================
// ELBOW CONDITIONS RATING CRITERIA (DC 5205-5207)
// ============================================

export const ELBOW_CRITERIA = {
  diagnosticCode: '5205-5207',
  condition: 'Elbow Conditions',
  cfrReference: '38 CFR 4.71a, Diagnostic Codes 5205-5207',

  majorMinorNote: 'Ratings shown are for dominant arm (major). Non-dominant (minor) arm ratings are typically 10% lower.',

  ratings: [
    {
      percent: 60,
      summary: 'Unfavorable elbow ankylosis <50 or complete supination/pronation loss (dominant)',
      criteria: {
        ankylosis: true,
        unfavorable: true,
      },
      criteriaDescription: [
        'Complete ankylosis at angle less than 50, OR',
        'Complete loss of supination or pronation',
        '(50% for non-dominant arm)',
      ],
      evidenceNeeded: [
        'Surgical fusion records',
        'X-ray confirming fusion',
        'Documentation of fixed angle',
      ],
    },
    {
      percent: 50,
      summary: 'Intermediate elbow ankylosis at 50-90 (dominant)',
      criteria: {
        ankylosis: true,
        intermediate: true,
      },
      criteriaDescription: [
        'Complete ankylosis',
        'At angle more than 90, or between 70 and 50',
        '(40% for non-dominant arm)',
      ],
      evidenceNeeded: [
        'Documentation of fusion',
        'Position measurement',
      ],
    },
    {
      percent: 50,
      summary: 'Flexion limited to 45 (dominant)',
      criteria: {
        flexionLimited: true,
        to45: true,
      },
      criteriaDescription: [
        'Cannot bend elbow past 45',
        'Severe limitation of flexion',
        '(40% for non-dominant arm)',
      ],
      evidenceNeeded: [
        'ROM measurements',
        'Functional impact documentation',
      ],
    },
    {
      percent: 50,
      summary: 'Extension limited to 110 (dominant)',
      criteria: {
        extensionLimited: true,
        to110: true,
      },
      criteriaDescription: [
        'Cannot extend elbow past 110 (20 from straight)',
        'Severe extension limitation',
        '(40% for non-dominant arm)',
      ],
      evidenceNeeded: [
        'ROM measurements',
        'Functional impact documentation',
      ],
    },
    {
      percent: 40,
      summary: 'Favorable elbow ankylosis at 70-90 (dominant) OR flexion to 55',
      criteria: {
        ankylosis: true,
        favorable: true,
      },
      criteriaDescription: [
        'Complete ankylosis at favorable angle (70-90), OR',
        'Flexion limited to 55',
        '(30% for non-dominant arm)',
      ],
      evidenceNeeded: [
        'Documentation of fusion or limitation',
        'Functional assessment',
      ],
    },
    {
      percent: 30,
      summary: 'Flexion limited to 70 OR extension limited to 90 (dominant)',
      criteria: {
        moderateLimitation: true,
      },
      criteriaDescription: [
        'Flexion limited to 70, OR',
        'Extension limited to 90',
        '(20% for non-dominant arm)',
      ],
      evidenceNeeded: [
        'ROM measurements',
        'Pain documentation',
        'Functional impact',
      ],
    },
    {
      percent: 20,
      summary: 'Flexion limited to 90 OR extension limited to 75',
      criteria: {
        mildModerateLimitation: true,
      },
      criteriaDescription: [
        'Flexion limited to 90, OR',
        'Extension limited to 75',
        '(Same for either arm)',
      ],
      evidenceNeeded: [
        'ROM measurements',
        'Document pain and limitations',
      ],
    },
    {
      percent: 10,
      summary: 'Flexion limited to 100 OR extension limited to 45-60',
      criteria: {
        mildLimitation: true,
      },
      criteriaDescription: [
        'Flexion limited to 100, OR',
        'Extension limited to 45 or 60',
        '(Same for either arm)',
      ],
      evidenceNeeded: [
        'Log elbow pain episodes',
        'Document ROM limitations',
      ],
    },
    {
      percent: 0,
      summary: 'Minimal symptoms or normal motion',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Flexion greater than 110',
        'Extension limited to less than 45',
        'Normal or near-normal function',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    ankylosis: {
      term: 'Elbow Ankylosis',
      definition: 'Complete fusion or immobility of the elbow joint.',
      examples: [
        'Elbow does not bend or straighten at all',
        'Surgical elbow fusion',
        'Complete stiffness from severe trauma',
      ],
    },
    elbowROM: {
      term: 'Elbow Range of Motion',
      definition: 'Normal elbow ROM is 0 extension (fully straight) to 145 flexion (fully bent). Normal pronation and supination each 80.',
      examples: [
        'Cannot bend elbow fully (limited flexion)',
        'Cannot straighten elbow (limited extension)',
        'Cannot rotate forearm palm up (supination)',
        'Cannot rotate forearm palm down (pronation)',
      ],
    },
    favorableAngle: {
      term: 'Favorable Angle',
      definition: 'Elbow fused between 70 and 90 - the functional range for daily activities.',
    },
  },

  disclaimer: 'This analysis is based on logged elbow symptoms. VA rating requires orthopedic examination with ROM measurements. Note whether condition affects dominant or non-dominant arm.',
};

// ============================================
// DEGENERATIVE ARTHRITIS RATING CRITERIA (DC 5003)
// ============================================

export const DEGENERATIVE_ARTHRITIS_CRITERIA = {
  diagnosticCode: '5003',
  condition: 'Degenerative Arthritis (Osteoarthritis)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5003',

  ratingNote: 'Degenerative arthritis (DJD/OA) is typically rated based on limitation of motion of the affected joint(s). When limitation is noncompensable, X-ray evidence can support ratings.',

  ratings: [
    {
      percent: 20,
      summary: 'X-ray evidence in 2+ major joints with occasional incapacitating exacerbations',
      criteria: {
        xrayEvidence: true,
        multipleJoints: true,
        incapacitatingExacerbations: true,
      },
      criteriaDescription: [
        'X-ray evidence of arthritis involvement',
        '2 or more major joints OR 2+ minor joint groups',
        'With occasional incapacitating exacerbations',
        'When limitation of motion is noncompensable',
      ],
      evidenceNeeded: [
        'X-rays showing degenerative changes in multiple joints',
        'Document flare-ups requiring rest or unable to work',
        'Track frequency and severity of exacerbations',
        'Medical records of flare-up treatment',
      ],
    },
    {
      percent: 10,
      summary: 'X-ray evidence in 2+ major joints without incapacitating exacerbations',
      criteria: {
        xrayEvidence: true,
        multipleJoints: true,
      },
      criteriaDescription: [
        'X-ray evidence of arthritis involvement',
        '2 or more major joints OR 2+ minor joint groups',
        'Without incapacitating exacerbations',
        'When limitation of motion is noncompensable',
      ],
      evidenceNeeded: [
        'X-rays showing degenerative changes',
        'Document joint pain and stiffness',
        'Track morning stiffness duration',
      ],
    },
    {
      percent: 10,
      summary: 'Single major joint with noncompensable limitation and X-ray evidence',
      criteria: {
        singleJoint: true,
        limitationPresent: true,
      },
      criteriaDescription: [
        'Limitation of motion present but noncompensable',
        'Objectively confirmed (swelling, muscle spasm, or painful motion)',
        'For each major joint or group of minor joints affected',
      ],
      evidenceNeeded: [
        'Document painful motion',
        'X-ray showing degenerative changes',
        'Clinical exam findings',
      ],
    },
    {
      percent: 0,
      summary: 'Rate based on limitation of motion of specific joint',
      criteria: {
        rateUnderJoint: true,
      },
      criteriaDescription: [
        'When limitation of motion is compensable',
        'Rate under the specific joint diagnostic code',
        'E.g., knee (5260-5261), shoulder (5201), etc.',
      ],
      evidenceNeeded: [
        'Track symptoms under specific joint condition',
      ],
    },
  ],

  definitions: {
    majorJoints: {
      term: 'Major Joints',
      definition: 'For rating purposes: shoulder, elbow, wrist, hip, knee, and ankle.',
      examples: [
        'Shoulder joint',
        'Elbow joint',
        'Wrist joint',
        'Hip joint',
        'Knee joint',
        'Ankle joint',
      ],
    },
    minorJointGroups: {
      term: 'Minor Joint Groups',
      definition: 'Multiple small joints rated as groups: interphalangeal, metacarpal, carpal joints of hands; interphalangeal, metatarsal, tarsal joints of feet; cervical, thoracic, lumbar vertebrae.',
    },
    incapacitatingExacerbation: {
      term: 'Incapacitating Exacerbation',
      definition: 'A flare-up of arthritis symptoms severe enough to require rest, limit activities significantly, or seek medical treatment.',
      examples: [
        'Flare-up preventing work for a day or more',
        'Severe pain requiring bed rest',
        'Emergency or urgent care visit for joint pain',
        'Steroid injection or course of steroids for flare',
      ],
    },
    xrayEvidence: {
      term: 'X-Ray Evidence',
      definition: 'Radiographic findings showing degenerative changes: joint space narrowing, osteophytes (bone spurs), subchondral sclerosis, or cyst formation.',
    },
  },

  disclaimer: 'This analysis is based on logged arthritis symptoms. Degenerative arthritis is primarily rated on limitation of motion of specific joints. When ROM limitation is noncompensable, X-ray evidence can support 10-20% ratings. Always document which joints are affected.',
};

// ============================================
// PHASE 4A: GOUT RATING CRITERIA (DC 5017)
// Per 38 CFR 4.71a Note to DCs 5013-5024: Rated as degenerative arthritis
// ============================================

export const GOUT_CRITERIA = {
  diagnosticCode: '5017',
  condition: 'Gout',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5017',

  ratingNote: 'Per 38 CFR 4.71a Note to DCs 5013-5024: Gout is evaluated as degenerative arthritis, based on limitation of motion of affected parts. Gout differs from typical arthritis by having acute inflammatory attacks with periods of remission.',

  ratings: [
    {
      percent: 20,
      summary: 'X-ray evidence in 2+ joints with occasional incapacitating exacerbations (acute gout attacks)',
      criteriaDescription: [
        'Multiple joints affected by gout',
        'X-ray evidence showing gouty changes or tophi',
        'Occasional incapacitating exacerbations (acute gout attacks)',
        'When limitation of motion during attacks is noncompensable',
      ],
      evidenceNeeded: [
        'X-rays showing gouty changes (tophi, erosions)',
        'Document acute gout attacks (frequency, duration, severity)',
        'Track which joints are affected during each attack',
        'Medical records showing elevated uric acid levels',
        'Document flare-ups that limit work or daily activities',
      ],
    },
    {
      percent: 10,
      summary: 'X-ray evidence in 2+ joints without incapacitating exacerbations',
      criteriaDescription: [
        'Multiple joints affected by gout',
        'X-ray evidence of gouty involvement',
        'Without incapacitating exacerbations',
        'Controlled with medication',
      ],
      evidenceNeeded: [
        'X-rays showing gouty changes',
        'Document gout attack history',
        'Uric acid lab values',
        'Medication records (colchicine, allopurinol, etc.)',
      ],
    },
    {
      percent: 10,
      summary: 'Single major joint with limitation of motion and gout diagnosis',
      criteriaDescription: [
        'Single joint (commonly big toe, ankle, or knee) affected',
        'Limitation of motion present but noncompensable',
        'Confirmed gout diagnosis',
      ],
      evidenceNeeded: [
        'Joint aspiration showing urate crystals (gold standard)',
        'Elevated serum uric acid levels',
        'Document attacks and recovery time',
      ],
    },
    {
      percent: 0,
      summary: 'If significant ROM limitation, rate under specific joint code',
      criteriaDescription: [
        'When limitation of motion is compensable',
        'Rate under the specific joint diagnostic code',
        'E.g., ankle (5271), knee (5260-5261), etc.',
      ],
      evidenceNeeded: [
        'Track symptoms under specific affected joint condition',
      ],
    },
  ],

  definitions: {
    acuteGoutAttack: {
      term: 'Acute Gout Attack',
      definition: 'Sudden onset of severe joint pain, swelling, redness, and warmth, typically reaching peak intensity within 12-24 hours. Most commonly affects the first metatarsophalangeal joint (big toe).',
      examples: [
        'Big toe attack (podagra)',
        'Ankle flare with severe swelling',
        'Knee attack preventing walking',
        'Wrist attack limiting hand function',
      ],
    },
    tophi: {
      term: 'Tophi',
      definition: 'Deposits of monosodium urate crystals that form lumps under the skin, typically in chronic gout. Can cause joint damage and deformity.',
    },
    hyperuricemia: {
      term: 'Hyperuricemia',
      definition: 'Elevated uric acid levels in the blood (typically >6.8 mg/dL), which predisposes to gout attacks.',
    },
    incapacitatingExacerbation: {
      term: 'Incapacitating Exacerbation',
      definition: 'Acute gout attack severe enough to prevent normal activity, require bed rest, or seek medical treatment.',
    },
  },

  disclaimer: 'Gout is rated under DC 5017 as degenerative arthritis per 38 CFR 4.71a. Acute attacks should be documented with date, affected joint(s), duration, and severity. Lab values (uric acid) and imaging strengthen claims.',
};

// ============================================
// PHASE 4A: BURSITIS RATING CRITERIA (DC 5019)
// Per 38 CFR 4.71a Note to DCs 5013-5024: Rated as degenerative arthritis
// ============================================

export const BURSITIS_CRITERIA = {
  diagnosticCode: '5019',
  condition: 'Bursitis',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5019',

  ratingNote: 'Per 38 CFR 4.71a Note to DCs 5013-5024: Bursitis is evaluated as degenerative arthritis, based on limitation of motion of affected parts. Common locations include shoulder (subacromial), elbow (olecranon), hip (trochanteric), knee (prepatellar, infrapatellar), and ankle.',

  ratings: [
    {
      percent: 20,
      summary: 'X-ray/imaging evidence in 2+ joints with occasional incapacitating exacerbations',
      criteriaDescription: [
        'Multiple joints affected by bursitis',
        'Imaging evidence showing bursitis (ultrasound, MRI)',
        'Occasional incapacitating exacerbations',
        'When limitation of motion is noncompensable',
      ],
      evidenceNeeded: [
        'Imaging (ultrasound/MRI) showing bursitis',
        'Document flare-ups that limit work or daily activities',
        'Track which joints/bursae are affected',
        'Medical records showing steroid injections or aspiration',
      ],
    },
    {
      percent: 10,
      summary: 'Imaging evidence in 2+ joints without incapacitating exacerbations',
      criteriaDescription: [
        'Multiple joints affected by bursitis',
        'Imaging evidence of bursitis',
        'Without incapacitating exacerbations',
        'Chronic but manageable symptoms',
      ],
      evidenceNeeded: [
        'Imaging showing bursitis in multiple locations',
        'Document pain patterns and triggers',
        'Physical therapy records',
      ],
    },
    {
      percent: 10,
      summary: 'Single major joint with limitation of motion and bursitis diagnosis',
      criteriaDescription: [
        'Single joint affected (shoulder, hip, knee, elbow, ankle)',
        'Limitation of motion present but noncompensable',
        'Confirmed bursitis diagnosis',
      ],
      evidenceNeeded: [
        'Physical exam findings (tenderness over bursa)',
        'Imaging showing fluid in bursa',
        'Document functional limitations',
      ],
    },
    {
      percent: 0,
      summary: 'If significant ROM limitation, rate under specific joint code',
      criteriaDescription: [
        'When limitation of motion is compensable',
        'Rate under the specific joint diagnostic code',
        'E.g., shoulder (5201), hip (5251-5253), knee (5260-5261)',
      ],
      evidenceNeeded: [
        'Track symptoms under specific affected joint condition',
      ],
    },
  ],

  definitions: {
    bursa: {
      term: 'Bursa',
      definition: 'Small fluid-filled sacs that cushion bones, tendons, and muscles near joints. When inflamed, they cause pain and limit motion.',
    },
    commonBursitisLocations: {
      term: 'Common Bursitis Locations',
      definition: 'Shoulder (subacromial/subdeltoid), elbow (olecranon), hip (trochanteric, iliopsoas), knee (prepatellar, infrapatellar, pes anserine), ankle (retrocalcaneal).',
    },
    incapacitatingExacerbation: {
      term: 'Incapacitating Exacerbation',
      definition: 'Bursitis flare-up severe enough to prevent normal activity, require rest, or seek medical treatment.',
    },
  },

  disclaimer: 'Bursitis is rated under DC 5019 as degenerative arthritis per 38 CFR 4.71a. Document which bursa/joint is affected, pain location, and functional limitations. Imaging (ultrasound/MRI) and injection records strengthen claims.',
};

// ============================================
// PHASE 4A: TENDINITIS/TENOSYNOVITIS RATING CRITERIA (DC 5024)
// Per 38 CFR 4.71a Note to DCs 5013-5024: Rated as degenerative arthritis
// ============================================

export const TENDINITIS_CRITERIA = {
  diagnosticCode: '5024',
  condition: 'Tendinitis/Tenosynovitis',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5024',

  ratingNote: 'Per 38 CFR 4.71a Note to DCs 5013-5024: Tendinitis, tenosynovitis, tendinosis, and tendinopathy are evaluated as degenerative arthritis, based on limitation of motion of affected parts. Common types include rotator cuff tendinitis, tennis elbow (lateral epicondylitis), golfer\'s elbow (medial epicondylitis), patellar tendinitis, and Achilles tendinitis.',

  ratings: [
    {
      percent: 20,
      summary: 'Imaging evidence in 2+ tendons/joints with occasional incapacitating exacerbations',
      criteriaDescription: [
        'Multiple tendons affected by tendinitis',
        'Imaging evidence showing tendon pathology (ultrasound, MRI)',
        'Occasional incapacitating exacerbations',
        'When limitation of motion is noncompensable',
      ],
      evidenceNeeded: [
        'Imaging (ultrasound/MRI) showing tendinitis, tendinosis, or tears',
        'Document flare-ups that limit work or daily activities',
        'Track which tendons are affected',
        'Medical records showing steroid injections or other treatments',
      ],
    },
    {
      percent: 10,
      summary: 'Imaging evidence in 2+ tendons/joints without incapacitating exacerbations',
      criteriaDescription: [
        'Multiple tendons affected by tendinitis',
        'Imaging evidence of tendon pathology',
        'Without incapacitating exacerbations',
        'Chronic but manageable symptoms',
      ],
      evidenceNeeded: [
        'Imaging showing tendinitis in multiple locations',
        'Document pain patterns and aggravating activities',
        'Physical therapy records',
      ],
    },
    {
      percent: 10,
      summary: 'Single major tendon with limitation of motion and tendinitis diagnosis',
      criteriaDescription: [
        'Single tendon/joint affected (shoulder, elbow, wrist, knee, ankle)',
        'Limitation of motion present but noncompensable',
        'Confirmed tendinitis diagnosis',
      ],
      evidenceNeeded: [
        'Physical exam findings (tenderness along tendon)',
        'Imaging showing tendon pathology',
        'Document functional limitations',
      ],
    },
    {
      percent: 0,
      summary: 'If significant ROM limitation, rate under specific joint code',
      criteriaDescription: [
        'When limitation of motion is compensable',
        'Rate under the specific joint diagnostic code',
        'E.g., shoulder (5201), elbow (5206-5207), wrist (5215)',
      ],
      evidenceNeeded: [
        'Track symptoms under specific affected joint condition',
      ],
    },
  ],

  definitions: {
    tendinitis: {
      term: 'Tendinitis',
      definition: 'Inflammation of a tendon, typically from overuse. Causes pain, tenderness, and mild swelling near a joint.',
    },
    tenosynovitis: {
      term: 'Tenosynovitis',
      definition: 'Inflammation of the tendon sheath (synovium surrounding the tendon). Common in wrists and fingers (De Quervain\'s tenosynovitis).',
    },
    tendinosis: {
      term: 'Tendinosis',
      definition: 'Chronic tendon degeneration without significant inflammation. Often results from long-term overuse or aging.',
    },
    commonTypes: {
      term: 'Common Types',
      definition: 'Rotator cuff tendinitis (shoulder), lateral epicondylitis (tennis elbow), medial epicondylitis (golfer\'s elbow), patellar tendinitis (jumper\'s knee), Achilles tendinitis.',
    },
    incapacitatingExacerbation: {
      term: 'Incapacitating Exacerbation',
      definition: 'Tendinitis flare-up severe enough to prevent normal activity, require rest, or seek medical treatment.',
    },
  },

  disclaimer: 'Tendinitis/tenosynovitis is rated under DC 5024 as degenerative arthritis per 38 CFR 4.71a. Document which tendon is affected, pain location, aggravating activities, and functional limitations. Imaging and treatment records strengthen claims.',
};

// ============================================
// PHASE 4B: MYOSITIS RATING CRITERIA (DC 5021)
// Per 38 CFR 4.71a Note to DCs 5013-5024: Rated as degenerative arthritis
// ============================================

export const MYOSITIS_CRITERIA = {
  diagnosticCode: '5021',
  condition: 'Myositis',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5021',

  ratingNote: 'Per 38 CFR 4.71a Note to DCs 5013-5024: Myositis is evaluated as degenerative arthritis, based on limitation of motion of affected parts. Myositis includes inflammatory conditions affecting skeletal muscles such as polymyositis, dermatomyositis, and inclusion body myositis.',

  ratings: [
    {
      percent: 20,
      summary: 'Multiple muscle groups affected with occasional incapacitating exacerbations',
      criteriaDescription: [
        'Multiple muscle groups affected by myositis',
        'Documented muscle inflammation on biopsy or imaging',
        'Occasional incapacitating exacerbations',
        'When limitation of motion is noncompensable',
      ],
      evidenceNeeded: [
        'Muscle biopsy showing inflammatory changes',
        'MRI showing muscle inflammation/edema',
        'Elevated muscle enzymes (CK, aldolase)',
        'Document flare-ups that limit work or daily activities',
        'Track which muscle groups are affected',
      ],
    },
    {
      percent: 10,
      summary: 'Multiple muscle groups affected without incapacitating exacerbations',
      criteriaDescription: [
        'Multiple muscle groups affected',
        'Documented myositis diagnosis',
        'Without incapacitating exacerbations',
        'Chronic but manageable symptoms',
      ],
      evidenceNeeded: [
        'Medical records confirming myositis diagnosis',
        'Lab values showing muscle involvement',
        'Document muscle pain and weakness patterns',
      ],
    },
    {
      percent: 10,
      summary: 'Single muscle group with limitation of motion',
      criteriaDescription: [
        'Single muscle group affected',
        'Limitation of motion present but noncompensable',
        'Confirmed myositis diagnosis',
      ],
      evidenceNeeded: [
        'Documented diagnosis',
        'Track functional limitations',
      ],
    },
    {
      percent: 0,
      summary: 'If significant limitation, rate under specific joint/muscle code',
      criteriaDescription: [
        'When limitation of motion is compensable',
        'Rate under the specific affected area diagnostic code',
      ],
      evidenceNeeded: [
        'Track symptoms under specific affected area',
      ],
    },
  ],

  definitions: {
    myositis: {
      term: 'Myositis',
      definition: 'Inflammation of skeletal muscles causing weakness, pain, and fatigue. Types include polymyositis (proximal muscle weakness), dermatomyositis (with skin rash), and inclusion body myositis.',
    },
    muscleEnzymes: {
      term: 'Muscle Enzymes',
      definition: 'Blood tests (CK, aldolase, AST, ALT, LDH) that indicate muscle damage when elevated.',
    },
    incapacitatingExacerbation: {
      term: 'Incapacitating Exacerbation',
      definition: 'Myositis flare-up severe enough to prevent normal activity, require rest, or seek medical treatment.',
    },
  },

  disclaimer: 'Myositis (DC 5021) is rated as degenerative arthritis per 38 CFR 4.71a. Lab values (muscle enzymes), biopsy, and imaging strengthen claims. Document muscle groups affected and functional limitations.',
};

// ============================================
// PHASE 4B: OSTEOMYELITIS RATING CRITERIA (DC 5000)
// Has its own unique rating schedule
// ============================================

export const OSTEOMYELITIS_CRITERIA = {
  diagnosticCode: '5000',
  condition: 'Osteomyelitis',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5000',

  ratingNote: 'Osteomyelitis has its own unique rating schedule based on severity, location, and activity status. A rating will NOT be applied following cure by removal or radical resection of the affected bone.',

  ratings: [
    {
      percent: 100,
      summary: 'Pelvis/vertebrae, major joints, multiple sites, or long history with constitutional symptoms',
      criteriaDescription: [
        'Osteomyelitis of pelvis or vertebrae',
        'Extending into major joints',
        'Multiple localization (multiple bones affected)',
        'Long history of intractability and debility',
        'Anemia, amyloid liver changes, or other continuous constitutional symptoms',
      ],
      evidenceNeeded: [
        'Imaging showing bone involvement (X-ray, MRI, CT, bone scan)',
        'Lab values showing chronic infection markers',
        'Documentation of affected bones/joints',
        'Medical records showing long treatment history',
        'Evidence of constitutional symptoms (anemia, liver changes)',
      ],
    },
    {
      percent: 60,
      summary: 'Frequent episodes with constitutional symptoms',
      criteriaDescription: [
        'Frequent recurrent episodes of active osteomyelitis',
        'Constitutional symptoms present (fever, fatigue, weight loss)',
        'Requiring repeated antibiotic courses',
      ],
      evidenceNeeded: [
        'Documentation of multiple infection episodes',
        'Lab values during active infection',
        'Antibiotic treatment records',
        'Constitutional symptom documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Definite involucrum or sequestrum, with or without discharging sinus',
      criteriaDescription: [
        'Imaging showing involucrum (new bone formation around dead bone)',
        'Imaging showing sequestrum (dead bone fragment)',
        'May have discharging sinus or may not',
      ],
      evidenceNeeded: [
        'Imaging showing involucrum or sequestrum',
        'Surgical or medical records',
        'Document any wound drainage',
      ],
    },
    {
      percent: 20,
      summary: 'Discharging sinus or active infection evidence within past 5 years',
      criteriaDescription: [
        'Discharging sinus present',
        'OR other evidence of active infection within the past 5 years',
        'History of recurrent osteomyelitis required',
      ],
      evidenceNeeded: [
        'Wound/sinus documentation with photos if possible',
        'Culture results showing infection',
        'Treatment records within past 5 years',
      ],
    },
    {
      percent: 10,
      summary: 'Inactive, following repeated episodes, no active infection in past 5 years',
      criteriaDescription: [
        'History of osteomyelitis with repeated episodes',
        'Currently inactive',
        'No evidence of active infection in past 5 years',
        'Requires 2 or more episodes following initial infection',
      ],
      evidenceNeeded: [
        'Documentation of past episodes (at least 2)',
        'Current imaging showing inactive disease',
        'Lab values showing no active infection',
      ],
    },
  ],

  definitions: {
    involucrum: {
      term: 'Involucrum',
      definition: 'New bone formation that surrounds dead bone (sequestrum) in chronic osteomyelitis. Seen on imaging as a shell of new bone.',
    },
    sequestrum: {
      term: 'Sequestrum',
      definition: 'A piece of dead bone that has separated from healthy bone during osteomyelitis. Often requires surgical removal.',
    },
    dischargingSinus: {
      term: 'Discharging Sinus',
      definition: 'An abnormal channel (tract) that drains pus from the infected bone to the skin surface.',
    },
    constitutionalSymptoms: {
      term: 'Constitutional Symptoms',
      definition: 'Systemic symptoms affecting the whole body: fever, fatigue, weight loss, night sweats, anemia.',
    },
  },

  disclaimer: 'Osteomyelitis (DC 5000) has its own rating schedule. Document infection episodes, imaging findings, and any draining wounds. A rating will NOT be applied following cure by removal or resection of affected bone.',
};

// ============================================
// PHASE 4B: MULTI-JOINT ARTHRITIS RATING CRITERIA (DC 5002)
// Active process rating schedule
// ============================================

export const MULTI_JOINT_ARTHRITIS_CRITERIA = {
  diagnosticCode: '5002',
  condition: 'Multi-Joint Arthritis (Active Process)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5002',

  ratingNote: 'DC 5002 rates multi-joint arthritis as an ACTIVE inflammatory process (rheumatoid arthritis, psoriatic arthritis, spondyloarthropathies). For CHRONIC RESIDUALS after the active process resolves, rate under DC 5003 (degenerative arthritis). Cannot combine active process rating with residual ratings - use the higher evaluation.',

  ratings: [
    {
      percent: 100,
      summary: 'Constitutional manifestations with active joint involvement, totally incapacitating',
      criteriaDescription: [
        'Constitutional manifestations (fever, weight loss, anemia) present',
        'Active joint involvement in multiple joints',
        'Condition is totally incapacitating',
        'Unable to perform daily activities or work',
      ],
      evidenceNeeded: [
        'Rheumatology records showing active disease',
        'Lab values (ESR, CRP, RF, anti-CCP) showing inflammation',
        'Documentation of constitutional symptoms',
        'Functional assessment showing total incapacity',
        'Imaging showing active joint destruction',
      ],
    },
    {
      percent: 60,
      summary: 'Weight loss AND anemia with severe health impairment, OR 4+ severely incapacitating exacerbations/year',
      criteriaDescription: [
        'Less than totally incapacitating but with:',
        'Weight loss AND anemia productive of severe impairment of health',
        'OR severely incapacitating exacerbations occurring 4 or more times per year',
        'OR a lesser number of exacerbations over prolonged periods',
      ],
      evidenceNeeded: [
        'Lab values showing anemia',
        'Weight records showing loss',
        'Document exacerbations requiring bed rest or unable to work',
        'Medical visits for flare-ups',
      ],
    },
    {
      percent: 40,
      summary: 'Definite health impairment with exam findings, OR 3+ incapacitating exacerbations/year',
      criteriaDescription: [
        'Symptom combinations productive of definite impairment of health',
        'Objectively supported by examination findings',
        'OR incapacitating exacerbations occurring 3 or more times per year',
      ],
      evidenceNeeded: [
        'Examination findings documenting joint involvement',
        'Lab markers of inflammation',
        'Document 3+ incapacitating exacerbations per year',
      ],
    },
    {
      percent: 20,
      summary: 'One or two exacerbations per year in a well-established diagnosis',
      criteriaDescription: [
        'Well-established diagnosis of inflammatory arthritis',
        'One or two exacerbations per year',
        'Managed with medication between flares',
      ],
      evidenceNeeded: [
        'Confirmed diagnosis (rheumatoid, psoriatic, etc.)',
        'Document exacerbation episodes',
        'Treatment records',
      ],
    },
  ],

  definitions: {
    activeProcess: {
      term: 'Active Process',
      definition: 'Ongoing inflammatory disease activity with elevated markers (ESR, CRP), joint swelling, warmth, and systemic symptoms. Distinguished from chronic residuals.',
    },
    constitutionalManifestations: {
      term: 'Constitutional Manifestations',
      definition: 'Systemic symptoms: fever, fatigue, weight loss, anemia, malaise that accompany active inflammatory arthritis.',
    },
    incapacitatingExacerbation: {
      term: 'Incapacitating Exacerbation',
      definition: 'Severe flare-up that prevents normal activity and requires medical treatment. Document inability to work or perform daily activities.',
    },
    chronicResiduals: {
      term: 'Chronic Residuals',
      definition: 'After the active inflammatory process resolves, any remaining joint damage (deformity, limited motion) is rated under DC 5003 as degenerative arthritis.',
    },
    examplesOfConditions: {
      term: 'Conditions Rated Under DC 5002',
      definition: 'Rheumatoid arthritis, psoriatic arthritis, spondyloarthropathies (ankylosing spondylitis, reactive arthritis), and other inflammatory multi-joint conditions.',
    },
  },

  disclaimer: 'Multi-joint arthritis (DC 5002) rates the ACTIVE inflammatory process. For chronic residuals after inflammation resolves, rate under DC 5003. Cannot combine active process ratings with residual ratings - assign the higher evaluation.',
};


// ============================================
// PHASE 4D: FOOT CONDITION RATING CRITERIA
// ============================================

// WEAK FOOT RATING CRITERIA (DC 5277)
export const WEAK_FOOT_CRITERIA = {
  diagnosticCode: '5277',
  condition: 'Weak Foot (Bilateral)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5277',

  ratingNote: 'DC 5277 rates bilateral weak foot as a symptomatic condition secondary to many constitutional conditions. The underlying condition should also be rated. Minimum rating is 10%.',

  ratings: [
    {
      percent: 10,
      summary: 'Symptomatic bilateral weak foot with atrophy, disturbed circulation, and weakness',
      criteriaDescription: [
        'Bilateral (both feet) involvement required',
        'Symptomatic condition secondary to constitutional conditions',
        'Characterized by atrophy of the musculature',
        'Disturbed circulation',
        'Weakness affecting foot function',
      ],
      evidenceNeeded: [
        'Documentation of bilateral foot weakness',
        'Evidence of muscle atrophy on examination',
        'Circulation problems (cold feet, color changes)',
        'Underlying condition causing weak feet',
        'Functional limitations from weakness',
      ],
    },
  ],

  definitions: {
    bilateralWeakFoot: {
      term: 'Bilateral Weak Foot',
      definition: 'A symptomatic condition affecting both feet, secondary to constitutional or systemic conditions, characterized by muscle atrophy, circulatory disturbance, and weakness.',
    },
    constitutionalConditions: {
      term: 'Constitutional Conditions',
      definition: 'Systemic diseases that can cause bilateral weak foot include diabetes, peripheral neuropathy, vascular disease, and neuromuscular disorders.',
    },
    muscleAtrophy: {
      term: 'Muscle Atrophy',
      definition: 'Wasting or thinning of foot muscles visible on examination or measurable by comparison with normal.',
    },
    disturbedCirculation: {
      term: 'Disturbed Circulation',
      definition: 'Circulatory problems in the feet including cold feet, color changes, delayed capillary refill, or poor wound healing.',
    },
  },

  disclaimer: 'DC 5277 provides a minimum 10% rating for bilateral weak foot. The underlying constitutional condition causing the weak foot should be separately identified and rated if appropriate.',
};

// CLAW FOOT (PES CAVUS) RATING CRITERIA (DC 5278)
export const CLAW_FOOT_CRITERIA = {
  diagnosticCode: '5278',
  condition: 'Claw Foot (Pes Cavus)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5278',

  ratingNote: 'DC 5278 rates acquired claw foot (pes cavus) based on severity and bilateral/unilateral involvement. Higher ratings require more severe deformity with hammer toes, callosities, and varus deformity.',

  ratings: [
    {
      percent: 50,
      summary: 'Bilateral: Marked plantar fascia contraction, dropped forefoot, all toes hammer, very painful callosities, marked varus',
      criteriaDescription: [
        'BILATERAL involvement (both feet)',
        'Marked contraction of plantar fascia',
        'Dropped forefoot',
        'All toes hammer toes',
        'Very painful callosities',
        'Marked varus deformity',
      ],
      evidenceNeeded: [
        'Bilateral foot examination',
        'Documentation of plantar fascia contraction',
        'X-rays showing deformity',
        'Photos of hammer toes and callosities',
        'Pain documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Unilateral severe (as 50%), OR Bilateral: toes dorsiflexed, ankle dorsiflexion to right angle, shortened plantar fascia, marked metatarsal tenderness',
      criteriaDescription: [
        'UNILATERAL with: marked plantar fascia contraction, dropped forefoot, all toes hammer, very painful callosities, marked varus',
        'OR BILATERAL with: All toes tending to dorsiflexion, limitation of dorsiflexion at ankle to right angle, shortened plantar fascia, marked tenderness under metatarsal heads',
      ],
      evidenceNeeded: [
        'Examination documenting specific findings',
        'Ankle ROM measurements',
        'Documentation of metatarsal head tenderness',
        'Toe position assessment',
      ],
    },
    {
      percent: 20,
      summary: 'Unilateral: toes dorsiflexed, ankle dorsiflexion limited to right angle, shortened plantar fascia, marked metatarsal tenderness',
      criteriaDescription: [
        'UNILATERAL with:',
        'All toes tending to dorsiflexion',
        'Limitation of dorsiflexion at ankle to right angle',
        'Shortened plantar fascia',
        'Marked tenderness under metatarsal heads',
      ],
      evidenceNeeded: [
        'Single foot examination with documented findings',
        'Ankle ROM measurement',
        'Plantar fascia assessment',
        'Metatarsal tenderness documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Bilateral OR Unilateral: Great toe dorsiflexed, some ankle dorsiflexion limitation, definite metatarsal tenderness',
      criteriaDescription: [
        'BILATERAL or UNILATERAL with:',
        'Great toe dorsiflexed',
        'Some limitation of dorsiflexion at ankle',
        'Definite tenderness under metatarsal heads',
      ],
      evidenceNeeded: [
        'Foot examination documenting toe position',
        'Ankle ROM assessment',
        'Metatarsal tenderness on exam',
      ],
    },
  ],

  definitions: {
    pesCavus: {
      term: 'Pes Cavus (Claw Foot)',
      definition: 'A foot deformity characterized by an abnormally high arch that does not flatten with weight bearing. The arch remains rigid and elevated.',
    },
    hammerToes: {
      term: 'Hammer Toes',
      definition: 'Toes bent at the middle joint in a claw-like position, often associated with claw foot deformity.',
    },
    varusDeformity: {
      term: 'Varus Deformity',
      definition: 'Inward tilting of the heel (hindfoot varus), causing weight to shift to the outer edge of the foot.',
    },
    droppedForefoot: {
      term: 'Dropped Forefoot',
      definition: 'Forefoot positioned lower than the hindfoot due to plantar flexion of the metatarsals.',
    },
    callosities: {
      term: 'Callosities',
      definition: 'Thickened areas of skin (calluses) that form from abnormal pressure, often painful in claw foot.',
    },
  },

  disclaimer: 'DC 5278 ratings cannot be combined with claw foot ratings under other foot codes. Congenital pes cavus without aggravation is typically not service-connected.',
};

// METATARSALGIA (MORTON'S DISEASE) RATING CRITERIA (DC 5279)
export const METATARSALGIA_CRITERIA = {
  diagnosticCode: '5279',
  condition: "Metatarsalgia (Morton's Disease)",
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5279',

  ratingNote: 'DC 5279 provides a single 10% rating for anterior metatarsalgia (Morton\'s disease), whether unilateral or bilateral. This is the maximum schedular rating for this condition.',

  ratings: [
    {
      percent: 10,
      summary: 'Anterior metatarsalgia, unilateral or bilateral',
      criteriaDescription: [
        'Anterior metatarsalgia (pain in ball of foot)',
        'May include Morton neuroma',
        'Unilateral OR bilateral (same rating)',
        'Pain and tenderness under metatarsal heads',
      ],
      evidenceNeeded: [
        'Diagnosis of metatarsalgia or Morton neuroma',
        'Pain documentation with location',
        'Physical examination findings',
        'Impact on walking/standing',
      ],
    },
  ],

  definitions: {
    metatarsalgia: {
      term: 'Metatarsalgia',
      definition: 'Pain in the ball of the foot (metatarsal region), typically worse with weight bearing, walking, or standing.',
    },
    mortonNeuroma: {
      term: "Morton's Neuroma",
      definition: 'A thickening of nerve tissue between the metatarsal heads, typically between the 3rd and 4th toes, causing sharp, burning pain and numbness.',
    },
    anteriorMetatarsalgia: {
      term: 'Anterior Metatarsalgia',
      definition: 'Pain specifically in the front (anterior) portion of the metatarsal region, at the ball of the foot.',
    },
  },

  disclaimer: 'DC 5279 provides only a 10% rating regardless of unilateral or bilateral involvement. For higher ratings, consider if other foot codes apply or if extraschedular consideration is warranted.',
};

// HALLUX VALGUS (BUNION) RATING CRITERIA (DC 5280)
export const HALLUX_VALGUS_CRITERIA = {
  diagnosticCode: '5280',
  condition: 'Hallux Valgus (Bunion)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5280',

  ratingNote: 'DC 5280 rates unilateral hallux valgus at 10% for either: (1) operated with resection of metatarsal head, OR (2) severe, equivalent to amputation of great toe. Each foot rated separately.',

  ratings: [
    {
      percent: 10,
      summary: 'Unilateral: Operated with metatarsal head resection, OR severe (equivalent to great toe amputation)',
      criteriaDescription: [
        'UNILATERAL hallux valgus with EITHER:',
        '1. Operated with resection of metatarsal head, OR',
        '2. Severe, if equivalent to amputation of great toe',
        'Rate each foot separately if bilateral',
      ],
      evidenceNeeded: [
        'Surgical records if operated (bunionectomy)',
        'X-rays showing severity of deformity',
        'Functional assessment comparing to toe amputation',
        'Pain and limitation documentation',
      ],
    },
    {
      percent: 0,
      summary: 'Mild to moderate hallux valgus without surgery or severe functional loss',
      criteriaDescription: [
        'Hallux valgus present but not severe',
        'No surgical resection of metatarsal head',
        'Function not equivalent to great toe amputation',
      ],
      evidenceNeeded: [
        'Diagnosis of hallux valgus',
        'Document symptoms for potential future increase',
      ],
    },
  ],

  definitions: {
    halluxValgus: {
      term: 'Hallux Valgus',
      definition: 'A deformity where the big toe angles toward the other toes, creating a prominent bump (bunion) at the base of the big toe.',
    },
    bunion: {
      term: 'Bunion',
      definition: 'The bony bump that forms on the joint at the base of the big toe due to hallux valgus deformity.',
    },
    metatarsalHeadResection: {
      term: 'Metatarsal Head Resection',
      definition: 'Surgical removal of part of the metatarsal head (bunionectomy) to correct hallux valgus deformity.',
    },
    equivalentToAmputation: {
      term: 'Equivalent to Amputation',
      definition: 'Severity causing functional loss comparable to if the great toe were amputated - severely limited motion and function.',
    },
  },

  disclaimer: 'DC 5280 rates each foot separately. Bilateral hallux valgus can result in 10% for each foot if criteria are met. Post-surgical residuals may warrant higher ratings under other codes.',
};

// HALLUX RIGIDUS RATING CRITERIA (DC 5281)
export const HALLUX_RIGIDUS_CRITERIA = {
  diagnosticCode: '5281',
  condition: 'Hallux Rigidus',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5281',

  ratingNote: 'DC 5281 rates unilateral hallux rigidus the same as severe hallux valgus (10%) when severe. Note: Cannot be combined with claw foot ratings.',

  ratings: [
    {
      percent: 10,
      summary: 'Unilateral, severe: Rate as hallux valgus, severe',
      criteriaDescription: [
        'UNILATERAL hallux rigidus',
        'Severe stiffness/rigidity of big toe joint',
        'Rate as severe hallux valgus (10%)',
        'Note: Not to be combined with claw foot ratings',
      ],
      evidenceNeeded: [
        'Diagnosis of hallux rigidus',
        'ROM measurements of big toe (MTP joint)',
        'X-rays showing arthritic changes',
        'Functional limitation documentation',
      ],
    },
    {
      percent: 0,
      summary: 'Mild to moderate hallux rigidus',
      criteriaDescription: [
        'Hallux rigidus present but not severe',
        'Some limitation of big toe motion',
        'May progress to severe over time',
      ],
      evidenceNeeded: [
        'Diagnosis documentation',
        'ROM measurements for baseline',
        'Symptom tracking for future claim',
      ],
    },
  ],

  definitions: {
    halluxRigidus: {
      term: 'Hallux Rigidus',
      definition: 'Stiffness and limited motion of the big toe at the MTP joint, usually due to arthritis. The toe becomes rigid and painful with movement.',
    },
    mtpJoint: {
      term: 'MTP Joint',
      definition: 'Metatarsophalangeal joint - the joint at the base of the big toe where the first metatarsal meets the proximal phalanx.',
    },
    boneSpur: {
      term: 'Bone Spur (Osteophyte)',
      definition: 'Bony projection that can form on top of the big toe joint in hallux rigidus, causing additional pain and limiting shoe wear.',
    },
  },

  disclaimer: 'DC 5281 rates hallux rigidus as severe hallux valgus. Cannot be combined with claw foot (DC 5278) ratings. Each foot rated separately if bilateral.',
};

// ============================================
// PHASE 4C: SPINE EXPANSION RATING CRITERIA
// DC 5235, 5236, 5238, 5240, 5241
// All use General Rating Formula for Diseases and Injuries of the Spine
// ============================================

// Shared General Rating Formula for Spine (DC 5235-5243)
// This is the same formula used by existing spine conditions
export const GENERAL_SPINE_RATING_FORMULA = {
  ratings: [
    {
      percent: 100,
      summary: 'Unfavorable ankylosis of the entire spine',
      criteriaDescription: [
        'Complete fusion of the entire spine in an unfavorable position',
        'Extremely severe and disabling condition',
        'Unable to look forward, severe postural deformity',
      ],
      evidenceNeeded: [
        'Medical imaging (X-ray, CT, MRI) showing complete spinal fusion',
        'Clinical examination documenting complete loss of spinal motion',
        'Documentation of unfavorable position (inability to look straight ahead)',
      ],
    },
    {
      percent: 50,
      summary: 'Unfavorable ankylosis of the entire thoracolumbar spine',
      criteriaDescription: [
        'Complete fusion of the thoracolumbar spine (mid and low back)',
        'In unfavorable position',
        'Severe limitation of mobility and function',
      ],
      evidenceNeeded: [
        'Imaging showing thoracolumbar ankylosis',
        'Clinical ROM measurements showing no motion',
        'Documentation of significant functional impairment',
      ],
    },
    {
      percent: 40,
      summary: 'Forward flexion 30 or less, OR favorable ankylosis of entire thoracolumbar spine',
      criteriaDescription: [
        'Forward flexion of thoracolumbar spine 30 or less (normal is 90), OR',
        'Favorable ankylosis of the entire thoracolumbar spine',
        'Significant but somewhat functional limitation',
      ],
      evidenceNeeded: [
        'ROM measurements showing forward flexion <=30',
        'Goniometer readings by healthcare provider',
        'OR imaging showing fusion in functional position',
      ],
    },
    {
      percent: 20,
      summary: 'Forward flexion 30-60, OR combined ROM <=120, OR muscle spasm causing abnormal gait/contour',
      criteriaDescription: [
        'Forward flexion greater than 30 but not greater than 60, OR',
        'Combined ROM of thoracolumbar spine not greater than 120, OR',
        'Muscle spasm or guarding severe enough to result in abnormal gait or abnormal spinal contour (scoliosis, reversed lordosis, abnormal kyphosis)',
      ],
      evidenceNeeded: [
        'ROM measurements showing limitation',
        'Clinical notes documenting muscle spasm or guarding',
        'Observation of abnormal gait or spinal contour',
      ],
    },
    {
      percent: 10,
      summary: 'Forward flexion 60-85, OR combined ROM 120-235, OR muscle spasm without abnormal gait',
      criteriaDescription: [
        'Forward flexion greater than 60 but not greater than 85, OR',
        'Combined ROM greater than 120 but not greater than 235, OR',
        'Muscle spasm, guarding, or localized tenderness not resulting in abnormal gait or abnormal spinal contour, OR',
        'Vertebral body fracture with loss of 50% or more of the height',
      ],
      evidenceNeeded: [
        'ROM measurements in the specified range',
        'Clinical examination notes',
        'Documentation of pain and functional limitations',
        'X-ray showing vertebral height loss if applicable',
      ],
    },
    {
      percent: 0,
      summary: 'Forward flexion greater than 85 with minimal symptoms',
      criteriaDescription: [
        'Forward flexion greater than 85',
        'Minimal functional impact',
        'Symptoms controlled with treatment',
      ],
      evidenceNeeded: [],
    },
  ],
  notes: [
    'Note 1: Evaluate any associated objective neurologic abnormalities (bowel, bladder, extremities) separately under appropriate diagnostic code.',
    'Note 2: For VA purposes, normal forward flexion of thoracolumbar spine is 90; extension is 30; left and right lateral flexion are 30 each; and left and right lateral rotation are 30 each. Combined ROM is sum of these (240 normal).',
    'Note 5: For VA purposes, unfavorable ankylosis is when the entire spine is fixed in flexion or extension. Fixation at 0 (neutral) is favorable ankylosis.',
  ],
};

// VERTEBRAL FRACTURE OR DISLOCATION (DC 5235)
export const VERTEBRAL_FRACTURE_CRITERIA = {
  diagnosticCode: '5235',
  condition: 'Vertebral Fracture or Dislocation',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5235',

  // Uses General Rating Formula for Spine
  ratings: GENERAL_SPINE_RATING_FORMULA.ratings,
  notes: GENERAL_SPINE_RATING_FORMULA.notes,

  definitions: {
    vertebralFracture: {
      term: 'Vertebral Fracture',
      definition: 'Break in one of the vertebral bones of the spine. Can be compression fracture, burst fracture, or fracture-dislocation.',
    },
    compressionFracture: {
      term: 'Compression Fracture',
      definition: 'Vertebra collapses, usually in the front, causing wedge shape. Common in osteoporosis or trauma. 50%+ height loss qualifies for minimum 10% rating.',
    },
    heightLoss: {
      term: 'Vertebral Height Loss',
      definition: 'Reduction in vertebral body height compared to normal. 50% or more height loss specifically noted in 10% criteria.',
    },
  },

  note: 'Vertebral fracture with 50% or more height loss qualifies for minimum 10% rating even without significant ROM limitation. Any associated neurologic abnormalities (radiculopathy, bowel/bladder dysfunction) are rated separately.',

  disclaimer: 'This analysis is based on logged symptoms. VA rating requires orthopedic examination with ROM measurements and imaging (X-ray, CT, MRI) showing fracture. Vertebral height loss should be documented by radiologist.',
};

// SACROILIAC INJURY AND WEAKNESS (DC 5236)
export const SACROILIAC_INJURY_CRITERIA = {
  diagnosticCode: '5236',
  condition: 'Sacroiliac Injury and Weakness',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5236',

  // Uses General Rating Formula for Spine
  ratings: GENERAL_SPINE_RATING_FORMULA.ratings,
  notes: GENERAL_SPINE_RATING_FORMULA.notes,

  definitions: {
    sacroiliacJoint: {
      term: 'Sacroiliac (SI) Joint',
      definition: 'Joint connecting the sacrum (base of spine) to the ilium (pelvis). SI dysfunction causes low back, buttock, and leg pain.',
    },
    siDysfunction: {
      term: 'SI Joint Dysfunction',
      definition: 'Abnormal motion (too much or too little) in the sacroiliac joint causing pain and instability.',
    },
    referredPain: {
      term: 'Referred Pain',
      definition: 'Pain felt in areas away from the actual source. SI dysfunction commonly causes referred pain to buttock, hip, groin, and leg.',
    },
  },

  note: 'SI joint dysfunction is rated under the General Rating Formula for Spine based on limitation of motion of the thoracolumbar spine. Document both SI-specific symptoms AND overall spinal ROM limitations.',

  disclaimer: 'This analysis is based on logged symptoms. VA rating requires orthopedic examination with ROM measurements. Special SI joint provocative tests (FABER, Gaenslen, compression) support diagnosis.',
};

// SPINAL STENOSIS (DC 5238)
export const SPINAL_STENOSIS_CRITERIA = {
  diagnosticCode: '5238',
  condition: 'Spinal Stenosis',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5238',

  // Uses General Rating Formula for Spine
  ratings: GENERAL_SPINE_RATING_FORMULA.ratings,
  notes: GENERAL_SPINE_RATING_FORMULA.notes,

  definitions: {
    spinalStenosis: {
      term: 'Spinal Stenosis',
      definition: 'Narrowing of the spinal canal that puts pressure on the spinal cord and nerves. Can be central (spinal cord) or foraminal (nerve roots).',
    },
    neurogenicClaudication: {
      term: 'Neurogenic Claudication',
      definition: 'Leg pain, weakness, or numbness with walking or standing that improves with sitting or bending forward. Classic symptom of lumbar spinal stenosis.',
    },
    shoppingCartSign: {
      term: 'Shopping Cart Sign',
      definition: 'Relief when leaning forward (like pushing a shopping cart) because flexion opens the spinal canal. Classic finding in spinal stenosis.',
    },
  },

  note: 'Spinal stenosis is rated under the General Rating Formula based on ROM limitation. However, associated neurologic symptoms (leg weakness, numbness, bowel/bladder changes) should be rated separately under appropriate neurologic codes (e.g., radiculopathy).',

  disclaimer: 'This analysis is based on logged symptoms. VA rating requires orthopedic examination with ROM measurements and imaging (MRI/CT) showing stenosis. Neurologic symptoms should be separately evaluated.',
};

// ANKYLOSING SPONDYLITIS (DC 5240)
export const ANKYLOSING_SPONDYLITIS_CRITERIA = {
  diagnosticCode: '5240',
  condition: 'Ankylosing Spondylitis',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5240',

  // Uses General Rating Formula for Spine
  ratings: GENERAL_SPINE_RATING_FORMULA.ratings,
  notes: GENERAL_SPINE_RATING_FORMULA.notes,

  definitions: {
    ankylosingSpondylitis: {
      term: 'Ankylosing Spondylitis',
      definition: 'Chronic inflammatory disease primarily affecting the spine and sacroiliac joints. Can cause vertebrae to fuse over time (ankylosis).',
    },
    inflammatoryBackPain: {
      term: 'Inflammatory Back Pain',
      definition: 'Back pain that improves with exercise but not rest, morning stiffness >30 minutes, awakening in second half of night, and alternating buttock pain.',
    },
    enthesitis: {
      term: 'Enthesitis',
      definition: 'Inflammation where tendons and ligaments attach to bone. Common in ankylosing spondylitis at Achilles tendon, plantar fascia, and rib attachments.',
    },
    bambooSpine: {
      term: 'Bamboo Spine',
      definition: 'X-ray appearance of fused vertebrae in advanced ankylosing spondylitis, resembling bamboo.',
    },
  },

  note: 'Ankylosing spondylitis is an inflammatory condition that can progress to spinal fusion (ankylosis). Document morning stiffness duration, night pain, and response to exercise vs rest. HLA-B27 testing and inflammatory markers (ESR, CRP) support diagnosis.',

  disclaimer: 'This analysis is based on logged symptoms. VA rating requires rheumatology evaluation with ROM measurements. Lab tests (HLA-B27, inflammatory markers) and imaging showing sacroiliitis or spinal fusion strengthen claims.',
};

// SPINAL FUSION (DC 5241)
export const SPINAL_FUSION_CRITERIA = {
  diagnosticCode: '5241',
  condition: 'Spinal Fusion',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5241',

  // Uses General Rating Formula for Spine
  ratings: GENERAL_SPINE_RATING_FORMULA.ratings,
  notes: GENERAL_SPINE_RATING_FORMULA.notes,

  definitions: {
    spinalFusion: {
      term: 'Spinal Fusion',
      definition: 'Surgical procedure joining two or more vertebrae to eliminate motion between them. May include hardware (rods, screws, cages).',
    },
    adjacentSegmentDisease: {
      term: 'Adjacent Segment Disease',
      definition: 'Degeneration of spinal segments above or below a fusion due to increased stress. Can cause pain and may require additional surgery.',
    },
    pseudoarthrosis: {
      term: 'Pseudoarthrosis',
      definition: 'Failed fusion where bone does not completely heal. Causes persistent pain and instability.',
    },
    hardwareFailure: {
      term: 'Hardware Failure',
      definition: 'Broken, loose, or migrated surgical hardware (rods, screws, cages) causing pain or instability.',
    },
  },

  note: 'Spinal fusion eliminates motion at fused segments, permanently limiting ROM. Rating is based on remaining spinal motion. Document levels fused, as multi-level fusions cause greater ROM loss. Adjacent segment disease is common complication.',

  disclaimer: 'This analysis is based on logged symptoms. VA rating requires orthopedic examination with ROM measurements. Surgical records documenting fusion levels and post-operative imaging showing fusion status are essential.',
};

// ============================================
// ASTHMA RATING CRITERIA (DC 6602)
// ============================================

export const ASTHMA_CRITERIA = {
  diagnosticCode: '6602',
  condition: 'Bronchial Asthma',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6602',

  ratings: [
    {
      percent: 100,
      summary: 'FEV-1 <40% predicted, OR FEV-1/FVC <40%, OR >1 attack/week with respiratory failure, OR daily systemic corticosteroids',
      criteria: {
        fev1Percent: [0, 39],
        fev1FvcRatio: [0, 39],
        attacksPerWeek: 1.1,
        respiratoryFailure: true,
        dailySystemicSteroids: true,
      },
      criteriaDescription: [
        'FEV-1 less than 40% of predicted value, OR',
        'FEV-1/FVC ratio less than 40%, OR',
        'More than one attack per week with episodes of respiratory failure, OR',
        'Requires daily use of systemic (oral or parenteral) high dose corticosteroids or immuno-suppressive medications',
      ],
      evidenceNeeded: [
        'Spirometry results showing FEV-1 <40% predicted',
        'FEV-1/FVC ratio calculation',
        'Documentation of frequent attacks with respiratory failure',
        'Medical records of daily systemic steroid use',
      ],
    },
    {
      percent: 60,
      summary: 'FEV-1 40-55% predicted, OR FEV-1/FVC 40-55%, OR monthly MD visits for exacerbations, OR >=3 systemic steroid courses/year',
      criteria: {
        fev1Percent: [40, 55],
        fev1FvcRatio: [40, 55],
        mdVisitsPerMonth: 1,
        systemicSteroidCourses: 3,
      },
      criteriaDescription: [
        'FEV-1 of 40-55% of predicted value, OR',
        'FEV-1/FVC ratio of 40-55%, OR',
        'At least monthly visits to physician for required care of exacerbations, OR',
        'Intermittent (at least 3 per year) courses of systemic corticosteroids',
      ],
      evidenceNeeded: [
        'Spirometry results showing FEV-1 40-55% predicted',
        'FEV-1/FVC ratio in 40-55% range',
        'Medical records showing monthly physician visits for asthma',
        'Documentation of >=3 oral steroid courses per year',
      ],
    },
    {
      percent: 30,
      summary: 'FEV-1 56-70% predicted, OR FEV-1/FVC 56-70%, OR daily inhaled bronchodilator, OR inhaled anti-inflammatory medication',
      criteria: {
        fev1Percent: [56, 70],
        fev1FvcRatio: [56, 70],
        dailyInhaledBronchodilator: true,
        inhaledAntiInflammatory: true,
      },
      criteriaDescription: [
        'FEV-1 of 56-70% of predicted value, OR',
        'FEV-1/FVC ratio of 56-70%, OR',
        'Daily inhalational or oral bronchodilator therapy, OR',
        'Inhalational anti-inflammatory medication',
      ],
      evidenceNeeded: [
        'Spirometry results showing FEV-1 56-70% predicted',
        'FEV-1/FVC ratio in 56-70% range',
        'Prescription records for daily inhaled bronchodilators',
        'Prescription records for inhaled corticosteroids or anti-inflammatory meds',
      ],
    },
    {
      percent: 10,
      summary: 'FEV-1 71-80% predicted, OR FEV-1/FVC 71-80%, OR intermittent inhaled bronchodilator therapy',
      criteria: {
        fev1Percent: [71, 80],
        fev1FvcRatio: [71, 80],
        intermittentInhaledBronchodilator: true,
      },
      criteriaDescription: [
        'FEV-1 of 71-80% of predicted value, OR',
        'FEV-1/FVC ratio of 71-80%, OR',
        'Intermittent inhalational or oral bronchodilator therapy',
      ],
      evidenceNeeded: [
        'Spirometry results showing FEV-1 71-80% predicted',
        'FEV-1/FVC ratio in 71-80% range',
        'Prescription records for rescue inhalers',
        'Documentation of intermittent bronchodilator use',
      ],
    },
    {
      percent: 0,
      summary: 'FEV-1 >80% predicted without symptoms or only minimal medication use',
      criteria: {
        fev1Percent: [81, 200],
      },
      criteriaDescription: [
        'FEV-1 greater than 80% of predicted value',
        'Minimal or no symptoms',
        'Minimal or no medication requirements',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    fev1: {
      term: 'FEV-1 (Forced Expiratory Volume in 1 second)',
      definition: 'Amount of air you can forcefully exhale in 1 second. Measured by spirometry. The VA uses this as the primary measure for asthma severity.',
      examples: [
        'Example: If your predicted FEV-1 is 4.0 L and your actual FEV-1 is 2.8 L, your FEV-1 is 70% predicted',
      ],
    },
    fev1FvcRatio: {
      term: 'FEV-1/FVC Ratio',
      definition: 'The ratio of FEV-1 to FVC (Forced Vital Capacity). Normal is typically >70-75%. Lower ratios indicate airway obstruction.',
      examples: [
        'Example: FEV-1 of 2.8 L  FVC of 4.0 L = 70% ratio',
      ],
    },
    systemicCorticosteroids: {
      term: 'Systemic Corticosteroids',
      definition: 'Oral or injectable steroids like prednisone or methylprednisolone. These are different from inhaled steroids - systemic steroids affect the whole body.',
      examples: [
        'Prednisone pills or "steroid packs" for severe exacerbations',
        'Not the same as inhaled corticosteroids like Flovent or Advair',
      ],
    },
    exacerbation: {
      term: 'Exacerbation',
      definition: 'A worsening of asthma symptoms requiring increased treatment. May require physician visit, oral steroids, or ER visit.',
    },
    bronchodilator: {
      term: 'Bronchodilator',
      definition: 'Medication that opens airways. Can be rescue inhalers (albuterol) or long-acting (salmeterol). VA distinguishes between intermittent and daily use.',
      examples: [
        'Rescue inhalers: Albuterol (ProAir, Ventolin) - used as needed',
        'Daily bronchodilators: Salmeterol (Serevent), formoterol (Foradil)',
      ],
    },
    postBronchodilator: {
      term: 'Post-Bronchodilator Testing',
      definition: 'Spirometry performed after using a bronchodilator. VA generally uses post-bronchodilator results unless pre-bronchodilator values are worse.',
    },
  },

  note: 'In the absence of clinical findings of asthma at time of examination, a verified history of asthmatic attacks must be of record.',
};

export const COPD_CRITERIA = {
  diagnosticCode: '6604',
  condition: 'Chronic Obstructive Pulmonary Disease',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6604',

  ratings: [
    {
      percent: 100,
      summary: 'FEV-1 <40%, OR FEV-1/FVC <40%, OR DLCO <40%, OR oxygen therapy, OR respiratory failure, OR cor pulmonale',
      criteria: {
        fev1Percent: [0, 39],
        fev1FvcRatio: [0, 39],
        dlcoPercent: [0, 39],
        oxygenTherapy: true,
        respiratoryFailure: true,
        corPulmonale: true,
      },
      criteriaDescription: [
        'FEV-1 less than 40% of predicted value, OR',
        'FEV-1/FVC ratio less than 40%, OR',
        'DLCO (SB) less than 40% predicted, OR',
        'Maximum exercise capacity less than 15 ml/kg/min oxygen consumption, OR',
        'Cor pulmonale (right heart failure), OR',
        'Right ventricular hypertrophy, OR',
        'Pulmonary hypertension (shown by Echo or cardiac catheterization), OR',
        'Episode(s) of acute respiratory failure, OR',
        'Requires outpatient oxygen therapy',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 <40% predicted',
        'DLCO testing showing <40% predicted',
        'Documentation of oxygen therapy prescription',
        'Echocardiogram or cardiac catheterization showing pulmonary hypertension',
        'Medical records of respiratory failure episodes',
      ],
    },
    {
      percent: 60,
      summary: 'FEV-1 40-55%, OR FEV-1/FVC 40-55%, OR DLCO 40-55%, OR max O2 consumption 15-20 ml/kg/min',
      criteria: {
        fev1Percent: [40, 55],
        fev1FvcRatio: [40, 55],
        dlcoPercent: [40, 55],
      },
      criteriaDescription: [
        'FEV-1 of 40- to 55-percent predicted, OR',
        'FEV-1/FVC of 40 to 55 percent, OR',
        'DLCO (SB) of 40- to 55-percent predicted, OR',
        'Maximum oxygen consumption of 15 to 20 ml/kg/min (with cardiorespiratory limit)',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 40-55% predicted',
        'FEV-1/FVC ratio calculation',
        'DLCO testing if available',
        'Exercise capacity testing if available',
      ],
    },
    {
      percent: 30,
      summary: 'FEV-1 56-70%, OR FEV-1/FVC 56-70%, OR DLCO 56-65%',
      criteria: {
        fev1Percent: [56, 70],
        fev1FvcRatio: [56, 70],
        dlcoPercent: [56, 65],
      },
      criteriaDescription: [
        'FEV-1 of 56- to 70-percent predicted, OR',
        'FEV-1/FVC of 56 to 70 percent, OR',
        'DLCO (SB) 56- to 65-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 56-70% predicted',
        'FEV-1/FVC ratio calculation',
        'DLCO testing if available',
      ],
    },
    {
      percent: 10,
      summary: 'FEV-1 71-80%, OR FEV-1/FVC 71-80%, OR DLCO 66-80%',
      criteria: {
        fev1Percent: [71, 80],
        fev1FvcRatio: [71, 80],
        dlcoPercent: [66, 80],
      },
      criteriaDescription: [
        'FEV-1 of 71- to 80-percent predicted, OR',
        'FEV-1/FVC of 71 to 80 percent, OR',
        'DLCO (SB) 66- to 80-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 71-80% predicted',
        'FEV-1/FVC ratio calculation',
        'DLCO testing if available',
      ],
    },
    {
      percent: 0,
      summary: 'FEV-1 >80% predicted without symptoms or only minimal symptoms',
      criteria: {
        fev1Percent: [81, 100],
      },
      criteriaDescription: [
        'FEV-1 greater than 80% of predicted value',
        'No significant pulmonary impairment demonstrated',
      ],
      evidenceNeeded: [
        'Spirometry results',
      ],
    },
  ],

  definitions: {
    fev1: {
      term: 'FEV-1 (Forced Expiratory Volume in 1 Second)',
      definition: 'The amount of air you can forcibly exhale in one second. Measured by spirometry and compared to predicted values based on age, height, and gender.',
      examples: [
        'Your FEV-1 is 2.0L, predicted is 4.0L = 50% predicted',
        'Lower percentages indicate more severe obstruction',
      ],
    },
    fev1fvc: {
      term: 'FEV-1/FVC Ratio',
      definition: 'The ratio of FEV-1 to Forced Vital Capacity. A ratio below 70% typically indicates obstructive lung disease.',
      examples: [
        'Normal ratio is typically >70%',
        'COPD typically shows ratio <70%',
      ],
    },
    dlco: {
      term: 'DLCO (Diffusion Capacity)',
      definition: 'Measures how well oxygen passes from the air sacs of the lungs into the blood. Reduced DLCO indicates impaired gas exchange.',
      examples: [
        'DLCO of 15, predicted 30 = 50% predicted',
        'Emphysema particularly affects DLCO',
      ],
    },
    corPulmonale: {
      term: 'Cor Pulmonale',
      definition: 'Right-sided heart failure caused by lung disease. The right ventricle enlarges due to increased pulmonary pressure.',
      examples: [
        'Swelling in legs and ankles',
        'Shortness of breath at rest',
        'Diagnosed by echocardiogram',
      ],
    },
    oxygenTherapy: {
      term: 'Supplemental Oxygen Therapy',
      definition: 'Medical oxygen prescribed for use at home, during activity, or continuously due to low blood oxygen levels.',
      examples: [
        'Oxygen concentrator at home',
        'Portable oxygen tanks',
        'Continuous vs. as-needed oxygen',
      ],
    },
  },

  pftNote: 'Pulmonary function tests (PFTs) are required to evaluate COPD. Use post-bronchodilator results unless pre-bronchodilator results are worse. When PFT results differ, use the test that most accurately reflects disability.',

  disclaimer: 'This analysis is based on logged symptoms and available measurements. VA rating requires pulmonary function testing (spirometry and DLCO). Ratings cannot be combined with other respiratory conditions under DC 6600-6847.',
};

export const CHRONIC_BRONCHITIS_CRITERIA = {
  diagnosticCode: '6600',
  condition: 'Chronic Bronchitis',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6600',

  ratings: [
    {
      percent: 100,
      summary: 'FEV-1 <40%, OR FEV-1/FVC <40%, OR DLCO <40%, OR oxygen therapy, OR respiratory failure, OR cor pulmonale',
      criteria: {
        fev1Percent: [0, 39],
        fev1FvcRatio: [0, 39],
        dlcoPercent: [0, 39],
        oxygenTherapy: true,
        respiratoryFailure: true,
        corPulmonale: true,
      },
      criteriaDescription: [
        'FEV-1 less than 40% of predicted value, OR',
        'FEV-1/FVC ratio less than 40%, OR',
        'DLCO (SB) less than 40% predicted, OR',
        'Maximum exercise capacity less than 15 ml/kg/min oxygen consumption, OR',
        'Cor pulmonale (right heart failure), OR',
        'Right ventricular hypertrophy, OR',
        'Pulmonary hypertension (shown by Echo or cardiac catheterization), OR',
        'Episode(s) of acute respiratory failure, OR',
        'Requires outpatient oxygen therapy',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 <40% predicted',
        'DLCO testing showing <40% predicted',
        'Documentation of oxygen therapy prescription',
        'Medical records of respiratory failure episodes',
      ],
    },
    {
      percent: 60,
      summary: 'FEV-1 40-55%, OR FEV-1/FVC 40-55%, OR DLCO 40-55%',
      criteria: {
        fev1Percent: [40, 55],
        fev1FvcRatio: [40, 55],
        dlcoPercent: [40, 55],
      },
      criteriaDescription: [
        'FEV-1 of 40- to 55-percent predicted, OR',
        'FEV-1/FVC of 40 to 55 percent, OR',
        'DLCO (SB) of 40- to 55-percent predicted, OR',
        'Maximum oxygen consumption of 15 to 20 ml/kg/min (with cardiorespiratory limit)',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 40-55% predicted',
        'DLCO testing if available',
      ],
    },
    {
      percent: 30,
      summary: 'FEV-1 56-70%, OR FEV-1/FVC 56-70%, OR DLCO 56-65%',
      criteria: {
        fev1Percent: [56, 70],
        fev1FvcRatio: [56, 70],
        dlcoPercent: [56, 65],
      },
      criteriaDescription: [
        'FEV-1 of 56- to 70-percent predicted, OR',
        'FEV-1/FVC of 56 to 70 percent, OR',
        'DLCO (SB) 56- to 65-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 56-70% predicted',
        'DLCO testing if available',
      ],
    },
    {
      percent: 10,
      summary: 'FEV-1 71-80%, OR FEV-1/FVC 71-80%, OR DLCO 66-80%',
      criteria: {
        fev1Percent: [71, 80],
        fev1FvcRatio: [71, 80],
        dlcoPercent: [66, 80],
      },
      criteriaDescription: [
        'FEV-1 of 71- to 80-percent predicted, OR',
        'FEV-1/FVC of 71 to 80 percent, OR',
        'DLCO (SB) 66- to 80-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 71-80% predicted',
        'DLCO testing if available',
      ],
    },
    {
      percent: 0,
      summary: 'FEV-1 >80% predicted without significant impairment',
      criteria: {
        fev1Percent: [81, 100],
      },
      criteriaDescription: [
        'FEV-1 greater than 80% of predicted value',
        'No significant pulmonary impairment demonstrated',
      ],
      evidenceNeeded: [
        'Spirometry results',
      ],
    },
  ],

  definitions: {
    chronicBronchitis: {
      term: 'Chronic Bronchitis',
      definition: 'Inflammation of the bronchial tubes with chronic productive cough for at least 3 months per year for 2 consecutive years.',
      examples: [
        'Daily productive cough',
        'Sputum production most days',
        'Recurrent respiratory infections',
      ],
    },
    productiveCough: {
      term: 'Productive Cough',
      definition: 'Cough that produces mucus (sputum). A hallmark of chronic bronchitis.',
      examples: [
        'Morning cough with phlegm',
        'Cough producing clear, white, yellow, or green mucus',
      ],
    },
    fev1: {
      term: 'FEV-1 (Forced Expiratory Volume in 1 Second)',
      definition: 'The amount of air you can forcibly exhale in one second. Key measurement for rating.',
      examples: [
        'Measured by spirometry',
        'Compared to predicted values for your age/height/gender',
      ],
    },
    dlco: {
      term: 'DLCO (Diffusion Capacity)',
      definition: 'Measures how well oxygen passes from lungs into blood.',
      examples: [
        'May be less affected in pure bronchitis vs emphysema',
        'Still important for comprehensive evaluation',
      ],
    },
  },

  pftNote: 'Pulmonary function tests (PFTs) are required. Chronic bronchitis is defined clinically by chronic productive cough but rated based on objective pulmonary function impairment.',

  disclaimer: 'This analysis is based on logged symptoms and available measurements. VA rating requires pulmonary function testing. Ratings cannot be combined with other respiratory conditions under DC 6600-6847.',
};

export const EMPHYSEMA_CRITERIA = {
  diagnosticCode: '6603',
  condition: 'Pulmonary Emphysema',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6603',

  ratings: [
    {
      percent: 100,
      summary: 'FEV-1 <40%, OR FEV-1/FVC <40%, OR DLCO <40%, OR oxygen therapy, OR respiratory failure, OR cor pulmonale',
      criteria: {
        fev1Percent: [0, 39],
        fev1FvcRatio: [0, 39],
        dlcoPercent: [0, 39],
        oxygenTherapy: true,
        respiratoryFailure: true,
        corPulmonale: true,
      },
      criteriaDescription: [
        'FEV-1 less than 40% of predicted value, OR',
        'FEV-1/FVC ratio less than 40%, OR',
        'DLCO (SB) less than 40% predicted, OR',
        'Maximum exercise capacity less than 15 ml/kg/min oxygen consumption, OR',
        'Cor pulmonale (right heart failure), OR',
        'Right ventricular hypertrophy, OR',
        'Pulmonary hypertension (shown by Echo or cardiac catheterization), OR',
        'Episode(s) of acute respiratory failure, OR',
        'Requires outpatient oxygen therapy',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 <40% predicted',
        'DLCO testing showing <40% predicted (particularly important for emphysema)',
        'Documentation of oxygen therapy prescription',
        'CT scan showing emphysematous changes',
      ],
    },
    {
      percent: 60,
      summary: 'FEV-1 40-55%, OR FEV-1/FVC 40-55%, OR DLCO 40-55%',
      criteria: {
        fev1Percent: [40, 55],
        fev1FvcRatio: [40, 55],
        dlcoPercent: [40, 55],
      },
      criteriaDescription: [
        'FEV-1 of 40- to 55-percent predicted, OR',
        'FEV-1/FVC of 40 to 55 percent, OR',
        'DLCO (SB) of 40- to 55-percent predicted, OR',
        'Maximum oxygen consumption of 15 to 20 ml/kg/min (with cardiorespiratory limit)',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 40-55% predicted',
        'DLCO testing (emphysema often significantly reduces DLCO)',
      ],
    },
    {
      percent: 30,
      summary: 'FEV-1 56-70%, OR FEV-1/FVC 56-70%, OR DLCO 56-65%',
      criteria: {
        fev1Percent: [56, 70],
        fev1FvcRatio: [56, 70],
        dlcoPercent: [56, 65],
      },
      criteriaDescription: [
        'FEV-1 of 56- to 70-percent predicted, OR',
        'FEV-1/FVC of 56 to 70 percent, OR',
        'DLCO (SB) 56- to 65-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 56-70% predicted',
        'DLCO testing',
      ],
    },
    {
      percent: 10,
      summary: 'FEV-1 71-80%, OR FEV-1/FVC 71-80%, OR DLCO 66-80%',
      criteria: {
        fev1Percent: [71, 80],
        fev1FvcRatio: [71, 80],
        dlcoPercent: [66, 80],
      },
      criteriaDescription: [
        'FEV-1 of 71- to 80-percent predicted, OR',
        'FEV-1/FVC of 71 to 80 percent, OR',
        'DLCO (SB) 66- to 80-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FEV-1 71-80% predicted',
        'DLCO testing',
      ],
    },
    {
      percent: 0,
      summary: 'FEV-1 >80% predicted without significant impairment',
      criteria: {
        fev1Percent: [81, 100],
      },
      criteriaDescription: [
        'FEV-1 greater than 80% of predicted value',
        'No significant pulmonary impairment demonstrated',
      ],
      evidenceNeeded: [
        'Spirometry results',
      ],
    },
  ],

  definitions: {
    emphysema: {
      term: 'Pulmonary Emphysema',
      definition: 'Destruction of the air sacs (alveoli) in the lungs, reducing surface area for gas exchange. Part of the COPD spectrum.',
      examples: [
        'Progressive shortness of breath',
        'Barrel-shaped chest',
        'Reduced exercise tolerance',
      ],
    },
    dlco: {
      term: 'DLCO (Diffusion Capacity)',
      definition: 'Particularly important for emphysema as destroyed alveoli significantly impair gas exchange even when airflow obstruction is mild.',
      examples: [
        'DLCO often reduced more than FEV-1 in emphysema',
        'Better indicator of emphysema severity than spirometry alone',
      ],
    },
    hyperinflation: {
      term: 'Hyperinflation / Barrel Chest',
      definition: 'Air trapping causes the lungs to remain over-inflated, leading to characteristic barrel-shaped chest appearance.',
      examples: [
        'Increased anterior-posterior chest diameter',
        'Flattened diaphragm on imaging',
        'Difficulty fully exhaling',
      ],
    },
    fev1: {
      term: 'FEV-1 (Forced Expiratory Volume in 1 Second)',
      definition: 'Volume of air exhaled in the first second of forced exhalation. May underestimate emphysema severity.',
      examples: [
        'Used in combination with DLCO for emphysema',
        'Air trapping can affect reliability',
      ],
    },
  },

  pftNote: 'Both spirometry and DLCO testing are important for emphysema evaluation. DLCO may be significantly reduced even when FEV-1 is only mildly impaired due to alveolar destruction.',

  disclaimer: 'This analysis is based on logged symptoms and available measurements. VA rating requires pulmonary function testing. DLCO is particularly important for emphysema evaluation. Ratings cannot be combined with other respiratory conditions under DC 6600-6847.',
};

// ============================================
// BRONCHIECTASIS RATING CRITERIA (DC 6601)
// Phase 11 - Rated by incapacitating episodes OR as chronic bronchitis (DC 6600)
// ============================================

export const BRONCHIECTASIS_CRITERIA = {
  diagnosticCode: '6601',
  condition: 'Bronchiectasis',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6601',

  ratings: [
    {
      percent: 100,
      summary: 'Incapacitating episodes of infection totaling 6+ weeks per year',
      criteria: {
        incapacitatingWeeks: [6, 52],
      },
      criteriaDescription: [
        'Incapacitating episodes of infection of at least six weeks total duration per year',
        'An incapacitating episode requires bedrest and treatment by a physician',
      ],
      evidenceNeeded: [
        'Medical records documenting each incapacitating episode',
        'Physician orders for bedrest during episodes',
        'Documentation of total weeks of incapacitating episodes',
        'Treatment records for each infection episode',
      ],
    },
    {
      percent: 60,
      summary: 'Incapacitating episodes 4-6 weeks/year, OR near-constant symptoms with hemoptysis requiring continuous antibiotics',
      criteria: {
        incapacitatingWeeks: [4, 6],
        nearConstantSymptoms: true,
        continuousAntibiotics: true,
      },
      criteriaDescription: [
        'Incapacitating episodes of infection of four to six weeks total duration per year, OR',
        'Near constant findings of cough with purulent sputum associated with anorexia, weight loss, and frank hemoptysis and requiring antibiotic usage almost continuously',
      ],
      evidenceNeeded: [
        'Documentation of incapacitating episodes with bedrest orders',
        'Medical records showing persistent purulent cough',
        'Evidence of weight loss and decreased appetite',
        'Records of hemoptysis (blood in sputum)',
        'Pharmacy records showing continuous/frequent antibiotic courses',
      ],
    },
    {
      percent: 30,
      summary: 'Incapacitating episodes 2-4 weeks/year, OR daily productive cough with prolonged antibiotics >2x/year',
      criteria: {
        incapacitatingWeeks: [2, 4],
        dailyProductiveCough: true,
        prolongedAntibiotics: true,
      },
      criteriaDescription: [
        'Incapacitating episodes of infection of two to four weeks total duration per year, OR',
        'Daily productive cough with sputum that is at times purulent or blood-tinged and that requires prolonged (lasting four to six weeks) antibiotic usage more than twice a year',
      ],
      evidenceNeeded: [
        'Documentation of incapacitating episodes',
        'Daily symptom logs showing productive cough',
        'Records of antibiotic courses lasting 4-6 weeks',
        'Evidence of purulent or blood-tinged sputum',
      ],
    },
    {
      percent: 10,
      summary: 'Intermittent productive cough with acute infection requiring antibiotics at least twice a year',
      criteria: {
        intermittentCough: true,
        antibioticCourses: 2,
      },
      criteriaDescription: [
        'Intermittent productive cough with acute infection requiring a course of antibiotics at least twice a year',
      ],
      evidenceNeeded: [
        'Symptom logs showing intermittent productive cough',
        'Medical records of at least 2 infections per year',
        'Documentation of antibiotic prescriptions',
      ],
    },
    {
      percent: 0,
      summary: 'Diagnosed but minimal symptoms or well-controlled',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Bronchiectasis diagnosed but symptoms controlled',
        'No significant infections requiring treatment',
      ],
      evidenceNeeded: [
        'Diagnosis confirmation (CT scan)',
      ],
    },
  ],

  alternativeRating: {
    note: 'Or rate according to pulmonary impairment as for chronic bronchitis (DC 6600)',
    reference: 'CHRONIC_BRONCHITIS_CRITERIA',
  },

  definitions: {
    incapacitatingEpisode: {
      term: 'Incapacitating Episode',
      definition: 'An episode of bronchiectasis infection that requires bedrest AND treatment by a physician. Both requirements must be met for VA rating purposes.',
      examples: [
        'Severe respiratory infection requiring bedrest',
        'Physician-ordered rest period during exacerbation',
        'Unable to perform normal activities due to infection',
      ],
    },
    bronchiectasis: {
      term: 'Bronchiectasis',
      definition: 'Permanent dilation (widening) of the bronchi caused by destruction of the muscle and elastic tissue. Usually results from chronic infection or inflammation.',
      examples: [
        'Diagnosed by CT scan showing dilated airways',
        'Chronic productive cough with daily sputum',
        'Recurrent respiratory infections',
      ],
    },
    purulentSputum: {
      term: 'Purulent Sputum',
      definition: 'Mucus/phlegm that contains pus, typically yellow, green, or brown in color, indicating bacterial infection.',
      examples: [
        'Yellow or green mucus production',
        'Thick, discolored sputum',
        'Foul-smelling sputum',
      ],
    },
    hemoptysis: {
      term: 'Hemoptysis',
      definition: 'Coughing up blood or blood-streaked sputum from the respiratory tract.',
      examples: [
        'Bright red blood in sputum',
        'Blood-streaked mucus',
        'Pink-tinged sputum',
      ],
    },
    prolongedAntibiotics: {
      term: 'Prolonged Antibiotic Usage',
      definition: 'Antibiotic courses lasting four to six weeks, significantly longer than standard 7-14 day courses.',
      examples: [
        '4-6 week antibiotic prescription',
        'Extended treatment for persistent infection',
        'Multiple courses per year',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged symptoms. VA rating requires documentation of incapacitating episodes (bedrest + physician treatment) OR can be rated based on pulmonary function testing as chronic bronchitis (DC 6600). Ratings cannot be combined with other respiratory conditions under DC 6600-6847.',
};

// ============================================
// PULMONARY FIBROSIS / INTERSTITIAL LUNG DISEASE RATING CRITERIA (DC 6825)
// Phase 11 - Uses General Rating Formula for Interstitial Lung Disease (FVC/DLCO based)
// ============================================

export const PULMONARY_FIBROSIS_CRITERIA = {
  diagnosticCode: '6825',
  condition: 'Pulmonary Fibrosis (Diffuse Interstitial Fibrosis)',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6825',

  ratings: [
    {
      percent: 100,
      summary: 'FVC <50%, OR DLCO <40%, OR max exercise <15 ml/kg/min, OR cor pulmonale, OR requires oxygen therapy',
      criteria: {
        fvcPercent: [0, 49],
        dlcoPercent: [0, 39],
        maxExercise: [0, 14],
        corPulmonale: true,
        pulmonaryHypertension: true,
        oxygenTherapy: true,
      },
      criteriaDescription: [
        'Forced Vital Capacity (FVC) less than 50-percent predicted, OR',
        'Diffusion Capacity (DLCO) less than 40-percent predicted, OR',
        'Maximum exercise capacity less than 15 ml/kg/min oxygen consumption with cardiorespiratory limitation, OR',
        'Cor pulmonale (right heart failure), OR',
        'Pulmonary hypertension, OR',
        'Requires outpatient oxygen therapy',
      ],
      evidenceNeeded: [
        'Pulmonary function test showing FVC <50% predicted',
        'DLCO testing showing <40% predicted',
        'Documentation of supplemental oxygen prescription',
        'Echocardiogram showing cor pulmonale or pulmonary hypertension',
        'Exercise testing if available',
      ],
    },
    {
      percent: 60,
      summary: 'FVC 50-64%, OR DLCO 40-55%, OR max exercise 15-20 ml/kg/min',
      criteria: {
        fvcPercent: [50, 64],
        dlcoPercent: [40, 55],
        maxExercise: [15, 20],
      },
      criteriaDescription: [
        'FVC of 50- to 64-percent predicted, OR',
        'DLCO (SB) of 40- to 55-percent predicted, OR',
        'Maximum exercise capacity of 15 to 20 ml/kg/min oxygen consumption with cardiorespiratory limitation',
      ],
      evidenceNeeded: [
        'Spirometry showing FVC 50-64% predicted',
        'DLCO testing showing 40-55% predicted',
        'Cardiopulmonary exercise testing if available',
      ],
    },
    {
      percent: 30,
      summary: 'FVC 65-74%, OR DLCO 56-65%',
      criteria: {
        fvcPercent: [65, 74],
        dlcoPercent: [56, 65],
      },
      criteriaDescription: [
        'FVC of 65- to 74-percent predicted, OR',
        'DLCO (SB) of 56- to 65-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FVC 65-74% predicted',
        'DLCO testing showing 56-65% predicted',
      ],
    },
    {
      percent: 10,
      summary: 'FVC 75-80%, OR DLCO 66-80%',
      criteria: {
        fvcPercent: [75, 80],
        dlcoPercent: [66, 80],
      },
      criteriaDescription: [
        'FVC of 75- to 80-percent predicted, OR',
        'DLCO (SB) of 66- to 80-percent predicted',
      ],
      evidenceNeeded: [
        'Spirometry showing FVC 75-80% predicted',
        'DLCO testing showing 66-80% predicted',
      ],
    },
    {
      percent: 0,
      summary: 'FVC and DLCO >80% predicted',
      criteria: {
        fvcPercent: [81, 100],
        dlcoPercent: [81, 100],
      },
      criteriaDescription: [
        'FVC greater than 80% of predicted value',
        'DLCO greater than 80% of predicted value',
        'No significant pulmonary impairment demonstrated',
      ],
      evidenceNeeded: [
        'Pulmonary function test results',
      ],
    },
  ],

  definitions: {
    interstitialLungDisease: {
      term: 'Interstitial Lung Disease (ILD)',
      definition: 'A group of disorders causing progressive scarring of lung tissue, affecting the ability to breathe and get oxygen to the bloodstream.',
      examples: [
        'Idiopathic pulmonary fibrosis (IPF)',
        'Fibrosing alveolitis',
        'Interstitial pneumonitis',
        'Drug-induced pulmonary fibrosis',
      ],
    },
    fvc: {
      term: 'FVC (Forced Vital Capacity)',
      definition: 'The total amount of air that can be forcibly exhaled after taking the deepest breath possible. Key measurement for restrictive lung diseases like pulmonary fibrosis.',
      examples: [
        'Reduced FVC indicates restricted lung expansion',
        'Expressed as percentage of predicted normal',
        'Lower values indicate more severe restriction',
      ],
    },
    dlco: {
      term: 'DLCO (Diffusion Capacity)',
      definition: 'Measures how well oxygen passes from the lungs into the bloodstream. Particularly important in interstitial lung disease.',
      examples: [
        'Reduced DLCO indicates impaired gas exchange',
        'Often affected early in pulmonary fibrosis',
        'Measured by single-breath carbon monoxide test',
      ],
    },
    corPulmonale: {
      term: 'Cor Pulmonale',
      definition: 'Right-sided heart failure caused by lung disease. The right ventricle enlarges due to chronic high pulmonary pressures.',
      examples: [
        'Complication of severe pulmonary fibrosis',
        'Diagnosed by echocardiogram',
        'Signs include leg swelling, enlarged liver',
      ],
    },
    fingerClubbing: {
      term: 'Finger Clubbing',
      definition: 'Enlargement of the fingertips and nails that curve around the fingertips. Associated with chronic lung disease and low oxygen levels.',
      examples: [
        'Nails curve downward like spoons inverted',
        'Soft tissue at nail base becomes spongy',
        'Common finding in pulmonary fibrosis',
      ],
    },
  },

  pftNote: 'Interstitial lung disease is evaluated using FVC (not FEV-1) as the primary spirometric measure, along with DLCO. FVC reflects the restrictive pattern characteristic of fibrotic lung disease.',

  disclaimer: 'This analysis is based on logged symptoms and available measurements. VA rating requires pulmonary function testing (FVC and DLCO). Ratings cannot be combined with other respiratory conditions under DC 6600-6847.',
};

// ============================================
// SARCOIDOSIS RATING CRITERIA (DC 6846)
// Phase 11 - Has specific rating criteria OR rate as chronic bronchitis (DC 6600)
// ============================================

export const SARCOIDOSIS_CRITERIA = {
  diagnosticCode: '6846',
  condition: 'Sarcoidosis',
  cfrReference: '38 CFR 4.97, Diagnostic Code 6846',

  ratings: [
    {
      percent: 100,
      summary: 'Cor pulmonale, OR cardiac involvement with CHF, OR progressive disease with fever/night sweats/weight loss despite treatment',
      criteria: {
        corPulmonale: true,
        cardiacInvolvement: true,
        congestiveHeartFailure: true,
        progressiveDisease: true,
        systemicSymptoms: true,
      },
      criteriaDescription: [
        'Cor pulmonale (right heart failure from lung involvement), OR',
        'Cardiac involvement with congestive heart failure, OR',
        'Progressive pulmonary disease with fever, night sweats, and weight loss despite treatment',
      ],
      evidenceNeeded: [
        'Echocardiogram showing cor pulmonale or cardiac involvement',
        'Documentation of congestive heart failure',
        'Medical records showing progressive disease despite treatment',
        'Documentation of systemic symptoms (fever, night sweats, weight loss)',
        'Treatment records showing failed response to therapy',
      ],
    },
    {
      percent: 60,
      summary: 'Pulmonary involvement requiring systemic high-dose (therapeutic) corticosteroids for control',
      criteria: {
        pulmonaryInvolvement: true,
        highDoseCorticosteroids: true,
        therapeuticDose: true,
      },
      criteriaDescription: [
        'Pulmonary involvement requiring systemic high dose (therapeutic) corticosteroids for control',
        'High-dose typically means prednisone 20mg+ daily or equivalent',
      ],
      evidenceNeeded: [
        'Documentation of pulmonary sarcoidosis',
        'Prescription records for high-dose systemic corticosteroids',
        'Medical records showing need for therapeutic steroid doses',
        'Evidence that lower doses do not control disease',
      ],
    },
    {
      percent: 30,
      summary: 'Pulmonary involvement with persistent symptoms requiring chronic low-dose or intermittent corticosteroids',
      criteria: {
        pulmonaryInvolvement: true,
        persistentSymptoms: true,
        maintenanceCorticosteroids: true,
      },
      criteriaDescription: [
        'Pulmonary involvement with persistent symptoms requiring chronic low dose (maintenance) or intermittent corticosteroids',
        'Low-dose/maintenance typically means prednisone <20mg daily',
      ],
      evidenceNeeded: [
        'Documentation of pulmonary sarcoidosis with ongoing symptoms',
        'Prescription records for maintenance steroid therapy',
        'Symptom logs showing persistent respiratory symptoms',
        'Medical records of intermittent steroid courses',
      ],
    },
    {
      percent: 0,
      summary: 'Chronic hilar adenopathy or stable lung infiltrates without symptoms or physiologic impairment',
      criteria: {
        asymptomatic: true,
        stableDisease: true,
      },
      criteriaDescription: [
        'Chronic hilar adenopathy or stable lung infiltrates without symptoms or physiologic impairment',
        'Disease present on imaging but not causing functional problems',
      ],
      evidenceNeeded: [
        'Imaging showing hilar adenopathy or lung infiltrates',
        'Documentation that condition is stable',
        'No treatment required',
      ],
    },
  ],

  alternativeRating: {
    note: 'Or rate active disease or residuals as chronic bronchitis (DC 6600) and extra-pulmonary involvement under specific body system involved',
    reference: 'CHRONIC_BRONCHITIS_CRITERIA',
  },

  definitions: {
    sarcoidosis: {
      term: 'Sarcoidosis',
      definition: 'An inflammatory disease that can affect multiple organs, most commonly the lungs and lymph nodes. Characterized by granulomas (clusters of inflammatory cells).',
      examples: [
        'Often discovered on routine chest X-ray',
        'Can affect lungs, skin, eyes, heart, nervous system',
        'Variable course - may resolve or become chronic',
      ],
    },
    hilarAdenopathy: {
      term: 'Hilar Adenopathy',
      definition: 'Enlargement of lymph nodes at the hilum (root) of the lung where blood vessels and bronchi enter. A common finding in sarcoidosis.',
      examples: [
        'Bilateral hilar lymphadenopathy on chest X-ray',
        'May be the only finding in early sarcoidosis',
        'Often asymptomatic',
      ],
    },
    corPulmonale: {
      term: 'Cor Pulmonale',
      definition: 'Right-sided heart failure secondary to lung disease. Occurs when pulmonary sarcoidosis causes pulmonary hypertension.',
      examples: [
        'Severe complication of pulmonary sarcoidosis',
        'Signs include leg edema, enlarged liver',
        'Diagnosed by echocardiogram',
      ],
    },
    systemicCorticosteroids: {
      term: 'Systemic Corticosteroids',
      definition: 'Oral or injectable steroids used throughout the body, as opposed to inhaled steroids which act locally in the lungs.',
      examples: [
        'Prednisone (oral)',
        'Methylprednisolone (oral or IV)',
        'Dexamethasone',
      ],
    },
    highDoseVsLowDose: {
      term: 'High-Dose vs. Low-Dose Corticosteroids',
      definition: 'High-dose (therapeutic): Prednisone 20mg+ daily or equivalent, used to control active disease. Low-dose (maintenance): Prednisone <20mg daily, used to prevent flares.',
      examples: [
        'High-dose: 40-60mg prednisone for acute flares',
        'Low-dose: 5-15mg prednisone for maintenance',
        'Intermittent: Periodic courses during flares',
      ],
    },
    extraPulmonaryInvolvement: {
      term: 'Extra-Pulmonary Involvement',
      definition: 'Sarcoidosis affecting organs other than the lungs, which should be rated separately under the appropriate body system.',
      examples: [
        'Skin lesions (rate under dermatology codes)',
        'Eye involvement/uveitis (rate under eye codes)',
        'Cardiac sarcoidosis (rate under cardiac codes)',
        'Neurological involvement (rate under neuro codes)',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged symptoms. VA rating requires documentation of pulmonary involvement and treatment requirements. Extra-pulmonary sarcoidosis should be rated separately under the specific body system involved. Active disease may alternatively be rated as chronic bronchitis (DC 6600) based on pulmonary function testing.',
};


// ============================================
// RATING CRITERIA - HEARING LOSS
// ============================================

export const HEARING_LOSS_CRITERIA = {
  description: 'Hearing loss rated based on pure-tone audiometry',
  levels: [
    {
      rating: '100%',
      criteria: [
        'Bilateral hearing loss with average of 55 dB or worse at 500, 1000, 2000 Hz',
        'With additional loss at 3000, 4000 Hz'
      ]
    },
    {
      rating: '60%',
      criteria: [
        'Bilateral hearing loss with average of 45-54 dB at 500, 1000, 2000 Hz'
      ]
    },
    {
      rating: '30%',
      criteria: [
        'Bilateral hearing loss with average of 35-44 dB at 500, 1000, 2000 Hz'
      ]
    },
    {
      rating: '10%',
      criteria: [
        'Bilateral hearing loss with average of 26-34 dB at 500, 1000, 2000 Hz'
      ]
    },
    {
      rating: '0%',
      criteria: ['Hearing loss present but below compensable level']
    }
  ],
  notes: [
    'Requires audiometry testing (pure-tone threshold test)',
    'Rating based on Maryland CNC word test or similar',
    'Unilateral hearing loss may be compensable if severe'
  ]
};

// ============================================
// RATING CRITERIA - SCARS
// ============================================

export const SCARS_CRITERIA = {
  description: 'Scars rated based on location, size, and characteristics',
  levels: [
    {
      rating: '80%',
      criteria: [
        'Head, face, or neck: deep scar(s) that cause gross distortion',
        'Extremely unsightly or disfiguring'
      ]
    },
    {
      rating: '50%',
      criteria: [
        'Head, face, or neck: 144+ square cm of scarring',
        'Unstable or painful scars over large areas'
      ]
    },
    {
      rating: '30%',
      criteria: [
        'Head, face, or neck: 72-143 square cm',
        'Or one major characteristic causing moderate disfigurement'
      ]
    },
    {
      rating: '10%',
      criteria: [
        'Head, face, or neck: 6-71 square cm',
        'Other body areas: 144+ square cm'
      ]
    },
    {
      rating: '0%',
      criteria: ['Scarring present but below compensable levels']
    }
  ],
  notes: [
    'Measure scars in square centimeters',
    'Head/face/neck scars rated higher due to visibility',
    'Unstable or painful scars may warrant higher rating',
    'Keloid scars rated based on size and characteristics'
  ]
};

// ============================================
// RATING CRITERIA - PSORIASIS
// ============================================

export const PSORIASIS_CRITERIA = {
  description: 'Psoriasis rated based on extent of body coverage and characteristics',
  levels: [
    {
      rating: '60%',
      criteria: [
        'Characteristic lesions of 40% or more of entire body',
        'Or 40% or more of exposed areas affected'
      ]
    },
    {
      rating: '30%',
      criteria: [
        'Characteristic lesions of 20-39% of entire body',
        'Or 20-39% of exposed areas affected'
      ]
    },
    {
      rating: '10%',
      criteria: [
        'Characteristic lesions of 5-19% of entire body',
        'Or 5-19% of exposed areas affected'
      ]
    },
    {
      rating: '0%',
      criteria: ['Psoriasis present but affects less than 5% of body']
    }
  ],
  notes: [
    'Exposed areas: head, face, neck, hands',
    'Use "rule of nines" or palm method (palm = ~1% body surface)',
    'Active lesions only (not clear/remission areas)',
    'Systemic therapy may indicate severity'
  ]
};

// ============================================
// RATING CRITERIA - ECZEMA/DERMATITIS
// ============================================

export const ECZEMA_CRITERIA = {
  description: 'Eczema/dermatitis rated based on extent and characteristics',
  levels: [
    {
      rating: '60%',
      criteria: [
        'More than 40% of entire body or exposed areas affected',
        'Characteristic lesions with intense itching'
      ]
    },
    {
      rating: '30%',
      criteria: [
        '20-40% of entire body or exposed areas affected'
      ]
    },
    {
      rating: '10%',
      criteria: [
        '5-20% of entire body or exposed areas affected',
        'With frequent flare-ups'
      ]
    },
    {
      rating: '0%',
      criteria: ['Eczema present but affects less than 5% of body']
    }
  ],
  notes: [
    'Exposed areas: head, face, neck, hands (rated same as body)',
    'Consider frequency and duration of flare-ups',
    'Lichenification (thickened skin) indicates chronic condition'
  ]
};

// ============================================
// RATING CRITERIA - TBI RESIDUALS
// ============================================

export const TBI_RESIDUALS_CRITERIA = {
  description: 'Residual effects of TBI rated based on cognitive, emotional, and physical symptoms',
  levels: [
    {
      rating: '100%',
      criteria: [
        'Total occupational and social impairment',
        'Unable to perform activities of daily living'
      ]
    },
    {
      rating: '70%',
      criteria: [
        'Occupational and social impairment with deficiencies in most areas',
        'Memory loss, impaired judgment, severe mood disturbance'
      ]
    },
    {
      rating: '50%',
      criteria: [
        'Occupational and social impairment with reduced reliability',
        'Memory problems, difficulty concentrating, mood issues'
      ]
    },
    {
      rating: '30%',
      criteria: [
        'Occupational and social impairment with occasional decrease in efficiency',
        'Mild memory loss, attention difficulties'
      ]
    },
    {
      rating: '10%',
      criteria: [
        'Mild residual symptoms',
        'Occasional cognitive or emotional difficulties'
      ]
    },
    {
      rating: '0%',
      criteria: ['TBI history but no current symptoms']
    }
  ],
  notes: [
    'Often rated same as main TBI rating',
    'Consider cognitive, emotional, and physical residuals',
    'Neuropsychological testing may support higher ratings',
    'Pyramidal on top of TBI rating for paralysis/motor issues'
  ]
};

// ============================================
// RATING CRITERIA - GERD COMPLICATIONS
// ============================================

export const GERD_COMPLICATIONS_CRITERIA = {
  description: 'GERD with complications rated based on severity and treatment required',
  levels: [
    {
      rating: '60%',
      criteria: [
        'Severe symptoms with Barrett\'s esophagus',
        'Or stricture requiring dilation every 2-3 months',
        'Significant weight loss, malnutrition'
      ]
    },
    {
      rating: '30%',
      criteria: [
        'Persistently recurrent symptoms with documented pathology',
        'Hiatal hernia or stricture with occasional dilation',
        'Daily medication required despite treatment'
      ]
    },
    {
      rating: '10%',
      criteria: [
        'Symptoms controlled with continuous medication',
        'Mild to moderate pathology (esophagitis, small hiatal hernia)'
      ]
    },
    {
      rating: '0%',
      criteria: ['GERD complications documented but symptoms controlled']
    }
  ],
  notes: [
    'Requires documentation of complications via endoscopy',
    'Barrett\'s esophagus is pre-cancerous condition',
    'Frequency of dilation procedures indicates severity',
    'Weight loss/malnutrition elevates rating'
  ]
};

// ============================================
// PHASE 6 CRITERIA OBJECTS - GI CONDITIONS
// ============================================

export const ULCERATIVE_COLITIS_CRITERIA = {
  diagnosticCode: '7323/7326',
  condition: 'Ulcerative Colitis / Inflammatory Bowel Disease',
  cfrReference: '38 CFR 4.114, Diagnostic Codes 7323/7326',

  ratings: [
    {
      percent: 100,
      summary: 'Severe IBD unresponsive to treatment, hospitalization 1+/year, inability to work OR 6+ diarrhea/day, 6+ rectal bleeding/day, rectal incontinence',
      criteria: {
        hospitalizationsPerYear: 1,
        unresponsiveToTreatment: true,
        diarrheaPerDay: 6,
        rectalBleedingPerDay: 6,
        rectalIncontinence: true,
      },
      criteriaDescription: [
        'Severe inflammatory bowel disease unresponsive to treatment, AND',
        'Requires hospitalization at least once per year, AND',
        'Results in inability to work OR characterized by recurrent abdominal pain with at least two of:',
        '- Six or more episodes per day of diarrhea',
        '- Six or more episodes per day of rectal bleeding',
        '- Recurrent episodes of rectal incontinence',
        '- Recurrent abdominal distension',
      ],
      evidenceNeeded: [
        'Documentation of treatment failure with multiple medications',
        'Hospital admission records',
        'Daily symptom frequency logs',
        'Work impact documentation',
      ],
    },
    {
      percent: 60,
      summary: 'Moderate IBD managed with immunosuppressants/biologics, 4-5 diarrhea episodes/day, intermittent fever/tachycardia/anemia',
      criteria: {
        immunosuppressantUse: true,
        diarrheaPerDay: [4, 5],
        intermittentToxicity: true,
      },
      criteriaDescription: [
        'Moderate inflammatory bowel disease managed on outpatient basis with immunosuppressants or other biologic agents, AND',
        'Characterized by recurrent abdominal pain, four to five daily episodes of diarrhea, AND',
        'Intermittent signs of toxicity such as fever, tachycardia, or anemia',
      ],
      evidenceNeeded: [
        'Prescription records for immunosuppressants or biologics',
        'Daily diarrhea frequency logs',
        'Documentation of fever, heart rate, or anemia episodes',
      ],
    },
    {
      percent: 30,
      summary: 'Mild-moderate IBD managed with oral/topical agents (not immunosuppressants), 3 or less diarrhea/day, minimal toxicity',
      criteria: {
        oralTopicalAgents: true,
        diarrheaPerDay: [0, 3],
        minimalToxicity: true,
      },
      criteriaDescription: [
        'Mild to moderate inflammatory bowel disease managed with oral and topical agents (other than immunosuppressants or biologics), AND',
        'Characterized by recurrent abdominal pain with three or less daily episodes of diarrhea, AND',
        'Minimal signs of toxicity such as fever, tachycardia, or anemia',
      ],
      evidenceNeeded: [
        'Prescription records for oral/topical medications',
        'Symptom frequency logs',
        'Medical records showing treatment approach',
      ],
    },
    {
      percent: 10,
      summary: 'Minimal-mild IBD managed with oral/topical agents, 3 or less diarrhea/day, no systemic toxicity',
      criteria: {
        oralTopicalAgents: true,
        diarrheaPerDay: [0, 3],
        noToxicity: true,
      },
      criteriaDescription: [
        'Minimal to mild symptomatic inflammatory bowel disease managed with oral or topical agents, AND',
        'Characterized by recurrent abdominal pain with three or less daily episodes of diarrhea, AND',
        'No signs of systemic toxicity',
      ],
      evidenceNeeded: [
        'Symptom frequency logs',
        'Medication records',
      ],
    },
  ],

  definitions: {
    ibd: {
      term: 'Inflammatory Bowel Disease (IBD)',
      definition: 'Chronic inflammation of the digestive tract, including ulcerative colitis (affects colon) and Crohn\'s disease (can affect any part of GI tract).',
      examples: [
        'Ulcerative colitis - inflammation limited to colon',
        'Crohn\'s disease - can affect entire GI tract',
        'Diagnosis confirmed by endoscopy or radiologic studies',
      ],
    },
    systemicToxicity: {
      term: 'Signs of Systemic Toxicity',
      definition: 'Fever, tachycardia (rapid heart rate), or anemia indicating the disease is affecting the whole body, not just the GI tract.',
      examples: [
        'Fever above 100.4F during flares',
        'Heart rate above 100 bpm',
        'Low hemoglobin/anemia',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged IBD symptoms. VA rating requires diagnosis confirmed by endoscopy or radiologic studies. Continue gastroenterology care and maintain detailed symptom diary.',
};

export const PEPTIC_ULCER_CRITERIA = {
  diagnosticCode: '7304',
  condition: 'Peptic Ulcer Disease',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7304',

  ratings: [
    {
      percent: 100,
      summary: 'Post-operative for perforation or hemorrhage (for 3 months)',
      criteria: {
        postOperative: true,
        perforationOrHemorrhage: true,
      },
      criteriaDescription: [
        'Post-operative status for perforation or hemorrhage',
        'This 100% rating continues for 3 months after surgery',
        'After 3 months, rate on residuals by VA examination',
      ],
      evidenceNeeded: [
        'Surgical records showing perforation or hemorrhage repair',
        'Hospital admission records',
      ],
    },
    {
      percent: 60,
      summary: 'Continuous pain, intermittent vomiting, hematemesis/melena with anemia, hospitalization 1+/year',
      criteria: {
        continuousPain: true,
        intermittentVomiting: true,
        bleeding: true,
        anemia: true,
        hospitalizationsPerYear: 1,
      },
      criteriaDescription: [
        'Continuous abdominal pain with intermittent vomiting',
        'Recurrent hematemesis (vomiting blood) or melena (tarry stools)',
        'Manifestations of anemia',
        'Requires hospitalization at least once in the past 12 months',
      ],
      evidenceNeeded: [
        'Daily pain logs',
        'Documentation of vomiting episodes',
        'Lab work showing anemia',
        'Hospital admission records',
      ],
    },
    {
      percent: 40,
      summary: 'Episodes (pain/nausea/vomiting) lasting 3+ consecutive days, 4+ times/year, daily medication',
      criteria: {
        episodeDuration: 3,
        episodesPerYear: 4,
        dailyMedication: true,
      },
      criteriaDescription: [
        'Episodes of abdominal pain, nausea, or vomiting that:',
        '- Last for at least three consecutive days in duration',
        '- Occur four or more times in the past 12 months',
        '- Are managed by daily prescribed medication',
      ],
      evidenceNeeded: [
        'Symptom logs showing episode duration and frequency',
        'Prescription records for daily medication',
      ],
    },
    {
      percent: 20,
      summary: 'Episodes lasting 3+ consecutive days, 3 times or less/year, daily medication',
      criteria: {
        episodeDuration: 3,
        episodesPerYear: [1, 3],
        dailyMedication: true,
      },
      criteriaDescription: [
        'Episodes of abdominal pain, nausea, or vomiting that:',
        '- Last for at least three consecutive days in duration',
        '- Occur three times or less in the past 12 months',
        '- Are managed by daily prescribed medication',
      ],
      evidenceNeeded: [
        'Symptom logs showing episode duration and frequency',
        'Prescription records for daily medication',
      ],
    },
    {
      percent: 0,
      summary: 'History documented by endoscopy or imaging only',
      criteria: {
        historyOnly: true,
      },
      criteriaDescription: [
        'History of peptic ulcer disease documented by endoscopy or diagnostic imaging studies',
        'Currently asymptomatic or well-controlled',
      ],
      evidenceNeeded: [
        'Endoscopy or imaging records',
      ],
    },
  ],

  definitions: {
    hematemesis: {
      term: 'Hematemesis',
      definition: 'Vomiting blood. Can be bright red or look like coffee grounds. Indicates upper GI bleeding.',
      examples: [
        'Vomiting bright red blood',
        'Vomiting material that looks like coffee grounds',
      ],
    },
    melena: {
      term: 'Melena',
      definition: 'Black, tarry stools caused by digested blood from upper GI bleeding.',
      examples: [
        'Black, sticky, tar-like stools',
        'Strong, foul odor',
        'Indicates bleeding in stomach or upper intestine',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged peptic ulcer symptoms. VA rating requires documentation by endoscopy or diagnostic imaging. Continue GI care and maintain detailed symptom diary.',
};

export const HEMORRHOID_CRITERIA = {
  diagnosticCode: '7336',
  condition: 'Hemorrhoids',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7336',

  ratings: [
    {
      percent: 20,
      summary: 'Persistent bleeding with anemia, OR continuously prolapsed with 3+ thrombosis episodes/year',
      criteria: {
        persistentBleeding: true,
        anemia: true,
        continuouslyProlapsed: true,
        thrombosisPerYear: 3,
      },
      criteriaDescription: [
        'Internal or external hemorrhoids with persistent bleeding and anemia, OR',
        'Continuously prolapsed internal hemorrhoids with three or more episodes per year of thrombosis',
      ],
      evidenceNeeded: [
        'Bleeding frequency logs',
        'Lab work showing anemia',
        'Documentation of prolapse',
        'Thrombosis episode documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Prolapsed with 2 or less thrombosis/year, OR external with 3+ thrombosis/year',
      criteria: {
        prolapsedWithThrombosis: [1, 2],
        externalWithThrombosis: 3,
      },
      criteriaDescription: [
        'Prolapsed internal hemorrhoids with two or less episodes per year of thrombosis, OR',
        'External hemorrhoids with three or more episodes per year of thrombosis',
      ],
      evidenceNeeded: [
        'Thrombosis episode logs',
        'Documentation of hemorrhoid type (internal/external)',
      ],
    },
  ],

  definitions: {
    thrombosis: {
      term: 'Hemorrhoid Thrombosis',
      definition: 'Blood clot forming in a hemorrhoid, causing severe pain, swelling, and a hard lump near the anus.',
      examples: [
        'Sudden severe pain',
        'Hard, painful lump',
        'May require medical intervention',
      ],
    },
    prolapse: {
      term: 'Prolapsed Hemorrhoids',
      definition: 'Internal hemorrhoids that have stretched and protrude outside the anus.',
      examples: [
        'Tissue protruding during bowel movements',
        'May retract on own or require manual reduction',
        'Continuously prolapsed = always protruding',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged hemorrhoid symptoms. Document bleeding frequency, thrombosis episodes, and prolapse status for VA claims.',
};

export const DIVERTICULITIS_CRITERIA = {
  diagnosticCode: '7327',
  condition: 'Diverticulitis',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7327',

  ratings: [
    {
      percent: 30,
      summary: 'Hospitalization 1+/year for abdominal distress, fever, leukocytosis WITH complications',
      criteria: {
        hospitalizationsPerYear: 1,
        withComplications: true,
      },
      criteriaDescription: [
        'Diverticular disease requiring hospitalization for abdominal distress, fever, and leukocytosis (elevated white blood cells) one or more times in the past 12 months, AND',
        'With at least one of the following complications:',
        '- Hemorrhage',
        '- Obstruction',
        '- Abscess',
        '- Peritonitis',
        '- Perforation',
      ],
      evidenceNeeded: [
        'Hospital admission records',
        'Lab work showing leukocytosis',
        'Imaging or surgical records documenting complications',
      ],
    },
    {
      percent: 20,
      summary: 'Hospitalization 1+/year for abdominal distress, fever, leukocytosis WITHOUT complications',
      criteria: {
        hospitalizationsPerYear: 1,
        withoutComplications: true,
      },
      criteriaDescription: [
        'Diverticular disease requiring hospitalization for abdominal distress, fever, and leukocytosis one or more times in the past 12 months',
        'Without associated hemorrhage, obstruction, abscess, peritonitis, or perforation',
      ],
      evidenceNeeded: [
        'Hospital admission records',
        'Lab work showing leukocytosis',
        'Medical records confirming no complications',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic or managed by diet/medication',
      criteria: {
        asymptomatic: true,
        managedConservatively: true,
      },
      criteriaDescription: [
        'Asymptomatic diverticulosis, OR',
        'Symptomatic diverticulitis that is managed by diet and medication',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    diverticulitis: {
      term: 'Diverticulitis',
      definition: 'Inflammation or infection of small pouches (diverticula) that form in the walls of the intestine, usually the colon.',
      examples: [
        'Abdominal pain, usually left lower quadrant',
        'Fever and chills',
        'Nausea and vomiting',
        'Changes in bowel habits',
      ],
    },
    complications: {
      term: 'Diverticulitis Complications',
      definition: 'Serious conditions resulting from diverticulitis that typically require hospitalization.',
      examples: [
        'Abscess - pocket of pus',
        'Perforation - hole in intestinal wall',
        'Peritonitis - infection of abdominal lining',
        'Obstruction - blocked intestine',
        'Fistula - abnormal connection between organs',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged diverticulitis symptoms. The key rating distinction is hospitalization with or without complications. Maintain records of all flare-ups and hospital visits.',
};

// ============================================
// PHASE 7 CRITERIA OBJECTS - COMMON CONDITIONS
// ============================================

export const HYPOTHYROIDISM_CRITERIA = {
  diagnosticCode: '7903',
  condition: 'Hypothyroidism',
  cfrReference: '38 CFR 4.119, Diagnostic Code 7903',

  ratings: [
    {
      percent: 100,
      summary: 'Myxedema: cold intolerance, muscular weakness, cardiovascular involvement, mental disturbance',
      criteria: {
        myxedema: true,
        coldIntolerance: true,
        muscularWeakness: true,
        cardiovascularInvolvement: true,
        mentalDisturbance: true,
      },
      criteriaDescription: [
        'Hypothyroidism manifesting as myxedema with:',
        '- Cold intolerance',
        '- Muscular weakness',
        '- Cardiovascular involvement (hypotension, bradycardia, pericardial effusion)',
        '- Mental disturbance (dementia, slowing of thought, depression)',
      ],
      evidenceNeeded: [
        'Diagnosis of myxedema',
        'Documentation of all four symptom categories',
        'Lab work showing severe hypothyroidism',
        'Cardiology records if cardiovascular involvement',
      ],
    },
    {
      percent: 30,
      summary: 'Hypothyroidism without myxedema',
      criteria: {
        hypothyroidism: true,
        withoutMyxedema: true,
      },
      criteriaDescription: [
        'Hypothyroidism without myxedema',
        'This 30% evaluation continues for six months after initial diagnosis',
        'Thereafter, rate residuals under appropriate diagnostic codes',
      ],
      evidenceNeeded: [
        'Diagnosis of hypothyroidism',
        'Lab work (TSH, T4)',
        'Medication records',
      ],
    },
  ],

  definitions: {
    myxedema: {
      term: 'Myxedema',
      definition: 'Severe, advanced hypothyroidism with skin changes, mental slowing, and life-threatening complications. A medical emergency.',
      examples: [
        'Puffy face and extremities',
        'Severe cold intolerance',
        'Extreme fatigue and mental slowness',
        'Low body temperature, blood pressure, heart rate',
      ],
    },
    hypothyroidism: {
      term: 'Hypothyroidism',
      definition: 'Underactive thyroid gland that doesn\'t produce enough thyroid hormone, causing metabolism to slow.',
      examples: [
        'Fatigue and sluggishness',
        'Weight gain',
        'Cold intolerance',
        'Dry skin and hair',
        'Constipation',
        'Depression',
      ],
    },
  },

  ratingNote: 'The 30% rating continues for 6 months after initial diagnosis. After that period, the VA rates residuals of the disease or medical treatment under the most appropriate diagnostic codes.',

  disclaimer: 'This analysis is based on logged hypothyroidism symptoms. Most Veterans will receive the 30% initial rating, then be rated on residual symptoms. Track all symptoms and medication side effects.',
};

// ============================================
// HYPERTHYROIDISM/GRAVES' DISEASE CRITERIA (DC 7900)
// ============================================
export const HYPERTHYROIDISM_CRITERIA = {
  diagnosticCode: '7900',
  condition: 'Hyperthyroidism/Graves\' Disease',
  cfrReference: '38 CFR 4.119',
  ratings: [
    {
      percent: 30,
      summary: 'For six months after initial diagnosis',
      criteria: {
        initialDiagnosis: true,
      },
      requirements: [
        'Initial diagnosis of hyperthyroidism or Graves\' disease',
        '30% rating continues for six months after initial diagnosis',
        'After six months, rate residuals under appropriate diagnostic codes',
      ],
    },
    {
      percent: 0,
      summary: 'After initial period - rate residuals separately',
      criteria: {
        residualsOnly: true,
      },
      requirements: [
        'After six-month initial period',
        'Rate cardiac involvement under DC 7008 (hyperthyroid heart disease)',
        'Rate eye involvement under appropriate eye DCs (6061-6066, 6090)',
        'Rate other residuals under appropriate body system codes',
      ],
    },
  ],
  definitions: {
    gravesDisease: {
      term: 'Graves\' Disease',
      definition: 'An autoimmune disorder causing hyperthyroidism, often with eye involvement (Graves\' ophthalmopathy).',
    },
    hyperthyroidism: {
      term: 'Hyperthyroidism',
      definition: 'Overactive thyroid producing excess thyroid hormone, causing increased metabolism, rapid heartbeat, and other symptoms.',
    },
    exophthalmos: {
      term: 'Exophthalmos',
      definition: 'Bulging of the eyes, a hallmark of Graves\' disease caused by inflammation of tissues behind the eyes.',
    },
  },
  note: 'Hyperthyroid heart disease (DC 7008) and eye involvement from Graves\' disease should be separately evaluated under their respective diagnostic codes. Track all symptoms including cardiac and eye manifestations.',
  disclaimer: 'This analysis is based on logged hyperthyroidism symptoms. The initial 30% rating applies for six months after diagnosis. After that period, residual symptoms are rated under appropriate body system codes.',
};

// ============================================
// THYROIDITIS CRITERIA (DC 7906)
// ============================================
export const THYROIDITIS_CRITERIA = {
  diagnosticCode: '7906',
  condition: 'Thyroiditis',
  cfrReference: '38 CFR 4.119',
  ratings: [
    {
      percent: 30,
      summary: 'Manifesting as hyperthyroidism - rate as DC 7900',
      criteria: {
        hyperthyroidPhase: true,
      },
      requirements: [
        'Thyroiditis with hyperthyroid symptoms',
        'Evaluate as hyperthyroidism (DC 7900)',
        'Weight loss, rapid heartbeat, heat intolerance, anxiety',
      ],
    },
    {
      percent: 30,
      summary: 'Manifesting as hypothyroidism - rate as DC 7903',
      criteria: {
        hypothyroidPhase: true,
      },
      requirements: [
        'Thyroiditis with hypothyroid symptoms',
        'Evaluate as hypothyroidism (DC 7903)',
        'Fatigue, cold intolerance, weight gain, depression',
      ],
    },
    {
      percent: 0,
      summary: 'With normal thyroid function (euthyroid)',
      criteria: {
        euthyroid: true,
      },
      requirements: [
        'Thyroiditis with normal thyroid function',
        'No hyperthyroid or hypothyroid symptoms',
      ],
    },
  ],
  definitions: {
    thyroiditis: {
      term: 'Thyroiditis',
      definition: 'Inflammation of the thyroid gland that can cause temporary hyperthyroidism followed by hypothyroidism, or may resolve to normal function.',
    },
    hashimotos: {
      term: 'Hashimoto\'s Thyroiditis',
      definition: 'An autoimmune form of thyroiditis that typically leads to hypothyroidism.',
    },
    subacute: {
      term: 'Subacute Thyroiditis',
      definition: 'Painful thyroid inflammation often following viral infection, causing temporary thyroid dysfunction.',
    },
  },
  note: 'Thyroiditis is rated based on its functional manifestation: as hyperthyroidism (DC 7900) if causing excess thyroid hormone, as hypothyroidism (DC 7903) if causing thyroid deficiency, or 0% if thyroid function is normal.',
  disclaimer: 'This analysis is based on logged thyroiditis symptoms. Rating depends on current thyroid function status - track both hyperthyroid and hypothyroid symptoms.',
};

// ============================================
// HYPERPARATHYROIDISM CRITERIA (DC 7904)
// ============================================
export const HYPERPARATHYROIDISM_CRITERIA = {
  diagnosticCode: '7904',
  condition: 'Hyperparathyroidism',
  cfrReference: '38 CFR 4.119',
  ratings: [
    {
      percent: 100,
      summary: 'For six months following surgery',
      criteria: {
        postSurgery: true,
      },
      requirements: [
        'Following parathyroid surgery',
        '100% rating for six months from date of discharge',
        'After six months, rate on residuals based on VA examination',
      ],
    },
    {
      percent: 60,
      summary: 'Hypercalcemia with objective findings',
      criteria: {
        hypercalcemia: true,
        objectiveFindings: true,
      },
      requirements: [
        'Total Ca >12 mg/dL (3-3.5 mmol/L), OR',
        'Ionized Ca >5.6 mg/dL (2-2.5 mmol/L), OR',
        'Creatinine clearance <60 mL/min, OR',
        'Bone mineral density T-score <-2.5 SD at any site, OR',
        'Previous fragility fracture',
      ],
    },
    {
      percent: 10,
      summary: 'Symptoms despite surgery or requires continuous medication',
      criteria: {
        persistentSymptoms: true,
      },
      requirements: [
        'Symptoms (fatigue, anorexia, nausea, constipation) despite surgery, OR',
        'Not a surgical candidate but requires continuous medication for control',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic',
      criteria: {
        asymptomatic: true,
      },
      requirements: [
        'No symptoms',
        'Condition controlled without medication',
      ],
    },
  ],
  definitions: {
    hyperparathyroidism: {
      term: 'Hyperparathyroidism',
      definition: 'Overproduction of parathyroid hormone (PTH) causing elevated calcium levels, bone loss, kidney stones, and other complications.',
    },
    hypercalcemia: {
      term: 'Hypercalcemia',
      definition: 'Elevated calcium levels in the blood, causing symptoms like fatigue, confusion, constipation, and bone pain.',
    },
    fragilityFracture: {
      term: 'Fragility Fracture',
      definition: 'A fracture resulting from minimal trauma (such as a fall from standing height) indicating weakened bones.',
    },
  },
  note: 'Chronic residuals such as kidney stones, decreased renal function, fractures, vision problems, and cardiovascular complications should be evaluated under their appropriate diagnostic codes.',
  disclaimer: 'This analysis is based on logged hyperparathyroidism symptoms. Lab values (calcium levels, creatinine clearance) and bone density testing significantly impact the rating.',
};

// ============================================
// HYPOPARATHYROIDISM CRITERIA (DC 7905)
// ============================================
export const HYPOPARATHYROIDISM_CRITERIA = {
  diagnosticCode: '7905',
  condition: 'Hypoparathyroidism',
  cfrReference: '38 CFR 4.119',
  ratings: [
    {
      percent: 100,
      summary: 'For three months after initial diagnosis',
      criteria: {
        initialDiagnosis: true,
      },
      requirements: [
        'Initial diagnosis of hypoparathyroidism',
        '100% rating for three months after initial diagnosis',
        'After three months, rate chronic residuals under appropriate codes',
      ],
    },
    {
      percent: 0,
      summary: 'After initial period - rate residuals separately',
      criteria: {
        residualsOnly: true,
      },
      requirements: [
        'After three-month initial period',
        'Rate kidney stones under DC 7508-7509',
        'Rate cataracts under appropriate eye DC',
        'Rate decreased renal function under DC 7530-7541',
        'Rate congestive heart failure under DC 7006',
      ],
    },
  ],
  definitions: {
    hypoparathyroidism: {
      term: 'Hypoparathyroidism',
      definition: 'Underproduction of parathyroid hormone (PTH) causing low calcium levels, muscle cramps, spasms, and neurological symptoms.',
    },
    tetany: {
      term: 'Tetany',
      definition: 'Involuntary muscle contractions and spasms caused by low calcium levels, a hallmark of hypoparathyroidism.',
    },
    hypocalcemia: {
      term: 'Hypocalcemia',
      definition: 'Low calcium levels in the blood causing numbness, tingling, muscle cramps, and potentially seizures.',
    },
  },
  note: 'Chronic residuals including kidney stones, cataracts, decreased renal function, and congestive heart failure should be evaluated under their respective diagnostic codes after the initial rating period.',
  disclaimer: 'This analysis is based on logged hypoparathyroidism symptoms. The initial 100% rating applies for three months after diagnosis. Track all residual symptoms for separate rating consideration.',
};

// ============================================
// PHASE 3B: ADRENAL & PITUITARY CRITERIA
// ============================================

/**
 * Addison's Disease Rating Criteria - DC 7911
 * 38 CFR 4.119
 */
export const ADDISONS_DISEASE_CRITERIA = {
  diagnosticCode: '7911',
  cfrReference: '38 CFR 4.119',
  condition: "Addison's Disease (Adrenocortical Insufficiency)",
  ratings: [
    {
      percent: 60,
      criteria: 'Four or more crises during the past year',
      summary: 'Four or more adrenal crises per year',
    },
    {
      percent: 40,
      criteria: 'Three crises during the past year, or; five or more episodes during the past year',
      summary: 'Three crises OR five or more episodes per year',
    },
    {
      percent: 20,
      criteria: 'One or two crises during the past year, or; two to four episodes during the past year, or; weakness and fatigability, or; corticosteroid therapy required for control',
      summary: '1-2 crises OR 2-4 episodes OR weakness/fatigue OR requires corticosteroids',
    },
  ],
  notes: [
    'An Addisonian "crisis" consists of rapid onset of peripheral vascular collapse with acute hypotension and shock',
    'Crisis findings may include: anorexia, nausea, vomiting, dehydration, profound weakness, pain in abdomen/legs/back, fever, apathy, depressed mentation with possible progression to coma, renal shutdown, and death',
    'An Addisonian "episode" is less acute and less severe than a crisis',
    'Episode may consist of: anorexia, nausea, vomiting, diarrhea, dehydration, weakness, malaise, orthostatic hypotension, or hypoglycemia, but no peripheral vascular collapse',
    'Tuberculous Addison\'s disease is evaluated as active or inactive tuberculosis',
  ],
  definitions: {
    "Addisonian Crisis": "Rapid onset of peripheral vascular collapse with acute hypotension and shock, potentially life-threatening",
    "Addisonian Episode": "Less severe event without vascular collapse - may include nausea, weakness, orthostatic hypotension, or hypoglycemia",
    "Adrenocortical Insufficiency": "Inadequate production of cortisol and/or aldosterone by the adrenal glands",
    "Hyperpigmentation": "Darkening of skin, especially in creases, scars, and mucous membranes, due to elevated ACTH",
  },
  disclaimer: 'This analysis is for documentation purposes only. VA ratings require official medical evaluation and C&P examination.',
};

/**
 * Cushing's Syndrome Rating Criteria - DC 7907
 * 38 CFR 4.119
 */
export const CUSHINGS_SYNDROME_CRITERIA = {
  diagnosticCode: '7907',
  cfrReference: '38 CFR 4.119',
  condition: "Cushing's Syndrome",
  ratings: [
    {
      percent: 100,
      criteria: 'As active, progressive disease, including areas of osteoporosis, hypertension, and proximal upper and lower extremity muscle wasting that results in inability to rise from squatting position, climb stairs, rise from a deep chair without assistance, or raise arms',
      summary: 'Active progressive disease with osteoporosis, HTN, AND severe proximal muscle wasting',
    },
    {
      percent: 60,
      criteria: 'Proximal upper or lower extremity muscle wasting that results in inability to rise from squatting position, climb stairs, rise from a deep chair without assistance, or raise arms',
      summary: 'Proximal muscle wasting causing functional limitations',
    },
    {
      percent: 30,
      criteria: 'With striae, obesity, moon face, glucose intolerance, and vascular fragility',
      summary: 'Classic Cushingoid features: striae, obesity, moon face, glucose intolerance, vascular fragility',
    },
  ],
  notes: [
    'Evaluations continue for six months following initial diagnosis',
    'After six months, rate on residuals under the appropriate diagnostic codes within the appropriate body systems',
    'Proximal muscle weakness specifically affects ability to rise from squatting, climb stairs, rise from chair, or raise arms',
  ],
  definitions: {
    "Cushing's Syndrome": "Condition resulting from prolonged exposure to elevated cortisol levels",
    "Moon Face": "Rounded, full facial appearance due to fat redistribution",
    "Buffalo Hump": "Fat accumulation between the shoulders (dorsocervical fat pad)",
    "Striae": "Purple or pink stretch marks, typically on abdomen, thighs, breasts, and arms",
    "Proximal Muscle Weakness": "Weakness affecting muscles closest to the trunk - thighs, upper arms, shoulders",
    "Vascular Fragility": "Thin skin and blood vessels that bruise easily",
  },
  disclaimer: 'This analysis is for documentation purposes only. VA ratings require official medical evaluation and C&P examination.',
};

/**
 * Diabetes Insipidus Rating Criteria - DC 7909
 * 38 CFR 4.119
 */
export const DIABETES_INSIPIDUS_CRITERIA = {
  diagnosticCode: '7909',
  cfrReference: '38 CFR 4.119',
  condition: 'Diabetes Insipidus',
  ratings: [
    {
      percent: 30,
      criteria: 'For three months after initial diagnosis',
      summary: 'For three months after initial diagnosis',
    },
    {
      percent: 10,
      criteria: 'With persistent polyuria or requiring continuous hormonal therapy',
      summary: 'Persistent polyuria OR requires continuous hormonal therapy',
    },
  ],
  notes: [
    'Initial 30% rating applies for three months after diagnosis',
    'If diabetes insipidus has subsided after initial period, rate residuals under appropriate diagnostic codes',
    'Hormonal therapy typically involves desmopressin (DDAVP)',
  ],
  definitions: {
    "Diabetes Insipidus": "Condition characterized by excretion of large amounts of severely diluted urine due to inadequate ADH production or kidney response",
    "Polyuria": "Excessive urination, typically >3 liters per day",
    "Polydipsia": "Excessive thirst",
    "ADH (Vasopressin)": "Antidiuretic hormone that regulates water balance",
    "Desmopressin": "Synthetic ADH used to treat diabetes insipidus",
  },
  disclaimer: 'This analysis is for documentation purposes only. VA ratings require official medical evaluation and C&P examination.',
};

/**
 * Hyperaldosteronism Rating Criteria - DC 7917
 * 38 CFR 4.119
 */
export const HYPERALDOSTERONISM_CRITERIA = {
  diagnosticCode: '7917',
  cfrReference: '38 CFR 4.119',
  condition: 'Hyperaldosteronism',
  ratings: [
    {
      percent: 100,
      criteria: 'If malignant neoplasm - 100% during active disease and treatment',
      summary: 'Malignant - rate as malignant neoplasm',
    },
    {
      percent: 0,
      criteria: 'If benign - evaluate residuals under appropriate diagnostic codes',
      summary: 'Benign - rate residuals (hypertension, hypokalemia effects)',
    },
  ],
  notes: [
    'Evaluate as malignant or benign neoplasm as appropriate',
    'Common residuals include hypertension (rate under DC 7101) and hypokalemia-related symptoms',
    'Conn\'s syndrome (aldosterone-producing adenoma) is the most common cause',
    'Symptoms largely driven by hypertension and low potassium',
  ],
  definitions: {
    "Hyperaldosteronism": "Excessive production of aldosterone by the adrenal glands",
    "Conn's Syndrome": "Primary hyperaldosteronism caused by an aldosterone-producing adrenal adenoma",
    "Hypokalemia": "Low potassium levels in the blood, causing muscle weakness, cramps, and cardiac effects",
    "Aldosterone": "Hormone that regulates sodium and potassium balance, affecting blood pressure",
  },
  disclaimer: 'This analysis is for documentation purposes only. VA ratings require official medical evaluation and C&P examination.',
};

export const RAYNAUDS_CRITERIA = {
  diagnosticCode: '7117',
  condition: "Raynaud's Syndrome",
  cfrReference: '38 CFR 4.104, Diagnostic Code 7117',

  ratings: [
    {
      percent: 100,
      summary: '2+ digital ulcers plus auto-amputation + history of characteristic attacks',
      criteria: {
        digitalUlcers: 2,
        autoAmputation: true,
        characteristicAttacks: true,
      },
      criteriaDescription: [
        'Two or more digital ulcers',
        'PLUS auto-amputation of one or more digits',
        'AND history of characteristic attacks',
      ],
      evidenceNeeded: [
        'Medical documentation of digital ulcers',
        'Surgical/medical records of auto-amputation',
        'Attack frequency logs',
      ],
    },
    {
      percent: 60,
      summary: '2+ digital ulcers + history of characteristic attacks',
      criteria: {
        digitalUlcers: 2,
        characteristicAttacks: true,
      },
      criteriaDescription: [
        'Two or more digital ulcers',
        'AND history of characteristic attacks',
      ],
      evidenceNeeded: [
        'Medical documentation of digital ulcers',
        'Attack frequency logs',
        'Photos of ulcers if available',
      ],
    },
    {
      percent: 40,
      summary: 'Characteristic attacks occurring at least daily',
      criteria: {
        attackFrequency: 'daily',
      },
      criteriaDescription: [
        'Characteristic attacks occurring at least daily',
      ],
      evidenceNeeded: [
        'Daily attack logs',
        'Description of color changes and symptoms',
      ],
    },
    {
      percent: 20,
      summary: 'Characteristic attacks occurring 4-6 times/week',
      criteria: {
        attacksPerWeek: [4, 6],
      },
      criteriaDescription: [
        'Characteristic attacks occurring four to six times a week',
      ],
      evidenceNeeded: [
        'Attack frequency logs',
        'Description of triggers and symptoms',
      ],
    },
    {
      percent: 10,
      summary: 'Characteristic attacks occurring 1-3 times/week',
      criteria: {
        attacksPerWeek: [1, 3],
      },
      criteriaDescription: [
        'Characteristic attacks occurring one to three times a week',
      ],
      evidenceNeeded: [
        'Attack frequency logs',
        'Description of triggers and symptoms',
      ],
    },
  ],

  definitions: {
    characteristicAttack: {
      term: 'Characteristic Attack',
      definition: 'Sequential color changes of the digits (typically white  blue  red) lasting minutes to hours, sometimes with pain and paresthesias, precipitated by cold exposure or emotional stress.',
      examples: [
        'Fingers turn white, then blue, then red',
        'Numbness or tingling during attack',
        'Pain as blood flow returns',
        'Triggered by cold or stress',
      ],
    },
    digitalUlcer: {
      term: 'Digital Ulcer',
      definition: 'Open sore on the fingers or toes caused by severe, repeated attacks reducing blood flow.',
      examples: [
        'Painful sores on fingertips',
        'Slow-healing wounds',
        'May become infected',
      ],
    },
  },

  primaryVsSecondary: "DC 7117 is for Raynaud's Syndrome (secondary Raynaud's) - caused by underlying condition. DC 7124 is for Raynaud's Disease (primary Raynaud's) - no underlying cause. Secondary is rated higher because it's typically more severe.",

  disclaimer: 'This analysis is based on logged Raynaud\'s symptoms. Attack frequency is the key rating factor. Document each attack with date, duration, triggers, and affected digits.',
};

export const VARICOSE_VEINS_CRITERIA = {
  diagnosticCode: '7120/7121',
  condition: 'Varicose Veins',
  cfrReference: '38 CFR 4.104, Diagnostic Codes 7120/7121',

  ratings: [
    {
      percent: 100,
      summary: 'Massive board-like edema with constant pain at rest',
      criteria: {
        massiveEdema: true,
        constantPainAtRest: true,
      },
      criteriaDescription: [
        'Massive board-like edema',
        'WITH constant pain at rest',
      ],
      evidenceNeeded: [
        'Medical documentation of severe edema',
        'Pain logs showing constant rest pain',
        'Photos of affected extremity',
      ],
    },
    {
      percent: 60,
      summary: 'Persistent edema, stasis pigmentation/eczema, persistent ulceration',
      criteria: {
        persistentEdema: true,
        stasisPigmentation: true,
        persistentUlceration: true,
      },
      criteriaDescription: [
        'Persistent edema or subcutaneous induration',
        'Stasis pigmentation or eczema',
        'AND persistent ulceration',
      ],
      evidenceNeeded: [
        'Medical documentation of all three findings',
        'Photos of pigmentation changes and ulcers',
        'Wound care records',
      ],
    },
    {
      percent: 40,
      summary: 'Persistent edema, stasis pigmentation/eczema, with/without intermittent ulceration',
      criteria: {
        persistentEdema: true,
        stasisPigmentation: true,
        intermittentUlceration: true,
      },
      criteriaDescription: [
        'Persistent edema',
        'AND stasis pigmentation or eczema',
        'With or without intermittent ulceration',
      ],
      evidenceNeeded: [
        'Medical documentation of edema and skin changes',
        'Photos showing pigmentation',
        'Ulcer history if applicable',
      ],
    },
    {
      percent: 20,
      summary: 'Persistent edema incompletely relieved by elevation, with/without beginning stasis pigmentation',
      criteria: {
        persistentEdema: true,
        incompleteReliefByElevation: true,
      },
      criteriaDescription: [
        'Persistent edema incompletely relieved by elevation of extremity',
        'With or without beginning stasis pigmentation or eczema',
      ],
      evidenceNeeded: [
        'Documentation of persistent swelling',
        'Notes on response to elevation',
      ],
    },
    {
      percent: 10,
      summary: 'Intermittent edema OR aching/fatigue after standing/walking, relieved by elevation/compression',
      criteria: {
        intermittentEdema: true,
        achingAfterActivity: true,
        relievedByElevation: true,
      },
      criteriaDescription: [
        'Intermittent edema of extremity, OR',
        'Aching and fatigue in leg after prolonged standing or walking',
        'Symptoms relieved by elevation of extremity or compression hosiery',
      ],
      evidenceNeeded: [
        'Symptom logs',
        'Notes on what provides relief',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic palpable or visible varicose veins',
      criteria: {
        asymptomatic: true,
      },
      criteriaDescription: [
        'Asymptomatic palpable or visible varicose veins',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    stasisPigmentation: {
      term: 'Stasis Pigmentation',
      definition: 'Brownish discoloration of the skin, usually around ankles, caused by chronic poor circulation and blood pooling.',
      examples: [
        'Brown or rust-colored skin',
        'Usually around ankles and lower legs',
        'Sign of chronic venous insufficiency',
      ],
    },
    stasisEczema: {
      term: 'Stasis Eczema (Dermatitis)',
      definition: 'Itchy, inflamed skin caused by poor circulation. Also called venous eczema.',
      examples: [
        'Red, scaly, itchy skin',
        'Usually on lower legs',
        'May weep or crust',
      ],
    },
  },

  bilateralNote: 'Rate each extremity separately and combine using the bilateral factor if applicable. Track symptoms for each leg individually.',

  disclaimer: 'This analysis is based on logged varicose vein symptoms. Document symptoms for each affected leg separately. Key factors are edema persistence, skin changes, and ulceration.',
};

export const CHRONIC_URTICARIA_CRITERIA = {
  diagnosticCode: '7825',
  condition: 'Chronic Urticaria',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7825',

  ratings: [
    {
      percent: 60,
      summary: 'Chronic refractory urticaria requiring third-line treatment',
      criteria: {
        thirdLineTreatment: true,
        refractoryToFirstSecondLine: true,
      },
      criteriaDescription: [
        'Chronic refractory urticaria that requires third line treatment for control due to ineffectiveness with first and second line treatments',
        'Third line treatments include: plasmapheresis, immunotherapy, immunosuppressives',
      ],
      evidenceNeeded: [
        'Documentation of failed first-line treatment (antihistamines)',
        'Documentation of failed second-line treatment (steroids, etc.)',
        'Prescription records for third-line treatment',
      ],
    },
    {
      percent: 30,
      summary: 'Chronic urticaria requiring second-line treatment',
      criteria: {
        secondLineTreatment: true,
      },
      criteriaDescription: [
        'Chronic urticaria that requires second line treatment for control',
        'Second line treatments include: corticosteroids, sympathomimetics, leukotriene inhibitors, neutrophil inhibitors, thyroid hormone',
      ],
      evidenceNeeded: [
        'Documentation that antihistamines alone are insufficient',
        'Prescription records for second-line treatment',
        'Outbreak frequency logs',
      ],
    },
    {
      percent: 10,
      summary: 'Chronic urticaria requiring first-line treatment (antihistamines)',
      criteria: {
        firstLineTreatment: true,
      },
      criteriaDescription: [
        'Chronic urticaria that requires first line treatment (antihistamines) for control',
      ],
      evidenceNeeded: [
        'Prescription records for antihistamines',
        'Outbreak frequency logs showing chronic pattern',
      ],
    },
  ],

  definitions: {
    chronicUrticaria: {
      term: 'Chronic Urticaria',
      definition: 'Continuous urticaria (hives) occurring at least twice per week, off treatment, for a period of six weeks or more.',
      examples: [
        'Raised, itchy welts (hives)',
        'Welts may change shape or disappear and reappear',
        'Occurring regularly for 6+ weeks',
      ],
    },
    treatmentLines: {
      term: 'Treatment Lines',
      definition: 'The progression of treatments tried for urticaria, from least to most aggressive.',
      examples: [
        'First line: Antihistamines (Zyrtec, Allegra, Benadryl)',
        'Second line: Steroids, leukotriene inhibitors (Singulair)',
        'Third line: Immunosuppressives, biologics (Xolair)',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged urticaria symptoms. The rating is based on treatment level required for control. Document all outbreaks and medications used.',
};

// ============================================
// EPILEPSY - MAJOR SEIZURES (DC 8910)
// ============================================
// Grand Mal (Generalized Tonic-Clonic) Seizures
// Rated based on frequency of major seizures over time

export const EPILEPSY_MAJOR_CRITERIA = {
  diagnosticCode: '8910',
  condition: 'Epilepsy, Grand Mal (Major Seizures)',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8910',

  note: 'A major seizure is characterized by generalized tonic-clonic convulsion with unconsciousness. Seizures must be witnessed or verified by a physician at some time. Frequency can be established by competent lay testimony. On continuous medication, minimum rating is 10%.',

  ratings: [
    {
      percent: 100,
      summary: 'Averaging at least 1 major seizure per month over the last year',
      criteriaDescription: [
        'At least 12 major seizures in the past year (average >=1/month)',
        'Major seizure = generalized tonic-clonic convulsion with unconsciousness',
        'Frequency documented over ordinary conditions of life (not hospitalized)'
      ],
      evidenceNeeded: [
        'Physician diagnosis of epilepsy',
        'Seizure logs showing dates and witnesses',
        'Medical records documenting seizure frequency',
        'Witness statements for observed seizures',
        'Documentation of tonic-clonic characteristics and loss of consciousness'
      ],
    },
    {
      percent: 80,
      summary: 'Averaging at least 1 major seizure in 3 months over the last year',
      criteriaDescription: [
        'At least 4 major seizures in the past year (average >=1 per 3 months)',
        'OR more than 10 minor seizures weekly (see DC 8911)',
        'Pattern of seizures every 3 months or less'
      ],
      evidenceNeeded: [
        'Physician diagnosis',
        'Seizure logs with dates',
        'Witness statements',
        'Medical records confirming frequency pattern'
      ],
    },
    {
      percent: 60,
      summary: 'Averaging at least 1 major seizure in 4 months over the last year',
      criteriaDescription: [
        'At least 3 major seizures in the past year (average >=1 per 4 months)',
        'OR 9-10 minor seizures per week',
        'Regular pattern of seizures'
      ],
      evidenceNeeded: [
        'Physician diagnosis',
        'Documented seizure frequency',
        'Witness accounts',
        'Medical treatment records'
      ],
    },
    {
      percent: 40,
      summary: 'At least 1 major seizure in the last 6 months or 2 in the last year',
      criteriaDescription: [
        'At least 1 major seizure in the last 6 months',
        'OR at least 2 major seizures in the last year',
        'OR averaging 5-8 minor seizures weekly'
      ],
      evidenceNeeded: [
        'Recent seizure documentation',
        'Medical records',
        'Witness statements',
        'Treatment history'
      ],
    },
    {
      percent: 20,
      summary: 'At least 1 major seizure in the last 2 years',
      criteriaDescription: [
        'At least 1 major seizure in the last 2 years',
        'OR at least 2 minor seizures in the last 6 months',
        'Less frequent but documented seizure activity'
      ],
      evidenceNeeded: [
        'Medical records of seizure(s)',
        'Physician documentation',
        'Witness accounts if available'
      ],
    },
    {
      percent: 10,
      summary: 'Confirmed diagnosis of epilepsy with history of seizures',
      criteriaDescription: [
        'Confirmed epilepsy diagnosis by physician',
        'History of seizures documented',
        'Currently on continuous medication for seizure control',
        'Minimum rating when on medication'
      ],
      evidenceNeeded: [
        'Epilepsy diagnosis from physician',
        'EEG or other diagnostic tests',
        'Medication list showing anti-epileptic drugs',
        'Medical history documenting past seizures'
      ],
    },
  ],

  definitions: {
    majorSeizure: {
      term: 'Major Seizure',
      definition: 'Generalized tonic-clonic convulsion (grand mal) with unconsciousness. Characterized by violent muscle contractions, loss of consciousness, and post-ictal confusion. Must be witnessed or verified by a physician.'
    },
    continuousMedication: {
      term: 'Continuous Medication',
      definition: 'Ongoing prescription anti-epileptic drugs required for seizure control. When medication is necessary, the minimum rating is 10% even without recent seizures.'
    },
    witnessedSeizure: {
      term: 'Witnessed/Verified Seizure',
      definition: 'Seizure observed by another person (witness statement) or verified by a physician through examination, EEG, or medical records. Required for VA rating.'
    },
  },
};

// ============================================
// EPILEPSY - MINOR SEIZURES (DC 8911)
// ============================================
// Petit Mal (Absence) and Other Minor Seizures
// Rated based on frequency of minor seizures

export const EPILEPSY_MINOR_CRITERIA = {
  diagnosticCode: '8911',
  condition: 'Epilepsy, Petit Mal (Minor Seizures)',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8911',

  note: 'A minor seizure consists of brief interruption in consciousness or conscious control: "pure" petit mal (staring, rhythmic blinking, nodding), myoclonic type (sudden jerking movements), or akinetic type (sudden loss of postural control). Use same rating formula as major seizures.',

  ratings: [
    {
      percent: 100,
      summary: 'Averaging at least 1 major seizure per month (or minor seizure equivalent)',
      criteriaDescription: [
        'More than 10 minor seizures weekly over the last year',
        'Severe frequency of absence or myoclonic seizures',
        'Significantly impairs daily functioning'
      ],
      evidenceNeeded: [
        'Physician diagnosis of petit mal epilepsy',
        'Detailed seizure logs showing frequency',
        'EEG findings consistent with absence seizures',
        'Witness accounts of episodes',
        'Impact on work/social functioning'
      ],
    },
    {
      percent: 80,
      summary: 'More than 10 minor seizures weekly',
      criteriaDescription: [
        'Greater than 10 minor seizures per week',
        'Frequent brief lapses in consciousness',
        'Regular pattern documented'
      ],
      evidenceNeeded: [
        'Physician diagnosis',
        'Seizure frequency logs',
        'EEG documentation',
        'Treatment records'
      ],
    },
    {
      percent: 60,
      summary: '9-10 minor seizures per week',
      criteriaDescription: [
        '9-10 minor seizures weekly on average',
        'Frequent absence or myoclonic episodes',
        'Documented pattern over time'
      ],
      evidenceNeeded: [
        'Detailed seizure logs',
        'Medical documentation',
        'EEG findings',
        'Witness statements'
      ],
    },
    {
      percent: 40,
      summary: 'Averaging 5-8 minor seizures weekly',
      criteriaDescription: [
        '5-8 minor seizures per week on average',
        'Regular episodes of brief consciousness disruption',
        'Documented over extended period'
      ],
      evidenceNeeded: [
        'Seizure frequency documentation',
        'Medical records',
        'EEG results',
        'Treatment history'
      ],
    },
    {
      percent: 20,
      summary: 'At least 2 minor seizures in the last 6 months',
      criteriaDescription: [
        'At least 2 minor seizures in the last 6 months',
        'Less frequent but documented episodes',
        'May be controlled with medication'
      ],
      evidenceNeeded: [
        'Medical documentation of episodes',
        'Physician notes',
        'Medication records'
      ],
    },
    {
      percent: 10,
      summary: 'Confirmed diagnosis with history of minor seizures',
      criteriaDescription: [
        'Confirmed diagnosis of petit mal epilepsy',
        'History of minor seizures',
        'Currently on continuous medication',
        'Minimum rating when on medication'
      ],
      evidenceNeeded: [
        'Epilepsy diagnosis',
        'EEG showing absence seizure pattern',
        'Medication list',
        'Medical history'
      ],
    },
  ],

  definitions: {
    minorSeizure: {
      term: 'Minor Seizure',
      definition: 'Brief interruption in consciousness or conscious control. Includes: (1) Pure petit mal - staring, rhythmic blinking, nodding; (2) Myoclonic - sudden jerking movements of arms, trunk, or head; (3) Akinetic - sudden loss of postural control.'
    },
    absenceSeizure: {
      term: 'Absence (Petit Mal) Seizure',
      definition: 'Brief lapse in awareness, typically 5-30 seconds. Person may stare blankly, have subtle eye movements, or slight nodding. No memory of the episode. Common in childhood but can persist into adulthood.'
    },
    myoclonicSeizure: {
      term: 'Myoclonic Seizure',
      definition: 'Sudden, brief jerking movements of muscles. Can affect arms, legs, or entire body. Person remains conscious. May occur in clusters.'
    },
  },
};


// ============================================
// PHASE 1D: EPILEPSY EXPANSION CRITERIA
// ============================================

// EPILEPSY - JACKSONIAN/FOCAL (DC 8912)
export const EPILEPSY_JACKSONIAN_CRITERIA = {
  diagnosticCode: '8912',
  condition: 'Epilepsy, Jacksonian and Focal Motor or Sensory',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8912',
  description: 'Focal epilepsy characterized by seizures beginning in one area of the body (motor) or with sensory symptoms, which may spread (Jacksonian march). Rate as minor seizures, except when major seizures predominate.',
  note: 'Per 38 CFR 4.124a: "Rate as minor seizures, except in the presence of major and minor seizures, rate the predominating type." Jacksonian seizures that secondarily generalize to tonic-clonic (grand mal) should be rated as major seizures.',
  disclaimer: 'This analysis is for documentation purposes only. The VA determines final ratings based on complete medical evidence, C&P examination findings, and the predominating seizure type.',
  ratings: [
    {
      percent: 100,
      summary: 'Averaging at least 1 major seizure per month over the last year',
      requirements: [
        'Secondary generalization to tonic-clonic convulsions with unconsciousness',
        'Average of 1+ generalized seizure per month for 12 months',
        'Medical documentation of seizure frequency',
      ],
      note: 'Only applicable when focal seizures predominantly secondarily generalize',
    },
    {
      percent: 80,
      summary: 'At least 1 major seizure in 3 months over the last year; OR more than 10 minor seizures weekly',
      requirements: [
        'Average 1 major (generalized) seizure every 3 months, OR',
        'More than 10 focal seizures per week',
      ],
    },
    {
      percent: 60,
      summary: 'At least 1 major seizure in 4 months over the last year; OR 9-10 minor seizures per week',
      requirements: [
        'Average 1 major seizure every 4 months, OR',
        '9-10 focal seizures per week',
      ],
    },
    {
      percent: 40,
      summary: 'At least 1 major seizure in last 6 months or 2 in last year; OR 5-8 minor seizures weekly',
      requirements: [
        '1+ major seizure in last 6 months OR 2+ in last year, OR',
        '5-8 focal seizures per week',
      ],
    },
    {
      percent: 20,
      summary: 'At least 1 major seizure in last 2 years; OR at least 2 minor seizures in last 6 months',
      requirements: [
        '1+ major seizure in last 2 years, OR',
        '2+ focal seizures in last 6 months',
      ],
    },
    {
      percent: 10,
      summary: 'Confirmed diagnosis of focal epilepsy with history of seizures',
      requirements: [
        'Confirmed diagnosis by physician',
        'History of focal/Jacksonian seizures',
        'On continuous anti-epileptic medication (minimum 10% if on medication)',
      ],
    },
  ],
  definitions: {
    focalMotorSeizure: 'Seizure beginning with motor activity (jerking, twitching) in one specific body area, typically face, hand, or foot.',
    focalSensorySeizure: 'Seizure beginning with sensory symptoms (tingling, numbness, visual disturbance) in one specific area.',
    jacksonianMarch: 'Progressive spread of motor or sensory seizure activity from initial focus to adjacent body areas, following the motor/sensory cortex representation.',
    secondaryGeneralization: 'When a focal seizure spreads to involve both hemispheres, resulting in tonic-clonic convulsion with loss of consciousness.',
  },
};

// EPILEPSY - DIENCEPHALIC (DC 8913)
export const EPILEPSY_DIENCEPHALIC_CRITERIA = {
  diagnosticCode: '8913',
  condition: 'Epilepsy, Diencephalic',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8913',
  description: 'Epilepsy involving the diencephalon (thalamus/hypothalamus) characterized primarily by autonomic symptoms. Rate as minor seizures, except when major seizures predominate.',
  note: 'Per 38 CFR 4.124a: "Rate as minor seizures, except in the presence of major and minor seizures, rate the predominating type." Diencephalic epilepsy primarily presents with autonomic symptoms and is typically rated under minor seizure criteria.',
  disclaimer: 'This analysis is for documentation purposes only. The VA determines final ratings based on complete medical evidence and C&P examination findings.',
  ratings: [
    {
      percent: 80,
      summary: 'More than 10 minor (autonomic) seizures weekly',
      requirements: [
        'More than 10 autonomic seizure episodes per week',
        'Medical documentation of frequency',
      ],
    },
    {
      percent: 60,
      summary: '9-10 minor (autonomic) seizures per week',
      requirements: [
        '9-10 autonomic seizure episodes per week',
      ],
    },
    {
      percent: 40,
      summary: '5-8 minor (autonomic) seizures weekly',
      requirements: [
        '5-8 autonomic seizure episodes per week',
      ],
    },
    {
      percent: 20,
      summary: 'At least 2 minor seizures in last 6 months',
      requirements: [
        '2+ autonomic seizure episodes in last 6 months',
      ],
    },
    {
      percent: 10,
      summary: 'Confirmed diagnosis of diencephalic epilepsy with history of seizures',
      requirements: [
        'Confirmed diagnosis by physician/neurologist',
        'History of autonomic seizure episodes',
        'On continuous anti-epileptic medication (minimum 10%)',
      ],
    },
  ],
  definitions: {
    autonomicSeizure: 'Seizure characterized by changes in autonomic nervous system function including flushing, sweating, blood pressure changes, heart rate changes, pupillary changes, temperature dysregulation, GI symptoms.',
    diencephalon: 'Brain region including thalamus and hypothalamus that regulates autonomic functions, sleep-wake cycles, and hormonal release.',
  },
};

// EPILEPSY - PSYCHOMOTOR (DC 8914)
export const EPILEPSY_PSYCHOMOTOR_CRITERIA = {
  diagnosticCode: '8914',
  condition: 'Epilepsy, Psychomotor',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8914',
  description: 'Complex partial seizures originating in temporal lobe. Can be rated as MAJOR or MINOR depending on presentation characteristics.',
  note: 'Per 38 CFR 4.124a: MAJOR seizures - characterized by automatic states AND/OR generalized convulsions with unconsciousness. MINOR seizures - characterized by brief transient episodes of random motor movements, hallucinations, perceptual illusions, abnormalities of thinking, memory or mood, or autonomic disturbances.',
  disclaimer: 'This analysis is for documentation purposes only. The VA determines final ratings based on complete medical evidence. Psychomotor seizure classification (major vs minor) depends on specific episode characteristics.',
  ratings: [
    {
      percent: 100,
      summary: 'Averaging at least 1 major psychomotor seizure per month over the last year',
      requirements: [
        'Episodes with automatic states AND/OR convulsions with unconsciousness',
        'Average 1+ such episode per month for 12 months',
        'Medical documentation of seizure characteristics and frequency',
      ],
      seizureType: 'major',
    },
    {
      percent: 80,
      summary: 'At least 1 major seizure in 3 months over last year; OR more than 10 minor seizures weekly',
      requirements: [
        'Average 1 major psychomotor seizure every 3 months, OR',
        'More than 10 minor psychomotor episodes per week',
      ],
    },
    {
      percent: 60,
      summary: 'At least 1 major seizure in 4 months over last year; OR 9-10 minor seizures per week',
      requirements: [
        'Average 1 major psychomotor seizure every 4 months, OR',
        '9-10 minor psychomotor episodes per week',
      ],
    },
    {
      percent: 40,
      summary: 'At least 1 major seizure in last 6 months or 2 in last year; OR 5-8 minor seizures weekly',
      requirements: [
        '1+ major psychomotor seizure in last 6 months OR 2+ in last year, OR',
        '5-8 minor psychomotor episodes per week',
      ],
    },
    {
      percent: 20,
      summary: 'At least 1 major seizure in last 2 years; OR at least 2 minor seizures in last 6 months',
      requirements: [
        '1+ major psychomotor seizure in last 2 years, OR',
        '2+ minor psychomotor episodes in last 6 months',
      ],
    },
    {
      percent: 10,
      summary: 'Confirmed diagnosis of psychomotor epilepsy with history of seizures',
      requirements: [
        'Confirmed diagnosis by physician/neurologist',
        'History of psychomotor seizures',
        'On continuous anti-epileptic medication (minimum 10%)',
      ],
    },
  ],
  definitions: {
    majorPsychomotor: 'Psychomotor seizures characterized by automatic states (complex automatisms, purposeless wandering, complex behaviors performed without awareness) AND/OR generalized convulsions with unconsciousness.',
    minorPsychomotor: 'Psychomotor seizures characterized by brief transient episodes of: random motor movements, hallucinations, perceptual illusions (dj vu, jamais vu), abnormalities of thinking, memory disturbance, mood changes, or autonomic disturbances.',
    automaticState: 'Period during which patient performs complex behaviors without conscious awareness or memory of the event.',
    oralAutomatisms: 'Repetitive mouth/lip movements including lip smacking, chewing, swallowing - common in temporal lobe seizures.',
  },
};

// ============================================
// TINNITUS (DC 6260)
// ============================================

export const TINNITUS_CRITERIA = {
  diagnosticCode: '6260',
  condition: 'Tinnitus, Recurrent',
  cfrReference: '38 CFR 4.87, Diagnostic Code 6260',

  note: 'Tinnitus receives a single flat rating. Only one evaluation for recurrent tinnitus regardless of whether sound is in one ear, both ears, or in the head.',

  ratings: [
    {
      percent: 10,
      summary: 'Recurrent tinnitus',
      criteriaDescription: [
        'Ringing, buzzing, hissing, or other sound in ears/head',
        'Occurring repeatedly (recurrent)',
        'No higher rating available - flat 10% for any recurrent tinnitus',
      ],
      evidenceNeeded: [
        'Diagnosis of tinnitus from healthcare provider',
        'Description of symptoms (type of sound, frequency, impact)',
        'Audiological examination (typically)',
        'Clinical documentation',
      ],
    },
    {
      percent: 0,
      summary: 'Non-recurrent or objective tinnitus',
      criteriaDescription: [
        'Tinnitus that is not recurrent, OR',
        'Objective tinnitus (sound audible to others - rate under underlying cause)',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    recurrent: {
      term: 'Recurrent',
      definition: 'Occurring repeatedly or regularly. For tinnitus, this means the ringing/buzzing happens on an ongoing or frequent basis, not just once.',
    },
    subjectiveTinnitus: {
      term: 'Subjective Tinnitus',
      definition: 'Sound only the veteran can hear (most common type). This is what DC 6260 covers.',
    },
    objectiveTinnitus: {
      term: 'Objective Tinnitus',
      definition: 'Sound audible to other people, with definable cause. Not rated under 6260 - instead rate under the condition causing it.',
    },
    flatRating: {
      term: 'Flat Rating',
      definition: 'A single rating percentage that does not vary based on severity. For tinnitus, all cases of recurrent tinnitus receive 10%, whether mild or severe.',
    },
  },
};

// ============================================
// FIBROMYALGIA (DC 5025)
// ============================================

export const FIBROMYALGIA_CRITERIA = {
  diagnosticCode: '5025',
  condition: 'Fibromyalgia (Fibrositis, Primary Fibromyalgia Syndrome)',
  cfrReference: '38 CFR 4.71a, Diagnostic Code 5025',

  note: 'Widespread pain means pain in both left AND right sides, both above AND below waist, AND affects both axial skeleton (neck/chest/spine/low back) and extremities.',

  ratings: [
    {
      percent: 40,
      summary: 'Constant or nearly constant symptoms, refractory to therapy',
      criteriaDescription: [
        'Widespread musculoskeletal pain and tender points',
        'Symptoms are constant or nearly so',
        'Refractory to therapy (does not respond well to treatment)',
        'May include: fatigue, sleep disturbance, stiffness, headaches, IBS, depression, anxiety',
      ],
      evidenceNeeded: [
        'Diagnosis of fibromyalgia from rheumatologist or qualified provider',
        'Documentation of widespread pain pattern',
        'Tender point examination results',
        'Treatment records showing multiple therapies tried',
        'Documentation that symptoms persist despite treatment',
        'Impact on daily functioning',
      ],
    },
    {
      percent: 20,
      summary: 'Episodic symptoms present more than 1/3 of the time',
      criteriaDescription: [
        'Widespread pain and tender points',
        'Symptoms are episodic (come and go)',
        'Often precipitated by environmental stress, emotional stress, or overexertion',
        'Present more than one-third of the time',
      ],
      evidenceNeeded: [
        'Diagnosis documentation',
        'Pattern of exacerbations documented',
        'Identification of triggers',
        'Frequency of symptom flares',
        'Impact during flares',
      ],
    },
    {
      percent: 10,
      summary: 'Requires continuous medication for control',
      criteriaDescription: [
        'Widespread pain and tender points',
        'Symptoms controlled with continuous medication',
        'Medication required daily',
      ],
      evidenceNeeded: [
        'Diagnosis of fibromyalgia',
        'Prescription records for ongoing medication',
        'Documentation that medication is needed for symptom control',
      ],
    },
    {
      percent: 0,
      summary: 'Symptoms well-controlled or minimal',
      criteriaDescription: [
        'Diagnosed but symptoms minimal or well-controlled',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    widespreadPain: {
      term: 'Widespread Pain',
      definition: 'Pain meeting ALL these criteria: (1) Both left AND right sides of body, (2) Both above AND below the waist, (3) Affects both axial skeleton (cervical spine, chest, thoracic spine, OR low back) AND the extremities (arms/legs).',
    },
    tenderPoints: {
      term: 'Tender Points',
      definition: 'Specific locations on the body that are painful when pressure is applied. Healthcare provider tests 18 standardized points. Fibromyalgia diagnosis traditionally required 11+ painful points.',
    },
    refractoryToTherapy: {
      term: 'Refractory to Therapy',
      definition: 'Does not respond well to treatment. Multiple treatments have been tried but symptoms persist. This is different from "untreated" - it means treatment has been attempted but is not effective.',
    },
    episodic: {
      term: 'Episodic',
      definition: 'Symptoms that come and go in flares or exacerbations. May have periods of relative calm followed by periods of increased symptoms.',
    },
  },
};

// ============================================
// PHASE 2: VISION LOSS CRITERIA (DC 6061-6079)
// ============================================

export const VISION_LOSS_CRITERIA = {
  condition: 'Vision Loss',
  diagnosticCode: '6061-6079',
  ratings: [
    {
      percent: 100,
      summary: 'Blindness in both eyes or near-total vision loss',
      criteriaDescription: [
        'No light perception in both eyes (NLP bilateral), OR',
        'Visual acuity 5/200 or less in better eye with concentric contraction of visual field to 5 degrees or less'
      ],
      evidenceNeeded: [
        'Ophthalmology examination results',
        'Visual acuity measurements',
        'Visual field testing results',
        'Documentation of cause (if service-connected)'
      ]
    },
    {
      percent: 90,
      summary: 'Severe vision impairment',
      criteriaDescription: [
        'Visual acuity 5/200 in better eye, with 5/200 or less in poorer eye'
      ],
      evidenceNeeded: [
        'Bilateral visual acuity measurements',
        'Ophthalmology examination'
      ]
    },
    {
      percent: 70,
      summary: 'Marked vision impairment',
      criteriaDescription: [
        'Visual acuity 10/200 in better eye, OR',
        'Concentric contraction of visual field to 5 degrees in better eye'
      ],
      evidenceNeeded: [
        'Visual acuity testing',
        'Visual field examination (perimetry)',
        'Documentation of better eye measurement'
      ]
    },
    {
      percent: 60,
      summary: 'Moderate to severe vision impairment',
      criteriaDescription: [
        'Visual acuity 15/200 in better eye, OR',
        'Concentric contraction of visual field to 10 degrees in better eye'
      ],
      evidenceNeeded: [
        'Visual acuity measurements',
        'Visual field testing',
        'Ophthalmology reports'
      ]
    },
    {
      percent: 50,
      summary: 'Moderate vision impairment',
      criteriaDescription: [
        'Visual acuity 20/200 in better eye, OR',
        'Concentric contraction of visual field to 15 degrees in better eye'
      ],
      evidenceNeeded: [
        'Corrected visual acuity measurements',
        'Visual field examination results'
      ]
    },
    {
      percent: 40,
      summary: 'Mild to moderate vision impairment',
      criteriaDescription: [
        'Visual acuity 20/100 in better eye'
      ],
      evidenceNeeded: [
        'Visual acuity testing with best correction',
        'Ophthalmology examination'
      ]
    },
    {
      percent: 30,
      summary: 'Mild vision impairment',
      criteriaDescription: [
        'Visual acuity 20/70 in better eye, OR',
        'Marked constriction of visual fields'
      ],
      evidenceNeeded: [
        'Visual acuity measurements',
        'Visual field testing if field loss present'
      ]
    },
    {
      percent: 10,
      summary: 'Minimal vision impairment',
      criteriaDescription: [
        'Visual acuity 20/40 in better eye, OR',
        'Moderate constriction of visual fields'
      ],
      evidenceNeeded: [
        'Visual acuity testing',
        'Documentation of field defects if applicable'
      ]
    }
  ],
  definitions: {
    'visual acuity': 'Clarity or sharpness of vision, measured using Snellen chart (e.g., 20/20, 20/40)',
    'better eye': 'The eye with better visual acuity; VA ratings are based on the better eye',
    'concentric contraction': 'Progressive narrowing of the visual field from the periphery',
    'visual field': 'The entire area that can be seen when the eye is directed forward',
    'CF': 'Count Fingers - ability to count fingers at a specified distance',
    'HM': 'Hand Motion - ability to detect hand movement',
    'LP': 'Light Perception - ability to perceive light only',
    'NLP': 'No Light Perception - complete blindness'
  }
};

// ============================================
// PHASE 2: GLAUCOMA CRITERIA (DC 6067)
// ============================================

export const GLAUCOMA_CRITERIA = {
  condition: 'Glaucoma',
  diagnosticCode: '6067',
  ratings: [
    {
      percent: 100,
      summary: 'Rate based on resulting visual impairment',
      criteriaDescription: [
        'Bilateral glaucoma rated under vision loss criteria (DC 6061-6079)',
        'Use visual acuity and visual field measurements'
      ],
      evidenceNeeded: [
        'Glaucoma diagnosis from ophthalmologist',
        'Visual acuity measurements',
        'Visual field testing results',
        'Intraocular pressure readings',
        'Optic nerve examination findings'
      ]
    },
    {
      percent: 30,
      summary: 'Unilateral glaucoma with field defect and requiring medication',
      criteriaDescription: [
        'Unilateral (one eye) glaucoma with:',
        'Characteristic visual field defect, AND',
        'Either persistent increased intraocular pressure with optic nerve damage, OR',
        'Requires sustained medication to control intraocular pressure'
      ],
      evidenceNeeded: [
        'Diagnosis of glaucoma in one eye',
        'Visual field test showing defect',
        'IOP measurements',
        'Current medication regimen',
        'Optic nerve assessment'
      ]
    },
    {
      percent: 10,
      summary: 'Unilateral glaucoma controlled by medication',
      criteriaDescription: [
        'Unilateral glaucoma controlled by medication',
        'Without visual field defect',
        'Without optic nerve damage'
      ],
      evidenceNeeded: [
        'Glaucoma diagnosis',
        'Current medications',
        'IOP readings showing control',
        'Visual field testing (normal)',
        'Optic nerve examination (stable)'
      ]
    }
  ],
  definitions: {
    'glaucoma': 'Group of eye conditions that damage the optic nerve, often due to increased intraocular pressure',
    'IOP': 'Intraocular Pressure - fluid pressure inside the eye',
    'visual field defect': 'Areas of vision loss or blind spots characteristic of glaucoma',
    'optic nerve damage': 'Damage to the nerve that transmits visual information from the eye to the brain',
    'unilateral': 'Affecting one eye only',
    'bilateral': 'Affecting both eyes'
  }
};

// ============================================
// PHASE 2: DIABETIC RETINOPATHY CRITERIA (DC 6066)
// ============================================

export const DIABETIC_RETINOPATHY_CRITERIA = {
  condition: 'Diabetic Retinopathy',
  diagnosticCode: '6066',
  note: 'Rated based on resulting visual acuity under DC 6061-6079',
  ratings: [
    {
      percent: 'variable',
      summary: 'Rate based on visual acuity',
      criteriaDescription: [
        'Diabetic retinopathy is rated under vision loss criteria',
        'Use visual acuity measurements in better eye',
        'Consider macular edema impact on central vision',
        'Proliferative changes may cause more rapid progression'
      ],
      evidenceNeeded: [
        'Diagnosis of diabetic retinopathy',
        'Type (non-proliferative vs proliferative)',
        'Visual acuity measurements',
        'Dilated fundus examination results',
        'OCT (Optical Coherence Tomography) if available',
        'Fluorescein angiography results if performed',
        'Treatment history (laser photocoagulation, anti-VEGF injections)',
        'Relationship to diabetes control (HbA1c levels)'
      ]
    }
  ],
  definitions: {
    'diabetic retinopathy': 'Diabetes complication affecting blood vessels in the retina',
    'proliferative': 'Advanced stage with abnormal blood vessel growth',
    'non-proliferative': 'Earlier stage with damaged blood vessels but no new growth',
    'macular edema': 'Swelling in the central part of the retina affecting central vision',
    'OCT': 'Optical Coherence Tomography - imaging test showing retinal layers',
    'anti-VEGF': 'Anti-Vascular Endothelial Growth Factor injections to reduce abnormal vessel growth',
    'photocoagulation': 'Laser treatment to seal leaking blood vessels'
  }
};

// ============================================
// PHASE 2: MACULAR DEGENERATION CRITERIA (DC 6062)
// ============================================

export const MACULAR_DEGENERATION_CRITERIA = {
  condition: 'Macular Degeneration',
  diagnosticCode: '6062',
  note: 'Rated based on resulting visual acuity under DC 6061-6079',
  ratings: [
    {
      percent: 'variable',
      summary: 'Rate based on visual acuity',
      criteriaDescription: [
        'Macular degeneration is rated under vision loss criteria',
        'Use visual acuity measurements in better eye',
        'Central scotoma (blind spot) affects reading and detail vision',
        'Peripheral vision typically preserved'
      ],
      evidenceNeeded: [
        'Diagnosis of macular degeneration',
        'Type (dry AMD vs wet AMD)',
        'Visual acuity measurements',
        'Amsler grid test results',
        'OCT imaging',
        'Fluorescein angiography if performed',
        'Central scotoma documentation',
        'Treatment records (anti-VEGF injections for wet AMD)',
        'Progression documentation'
      ]
    }
  ],
  definitions: {
    'macular degeneration': 'Age-related disease affecting the macula (central retina)',
    'AMD': 'Age-Related Macular Degeneration',
    'dry AMD': 'More common form with gradual breakdown of macular tissue',
    'wet AMD': 'Less common but more severe form with abnormal blood vessel growth',
    'macula': 'Central part of retina responsible for sharp, detailed central vision',
    'central scotoma': 'Blind spot or area of vision loss in the center of visual field',
    'Amsler grid': 'Grid pattern test to detect central vision distortions'
  }
};

// ============================================
// ============================================
// PHASE 3: GENITOURINARY CONDITIONS
// ============================================

// DC 7508: Nephrolithiasis/Ureterolithiasis (Kidney Stones)
export const KIDNEY_STONES_CRITERIA = {
  diagnosticCode: '7508',
  condition: 'Nephrolithiasis/Ureterolithiasis/Nephrocalcinosis (Kidney Stones)',
  cfrReference: '38 CFR 4.115b, Diagnostic Code 7508',

  note: 'Rating based on stone episodes requiring invasive or non-invasive procedures, or rate as hydronephrosis if kidney function is impaired.',

  ratings: [
    {
      percent: 30,
      summary: 'Recurrent stone formation requiring invasive or non-invasive procedures more than 2 times per year',
      criteriaDescription: [
        'Stone formation documented on imaging',
        'Requires procedures (lithotripsy, ureteroscopy, stent placement) more than twice yearly',
        'Recurrent episodes despite treatment',
      ],
      evidenceNeeded: [
        'Imaging reports showing stones (CT, ultrasound, X-ray)',
        'Procedure records (lithotripsy, ureteroscopy, stent placement)',
        'Documentation of frequency (>2 procedures per year)',
        'Emergency room visits for renal colic',
        'Urology treatment records',
      ],
    },
    {
      percent: 10,
      summary: 'Recurrent stone formation requiring procedures 1-2 times per year',
      criteriaDescription: [
        'Stone formation requiring 1-2 procedures annually',
        'May include lithotripsy, ureteroscopy, or stent placement',
        'Documented history of kidney stones',
      ],
      evidenceNeeded: [
        'Imaging showing stone formation',
        'Procedure records',
        'Treatment history from urology',
      ],
    },
    {
      percent: 0,
      summary: 'History of stones but no recent procedures, or controlled with conservative management',
      criteriaDescription: [
        'History of kidney stones',
        'Controlled with diet, hydration, medication',
        'No procedures required in past year',
      ],
      evidenceNeeded: [
        'Documentation of stone history',
        'Current management plan',
      ],
    },
  ],

  definitions: {
    'Invasive procedures': 'Ureteroscopy, percutaneous nephrolithotomy, open surgery',
    'Non-invasive procedures': 'ESWL (lithotripsy), shock wave therapy',
    'Recurrent stone formation': 'New stones forming despite preventive measures',
    'Renal colic': 'Severe flank pain from stone passage',
  },

  disclaimer: 'If kidney function is impaired (elevated creatinine, decreased eGFR, hydronephrosis), rate under DC 7530 (Chronic Renal Disease) instead. Service connection requires evidence that stones are related to military service.',
};
// DC 7530: Chronic Renal Disease
export const CHRONIC_RENAL_DISEASE_CRITERIA = {
  diagnosticCode: '7530',
  condition: 'Chronic Renal Disease',
  cfrReference: '38 CFR 4.115a, Diagnostic Code 7530',

  note: 'Rated based on renal dysfunction. Requires regular dialysis for 100% rating.',

  ratings: [
    {
      percent: 100,
      summary: 'Requiring regular dialysis',
      criteriaDescription: [
        'End-stage renal disease (ESRD)',
        'Hemodialysis or peritoneal dialysis required',
        'Typically 3+ times per week for hemodialysis',
        'eGFR typically <15 mL/min/1.73m',
      ],
      evidenceNeeded: [
        'Dialysis center records showing regular treatment',
        'Vascular access documentation (fistula, graft, catheter)',
        'Lab values showing kidney failure',
        'Nephrology treatment records',
        'Documentation of dialysis frequency and duration',
      ],
    },
    {
      percent: 80,
      summary: 'eGFR 15-20 mL/min/1.73m, stage 4-5 CKD',
      criteriaDescription: [
        'Severe kidney disease',
        'eGFR 15-20 mL/min/1.73m sustained over time',
        'May be approaching dialysis',
        'Significant metabolic complications',
      ],
      evidenceNeeded: [
        'Serial lab values showing eGFR 15-20',
        'Multiple readings over evaluation period',
        'Nephrology records',
        'Documentation of complications (anemia, bone disease, etc.)',
      ],
    },
    {
      percent: 60,
      summary: 'eGFR 20-30 mL/min/1.73m, stage 4 CKD',
      criteriaDescription: [
        'Severe kidney disease',
        'eGFR 20-30 mL/min/1.73m',
        'Significant impairment of kidney function',
      ],
      evidenceNeeded: [
        'Lab values showing eGFR in range',
        'Creatinine levels elevated (typically >3.0 mg/dL)',
        'Treatment records',
      ],
    },
    {
      percent: 40,
      summary: 'eGFR 30-40 mL/min/1.73m, stage 3b CKD',
      criteriaDescription: [
        'Moderate to severe kidney disease',
        'eGFR 30-40 mL/min/1.73m',
        'Persistent kidney impairment',
      ],
      evidenceNeeded: [
        'Serial eGFR measurements',
        'Elevated creatinine',
        'Nephrology evaluation',
      ],
    },
    {
      percent: 20,
      summary: 'eGFR 40-60 mL/min/1.73m, stage 3a CKD',
      criteriaDescription: [
        'Moderate kidney disease',
        'eGFR 40-60 mL/min/1.73m',
        'Mild to moderate impairment',
      ],
      evidenceNeeded: [
        'Lab values showing reduced kidney function',
        'Multiple readings confirming chronic nature',
      ],
    },
    {
      percent: 0,
      summary: 'eGFR >60 or minimal impairment',
      criteriaDescription: [
        'Kidney function adequate',
        'eGFR >60 mL/min/1.73m',
        'Stage 1-2 CKD or normal function',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    'eGFR': 'Estimated Glomerular Filtration Rate - measures how well kidneys filter blood',
    'ESRD': 'End-Stage Renal Disease - kidney failure requiring dialysis or transplant',
    'Hemodialysis': 'Blood filtered through external machine, typically 3x/week, 3-4 hours per session',
    'Peritoneal dialysis': 'Dialysis using abdominal lining, can be done at home daily',
    'CKD stages': 'Stage 1-2: eGFR >60, Stage 3a: 45-60, Stage 3b: 30-45, Stage 4: 15-30, Stage 5: <15',
  },

  disclaimer: 'Chronic kidney disease must be documented as service-connected. Ratings based on sustained kidney function measurements over time, not single readings. Kidney transplant recipients rated separately under DC 7531.',
};
// VOIDING DYSFUNCTION CRITERIA (38 CFR 4.115a)
// Used by: DC 7512 (Chronic Cystitis), DC 7527 (Prostate), DC 7542 (Neurogenic Bladder), DC 7518 (Urethral Stricture)
export const VOIDING_DYSFUNCTION_CRITERIA = {
  diagnosticCode: '7512/7527/7542/7518',
  condition: 'Voiding Dysfunction (Urinary Frequency, Incontinence, or Obstruction)',
  cfrReference: '38 CFR 4.115a, Rating Formula for Voiding Dysfunction',

  note: 'Multiple conditions rated under voiding dysfunction. Choose highest rating from: Urine Leakage, Frequency, or Obstructed Voiding.',

  // CONTINUAL URINE LEAKAGE / URINARY INCONTINENCE
  ratingsIncontinence: [
    {
      percent: 60,
      summary: 'Requiring appliance or absorbent materials changed more than 4 times per day',
      criteriaDescription: [
        'Continuous or very frequent urine leakage',
        'Requires protective garments/pads/diapers',
        'Changed more than 4 times daily',
        'May require urinary appliance or catheter system',
      ],
      evidenceNeeded: [
        'Log of pad/diaper changes showing >4 per day',
        'Medical documentation of incontinence severity',
        'Prescription records for incontinence supplies',
        'Urodynamic studies if available',
        'Treatment attempts (medications, procedures)',
      ],
    },
    {
      percent: 40,
      summary: 'Requiring absorbent materials changed 2-4 times per day',
      criteriaDescription: [
        'Frequent urine leakage',
        'Requires protective garments',
        'Changed 2-4 times daily',
      ],
      evidenceNeeded: [
        'Documentation of 2-4 pad changes per day',
        'Medical records confirming incontinence',
        'Prescription for incontinence products',
      ],
    },
    {
      percent: 20,
      summary: 'Requiring absorbent materials changed less than 2 times per day',
      criteriaDescription: [
        'Moderate urine leakage',
        'Requires protective garments',
        'Changed 1-2 times daily',
      ],
      evidenceNeeded: [
        'Documentation of incontinence',
        'Evidence of protective garment use',
      ],
    },
  ],

  // URINARY FREQUENCY
  ratingsFrequency: [
    {
      percent: 40,
      summary: 'Daytime voiding interval less than 1 hour, OR awakening to void 5+ times per night',
      criteriaDescription: [
        'Severe urinary frequency',
        'Voiding more than hourly during day, OR',
        'Waking 5 or more times per night to urinate (nocturia)',
      ],
      evidenceNeeded: [
        'Voiding diary showing frequency patterns',
        'Documentation over multiple days',
        'Medical evaluation confirming frequency',
      ],
    },
    {
      percent: 20,
      summary: 'Daytime voiding interval 1-2 hours, OR awakening 3-4 times per night',
      criteriaDescription: [
        'Frequent urination',
        'Voiding every 1-2 hours during day, OR',
        'Waking 3-4 times nightly',
      ],
      evidenceNeeded: [
        'Voiding diary',
        'Medical documentation of frequency',
      ],
    },
    {
      percent: 10,
      summary: 'Daytime voiding interval 2-3 hours, OR awakening 2 times per night',
      criteriaDescription: [
        'Moderately increased frequency',
        'Voiding every 2-3 hours during day, OR',
        'Waking twice nightly',
      ],
      evidenceNeeded: [
        'Documentation of voiding patterns',
      ],
    },
  ],

  // OBSTRUCTED VOIDING
  ratingsObstruction: [
    {
      percent: 30,
      summary: 'Urinary retention requiring intermittent or continuous catheterization',
      criteriaDescription: [
        'Unable to empty bladder naturally',
        'Requires self-catheterization (intermittent), OR',
        'Indwelling catheter (Foley), OR',
        'Suprapubic catheter',
      ],
      evidenceNeeded: [
        'Catheterization records',
        'Documentation of catheterization frequency (if intermittent)',
        'Post-void residual measurements showing retention',
        'Urology treatment records',
      ],
    },
    {
      percent: 10,
      summary: 'Marked obstructive symptoms with complications',
      criteriaDescription: [
        'Hesitancy, weak stream, incomplete emptying',
        'PLUS one or more of:',
        '- Post-void residual >150cc',
        '- Markedly decreased peak flow rate (<10cc/sec)',
        '- Recurrent UTIs secondary to obstruction',
        '- Stricture requiring dilation every 2-3 months',
      ],
      evidenceNeeded: [
        'Post-void residual measurements',
        'Uroflowmetry results',
        'UTI treatment records',
        'Stricture dilation procedure records',
      ],
    },
    {
      percent: 0,
      summary: 'Obstructive symptoms requiring dilation 1-2 times per year',
      criteriaDescription: [
        'Mild obstruction',
        'Occasional stricture dilation needed',
      ],
      evidenceNeeded: [
        'Procedure records for dilations',
      ],
    },
  ],

  definitions: {
    'Voiding dysfunction': 'Difficulty with bladder emptying or storage',
    'Post-void residual': 'Urine remaining in bladder after urination (normal <50cc)',
    'Intermittent catheterization': 'Self-catheterization multiple times daily',
    'Indwelling catheter': 'Foley catheter left in place continuously',
    'Suprapubic catheter': 'Catheter inserted through abdominal wall',
    'Uroflowmetry': 'Test measuring urine flow rate',
    'Nocturia': 'Waking at night to urinate',
  },

  disclaimer: 'Rate under the highest applicable category: incontinence, frequency, or obstruction. Do not pyramid ratings from multiple categories. Service connection must be established.',
};
// DC 7332: Rectum and Anus, Impairment of Sphincter Control (Fecal Incontinence)
export const SPHINCTER_IMPAIRMENT_CRITERIA = {
  diagnosticCode: '7332',
  condition: 'Rectum and Anus, Impairment of Sphincter Control (Fecal Incontinence)',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7332',

  note: 'Rating based on frequency and severity of fecal incontinence episodes.',

  ratings: [
    {
      percent: 100,
      summary: 'Complete loss of sphincter control',
      criteriaDescription: [
        'Continuous fecal incontinence',
        'Unable to control bowel movements',
        'Constant soiling',
        'Requires protective garments at all times',
      ],
      evidenceNeeded: [
        'Medical documentation of complete incontinence',
        'Gastroenterology/colorectal surgery evaluation',
        'Anorectal manometry if performed',
        'Treatment records',
        'Documentation of protective garment use',
      ],
    },
    {
      percent: 60,
      summary: 'Frequent and essentially complete loss of control',
      criteriaDescription: [
        'Multiple daily episodes of fecal incontinence',
        'Inability to delay defecation',
        'Significant impairment of sphincter function',
      ],
      evidenceNeeded: [
        'Incontinence diary showing daily episodes',
        'Medical evaluation confirming severity',
        'Treatment attempts documented',
      ],
    },
    {
      percent: 30,
      summary: 'Occasional loss of sphincter control',
      criteriaDescription: [
        'Periodic fecal incontinence episodes',
        'May occur weekly or monthly',
        'Some sphincter control maintained',
      ],
      evidenceNeeded: [
        'Documentation of incontinence frequency',
        'Medical records',
        'Evidence of impact on daily activities',
      ],
    },
    {
      percent: 10,
      summary: 'Mild impairment',
      criteriaDescription: [
        'Rare loss of bowel control',
        'Gas incontinence or occasional soiling',
        'Minimal functional impairment',
      ],
      evidenceNeeded: [
        'Medical documentation',
        'Description of symptoms',
      ],
    },
    {
      percent: 0,
      summary: 'No significant impairment',
      criteriaDescription: [
        'Normal sphincter control',
        'No episodes of incontinence',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    'Fecal incontinence': 'Involuntary loss of bowel control',
    'Sphincter': 'Muscle ring controlling bowel movements',
    'Anorectal manometry': 'Test measuring sphincter muscle strength',
    'Urgency': 'Sudden, strong urge to defecate with limited time to reach toilet',
  },

  disclaimer: 'Service connection must be established. May result from trauma, surgery, neurological conditions, or other service-connected causes. Rate as diarrhea (DC 7319) if episodes are due to IBS and not sphincter impairment.',
};
// DC 7522: Erectile Dysfunction
export const ERECTILE_DYSFUNCTION_CRITERIA = {
  diagnosticCode: '7522',
  condition: 'Erectile Dysfunction, with or without penile deformity',
  cfrReference: '38 CFR 4.115b, Diagnostic Code 7522',

  note: 'Rated at 0% only. No compensation for impairment itself, but establishes service connection for potential special monthly compensation (SMC) eligibility under certain circumstances.',

  ratings: [
    {
      percent: 0,
      summary: 'Erectile dysfunction present',
      criteriaDescription: [
        'Documented erectile dysfunction',
        'May be mild, moderate, or severe',
        'With or without penile deformity',
      ],
      evidenceNeeded: [
        'Medical diagnosis of erectile dysfunction',
        'Urology evaluation',
        'Documentation of severity and impact',
        'Treatment attempts if any (medications, devices, etc.)',
        'Evidence linking to service-connected condition',
      ],
    },
  ],

  definitions: {
    'Erectile dysfunction': 'Inability to achieve or maintain erection sufficient for sexual intercourse',
    'SMC': 'Special Monthly Compensation - additional compensation for certain severe disabilities',
  },

  disclaimer: 'While rated at 0%, service connection for ED is important for: (1) potential SMC eligibility in specific circumstances, (2) establishing nexus to other service-connected conditions, (3) potential for increased rating if additional conditions develop. ED may be secondary to diabetes, hypertension, PTSD, medications, or other service-connected conditions.',
};

// =================================================================
// IMMUNE THROMBOCYTOPENIA (DC 7705)
// =================================================================
export const IMMUNE_THROMBOCYTOPENIA_CRITERIA = {
  diagnosticCode: '7705',
  condition: 'Immune Thrombocytopenia (ITP)',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'Bone marrow transplant OR platelet count <20,000',
      criteriaDescription: [
        'Requiring bone marrow or stem cell transplant, OR',
        'With platelet count less than 20,000 AND',
        '- Requiring continuous treatment with immunosuppressive therapy',
        '- Spontaneous bleeding, OR',
        '- Bleeding requiring transfusion'
      ],
      evidenceNeeded: [
        'Bone marrow transplant records, OR',
        'Multiple lab results showing platelet count <20,000',
        'Documentation of bleeding episodes',
        'Prescription records for immunosuppressive medications',
        'Transfusion records if applicable'
      ]
    },
    {
      percent: 70,
      summary: 'Platelet count 20,000-30,000 with bleeding',
      criteriaDescription: [
        'With platelet count of 20,000 to 30,000 AND',
        '- Requiring continuous treatment with immunosuppressive therapy',
        '- With either spontaneous bleeding OR bleeding with minor trauma'
      ],
      evidenceNeeded: [
        'Lab results showing platelet count 20,000-30,000',
        'Prescription records for immunosuppressive therapy',
        'Documentation of bleeding episodes'
      ]
    },
    {
      percent: 50,
      summary: 'Platelet count 30,000-50,000 with treatment',
      criteriaDescription: [
        'With platelet count of 30,000 to 50,000, AND',
        'Requiring continuous treatment with immunosuppressive therapy'
      ],
      evidenceNeeded: [
        'Lab results showing platelet count 30,000-50,000',
        'Prescription records for continuous immunosuppressive medications'
      ]
    },
    {
      percent: 30,
      summary: 'Platelet count 50,000-70,000 with treatment',
      criteriaDescription: [
        'With platelet count of 50,000 to 70,000, AND',
        'Requiring continuous treatment with immunosuppressive therapy'
      ],
      evidenceNeeded: [
        'Lab results',
        'Prescription records'
      ]
    },
    {
      percent: 10,
      summary: 'Platelet count 70,000-100,000',
      criteriaDescription: [
        'With platelet count of 70,000 to 100,000'
      ],
      evidenceNeeded: [
        'Lab results showing platelet count'
      ]
    },
    {
      percent: 0,
      summary: 'Platelet count >100,000 or asymptomatic',
      criteriaDescription: [
        'With platelet count greater than 100,000, OR',
        'Asymptomatic'
      ]
    }
  ],
  definitions: {
    'Immune Thrombocytopenia (ITP)': 'Autoimmune disorder causing low platelet count and increased bleeding risk',
    'Platelet Count': 'Normal range is 150,000-400,000 per L',
    'Immunosuppressive Therapy': 'Corticosteroids, IVIG, rituximab, TPO receptor agonists, immunosuppressants',
    'Spontaneous Bleeding': 'Bleeding without trauma (petechiae, purpura, nosebleeds, gum bleeding)'
  },
  disclaimer: 'Rating is based on the platelet count AND whether immunosuppressive treatment is required. Both factors matter.'
};


// =================================================================
// LEUKEMIA (DC 7703)
// =================================================================
export const LEUKEMIA_CRITERIA = {
  diagnosticCode: '7703',
  condition: 'Leukemia (Acute and Chronic)',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'During active treatment OR bone marrow transplant',
      criteriaDescription: [
        'Requiring chemotherapy, bone marrow or stem cell transplant, or other ongoing treatment modality, OR',
        'Status post bone marrow or stem cell transplant with chronic graft versus host disease'
      ],
      evidenceNeeded: [
        'Medical records documenting active treatment (chemotherapy, targeted therapy, etc.)',
        'Treatment schedule and protocols',
        'Bone marrow transplant records if applicable',
        'Documentation of graft versus host disease if post-transplant'
      ]
    },
    {
      percent: 60,
      summary: 'Post-treatment with residual symptoms',
      criteriaDescription: [
        'Following treatment, with residual symptoms such as:',
        '- Chronic fatigue',
        '- Anemia requiring treatment',
        '- Thrombocytopenia',
        '- Neuropathy',
        '- Infections',
        '- Other treatment-related complications'
      ],
      evidenceNeeded: [
        'Documentation that active treatment has ended',
        'Medical records showing residual symptoms and ongoing management',
        'Lab results showing persistent abnormalities'
      ]
    },
    {
      percent: 30,
      summary: 'In remission with surveillance only',
      criteriaDescription: [
        'In complete remission, requiring only surveillance (regular follow-up visits and blood tests)'
      ],
      evidenceNeeded: [
        'Oncology notes documenting complete remission',
        'Follow-up schedule',
        'Recent lab results showing remission'
      ]
    }
  ],
  definitions: {
    'Acute Leukemia': 'Rapidly progressing cancer of blood-forming tissues (ALL, AML)',
    'Chronic Leukemia': 'Slowly progressing blood cancer (CLL, CML)',
    'Complete Remission': 'No evidence of leukemia cells in blood or bone marrow',
    'Graft Versus Host Disease': 'Complication after bone marrow transplant where donor cells attack recipient tissues',
    'Surveillance': 'Regular monitoring without active treatment'
  },
  disclaimer: 'Rating is 100% during all active treatment. After treatment ends, rating decreases based on residual symptoms and remission status.'
};


// =================================================================
// HODGKIN'S LYMPHOMA (DC 7709)
// =================================================================
export const HODGKINS_LYMPHOMA_CRITERIA = {
  diagnosticCode: '7709',
  condition: "Hodgkin's Lymphoma (Hodgkin's Disease)",
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'During active treatment',
      criteriaDescription: [
        'Requiring chemotherapy, radiation therapy, bone marrow or stem cell transplant, or other ongoing treatment'
      ],
      evidenceNeeded: [
        'Medical records documenting active treatment',
        'Treatment schedule and protocols',
        'Oncology consultation reports'
      ]
    },
    {
      percent: 60,
      summary: 'Post-treatment with residual symptoms',
      criteriaDescription: [
        'Following treatment, with residual symptoms such as:',
        '- Chronic fatigue',
        '- Residual lymphadenopathy',
        '- Treatment-related complications (neuropathy, cardiac issues, etc.)'
      ],
      evidenceNeeded: [
        'Documentation that treatment has ended',
        'Medical records showing residual symptoms',
        'Imaging showing residual disease or complications'
      ]
    },
    {
      percent: 30,
      summary: 'In remission with surveillance',
      criteriaDescription: [
        'In complete remission, requiring only surveillance'
      ],
      evidenceNeeded: [
        'Oncology notes documenting complete remission',
        'PET/CT scans showing no active disease',
        'Follow-up schedule'
      ]
    }
  ],
  definitions: {
    "Hodgkin's Lymphoma": 'Cancer of the lymphatic system characterized by Reed-Sternberg cells',
    'Lymphadenopathy': 'Enlarged lymph nodes',
    'PET/CT Scan': 'Imaging used to assess for active lymphoma'
  },
  disclaimer: 'Rating is 100% during all active treatment. Reduces after treatment completion based on remission status.'
};


// =================================================================
// MULTIPLE MYELOMA (DC 7712)
// =================================================================
export const MULTIPLE_MYELOMA_CRITERIA = {
  diagnosticCode: '7712',
  condition: 'Multiple Myeloma',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'During active treatment',
      criteriaDescription: [
        'Requiring chemotherapy, bone marrow or stem cell transplant, or other ongoing treatment modality'
      ],
      evidenceNeeded: [
        'Medical records documenting active treatment',
        'Treatment protocols',
        'Hematology/oncology consultation reports'
      ]
    },
    {
      percent: 60,
      summary: 'Post-treatment with residual symptoms',
      criteriaDescription: [
        'Following treatment, with residual symptoms such as:',
        '- Bone pain requiring narcotic medication',
        '- Pathological fractures',
        '- Anemia',
        '- Renal insufficiency',
        '- Neuropathy',
        '- Infections'
      ],
      evidenceNeeded: [
        'Documentation of residual symptoms and complications',
        'Imaging showing bone lesions or fractures',
        'Lab results showing anemia or kidney dysfunction',
        'Prescription records for pain medications'
      ]
    },
    {
      percent: 30,
      summary: 'In remission with surveillance',
      criteriaDescription: [
        'In remission, requiring only surveillance'
      ],
      evidenceNeeded: [
        'Oncology notes documenting remission',
        'Lab results (serum protein electrophoresis, free light chains)',
        'Bone marrow biopsy showing remission'
      ]
    }
  ],
  definitions: {
    'Multiple Myeloma': 'Cancer of plasma cells in bone marrow causing bone destruction, anemia, kidney damage',
    'Pathological Fracture': 'Bone fracture caused by disease weakening the bone',
    'Serum Protein Electrophoresis': 'Lab test detecting abnormal proteins (M-protein) in myeloma',
    'Free Light Chains': 'Proteins produced by myeloma cells, measured for monitoring disease'
  }
};


// =================================================================
// NON-HODGKIN'S LYMPHOMA (DC 7715)
// =================================================================
export const NON_HODGKINS_LYMPHOMA_CRITERIA = {
  diagnosticCode: '7715',
  condition: "Non-Hodgkin's Lymphoma",
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'During active treatment',
      criteriaDescription: [
        'Requiring chemotherapy, radiation, bone marrow or stem cell transplant, immunotherapy, or other ongoing treatment'
      ],
      evidenceNeeded: [
        'Medical records documenting active treatment',
        'Treatment protocols',
        'Oncology consultation reports'
      ]
    },
    {
      percent: 60,
      summary: 'Post-treatment with residual symptoms',
      criteriaDescription: [
        'Following treatment, with residual symptoms or complications'
      ],
      evidenceNeeded: [
        'Documentation of residual symptoms',
        'Imaging or lab results showing complications'
      ]
    },
    {
      percent: 30,
      summary: 'In remission with surveillance',
      criteriaDescription: [
        'In complete remission, requiring only surveillance'
      ],
      evidenceNeeded: [
        'Oncology notes documenting remission',
        'PET/CT scans showing no active disease'
      ]
    }
  ],
  definitions: {
    "Non-Hodgkin's Lymphoma": 'Group of blood cancers arising from lymphocytes (includes many subtypes)',
    'Subtypes': 'Includes diffuse large B-cell lymphoma, follicular lymphoma, mantle cell lymphoma, and many others'
  }
};


// =================================================================
// ESSENTIAL THROMBOCYTHEMIA / PRIMARY MYELOFIBROSIS (DC 7718)
// =================================================================
export const MYELOPROLIFERATIVE_7718_CRITERIA = {
  diagnosticCode: '7718',
  condition: 'Essential Thrombocythemia or Primary Myelofibrosis',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'Bone marrow transplant OR symptomatic splenomegaly + cytopenia',
      criteriaDescription: [
        'Requiring bone marrow or stem cell transplant, OR',
        'Symptomatic splenomegaly with cytopenia (anemia, thrombocytopenia, or leukopenia)'
      ],
      evidenceNeeded: [
        'Bone marrow transplant records, OR',
        'Imaging showing splenomegaly',
        'Documentation of symptoms (pain, early satiety)',
        'Lab results showing low blood counts'
      ]
    },
    {
      percent: 60,
      summary: 'Symptomatic splenomegaly OR requiring JAK inhibitor',
      criteriaDescription: [
        'Symptomatic splenomegaly, OR',
        'Requiring continuous treatment with JAK inhibitors (e.g., ruxolitinib)'
      ],
      evidenceNeeded: [
        'Imaging and symptom documentation, OR',
        'Prescription records for JAK inhibitor therapy'
      ]
    },
    {
      percent: 40,
      summary: 'Requiring continuous myelosuppressive treatment',
      criteriaDescription: [
        'Requiring continuous myelosuppressive treatment (hydroxyurea, interferon, anagrelide)'
      ],
      evidenceNeeded: [
        'Prescription records for continuous myelosuppressive medications'
      ]
    },
    {
      percent: 10,
      summary: 'Requiring aspirin only',
      criteriaDescription: [
        'Requiring continuous treatment with aspirin or antiplatelet therapy only'
      ],
      evidenceNeeded: [
        'Prescription records'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic',
      criteriaDescription: [
        'Asymptomatic'
      ]
    }
  ],
  definitions: {
    'Essential Thrombocythemia': 'Myeloproliferative disorder causing elevated platelet count',
    'Primary Myelofibrosis': 'Bone marrow scarring causing enlarged spleen and blood cell problems',
    'Splenomegaly': 'Enlarged spleen',
    'Cytopenia': 'Low blood cell counts',
    'JAK Inhibitor': 'Ruxolitinib (Jakafi) - targeted therapy for myelofibrosis'
  }
};


// =================================================================
// CHRONIC MYELOGENOUS LEUKEMIA (DC 7719)
// =================================================================
export const CHRONIC_MYELOGENOUS_LEUKEMIA_CRITERIA = {
  diagnosticCode: '7719',
  condition: 'Chronic Myelogenous Leukemia (CML)',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'Chronic or accelerated phase OR bone marrow transplant',
      criteriaDescription: [
        'Chronic phase or accelerated phase, OR',
        'Status post bone marrow or stem cell transplant'
      ],
      evidenceNeeded: [
        'Bone marrow biopsy showing disease phase',
        'Molecular testing (BCR-ABL levels)',
        'Transplant records if applicable',
        'Hematology/oncology consultation'
      ]
    },
    {
      percent: 60,
      summary: 'Molecular or cytogenetic response on TKI',
      criteriaDescription: [
        'Molecular or cytogenetic response (less than complete response) on tyrosine kinase inhibitor (TKI) therapy'
      ],
      evidenceNeeded: [
        'Molecular testing showing partial response',
        'Prescription records for TKI (imatinib, dasatinib, nilotinib, etc.)'
      ]
    },
    {
      percent: 10,
      summary: 'Complete molecular response on TKI',
      criteriaDescription: [
        'Complete molecular response on TKI therapy'
      ],
      evidenceNeeded: [
        'Molecular testing showing undetectable BCR-ABL',
        'Prescription records for TKI'
      ]
    }
  ],
  definitions: {
    'Chronic Myelogenous Leukemia': 'Blood cancer caused by Philadelphia chromosome creating BCR-ABL fusion protein',
    'Tyrosine Kinase Inhibitor (TKI)': 'Targeted therapy for CML (imatinib/Gleevec, dasatinib, nilotinib)',
    'BCR-ABL': 'Abnormal protein causing CML; monitored to assess treatment response',
    'Molecular Response': 'Reduction in BCR-ABL levels measured by PCR testing',
    'Complete Molecular Response': 'BCR-ABL undetectable by sensitive testing'
  },
  disclaimer: 'CML is now often well-controlled with TKI therapy. Rating reflects disease phase and treatment response.'
};


// =================================================================
// SOLITARY PLASMACYTOMA (DC 7724)
// =================================================================
export const SOLITARY_PLASMACYTOMA_CRITERIA = {
  diagnosticCode: '7724',
  condition: 'Solitary Plasmacytoma',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'During active treatment',
      criteriaDescription: [
        'Requiring chemotherapy, radiation therapy, or other ongoing treatment'
      ],
      evidenceNeeded: [
        'Medical records documenting active treatment',
        'Treatment protocols',
        'Oncology consultation reports'
      ]
    },
    {
      percent: 30,
      summary: 'Post-treatment with no recurrence',
      criteriaDescription: [
        'Following treatment, with no evidence of recurrence or progression to multiple myeloma'
      ],
      evidenceNeeded: [
        'Follow-up imaging showing no recurrence',
        'Lab results (SPEP, free light chains) showing no progression',
        'Oncology surveillance notes'
      ]
    }
  ],
  definitions: {
    'Solitary Plasmacytoma': 'Single tumor of plasma cells (related to multiple myeloma but localized)',
    'Progression to Multiple Myeloma': 'Many solitary plasmacytomas eventually progress to multiple myeloma'
  },
  disclaimer: 'Requires close monitoring as many cases progress to multiple myeloma over time.'
};


// =================================================================
// MYELODYSPLASTIC SYNDROMES (DC 7725)
// =================================================================
export const MYELODYSPLASTIC_SYNDROMES_CRITERIA = {
  diagnosticCode: '7725',
  condition: 'Myelodysplastic Syndromes (MDS)',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'Bone marrow transplant OR transfusions every 6 weeks',
      criteriaDescription: [
        'Requiring bone marrow or stem cell transplant, OR',
        'Requiring transfusions at least once every 6 weeks with infections recurring at least once every 6 weeks despite prophylactic antibiotic therapy'
      ],
      evidenceNeeded: [
        'Bone marrow transplant records, OR',
        'Transfusion records showing frequency',
        'Infection documentation',
        'Prescription records for prophylactic antibiotics'
      ]
    },
    {
      percent: 70,
      summary: 'Transfusions every 3 months + immunosuppression',
      criteriaDescription: [
        'Requiring transfusions at least once every 3 months, AND',
        'Requiring continuous immunosuppressive therapy or erythropoietin'
      ],
      evidenceNeeded: [
        'Transfusion records',
        'Prescription records for immunosuppressants or ESAs (erythropoietin-stimulating agents)'
      ]
    },
    {
      percent: 50,
      summary: 'Immunosuppression + growth factors',
      criteriaDescription: [
        'Requiring continuous immunosuppressive therapy, AND',
        'Requiring continuous treatment with myeloid growth factors'
      ],
      evidenceNeeded: [
        'Prescription records for immunosuppressants and growth factors'
      ]
    },
    {
      percent: 30,
      summary: 'Immunosuppression only',
      criteriaDescription: [
        'Requiring continuous immunosuppressive therapy or erythropoietin'
      ],
      evidenceNeeded: [
        'Prescription records'
      ]
    },
    {
      percent: 10,
      summary: 'Growth factors only',
      criteriaDescription: [
        'Requiring continuous treatment with myeloid growth factors'
      ],
      evidenceNeeded: [
        'Prescription or treatment records for growth factors'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic',
      criteriaDescription: [
        'Asymptomatic'
      ]
    }
  ],
  definitions: {
    'Myelodysplastic Syndromes': 'Group of bone marrow disorders causing ineffective blood cell production',
    'Risk Categories': 'Lower-risk MDS vs. higher-risk MDS (affects treatment and prognosis)',
    'Hypomethylating Agents': 'Azacitidine, decitabine - medications for higher-risk MDS',
    'Erythropoietin-Stimulating Agents (ESAs)': 'Medications to stimulate red blood cell production'
  },
  disclaimer: 'MDS has variable severity. Higher-risk MDS often progresses to acute leukemia.'
};


// =================================================================
// FOLATE DEFICIENCY ANEMIA (DC 7721)
// =================================================================
export const FOLATE_DEFICIENCY_ANEMIA_CRITERIA = {
  diagnosticCode: '7721',
  condition: 'Folate Deficiency Anemia',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 30,
      summary: 'Requiring intravenous folate 4+ times per year',
      criteriaDescription: [
        'Requiring intravenous folate infusions 4 or more times per 12-month period'
      ],
      evidenceNeeded: [
        'Medical records documenting IV folate treatment dates',
        'Lab results showing folate levels and RBC indices',
        'Documentation of oral folate failure or malabsorption'
      ]
    },
    {
      percent: 10,
      summary: 'IV folate 1-3x/year OR continuous oral folate',
      criteriaDescription: [
        'Requiring intravenous folate infusions 1-3 times per 12-month period, OR',
        'Requiring continuous treatment with oral folate supplementation'
      ],
      evidenceNeeded: [
        'Medical records of IV folate treatments',
        'Prescription records showing continuous oral folate',
        'Lab results showing improvement with treatment'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic or dietary modification only',
      criteriaDescription: [
        'Asymptomatic, OR',
        'Requiring treatment only by dietary modification'
      ]
    }
  ],
  definitions: {
    'Folate': 'Vitamin B9, essential for red blood cell production and DNA synthesis',
    'Malabsorption': 'Inability to absorb folate from the diet (seen in celiac disease, Crohn\'s disease)'
  }
};


// =================================================================
// PERNICIOUS ANEMIA / B12 DEFICIENCY (DC 7722)
// =================================================================
export const PERNICIOUS_ANEMIA_CRITERIA = {
  diagnosticCode: '7722',
  condition: 'Pernicious Anemia or Vitamin B12 Deficiency',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'With central nervous system involvement',
      criteriaDescription: [
        'With central nervous system involvement',
        'Manifested by significant neurological symptoms such as:',
        '- Subacute combined degeneration of the spinal cord',
        '- Peripheral neuropathy',
        '- Cognitive impairment',
        '- Ataxia or gait disturbances'
      ],
      evidenceNeeded: [
        'Neurology evaluation documenting CNS involvement',
        'MRI or neurological testing showing spinal cord or nerve damage',
        'Documentation of neurological symptoms and functional limitations',
        'Lab results showing B12 deficiency and elevated methylmalonic acid'
      ]
    },
    {
      percent: 30,
      summary: 'B12 injections 4+ times per year',
      criteriaDescription: [
        'Requiring B12 injections 4 or more times per 12-month period'
      ],
      evidenceNeeded: [
        'Medical records documenting B12 injection dates',
        'Lab results showing B12 deficiency',
        'Documentation of why oral B12 is ineffective'
      ]
    },
    {
      percent: 10,
      summary: 'B12 injections 1-3x/year OR continuous oral B12',
      criteriaDescription: [
        'Requiring B12 injections 1-3 times per 12-month period, OR',
        'Requiring continuous treatment with oral B12 or sublingual supplementation'
      ],
      evidenceNeeded: [
        'Medical records or prescription records',
        'Lab results showing B12 levels with treatment'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic or dietary only',
      criteriaDescription: [
        'Asymptomatic, OR',
        'Requiring treatment only by dietary modification'
      ]
    }
  ],
  definitions: {
    'Pernicious Anemia': 'Autoimmune condition preventing B12 absorption due to lack of intrinsic factor',
    'Intrinsic Factor': 'Protein needed to absorb B12 in the intestines',
    'Subacute Combined Degeneration': 'Spinal cord damage from B12 deficiency causing weakness, numbness, difficulty walking',
    'Methylmalonic Acid': 'Substance elevated in B12 deficiency, used for diagnosis'
  },
  disclaimer: 'CNS involvement (100% rating) requires documented neurological damage, not just symptoms of fatigue or mild memory issues.'
};


// =================================================================
// ACQUIRED HEMOLYTIC ANEMIA (DC 7723)
// =================================================================
export const HEMOLYTIC_ANEMIA_CRITERIA = {
  diagnosticCode: '7723',
  condition: 'Acquired Hemolytic Anemia',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'Bone marrow transplant',
      criteriaDescription: [
        'Requiring bone marrow or stem cell transplant'
      ],
      evidenceNeeded: [
        'Medical records documenting bone marrow/stem cell transplant',
        'Transplant procedure reports',
        'Post-transplant care documentation'
      ]
    },
    {
      percent: 70,
      summary: 'Severe - transfusions every 6 weeks',
      criteriaDescription: [
        'Requiring blood transfusions at least once every 6 weeks'
      ],
      evidenceNeeded: [
        'Transfusion records showing frequency',
        'Lab results (hemoglobin, hematocrit, reticulocyte count)',
        'Documentation of ongoing hemolysis'
      ]
    },
    {
      percent: 50,
      summary: 'Moderate - transfusions every 3 months + continuous immunosuppression',
      criteriaDescription: [
        'Requiring blood transfusions at least once every 3 months, AND',
        'Requiring continuous immunosuppressive therapy'
      ],
      evidenceNeeded: [
        'Transfusion records',
        'Prescription records for immunosuppressive medications',
        'Lab monitoring results'
      ]
    },
    {
      percent: 30,
      summary: 'Immunosuppression only OR occasional transfusions',
      criteriaDescription: [
        'Requiring continuous immunosuppressive therapy, OR',
        'Requiring blood transfusions at least once per year but less than once per 3 months'
      ],
      evidenceNeeded: [
        'Prescription records or transfusion records',
        'Lab results showing disease activity'
      ]
    },
    {
      percent: 10,
      summary: 'Managed with oral medication',
      criteriaDescription: [
        'Requiring continuous treatment with oral medication (e.g., corticosteroids, immunosuppressants)'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic or no treatment',
      criteriaDescription: [
        'Asymptomatic, OR',
        'Not requiring treatment'
      ]
    }
  ],
  definitions: {
    'Acquired Hemolytic Anemia': 'Condition where red blood cells are destroyed prematurely by the immune system or other causes',
    'Immunosuppressive Therapy': 'Medications that suppress the immune system (e.g., prednisone, azathioprine, rituximab)',
    'Reticulocyte Count': 'Measure of young red blood cells; elevated in hemolytic anemia as body tries to replace destroyed cells'
  }
};


// =================================================================
// SICKLE CELL ANEMIA (DC 7714)
// =================================================================
export const SICKLE_CELL_ANEMIA_CRITERIA = {
  diagnosticCode: '7714',
  condition: 'Sickle Cell Anemia',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: '4+ painful crises per year requiring hospitalization OR chronic organ damage',
      criteriaDescription: [
        'With at least 4 or more painful crises per year requiring parenteral (intravenous or intramuscular) opioid analgesics or hospitalization for pain management, OR',
        'With chronic organ damage such as stroke, end-stage renal disease, or severe pulmonary hypertension'
      ],
      evidenceNeeded: [
        'Medical records documenting 4+ hospitalizations or ER visits per year for sickle cell crises',
        'Inpatient or ER records showing IV pain management',
        'If organ damage: imaging studies, organ function tests, specialty consult reports',
        'Hematology consult reports'
      ]
    },
    {
      percent: 60,
      summary: '3 painful crises per year requiring hospitalization',
      criteriaDescription: [
        'With at least 3 painful crises per year requiring parenteral opioid analgesics or hospitalization for pain management'
      ],
      evidenceNeeded: [
        'Medical records documenting 3 hospitalizations or ER visits per year',
        'Documentation of IV pain medication administration'
      ]
    },
    {
      percent: 30,
      summary: '1-2 painful crises per year requiring medical attention',
      criteriaDescription: [
        'With at least 1 or 2 painful crises per year requiring parenteral opioid analgesics or hospitalization for pain management'
      ],
      evidenceNeeded: [
        'Medical records of 1-2 crises per year requiring medical treatment',
        'ER or clinic visit records showing pain crisis management'
      ]
    },
    {
      percent: 10,
      summary: 'Asymptomatic with documented organ impairment',
      criteriaDescription: [
        'Asymptomatic, with at least one of the following:',
        '- Hemoglobin S greater than 40 percent',
        '- Asplenia (absent or non-functioning spleen)',
        '- History of painful crises or acute chest syndrome'
      ],
      evidenceNeeded: [
        'Lab results showing hemoglobin electrophoresis with HbS > 40%',
        'Imaging showing absent/non-functioning spleen',
        'Medical history documentation of previous crises'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic sickle cell trait',
      criteriaDescription: [
        'Sickle cell trait (carrier) without symptoms or complications'
      ]
    }
  ],
  definitions: {
    'Painful Crisis (Vaso-occlusive Crisis)': 'Episode where sickled cells block blood vessels causing severe pain',
    'Parenteral Opioid': 'Pain medication given intravenously (IV) or intramuscularly (IM), not by mouth',
    'Acute Chest Syndrome': 'Life-threatening complication with lung involvement, fever, chest pain',
    'Asplenia': 'Absent or non-functioning spleen (common in sickle cell disease)',
    'Hemoglobin S': 'Abnormal hemoglobin that causes red blood cells to sickle'
  },
  disclaimer: 'Crises must require parenteral (IV/IM) opioids or hospitalization to count toward rating. Home-managed pain episodes do not qualify.'
};


// =================================================================
// APLASTIC ANEMIA (DC 7716)
// =================================================================
export const APLASTIC_ANEMIA_CRITERIA = {
  diagnosticCode: '7716',
  condition: 'Aplastic Anemia',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'Bone marrow transplant OR transfusions every 6 weeks',
      criteriaDescription: [
        'Requiring bone marrow or stem cell transplant, OR',
        'Requiring transfusions at least once every 6 weeks with infections recurring at least once every 6 weeks despite prophylactic antibiotic therapy'
      ],
      evidenceNeeded: [
        'Bone marrow transplant records, OR',
        'Transfusion records showing frequency (every 6 weeks)',
        'Infection documentation (cultures, treatment records)',
        'Prescription records for prophylactic antibiotics'
      ]
    },
    {
      percent: 70,
      summary: 'Transfusions every 3 months + immunosuppression',
      criteriaDescription: [
        'Requiring transfusions at least once every 3 months, AND',
        'Requiring continuous immunosuppressive therapy'
      ],
      evidenceNeeded: [
        'Transfusion records',
        'Prescription records for immunosuppressive medications (cyclosporine, ATG, etc.)'
      ]
    },
    {
      percent: 50,
      summary: 'Immunosuppression + growth factors',
      criteriaDescription: [
        'Requiring continuous immunosuppressive therapy, AND',
        'Requiring continuous treatment with myeloid growth factors'
      ],
      evidenceNeeded: [
        'Prescription records for immunosuppressants',
        'Prescription or treatment records for growth factors (G-CSF, GM-CSF, EPO)'
      ]
    },
    {
      percent: 30,
      summary: 'Immunosuppression only',
      criteriaDescription: [
        'Requiring continuous immunosuppressive therapy'
      ],
      evidenceNeeded: [
        'Prescription records for continuous immunosuppressive medications'
      ]
    },
    {
      percent: 10,
      summary: 'Growth factors only',
      criteriaDescription: [
        'Requiring continuous treatment with myeloid growth factors'
      ],
      evidenceNeeded: [
        'Prescription or treatment records for growth factors'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic or no treatment',
      criteriaDescription: [
        'Asymptomatic, OR',
        'Not requiring treatment'
      ]
    }
  ],
  definitions: {
    'Aplastic Anemia': 'Bone marrow failure resulting in low production of all blood cells (pancytopenia)',
    'Myeloid Growth Factors': 'Medications that stimulate bone marrow (G-CSF, GM-CSF, erythropoietin)',
    'Immunosuppressive Therapy': 'Treatment to suppress immune system (cyclosporine, ATG, eltrombopag)',
    'Prophylactic Antibiotics': 'Preventive antibiotics taken continuously to prevent infections'
  }
};


// =================================================================
// POLYCYTHEMIA VERA (DC 7704)
// =================================================================
export const POLYCYTHEMIA_VERA_CRITERIA = {
  diagnosticCode: '7704',
  condition: 'Polycythemia Vera',
  cfrReference: '38 CFR  4.117',
  ratings: [
    {
      percent: 100,
      summary: 'Bone marrow transplant',
      criteriaDescription: [
        'Requiring bone marrow or stem cell transplant'
      ],
      evidenceNeeded: [
        'Bone marrow/stem cell transplant records'
      ]
    },
    {
      percent: 75,
      summary: 'Phlebotomy 6+ times/year AND medication',
      criteriaDescription: [
        'Requiring phlebotomy 6 or more times per year, AND',
        'Requiring continuous myelosuppressive treatment'
      ],
      evidenceNeeded: [
        'Phlebotomy records showing 6+ procedures per year',
        'Prescription records for hydroxyurea, interferon, or JAK inhibitor'
      ]
    },
    {
      percent: 60,
      summary: 'Phlebotomy 4-5 times/year AND medication',
      criteriaDescription: [
        'Requiring phlebotomy 4 or 5 times per year, AND',
        'Requiring continuous myelosuppressive treatment'
      ],
      evidenceNeeded: [
        'Phlebotomy records',
        'Prescription records for myelosuppressive medications'
      ]
    },
    {
      percent: 50,
      summary: 'Phlebotomy 4-5 times/year OR continuous medication',
      criteriaDescription: [
        'Requiring phlebotomy 4 or 5 times per year, OR',
        'Requiring continuous myelosuppressive treatment'
      ],
      evidenceNeeded: [
        'Phlebotomy records OR prescription records'
      ]
    },
    {
      percent: 40,
      summary: 'Phlebotomy 3 times/year OR continuous medication',
      criteriaDescription: [
        'Requiring phlebotomy at least 3 times per year, OR',
        'Requiring continuous myelosuppressive treatment'
      ],
      evidenceNeeded: [
        'Phlebotomy records OR prescription records'
      ]
    },
    {
      percent: 20,
      summary: 'Phlebotomy 1-2 times/year',
      criteriaDescription: [
        'Requiring phlebotomy at least 1 time but less than 3 times per year'
      ],
      evidenceNeeded: [
        'Phlebotomy records'
      ]
    },
    {
      percent: 10,
      summary: 'Managed with aspirin only',
      criteriaDescription: [
        'Requiring continuous treatment with low-dose aspirin or other antiplatelet medication only'
      ],
      evidenceNeeded: [
        'Prescription records'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic or no treatment',
      criteriaDescription: [
        'Asymptomatic, OR',
        'Not requiring treatment'
      ]
    }
  ],
  definitions: {
    'Polycythemia Vera': 'Myeloproliferative disorder causing overproduction of red blood cells',
    'Phlebotomy': 'Therapeutic bloodletting to reduce red blood cell count and blood viscosity',
    'Myelosuppressive Treatment': 'Medications to reduce blood cell production (hydroxyurea, interferon, ruxolitinib/Jakafi)',
    'JAK Inhibitor': 'Ruxolitinib (Jakafi) - targeted therapy for polycythemia vera'
  }
};


// ============================================
// PHASE 4: GYNECOLOGICAL CONDITIONS (DC 7610-7632)
// ============================================

export const ENDOMETRIOSIS_CRITERIA = {
  diagnosticCode: '7629',
  condition: 'Endometriosis',
  cfrReference: '38 CFR 4.116, Diagnostic Code 7629',

  note: 'Diagnosis must be substantiated by laparoscopy. Ratings based on symptom severity and organ involvement.',

  ratings: [
    {
      percent: 50,
      summary: 'Lesions involving bowel or bladder with uncontrolled symptoms',
      criteriaDescription: [
        'Lesions involving bowel or bladder confirmed by laparoscopy',
        'Pelvic pain or heavy or irregular bleeding not controlled by treatment',
        'Bowel or bladder symptoms present',
      ],
      evidenceNeeded: [
        'Laparoscopy report confirming endometriosis',
        'Documentation of bowel involvement (e.g., painful bowel movements, rectal bleeding)',
        'Documentation of bladder involvement (e.g., painful urination, hematuria)',
        'Treatment records showing ongoing symptoms despite treatment',
        'Gynecology records documenting symptom severity',
        'Evidence that symptoms are not controlled by hormonal therapy, surgery, or pain management',
      ],
    },
    {
      percent: 30,
      summary: 'Pelvic pain or heavy/irregular bleeding not controlled by treatment',
      criteriaDescription: [
        'Pelvic pain or heavy or irregular bleeding',
        'Symptoms not controlled by treatment',
        'May or may not involve bowel/bladder',
      ],
      evidenceNeeded: [
        'Laparoscopy report confirming endometriosis',
        'Documentation of chronic pelvic pain',
        'Documentation of menorrhagia (heavy bleeding) or irregular bleeding',
        'Treatment records showing persistent symptoms',
        'Gynecology records documenting failed treatment attempts',
        'Pain severity documentation (pain scales, interference with daily activities)',
      ],
    },
    {
      percent: 10,
      summary: 'Pelvic pain or heavy/irregular bleeding requiring continuous treatment',
      criteriaDescription: [
        'Pelvic pain or heavy or irregular bleeding',
        'Symptoms require continuous treatment for control',
        'Symptoms are controlled with treatment',
      ],
      evidenceNeeded: [
        'Laparoscopy report confirming endometriosis',
        'Documentation of ongoing treatment (hormonal therapy, pain medication)',
        'Records showing symptoms are controlled with treatment',
        'Prescription records for continuous medications',
        'Gynecology follow-up records',
      ],
    },
  ],

  definitions: {
    'Endometriosis': 'Condition where tissue similar to uterine lining grows outside the uterus, causing pain and bleeding',
    'Laparoscopy': 'Surgical procedure using a camera to visualize inside the abdomen - required for VA diagnosis',
    'Menorrhagia': 'Abnormally heavy or prolonged menstrual bleeding',
    'Dysmenorrhea': 'Painful menstruation',
    'Dyspareunia': 'Painful sexual intercourse',
    'Pelvic adhesions': 'Scar tissue that can form from endometriosis, causing organs to stick together',
  },

  disclaimer: 'Endometriosis must be confirmed by laparoscopy for VA purposes. Ratings are based on symptom control, not extent of disease. Even extensive endometriosis may rate lower if well-controlled by treatment. Bowel/bladder involvement is key for 50% rating. Document all symptoms including pain severity, bleeding patterns, and interference with daily activities.',
};

export const FEMALE_REPRODUCTIVE_ORGANS_CRITERIA = {
  diagnosticCode: '7610-7615',
  condition: 'Disease, Injury, or Adhesions of Female Reproductive Organs',
  cfrReference: '38 CFR 4.116, General Rating Formula for DC 7610-7615',

  note: 'Applies to vulva/clitoris (7610), vagina (7611), cervix (7612), uterus (7613), fallopian tube/PID (7614), and ovary (7615). Ovarian dysfunction affecting menstrual cycle (dysmenorrhea, amenorrhea) rated under DC 7615.',

  ratings: [
    {
      percent: 30,
      summary: 'Symptoms not controlled by continuous treatment',
      criteriaDescription: [
        'Ongoing symptoms despite treatment',
        'Symptoms interfere with daily activities',
        'Treatment does not provide adequate control',
      ],
      evidenceNeeded: [
        'Medical diagnosis of condition',
        'Documentation of persistent symptoms despite treatment',
        'Treatment records showing failed or inadequate symptom control',
        'Gynecology records documenting severity',
        'Evidence of functional impairment',
        'For DC 7615: menstrual cycle documentation showing dysfunction',
      ],
    },
    {
      percent: 10,
      summary: 'Symptoms that require continuous treatment',
      criteriaDescription: [
        'Symptoms require ongoing treatment for control',
        'Treatment is effective in controlling symptoms',
        'Discontinuation of treatment results in symptom recurrence',
      ],
      evidenceNeeded: [
        'Medical diagnosis of condition',
        'Documentation of continuous treatment (medications, therapy)',
        'Records showing symptoms are controlled with treatment',
        'Prescription records for ongoing medications',
        'Gynecology follow-up records',
      ],
    },
    {
      percent: 0,
      summary: 'Symptoms that do not require continuous treatment',
      criteriaDescription: [
        'Symptoms are mild or intermittent',
        'No continuous treatment needed',
        'Symptoms resolve without ongoing intervention',
      ],
      evidenceNeeded: [
        'Medical diagnosis of condition',
        'Documentation that symptoms are mild',
        'Records showing no continuous treatment required',
      ],
    },
  ],

  definitions: {
    'Dysmenorrhea': 'Painful menstruation',
    'Amenorrhea': 'Absence of menstruation',
    'PID': 'Pelvic Inflammatory Disease - infection of female reproductive organs',
    'Adhesions': 'Scar tissue causing organs to stick together',
    'Ovarian dysfunction': 'Abnormal ovarian function affecting menstrual cycle',
    'Continuous treatment': 'Ongoing medical treatment required to control symptoms',
  },

  disclaimer: 'This general rating formula applies to multiple diagnostic codes (7610-7615). The key distinction is whether symptoms require continuous treatment and whether that treatment effectively controls symptoms. For ovarian disease (DC 7615), includes conditions like PCOS, ovarian cysts, and dysmenorrhea affecting the menstrual cycle.',
};

export const PELVIC_PROLAPSE_CRITERIA = {
  diagnosticCode: '7621',
  condition: 'Complete or Incomplete Pelvic Organ Prolapse',
  cfrReference: '38 CFR 4.116, Diagnostic Code 7621',

  note: 'Includes uterine/vaginal vault prolapse, cystocele, urethrocele, rectocele, enterocele, or any combination. Rated at flat 10%.',

  ratings: [
    {
      percent: 10,
      summary: 'Pelvic organ prolapse due to injury, disease, or surgical complications',
      criteriaDescription: [
        'Complete or incomplete pelvic organ prolapse',
        'Diagnosed by examination (POP-Q staging)',
        'May include: uterine prolapse, vaginal vault prolapse, cystocele, urethrocele, rectocele, enterocele',
        'Can be any combination of above',
      ],
      evidenceNeeded: [
        'Gynecology or urogynecology examination',
        'POP-Q staging documentation',
        'Description of type of prolapse (cystocele, rectocele, etc.)',
        'Symptom documentation (pelvic pressure, bulge, urinary/bowel symptoms)',
        'Treatment records (pessary use, pelvic floor PT, surgical repair)',
        'Evidence linking to service (injury during service, surgical complications, etc.)',
      ],
    },
  ],

  definitions: {
    'Pelvic organ prolapse': 'Dropping of pelvic organs (bladder, uterus, rectum, etc.) from normal position',
    'POP-Q': 'Pelvic Organ Prolapse Quantification - standardized staging system (0-IV)',
    'Cystocele': 'Prolapse of bladder into vagina',
    'Rectocele': 'Prolapse of rectum into vagina',
    'Uterine prolapse': 'Dropping of uterus into or through vagina',
    'Vaginal vault prolapse': 'Prolapse after hysterectomy where top of vagina descends',
    'Enterocele': 'Small bowel prolapse into vagina',
    'Urethrocele': 'Prolapse of urethra',
    'Pessary': 'Device inserted into vagina to support prolapsed organs',
  },

  disclaimer: 'Pelvic organ prolapse is rated at a flat 10% regardless of severity or type. Multiple types of prolapse (e.g., both cystocele and rectocele) are still rated as a single 10% disability. However, secondary conditions resulting from prolapse (such as urinary incontinence or bowel dysfunction) may be separately ratable under different diagnostic codes.',
};

export const FEMALE_SEXUAL_AROUSAL_DISORDER_CRITERIA = {
  diagnosticCode: '7632',
  condition: 'Female Sexual Arousal Disorder (FSAD)',
  cfrReference: '38 CFR 4.116, Diagnostic Code 7632',

  note: 'Rated at 0% only. No compensation for impairment itself, but establishes service connection for potential special monthly compensation (SMC) review under  3.350.',

  ratings: [
    {
      percent: 0,
      summary: 'Female sexual arousal disorder present',
      criteriaDescription: [
        'Documented female sexual arousal disorder',
        'May involve difficulty with arousal, lubrication, or orgasm',
        'Affects sexual function',
      ],
      evidenceNeeded: [
        'Medical diagnosis of FSAD or sexual dysfunction',
        'Gynecology or sexual health specialist evaluation',
        'Documentation of symptoms and impact',
        'Treatment attempts if any',
        'Evidence linking to service-connected condition (PTSD, medications, injury, etc.)',
      ],
    },
  ],

  definitions: {
    'FSAD': 'Female Sexual Arousal Disorder - persistent difficulty with sexual arousal or response',
    'SMC': 'Special Monthly Compensation - additional compensation for certain severe disabilities',
    'Sexual dysfunction': 'Impairment in sexual response or function',
  },

  disclaimer: 'While rated at 0%, service connection for FSAD is important for: (1) review for SMC entitlement under  3.350, (2) establishing nexus to other service-connected conditions, (3) potential for increased rating if additional related conditions develop. FSAD may be secondary to PTSD, depression, medications, pelvic trauma, or other service-connected conditions.',
};

// =================================================================
// IRON DEFICIENCY ANEMIA (DC 7720)
// =================================================================
export const IRON_DEFICIENCY_ANEMIA_CRITERIA = {
  diagnosticCode: '7720',
  condition: 'Iron Deficiency Anemia',
  cfrReference: '38 CFR  4.117',
  note: 'Do not evaluate iron deficiency anemia due to blood loss under this diagnostic code. Evaluate iron deficiency anemia due to blood loss under the criteria for the condition causing the blood loss.',
  ratings: [
    {
      percent: 30,
      summary: 'IV iron infusions 4+ times per year',
      criteriaDescription: [
        'Requiring intravenous iron infusions 4 or more times per 12-month period'
      ],
      evidenceNeeded: [
        'Medical records documenting IV iron infusion dates (at least 4 within 12 months)',
        'Lab results showing persistent iron deficiency despite treatment',
        'Provider statement regarding treatment frequency and necessity',
        'Documentation of oral iron supplementation failure or intolerance'
      ]
    },
    {
      percent: 10,
      summary: 'IV iron 1-3x/year OR continuous oral supplementation',
      criteriaDescription: [
        'Requiring intravenous iron infusions at least 1 time but less than 4 times per 12-month period, OR',
        'Requiring continuous treatment with oral supplementation'
      ],
      evidenceNeeded: [
        'Medical records of IV iron treatments (if applicable)',
        'Prescription records showing continuous oral iron supplementation',
        'Lab results (hemoglobin, ferritin, iron panel) showing improvement with treatment',
        'Provider statement regarding ongoing treatment requirement'
      ]
    },
    {
      percent: 0,
      summary: 'Asymptomatic or dietary modification only',
      criteriaDescription: [
        'Asymptomatic, OR',
        'Requiring treatment only by dietary modification'
      ],
      evidenceNeeded: [
        'Documentation that symptoms resolved with diet changes',
        'Lab results showing normal iron levels with dietary management',
        'No ongoing medication treatment required'
      ]
    }
  ],
  definitions: {
    'Iron Deficiency Anemia': 'A condition where the body lacks sufficient iron to produce adequate hemoglobin',
    'IV Iron Infusion': 'Intravenous administration of iron when oral supplementation is ineffective or not tolerated',
    'Ferritin': 'A blood protein that stores iron; low ferritin indicates iron deficiency',
    'Continuous Oral Supplementation': 'Daily or regular oral iron pills taken on an ongoing basis'
  },
  disclaimer: 'This rating is for iron deficiency anemia not caused by blood loss. If anemia is due to blood loss from another condition, rate under the diagnostic code for the underlying condition.'
};


// ============================================
// PHASE 6: INFECTIOUS DISEASES - HIV/AIDS (DC 6351)
// ============================================

export const HIV_AIDS_CRITERIA = {
  diagnosticCode: '6351',
  condition: 'HIV-Related Illness',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6351',

  ratings: [
    {
      percent: 100,
      summary: 'Chronic fatigue, diarrhea, recurrent opportunistic infections, or pathological weight loss',
      criteria: {
        opportunisticInfections: 'recurrent',
        constitutionalSymptoms: 'severe',
        weightLoss: 'pathological',
        debilitating: true,
      },
      criteriaDescription: [
        'Active AIDS diagnosis with one or more of:',
        '   Recurrent opportunistic infections',
        '   Debilitating fatigue with progressive weight loss',
        '   Chronic, uncontrolled diarrhea',
        '   Pathological weight loss (>10% body weight)',
      ],
      evidenceNeeded: [
        'Medical diagnosis of AIDS',
        'Documentation of opportunistic infections (PCP, CMV, MAC, etc.)',
        'Weight tracking showing significant loss',
        'Treatment records for infections',
        'CD4 count typically <200',
      ],
    },
    {
      percent: 60,
      summary: 'Recurrent constitutional symptoms, intermittent diarrhea, pathological weight loss; or minimum rating after opportunistic infection',
      criteria: {
        constitutionalSymptoms: 'recurrent',
        diarrhea: 'intermittent',
        weightLoss: 'significant',
      },
      criteriaDescription: [
        'Refractory constitutional symptoms including:',
        '   Daily fatigue and malaise',
        '   Intermittent diarrhea',
        '   Pathological weight loss',
        'OR minimum rating following documented opportunistic infection',
      ],
      evidenceNeeded: [
        'Consistent documentation of constitutional symptoms',
        'Weight tracking',
        'Treatment records',
        'Lab values (CD4, viral load)',
        'History of opportunistic infection if applicable',
      ],
    },
    {
      percent: 30,
      summary: 'Recurrent constitutional symptoms, intermittent diarrhea, CD4 <200, or use of approved medications',
      criteria: {
        constitutionalSymptoms: 'present',
        medications: 'antiretroviral',
        cd4Count: '<200',
        diarrhea: 'intermittent',
      },
      criteriaDescription: [
        'HIV with one or more of:',
        '   Recurrent constitutional symptoms (fever, night sweats, fatigue)',
        '   Intermittent diarrhea',
        '   CD4 count less than 200',
        '   Use of FDA-approved antiretroviral medications',
      ],
      evidenceNeeded: [
        'Documentation of constitutional symptoms',
        'CD4 count labs showing <200',
        'Medication list with antiretrovirals',
        'Treatment compliance records',
      ],
    },
    {
      percent: 10,
      summary: 'Constitutional symptoms following initial diagnosis, CD4 200-500, depression/memory loss',
      criteria: {
        constitutionalSymptoms: 'mild',
        cd4Count: '200-500',
        cognitiveImpairment: 'present',
      },
      criteriaDescription: [
        'Following initial diagnosis with:',
        '   Constitutional symptoms (intermittent)',
        '   CD4 count 200-500',
        '   Use of antiretroviral medications',
        '   Depression or memory loss',
      ],
      evidenceNeeded: [
        'HIV diagnosis documentation',
        'CD4 count in 200-500 range',
        'Documentation of constitutional symptoms',
        'Evidence of cognitive or mood changes',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic following initial diagnosis, with or without lymphadenopathy',
      criteria: {
        symptomatic: false,
        diagnosed: true,
      },
      criteriaDescription: [
        'HIV diagnosis confirmed but:',
        '   No constitutional symptoms',
        '   May have generalized lymphadenopathy',
        '   Stable on antiretroviral therapy',
      ],
      evidenceNeeded: [
        'HIV diagnosis documentation',
        'Current lab values',
        'Treatment records',
      ],
    },
  ],

  definitions: {
    opportunisticInfection: {
      term: 'Opportunistic Infection',
      definition: 'Infections that occur more frequently and are more severe in people with weakened immune systems. Common examples include Pneumocystis jirovecii pneumonia (PCP), Cytomegalovirus (CMV), Mycobacterium avium complex (MAC), toxoplasmosis, and cryptococcosis.',
    },
    constitutionalSymptoms: {
      term: 'Constitutional Symptoms',
      definition: 'General symptoms affecting the whole body, including persistent fever, night sweats, severe fatigue, and unintentional weight loss.',
    },
    cd4Count: {
      term: 'CD4 Count',
      definition: 'CD4 T-cell count measures the number of CD4+ T lymphocytes in a microliter of blood. Normal range is 500-1,500. Below 200 indicates AIDS and severe immunosuppression.',
    },
    pathologicalWeightLoss: {
      term: 'Pathological Weight Loss',
      definition: 'Unintentional loss of 10% or more of baseline body weight, not due to dieting. Indicates wasting syndrome.',
    },
  },

  importantNotes: [
    'VA rates HIV/AIDS based on manifestations and impact on daily functioning',
    'Opportunistic infections may qualify for 100% or minimum 60% rating',
    'CD4 count is important but not the sole determining factor',
    'Constitutional symptoms must be documented consistently',
    'Use of antiretroviral therapy alone supports 30% minimum rating',
    'Depression and cognitive impairment associated with HIV are ratable',
    'Multiple ratings may apply for opportunistic infections affecting specific body systems',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - HEPATITIS C (DC 7354)
// ============================================

export const HEPATITIS_C_CRITERIA = {
  diagnosticCode: '7354',
  condition: 'Hepatitis C',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7354',

  ratings: [
    {
      percent: 100,
      summary: 'Near-constant debilitating symptoms',
      criteria: {
        symptomatic: 'severe',
        debilitating: true,
        nearConstant: true,
      },
      criteriaDescription: [
        'Near-constant debilitating symptoms such as:',
        '   Severe fatigue and malaise',
        '   Anorexia with substantial weight loss',
        '   Nausea',
        '   Requires substantial lifestyle modifications',
      ],
      evidenceNeeded: [
        'Daily logging of severe fatigue/malaise',
        'Weight loss documentation',
        'Evidence of work/life impact',
        'Medical treatment records',
        'Liver enzyme lab values',
      ],
    },
    {
      percent: 60,
      summary: 'Daily fatigue, malaise, and anorexia with substantial weight loss',
      criteria: {
        symptomatic: 'moderate-severe',
        dailySymptoms: true,
        weightLoss: true,
      },
      criteriaDescription: [
        'Daily symptoms including:',
        '   Persistent fatigue',
        '   General malaise',
        '   Loss of appetite (anorexia)',
        '   Substantial weight loss or gain',
      ],
      evidenceNeeded: [
        'Daily symptom logs',
        'Weight tracking over time',
        'Dietary changes documentation',
        'Lab values showing disease activity',
      ],
    },
    {
      percent: 30,
      summary: 'Daily fatigue, malaise, and anorexia with minor weight loss',
      criteria: {
        symptomatic: 'moderate',
        dailySymptoms: true,
        weightLoss: 'minor',
      },
      criteriaDescription: [
        'Daily symptoms with moderate impact:',
        '   Fatigue and malaise',
        '   Reduced appetite',
        '   Minor weight loss (or near normal weight)',
        '   Dietary restrictions needed',
      ],
      evidenceNeeded: [
        'Regular symptom tracking',
        'Weight monitoring',
        'Dietary restriction documentation',
        'Treatment compliance records',
      ],
    },
    {
      percent: 10,
      summary: 'Intermittent fatigue, malaise, and anorexia',
      criteria: {
        symptomatic: 'mild',
        intermittent: true,
      },
      criteriaDescription: [
        'Intermittent symptoms:',
        '   Occasional fatigue episodes',
        '   Periodic malaise',
        '   Mild appetite changes',
      ],
      evidenceNeeded: [
        'Symptom frequency tracking',
        'Pattern documentation',
        'Lab monitoring',
      ],
    },
    {
      percent: 0,
      summary: 'Nonsymptomatic',
      criteria: {
        symptomatic: false,
        diagnosed: true,
      },
      criteriaDescription: [
        'Hepatitis C diagnosed but:',
        '   No active symptoms',
        '   Normal daily function',
        '   May be on treatment',
      ],
      evidenceNeeded: [
        'Diagnosis documentation',
        'Lab values',
        'Treatment records if applicable',
      ],
    },
  ],

  definitions: {
    debilitating: {
      term: 'Debilitating',
      definition: 'Symptoms that substantially interfere with employment and daily activities, requiring significant lifestyle modifications.',
    },
    nearConstant: {
      term: 'Near-Constant',
      definition: 'Symptoms present most days, with minimal symptom-free periods.',
    },
    substantialWeightLoss: {
      term: 'Substantial Weight Loss',
      definition: 'Loss of 10% or more of baseline body weight, or significant weight gain affecting health.',
    },
  },

  importantNotes: [
    'VA rates hepatitis based on symptom severity, not viral load alone',
    'Daily symptoms qualify for higher ratings than intermittent symptoms',
    'Weight changes (loss or gain) are key rating factors',
    'Treatment side effects may be separately ratable',
    'Liver enzyme levels support but do not determine rating',
    'Cirrhosis and other complications rated separately under appropriate codes',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - HEPATITIS B (DC 7314)
// ============================================

export const HEPATITIS_B_CRITERIA = {
  diagnosticCode: '7314',
  condition: 'Hepatitis B',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7314',

  ratings: [
    {
      percent: 100,
      summary: 'Near-constant debilitating symptoms',
      criteria: {
        symptomatic: 'severe',
        debilitating: true,
        nearConstant: true,
      },
      criteriaDescription: [
        'Near-constant debilitating symptoms such as:',
        '   Severe fatigue and malaise',
        '   Anorexia with substantial weight loss',
        '   Nausea',
        '   Requires substantial lifestyle modifications',
      ],
      evidenceNeeded: [
        'Daily logging of severe fatigue/malaise',
        'Weight loss documentation',
        'Evidence of work/life impact',
        'Medical treatment records',
        'Liver enzyme lab values',
      ],
    },
    {
      percent: 60,
      summary: 'Daily fatigue, malaise, and anorexia with substantial weight loss',
      criteria: {
        symptomatic: 'moderate-severe',
        dailySymptoms: true,
        weightLoss: true,
      },
      criteriaDescription: [
        'Daily symptoms including:',
        '   Persistent fatigue',
        '   General malaise',
        '   Loss of appetite (anorexia)',
        '   Substantial weight loss or gain',
      ],
      evidenceNeeded: [
        'Daily symptom logs',
        'Weight tracking over time',
        'Dietary changes documentation',
        'Lab values showing disease activity',
      ],
    },
    {
      percent: 30,
      summary: 'Daily fatigue, malaise, and anorexia with minor weight loss',
      criteria: {
        symptomatic: 'moderate',
        dailySymptoms: true,
        weightLoss: 'minor',
      },
      criteriaDescription: [
        'Daily symptoms with moderate impact:',
        '   Fatigue and malaise',
        '   Reduced appetite',
        '   Minor weight loss (or near normal weight)',
        '   Dietary restrictions needed',
      ],
      evidenceNeeded: [
        'Regular symptom tracking',
        'Weight monitoring',
        'Dietary restriction documentation',
        'Treatment compliance records',
      ],
    },
    {
      percent: 10,
      summary: 'Intermittent fatigue, malaise, and anorexia',
      criteria: {
        symptomatic: 'mild',
        intermittent: true,
      },
      criteriaDescription: [
        'Intermittent symptoms:',
        '   Occasional fatigue episodes',
        '   Periodic malaise',
        '   Mild appetite changes',
      ],
      evidenceNeeded: [
        'Symptom frequency tracking',
        'Pattern documentation',
        'Lab monitoring',
      ],
    },
    {
      percent: 0,
      summary: 'Nonsymptomatic',
      criteria: {
        symptomatic: false,
        diagnosed: true,
      },
      criteriaDescription: [
        'Hepatitis B diagnosed but:',
        '   No active symptoms',
        '   Normal daily function',
        '   May be on treatment',
      ],
      evidenceNeeded: [
        'Diagnosis documentation',
        'Lab values',
        'Treatment records if applicable',
      ],
    },
  ],

  definitions: {
    debilitating: {
      term: 'Debilitating',
      definition: 'Symptoms that substantially interfere with employment and daily activities, requiring significant lifestyle modifications.',
    },
    nearConstant: {
      term: 'Near-Constant',
      definition: 'Symptoms present most days, with minimal symptom-free periods.',
    },
    substantialWeightLoss: {
      term: 'Substantial Weight Loss',
      definition: 'Loss of 10% or more of baseline body weight, or significant weight gain affecting health.',
    },
  },

  importantNotes: [
    'VA rates hepatitis based on symptom severity, not viral load alone',
    'Daily symptoms qualify for higher ratings than intermittent symptoms',
    'Weight changes (loss or gain) are key rating factors',
    'Treatment side effects may be separately ratable',
    'Liver enzyme levels support but do not determine rating',
    'Cirrhosis and other complications rated separately under appropriate codes',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - LYME DISEASE (DC 6319)
// ============================================

export const LYME_DISEASE_CRITERIA = {
  diagnosticCode: '6319',
  condition: 'Lyme Disease',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6319',

  ratings: [
    {
      percent: 100,
      summary: 'Active disease requiring treatment (for 6 months minimum)',
      criteria: {
        activeDisease: true,
        treatment: 'required',
        duration: '6months',
      },
      criteriaDescription: [
        'Active Lyme disease requiring treatment:',
        '   100% rating during active treatment',
        '   Minimum 6-month rating period',
        '   Then rate residuals by affected body system',
      ],
      evidenceNeeded: [
        'Diagnosis of active Lyme disease',
        'Treatment records (antibiotics)',
        'Symptom documentation during treatment',
        'Lab results (Western blot, ELISA)',
      ],
    },
    {
      percent: 'residuals',
      summary: 'After treatment - rate residual symptoms by affected system',
      criteria: {
        postTreatment: true,
        residualSymptoms: true,
      },
      criteriaDescription: [
        'Post-Lyme disease syndrome (PTLDS):',
        '   Neurological residuals (rate as neuropathy)',
        '   Arthritis/joint pain (rate as arthritis)',
        '   Cardiac issues (rate as heart condition)',
        '   Chronic fatigue (rate as CFS)',
        '   Cognitive impairment (rate neurologically)',
      ],
      evidenceNeeded: [
        'Documentation of completed treatment',
        'Ongoing symptom tracking',
        'Specialist evaluations for residuals',
        'Evidence of functional impairment',
      ],
    },
  ],

  definitions: {
    activeDisease: {
      term: 'Active Lyme Disease',
      definition: 'Confirmed Lyme disease diagnosis requiring antibiotic treatment. Rates 100% during active treatment phase.',
    },
    ptlds: {
      term: 'Post-Treatment Lyme Disease Syndrome (PTLDS)',
      definition: 'Persistent symptoms after completing Lyme disease treatment, including fatigue, pain, cognitive difficulties.',
    },
    residuals: {
      term: 'Residuals',
      definition: 'Ongoing symptoms after treatment completion, rated under the body system affected (neurological, musculoskeletal, cardiac, etc.).',
    },
  },

  importantNotes: [
    'Active Lyme disease rates 100% during treatment (minimum 6 months)',
    'After treatment, rate residual symptoms under appropriate body system codes',
    'Common residuals: peripheral neuropathy, arthritis, chronic fatigue, cognitive issues',
    'PTLDS may require multiple diagnostic codes for different body systems',
    'Document all persistent symptoms after treatment completion',
    'Neurological residuals often rated under DC 8520 (incomplete paralysis)',
    'Joint residuals rated under appropriate arthritis codes',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - MALARIA (DC 6304)
// ============================================

export const MALARIA_CRITERIA = {
  diagnosticCode: '6304',
  condition: 'Malaria',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6304',

  ratings: [
    {
      percent: 100,
      summary: 'Active disease requiring hospital treatment or continuous medication',
      criteria: {
        activeDisease: true,
        severe: true,
        hospitalization: true,
      },
      criteriaDescription: [
        'Active malaria requiring treatment:',
        '   Severe symptoms requiring hospitalization',
        '   Complications (cerebral malaria, severe anemia, organ failure)',
        '   Continuous antimalarial medication required',
        '   Near-constant debilitating symptoms',
      ],
      evidenceNeeded: [
        'Hospital admission records for malaria complications',
        'Lab results showing parasitemia',
        'Daily symptom documentation during acute phase',
        'Medication records (antimalarials)',
        'Blood work showing severe anemia or organ involvement',
      ],
    },
    {
      percent: 60,
      summary: 'Frequent relapses with debilitating symptoms',
      criteria: {
        frequentRelapses: true,
        debilitating: true,
      },
      criteriaDescription: [
        'Relapsing malaria with significant impact:',
        '   Multiple relapses per year (3+)',
        '   Debilitating cyclical fever episodes',
        '   Chronic anemia from recurring parasitemia',
        '   Substantial impact on daily activities',
      ],
      evidenceNeeded: [
        'Documentation of multiple relapse episodes',
        'Lab confirmation of recurring parasitemia',
        'Symptom logs showing cyclical fever patterns',
        'Evidence of chronic anemia',
        'Impact on work/daily function',
      ],
    },
    {
      percent: 30,
      summary: 'Occasional relapses or chronic residual symptoms',
      criteria: {
        occasionalRelapses: true,
        residualSymptoms: true,
      },
      criteriaDescription: [
        'Chronic malaria symptoms:',
        '   1-2 relapses per year',
        '   Persistent fatigue and weakness',
        '   Mild chronic anemia',
        '   Enlarged spleen (splenomegaly)',
      ],
      evidenceNeeded: [
        'Documentation of relapse episodes',
        'Lab work showing mild anemia',
        'Ultrasound/imaging showing splenomegaly if present',
        'Regular symptom tracking',
      ],
    },
    {
      percent: 10,
      summary: 'Residual symptoms or single relapse',
      criteria: {
        residual: true,
        minimal: true,
      },
      criteriaDescription: [
        'Minimal residual effects:',
        '   History of malaria with occasional symptoms',
        '   Mild fatigue or weakness',
        '   Single relapse or no recent relapses',
      ],
      evidenceNeeded: [
        'Medical history confirming past malaria diagnosis',
        'Symptom tracking showing mild impact',
        'Treatment records',
      ],
    },
    {
      percent: 0,
      summary: 'Malaria treated, currently asymptomatic',
      criteria: {
        treated: true,
        asymptomatic: true,
      },
      criteriaDescription: [
        'Malaria successfully treated:',
        '   No active parasitemia',
        '   No current symptoms',
        '   No relapses',
      ],
      evidenceNeeded: [
        'Treatment completion records',
        'Negative lab tests for parasites',
      ],
    },
  ],

  definitions: {
    relapse: {
      term: 'Relapse',
      definition: 'Recurrence of malaria symptoms after apparent cure, caused by activation of dormant parasites in the liver (P. vivax and P. ovale).',
    },
    cyclicalFever: {
      term: 'Cyclical Fever',
      definition: 'Periodic fever pattern characteristic of malaria, typically occurring every 48-72 hours depending on parasite species.',
    },
    parasitemia: {
      term: 'Parasitemia',
      definition: 'Presence of malaria parasites in the blood, confirmed by microscopy or rapid diagnostic test.',
    },
  },

  importantNotes: [
    'VA rates malaria based on severity and frequency of relapses',
    'P. vivax and P. ovale can cause relapses years after initial infection',
    'Cyclical fever pattern (every 48-72 hours) is characteristic',
    'Document each fever episode with temperature readings',
    'Chronic anemia common with recurring infections',
    'Splenomegaly may persist after treatment',
    'Treatment requires full course of antimalarials plus primaquine for liver stages',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - BRUCELLOSIS (DC 6316)
// ============================================

export const BRUCELLOSIS_CRITERIA = {
  diagnosticCode: '6316',
  condition: 'Brucellosis',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6316',

  ratings: [
    {
      percent: 100,
      summary: 'Severe active disease with multiple organ involvement',
      criteria: {
        activeDisease: true,
        severe: true,
        multiOrgan: true,
      },
      criteriaDescription: [
        'Severe active brucellosis:',
        '   Constant debilitating symptoms',
        '   Multiple organ involvement (liver, spleen, bones, heart)',
        '   Neurobrucellosis or endocarditis',
        '   Requires continuous treatment',
      ],
      evidenceNeeded: [
        'Positive blood cultures or serology',
        'Imaging showing organ involvement',
        'Neurological exam results if CNS involvement',
        'Daily symptom logs showing severity',
        'Treatment records (long-term antibiotics)',
      ],
    },
    {
      percent: 60,
      summary: 'Active disease with relapsing pattern',
      criteria: {
        activeDisease: true,
        relapsing: true,
      },
      criteriaDescription: [
        'Chronic relapsing brucellosis:',
        '   Frequent relapses (3+ per year)',
        '   Chronic arthritis or spondylitis',
        '   Persistent fever and night sweats',
        '   Significant functional impairment',
      ],
      evidenceNeeded: [
        'Documentation of multiple relapse episodes',
        'Lab confirmation of active infection',
        'Joint imaging showing arthritis',
        'Symptom pattern documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Occasional relapses or chronic symptoms',
      criteria: {
        occasionalRelapses: true,
        chronicSymptoms: true,
      },
      criteriaDescription: [
        'Chronic brucellosis:',
        '   1-2 relapses per year',
        '   Chronic fatigue and weakness',
        '   Recurrent joint or back pain',
        '   Depression or mood changes',
      ],
      evidenceNeeded: [
        'Relapse documentation',
        'Lab work during symptomatic periods',
        'Mental health evaluation if depression present',
        'Regular symptom tracking',
      ],
    },
    {
      percent: 10,
      summary: 'Residual symptoms, minimal impact',
      criteria: {
        residual: true,
        minimal: true,
      },
      criteriaDescription: [
        'Post-brucellosis residuals:',
        '   Chronic fatigue or malaise',
        '   Occasional joint pain',
        '   Mood changes',
        '   No active infection',
      ],
      evidenceNeeded: [
        'History of confirmed brucellosis',
        'Treatment completion records',
        'Symptom logs showing mild impact',
      ],
    },
    {
      percent: 0,
      summary: 'Treated, currently asymptomatic',
      criteria: {
        treated: true,
        asymptomatic: true,
      },
      criteriaDescription: [
        'Brucellosis successfully treated with no residuals',
      ],
      evidenceNeeded: [
        'Treatment completion records',
        'Negative lab tests',
      ],
    },
  ],

  definitions: {
    relapse: {
      term: 'Relapse',
      definition: 'Recurrence of brucellosis symptoms after apparent cure. Common even after adequate treatment.',
    },
    neurobrucellosis: {
      term: 'Neurobrucellosis',
      definition: 'Central nervous system involvement causing meningitis, encephalitis, or other neurological complications.',
    },
    spondylitis: {
      term: 'Spondylitis',
      definition: 'Inflammation of vertebrae, a common complication of brucellosis causing chronic back pain.',
    },
  },

  importantNotes: [
    'Brucellosis is a zoonotic disease (contracted from animals)',
    'Common in military personnel exposed to livestock in deployment areas',
    'Relapsing pattern is characteristic - symptoms may recur for years',
    'Night sweats and undulant (wave-like) fever are classic symptoms',
    'Chronic depression and fatigue may persist after treatment',
    'Joint and spine involvement can cause permanent damage',
    'Requires prolonged antibiotic treatment (6+ weeks)',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - CAMPYLOBACTER JEJUNI (DC 6330)
// ============================================

export const CAMPYLOBACTER_CRITERIA = {
  diagnosticCode: '6330',
  condition: 'Campylobacter jejuni Infection',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6330',

  ratings: [
    {
      percent: 100,
      summary: 'Severe complications (Guillain-Barr syndrome or severe reactive arthritis)',
      criteria: {
        severeComplications: true,
        guillainBarre: true,
      },
      criteriaDescription: [
        'Severe post-infectious complications:',
        '   Guillain-Barr syndrome (GBS)',
        '   Severe reactive arthritis requiring mobility aids',
        '   Chronic inflammatory demyelinating polyneuropathy (CIDP)',
        '   Total functional impairment',
      ],
      evidenceNeeded: [
        'Neurological evaluation confirming GBS or CIDP',
        'EMG/nerve conduction studies',
        'Rheumatology evaluation for reactive arthritis',
        'Functional assessment documentation',
        'Link to prior Campylobacter infection',
      ],
    },
    {
      percent: 60,
      summary: 'Moderate complications with ongoing impairment',
      criteria: {
        moderateComplications: true,
        chronicSymptoms: true,
      },
      criteriaDescription: [
        'Chronic post-infectious sequelae:',
        '   Reactive arthritis affecting multiple joints',
        '   Peripheral neuropathy',
        '   Chronic fatigue post-infection',
        '   Irritable bowel syndrome (IBS) post-infection',
      ],
      evidenceNeeded: [
        'Joint imaging or exam findings',
        'Neurological exam for neuropathy',
        'GI evaluation for post-infectious IBS',
        'Documentation of functional limitations',
      ],
    },
    {
      percent: 30,
      summary: 'Mild chronic symptoms or occasional relapses',
      criteria: {
        mildChronic: true,
        occasionalSymptoms: true,
      },
      criteriaDescription: [
        'Post-infectious symptoms:',
        '   Mild reactive arthritis (1-2 joints)',
        '   Chronic diarrhea or bowel changes',
        '   Recurrent abdominal pain',
        '   Mild fatigue',
      ],
      evidenceNeeded: [
        'GI symptom tracking',
        'Stool studies if ongoing diarrhea',
        'Joint exam documentation',
        'Original infection confirmation',
      ],
    },
    {
      percent: 10,
      summary: 'Minimal residual symptoms',
      criteria: {
        minimal: true,
        residual: true,
      },
      criteriaDescription: [
        'Mild post-infectious effects:',
        '   Occasional GI symptoms',
        '   Mild fatigue',
        '   Rare joint pain',
      ],
      evidenceNeeded: [
        'History of confirmed Campylobacter infection',
        'Symptom logs',
      ],
    },
    {
      percent: 0,
      summary: 'Fully recovered',
      criteria: {
        recovered: true,
        asymptomatic: true,
      },
      criteriaDescription: [
        'Complete recovery from Campylobacter infection',
      ],
      evidenceNeeded: [
        'Treatment records',
        'Resolution of symptoms',
      ],
    },
  ],

  definitions: {
    guillainBarre: {
      term: 'Guillain-Barr Syndrome (GBS)',
      definition: 'Rare autoimmune complication where immune system attacks peripheral nerves, causing weakness and paralysis. Can follow Campylobacter infection.',
    },
    reactiveArthritis: {
      term: 'Reactive Arthritis',
      definition: 'Joint inflammation triggered by infection elsewhere in body. Can occur 1-4 weeks after Campylobacter infection.',
    },
    postInfectiousIBS: {
      term: 'Post-Infectious IBS',
      definition: 'Irritable bowel syndrome developing after acute gastroenteritis. Common after Campylobacter.',
    },
  },

  importantNotes: [
    'Campylobacter is a common cause of bacterial gastroenteritis',
    'Associated with Gulf War illness and military deployments',
    'Leading bacterial trigger for Guillain-Barr syndrome',
    'Reactive arthritis can develop 1-4 weeks after infection',
    'Post-infectious IBS may persist for months to years',
    'Acute infection typically lasts 3-7 days',
    'Complications are more important than acute infection for VA rating',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - Q FEVER (DC 6331)
// ============================================

export const Q_FEVER_CRITERIA = {
  diagnosticCode: '6331',
  condition: 'Q Fever',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6331',

  ratings: [
    {
      percent: 100,
      summary: 'Chronic Q fever with endocarditis or multi-organ involvement',
      criteria: {
        chronic: true,
        endocarditis: true,
        severe: true,
      },
      criteriaDescription: [
        'Chronic Q fever (>6 months):',
        '   Q fever endocarditis (valve infection)',
        '   Vascular infection (infected aneurysms)',
        '   Chronic hepatitis with cirrhosis',
        '   Osteomyelitis',
        '   Requires long-term antibiotics (18+ months)',
      ],
      evidenceNeeded: [
        'Echocardiogram showing valve vegetation',
        'Positive serology (Phase I antibodies >1:800)',
        'Imaging of affected organs',
        'Treatment records (doxycycline + hydroxychloroquine)',
        'Cardiology/infectious disease notes',
      ],
    },
    {
      percent: 60,
      summary: 'Chronic Q fever fatigue syndrome',
      criteria: {
        chronic: true,
        fatigueSyndrome: true,
      },
      criteriaDescription: [
        'Post-Q fever fatigue syndrome (QFS):',
        '   Severe chronic fatigue >6 months post-infection',
        '   Myalgias and arthralgias',
        '   Night sweats',
        '   Mood disturbances',
        '   Substantially impacts daily function',
      ],
      evidenceNeeded: [
        'Original Q fever diagnosis confirmation',
        'Symptom logs showing >6 months of fatigue',
        'Exclusion of other causes',
        'Functional impact documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Mild chronic symptoms or occasional relapses',
      criteria: {
        chronicMild: true,
        residualSymptoms: true,
      },
      criteriaDescription: [
        'Chronic residual symptoms:',
        '   Persistent fatigue or weakness',
        '   Recurrent fever or sweats',
        '   Chronic headaches',
        '   Joint or muscle pain',
      ],
      evidenceNeeded: [
        'Documentation of original infection',
        'Symptom tracking',
        'Lab work if available',
      ],
    },
    {
      percent: 10,
      summary: 'Minimal residual symptoms',
      criteria: {
        minimal: true,
        residual: true,
      },
      criteriaDescription: [
        'Mild post-Q fever effects:',
        '   Occasional fatigue',
        '   Rare headaches or muscle aches',
        '   Minimal functional impact',
      ],
      evidenceNeeded: [
        'History of Q fever',
        'Treatment records',
        'Symptom logs',
      ],
    },
    {
      percent: 0,
      summary: 'Fully recovered from acute Q fever',
      criteria: {
        recovered: true,
        asymptomatic: true,
      },
      criteriaDescription: [
        'Complete recovery from Q fever',
      ],
      evidenceNeeded: [
        'Treatment completion',
        'Symptom resolution',
      ],
    },
  ],

  definitions: {
    chronicQFever: {
      term: 'Chronic Q Fever',
      definition: 'Persistent infection >6 months, most commonly manifesting as endocarditis. Occurs in ~1-5% of acute infections.',
    },
    qFeverFatigueSyndrome: {
      term: 'Q Fever Fatigue Syndrome (QFS)',
      definition: 'Debilitating fatigue lasting >6 months after acute Q fever, similar to chronic fatigue syndrome.',
    },
    phaseIAntibodies: {
      term: 'Phase I Antibodies',
      definition: 'Antibodies against chronic form of Coxiella burnetii. High titers (>1:800) indicate chronic infection.',
    },
  },

  importantNotes: [
    'Q fever caused by Coxiella burnetii bacteria',
    'Common in military personnel deployed to Iraq, Afghanistan',
    'Transmitted via inhalation of contaminated dust/aerosols from livestock',
    'Acute Q fever: flu-like illness lasting 1-3 weeks',
    'Chronic Q fever develops in 1-5% of cases, usually within 2 years',
    'Q fever endocarditis has high mortality if untreated',
    'Post-Q fever fatigue syndrome can last years',
    'Veterans with valve abnormalities at higher risk for chronic Q fever',
  ],
};
// ============================================
// PHASE 6: INFECTIOUS DISEASES - SALMONELLA (DC 6333)
// ============================================

export const SALMONELLA_CRITERIA = {
  diagnosticCode: '6333',
  condition: 'Nontyphoid Salmonella Infection',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6333',

  ratings: [
    {
      percent: 100,
      summary: 'Severe complications (bacteremia, sepsis, or hospitalization)',
      criteria: {
        severeComplications: true,
        hospitalized: true,
      },
      criteriaDescription: [
        'Severe Salmonella infection with complications:',
        '   Bacteremia/sepsis requiring hospitalization',
        '   Reactive arthritis requiring mobility aids',
        '   Chronic post-infectious sequelae',
        '   Unable to work or perform daily activities',
      ],
      evidenceNeeded: [
        'Hospital admission records',
        'Blood culture results confirming bacteremia',
        'Treatment records (IV antibiotics)',
        'Documentation of complications',
        'Functional impact assessment',
      ],
    },
    {
      percent: 60,
      summary: 'Moderate symptoms with reactive arthritis or chronic complications',
      criteria: {
        reactiveArthritis: true,
        chronicSymptoms: true,
      },
      criteriaDescription: [
        'Post-infectious complications:',
        '   Reactive arthritis affecting multiple joints',
        '   Chronic diarrhea persisting weeks to months',
        '   Recurrent infections',
        '   Significant functional impairment',
      ],
      evidenceNeeded: [
        'Stool culture confirming Salmonella',
        'Joint imaging for reactive arthritis',
        'GI evaluation for chronic symptoms',
        'Documentation of frequency and severity',
      ],
    },
    {
      percent: 30,
      summary: 'Mild chronic symptoms or occasional relapses',
      criteria: {
        mildChronic: true,
        occasionalSymptoms: true,
      },
      criteriaDescription: [
        'Chronic residual symptoms:',
        '   Intermittent GI symptoms',
        '   Mild reactive arthritis (1-2 joints)',
        '   Chronic fatigue',
      ],
      evidenceNeeded: [
        'Original infection confirmation',
        'Symptom tracking logs',
        'Medical evaluation records',
      ],
    },
    {
      percent: 10,
      summary: 'Minimal residual symptoms',
      criteria: {
        minimal: true,
        residual: true,
      },
      criteriaDescription: [
        'Mild post-infection effects',
      ],
      evidenceNeeded: [
        'History of confirmed Salmonella infection',
        'Symptom logs',
      ],
    },
    {
      percent: 0,
      summary: 'Fully recovered',
      criteria: {
        recovered: true,
        asymptomatic: true,
      },
      criteriaDescription: [
        'Complete recovery from Salmonella infection',
      ],
      evidenceNeeded: [
        'Treatment completion records',
      ],
    },
  ],

  definitions: {
    bacteremia: {
      term: 'Bacteremia',
      definition: 'Bacteria in bloodstream. Salmonella bacteremia is more common in immunocompromised individuals.',
    },
    reactiveArthritis: {
      term: 'Reactive Arthritis',
      definition: 'Joint inflammation triggered by infection elsewhere in body. Can occur 1-4 weeks after Salmonella infection.',
    },
  },

  importantNotes: [
    'Salmonella is common cause of foodborne illness',
    'Associated with Gulf War deployments',
    'Reactive arthritis can develop 1-4 weeks post-infection',
    'Bacteremia more common in immunocompromised',
    'Chronic carrier state possible',
    'Document acute symptoms and any long-term complications',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - SHIGELLA (DC 6334)
// ============================================

export const SHIGELLA_CRITERIA = {
  diagnosticCode: '6334',
  condition: 'Shigella Infection',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6334',

  ratings: [
    {
      percent: 100,
      summary: 'Severe complications (HUS, seizures, or hospitalization)',
      criteria: {
        severeComplications: true,
        hus: true,
      },
      criteriaDescription: [
        'Severe Shigella infection with complications:',
        '   Hemolytic uremic syndrome (HUS)',
        '   Seizures (especially in children)',
        '   Bacteremia/sepsis',
        '   Hospitalization required',
        '   Severe dehydration requiring IV fluids',
      ],
      evidenceNeeded: [
        'Hospital admission records',
        'Lab results showing HUS (low platelets, kidney dysfunction)',
        'Stool culture confirming Shigella',
        'Treatment records',
        'Neurological evaluation if seizures',
      ],
    },
    {
      percent: 60,
      summary: 'Moderate symptoms with reactive arthritis or chronic complications',
      criteria: {
        reactiveArthritis: true,
        chronicSymptoms: true,
      },
      criteriaDescription: [
        'Post-infectious complications:',
        '   Reactive arthritis (Reiter syndrome)',
        '   Chronic diarrhea or IBS',
        '   Recurrent infections',
        '   Significant impact on daily function',
      ],
      evidenceNeeded: [
        'Stool culture confirming Shigella',
        'Joint evaluation and imaging',
        'GI evaluation for chronic symptoms',
        'Documentation of functional impact',
      ],
    },
    {
      percent: 30,
      summary: 'Mild chronic symptoms',
      criteria: {
        mildChronic: true,
      },
      criteriaDescription: [
        'Chronic residual symptoms:',
        '   Intermittent GI symptoms',
        '   Mild joint pain',
        '   Chronic fatigue',
      ],
      evidenceNeeded: [
        'Original infection documentation',
        'Symptom tracking',
      ],
    },
    {
      percent: 10,
      summary: 'Minimal residual symptoms',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Mild post-infection effects',
      ],
      evidenceNeeded: [
        'History of Shigella infection',
      ],
    },
    {
      percent: 0,
      summary: 'Fully recovered',
      criteria: {
        recovered: true,
      },
      criteriaDescription: [
        'Complete recovery',
      ],
      evidenceNeeded: [
        'Treatment completion',
      ],
    },
  ],

  definitions: {
    hus: {
      term: 'Hemolytic Uremic Syndrome (HUS)',
      definition: 'Life-threatening complication causing kidney failure, low platelets, and destruction of red blood cells. Can occur with Shigella dysenteriae.',
    },
    tenesmus: {
      term: 'Tenesmus',
      definition: 'Feeling of incomplete bowel evacuation with painful straining. Common with Shigella dysentery.',
    },
  },

  importantNotes: [
    'Shigella causes dysentery (bloody diarrhea)',
    'Associated with Gulf War deployments',
    'HUS is rare but serious complication',
    'Reactive arthritis can develop weeks after infection',
    'Tenesmus (straining) is characteristic symptom',
    'Document severity and any complications',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - WEST NILE VIRUS (DC 6335)
// ============================================

export const WEST_NILE_CRITERIA = {
  diagnosticCode: '6335',
  condition: 'West Nile Virus',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6335',

  ratings: [
    {
      percent: 100,
      summary: 'Severe neuroinvasive disease with permanent impairment',
      criteria: {
        neuroinvasive: true,
        permanentImpairment: true,
      },
      criteriaDescription: [
        'Severe West Nile neuroinvasive disease:',
        '   Encephalitis (brain inflammation)',
        '   Meningitis',
        '   Acute flaccid paralysis (polio-like)',
        '   Permanent muscle weakness',
        '   Cognitive impairment',
        '   Unable to work or perform daily activities',
      ],
      evidenceNeeded: [
        'Hospital admission records',
        'CSF (spinal fluid) analysis',
        'Serology confirming West Nile IgM antibodies',
        'MRI/CT showing brain involvement',
        'Neurological exam documenting deficits',
        'Functional assessment',
      ],
    },
    {
      percent: 60,
      summary: 'Moderate neurological symptoms or chronic fatigue',
      criteria: {
        moderateNeuro: true,
        chronicFatigue: true,
      },
      criteriaDescription: [
        'Post-West Nile syndrome:',
        '   Chronic muscle weakness',
        '   Persistent fatigue (months to years)',
        '   Memory/concentration problems',
        '   Tremors or movement disorders',
        '   Significant functional limitation',
      ],
      evidenceNeeded: [
        'Original West Nile diagnosis confirmation',
        'Neurological evaluation',
        'Documentation of persistent symptoms >6 months',
        'Functional impact assessment',
        'Treatment records',
      ],
    },
    {
      percent: 30,
      summary: 'Mild chronic symptoms',
      criteria: {
        mildChronic: true,
      },
      criteriaDescription: [
        'Chronic residual symptoms:',
        '   Mild muscle weakness',
        '   Fatigue',
        '   Headaches',
        '   Mild cognitive issues',
      ],
      evidenceNeeded: [
        'Diagnosis confirmation',
        'Symptom tracking',
        'Medical evaluation',
      ],
    },
    {
      percent: 10,
      summary: 'Minimal residual symptoms',
      criteria: {
        minimal: true,
      },
      criteriaDescription: [
        'Mild post-infection effects',
      ],
      evidenceNeeded: [
        'History of West Nile infection',
      ],
    },
    {
      percent: 0,
      summary: 'Fully recovered',
      criteria: {
        recovered: true,
      },
      criteriaDescription: [
        'Complete recovery from West Nile',
      ],
      evidenceNeeded: [
        'Recovery documentation',
      ],
    },
  ],

  definitions: {
    neuroinvasive: {
      term: 'Neuroinvasive Disease',
      definition: 'West Nile infection affecting the nervous system, causing encephalitis, meningitis, or acute flaccid paralysis.',
    },
    acuteFlaccidParalysis: {
      term: 'Acute Flaccid Paralysis',
      definition: 'Sudden muscle weakness similar to polio, caused by West Nile attacking spinal cord motor neurons. May be permanent.',
    },
  },

  importantNotes: [
    'West Nile transmitted by mosquitoes',
    'Only ~1% develop neuroinvasive disease, but it can be severe',
    'Post-West Nile syndrome: chronic fatigue and weakness can last years',
    'Acute flaccid paralysis may be permanent',
    'No specific treatment - supportive care',
    'Veterans in endemic areas at higher risk',
    'Document both acute illness and long-term sequelae',
  ],
};

// ============================================
// PHASE 6: INFECTIOUS DISEASES - NTM (DC 6312)
// ============================================

export const NTM_CRITERIA = {
  diagnosticCode: '6312',
  condition: 'Nontuberculous Mycobacterium Infection',
  cfrReference: '38 CFR 4.88b, Diagnostic Code 6312',

  ratings: [
    {
      percent: 100,
      summary: 'Active disease requiring continuous treatment',
      criteria: {
        activeDisease: true,
        continuousTreatment: true,
      },
      criteriaDescription: [
        'Active NTM infection:',
        '   Requires long-term multi-drug antibiotic therapy (12-24 months)',
        '   Progressive lung disease',
        '   Disseminated NTM infection',
        '   Severe respiratory impairment',
        '   Unable to work or perform daily activities',
      ],
      evidenceNeeded: [
        'Sputum cultures confirming NTM (multiple samples)',
        'CT scan showing cavitary or nodular lung disease',
        'Treatment records (macrolide + ethambutol + rifampin)',
        'Pulmonary function tests showing impairment',
        'Infectious disease specialist notes',
      ],
    },
    {
      percent: 60,
      summary: 'Active disease with moderate symptoms on treatment',
      criteria: {
        activeDisease: true,
        moderateSymptoms: true,
      },
      criteriaDescription: [
        'NTM requiring treatment with moderate impact:',
        '   On long-term antibiotics',
        '   Chronic cough with sputum production',
        '   Fatigue and weight loss',
        '   Moderate respiratory symptoms',
      ],
      evidenceNeeded: [
        'Positive NTM cultures',
        'CT findings consistent with NTM',
        'Treatment compliance records',
        'Symptom documentation',
        'Pulmonary function tests',
      ],
    },
    {
      percent: 30,
      summary: 'Mild disease or post-treatment monitoring',
      criteria: {
        mildDisease: true,
        postTreatment: true,
      },
      criteriaDescription: [
        'Mild NTM or post-treatment:',
        '   Completed treatment, monitoring for recurrence',
        '   Mild chronic cough',
        '   Minimal respiratory impairment',
      ],
      evidenceNeeded: [
        'Treatment completion records',
        'Follow-up imaging',
        'Negative cultures post-treatment',
      ],
    },
    {
      percent: 10,
      summary: 'Colonization without active disease',
      criteria: {
        colonization: true,
      },
      criteriaDescription: [
        'NTM isolated from cultures but not causing active disease',
      ],
      evidenceNeeded: [
        'Culture results',
        'Documentation of monitoring',
      ],
    },
    {
      percent: 0,
      summary: 'Successfully treated, no residuals',
      criteria: {
        cured: true,
      },
      criteriaDescription: [
        'NTM successfully treated with no ongoing symptoms',
      ],
      evidenceNeeded: [
        'Treatment completion',
        'Negative follow-up cultures',
      ],
    },
  ],

  definitions: {
    ntm: {
      term: 'Nontuberculous Mycobacterium (NTM)',
      definition: 'Bacteria related to TB but not M. tuberculosis. Common species: MAC (M. avium complex), M. abscessus, M. kansasii.',
    },
    mac: {
      term: 'MAC (M. avium Complex)',
      definition: 'Most common NTM causing lung disease. Requires prolonged multi-drug therapy.',
    },
  },

  importantNotes: [
    'NTM different from tuberculosis but related',
    'Common species: MAC, M. abscessus, M. kansasii',
    'Requires prolonged treatment (12-24 months)',
    'Multi-drug regimen: typically macrolide + ethambutol + rifampin',
    'Not contagious person-to-person',
    'More common in immunocompromised',
    'Diagnosis requires clinical + radiographic + microbiologic criteria',
    'Can be difficult to treat and may recur',
  ],
};

// ============================================
// Phase: 7 Dental Criteria
// ============================================

// ============================================
// TMJ DISORDER CRITERIA (DC 9905)
// ============================================
export const TMJ_DISORDER_CRITERIA = {
  diagnosticCode: '9905',
  condition: 'Temporomandibular Joint (TMJ) Disorder',
  cfrReference: '38 CFR 4.150, Diagnostic Code 9905',

  ratings: [
    {
      percent: 50,
      summary: 'Interincisal range of 0-10mm with liquid diet only',
      criteria: {
        interincisal: '0-10mm',
        diet: 'full-liquid',
        lateralExcursion: '0-4mm',
      },
      criteriaDescription: [
        'Maximum interincisal distance (jaw opening) of 0-10mm',
        'Requires full liquid diet',
        'May also have lateral excursion 0-4mm (additional 10%)',
      ],
      evidenceNeeded: [
        'Clinical measurement of maximum jaw opening (0-10mm)',
        'Documentation that solid foods cannot be chewed',
        'Evidence of liquid diet requirement',
        'Dentist or oral surgeon records',
        'X-rays or MRI showing TMJ damage if available',
      ],
    },
    {
      percent: 40,
      summary: 'Interincisal range of 11-20mm with semi-solid/soft diet',
      criteria: {
        interincisal: '11-20mm',
        diet: 'semi-solid-soft',
        lateralExcursion: '0-4mm',
      },
      criteriaDescription: [
        'Maximum interincisal distance of 11-20mm',
        'Requires semi-solid or soft food diet',
        'May also have lateral excursion 0-4mm (additional 10%)',
      ],
      evidenceNeeded: [
        'Clinical measurement of jaw opening (11-20mm)',
        'Documentation of dietary restrictions to soft foods',
        'Dentist records showing TMJ dysfunction',
        'Evidence that normal foods cause pain or cannot be chewed',
      ],
    },
    {
      percent: 30,
      summary: 'Interincisal range of 21-25mm with dietary restrictions',
      criteria: {
        interincisal: '21-25mm',
        diet: 'some-restrictions',
        lateralExcursion: '0-4mm',
      },
      criteriaDescription: [
        'Maximum interincisal distance of 21-25mm',
        'Some dietary restrictions required',
        'May also have lateral excursion 0-4mm (additional 10%)',
      ],
      evidenceNeeded: [
        'Clinical measurement showing 21-25mm opening',
        'Documentation of difficulty with certain foods (hard, chewy)',
        'TMJ treatment records',
        'Evidence of pain with prolonged chewing',
      ],
    },
    {
      percent: 20,
      summary: 'Interincisal range of 26-30mm',
      criteria: {
        interincisal: '26-30mm',
        lateralExcursion: '0-4mm',
      },
      criteriaDescription: [
        'Maximum interincisal distance of 26-30mm',
        'May also have lateral excursion 0-4mm (additional 10%)',
      ],
      evidenceNeeded: [
        'Clinical measurement of 26-30mm jaw opening',
        'Documentation of TMJ symptoms and treatment',
        'Evidence of functional limitation',
      ],
    },
    {
      percent: 10,
      summary: 'Interincisal range of 31-35mm OR lateral excursion 0-4mm',
      criteria: {
        options: [
          { interincisal: '31-35mm' },
          { lateralExcursion: '0-4mm' },
        ],
      },
      criteriaDescription: [
        'Maximum interincisal distance of 31-35mm, OR',
        'Lateral excursion limited to 0-4mm',
      ],
      evidenceNeeded: [
        'Clinical measurement of jaw opening or lateral movement',
        'TMJ diagnosis and treatment records',
      ],
    },
  ],

  definitions: {
    interincisal: {
      term: 'Interincisal Range',
      definition: 'The maximum distance you can open your mouth, measured between the upper and lower front teeth. Normal range is 35-50mm. This is measured clinically by a dentist or doctor.',
    },
    lateralExcursion: {
      term: 'Lateral Excursion',
      definition: 'Side-to-side movement of the jaw. Normal lateral movement is at least 6mm to each side. Limitation to 0-4mm indicates significant TMJ dysfunction and may warrant an additional 10% rating.',
    },
    dietaryRestrictions: {
      term: 'Dietary Restrictions',
      definition: 'Inability to eat certain consistencies of food due to jaw dysfunction. More severe restrictions result in higher ratings.',
      examples: [
        'Full liquid diet (50%) - can only consume liquids',
        'Semi-solid/soft foods (40%) - no solid foods',
        'Some restrictions (30%) - difficulty with hard or chewy foods',
      ],
    },
  },

  importantNotes: [
    'TMJ ratings are based on maximum jaw opening (interincisal range) and dietary restrictions',
    'Lateral excursion limitation (0-4mm) may add an additional 10% to the rating',
    'Measurements should be taken by a dentist or oral surgeon',
    'Normal interincisal range is 35-50mm',
    'Document pain levels, clicking/popping, and functional limitations',
    'Bilateral TMJ involvement results in a single rating (not combined)',
  ],
};

// ============================================
// TOOTH LOSS CRITERIA (DC 9913)
// ============================================
export const TOOTH_LOSS_CRITERIA = {
  diagnosticCode: '9913',
  condition: 'Loss of Teeth Due to Bone Loss',
  cfrReference: '38 CFR 4.150, Diagnostic Code 9913',

  ratings: [
    {
      percent: 40,
      summary: 'Loss of all teeth (edentulous) - prosthesis does NOT restore masticatory function',
      criteria: {
        teethLost: 'all',
        prosthesis: 'does-not-restore',
      },
      criteriaDescription: [
        'Complete loss of all teeth',
        'Prosthesis (dentures) does NOT satisfactorily restore masticatory function',
      ],
      evidenceNeeded: [
        'Documentation that all teeth are lost',
        'Evidence that dentures do not allow proper chewing',
        'Dental records showing complete edentulism',
        'Statement that prosthesis is ill-fitting or non-functional',
      ],
    },
    {
      percent: 30,
      summary: 'Loss of all upper OR all lower teeth - prosthesis does NOT restore function',
      criteria: {
        options: [
          { teethLost: 'all-upper', prosthesis: 'does-not-restore' },
          { teethLost: 'all-lower', prosthesis: 'does-not-restore' },
        ],
      },
      criteriaDescription: [
        'Complete loss of all upper teeth, OR',
        'Complete loss of all lower teeth',
        'Prosthesis does NOT satisfactorily restore masticatory function',
      ],
      evidenceNeeded: [
        'Documentation of complete tooth loss in upper or lower arch',
        'Evidence that partial denture does not restore function',
        'Dental records',
      ],
    },
    {
      percent: 20,
      summary: 'Loss of all posterior teeth - prosthesis does NOT restore function',
      criteria: {
        options: [
          { teethLost: 'all-upper-lower-posterior', prosthesis: 'does-not-restore' },
        ],
      },
      criteriaDescription: [
        'Complete loss of all posterior teeth (molars and premolars) - upper and lower',
        'Prosthesis does NOT satisfactorily restore masticatory function',
      ],
      evidenceNeeded: [
        'Documentation of posterior tooth loss (both arches)',
        'Evidence that prosthesis does not restore chewing ability',
        'Dental records showing extent of tooth loss',
      ],
    },
    {
      percent: 10,
      summary: 'Loss of all anterior teeth OR all upper/lower posterior teeth - prosthesis does NOT restore',
      criteria: {
        options: [
          { teethLost: 'all-upper-lower-anterior', prosthesis: 'does-not-restore' },
          { teethLost: 'all-upper-posterior', prosthesis: 'does-not-restore' },
          { teethLost: 'all-lower-posterior', prosthesis: 'does-not-restore' },
        ],
      },
      criteriaDescription: [
        'Complete loss of all anterior teeth (front teeth) - upper and lower, OR',
        'Complete loss of all upper posterior teeth, OR',
        'Complete loss of all lower posterior teeth',
        'Prosthesis does NOT satisfactorily restore masticatory function',
      ],
      evidenceNeeded: [
        'Documentation of specific tooth loss pattern',
        'Evidence that prosthesis does not restore function',
        'Dental records',
      ],
    },
    {
      percent: 0,
      compensable: true,
      summary: 'Tooth loss with prosthesis that DOES restore function',
      criteria: {
        teethLost: 'any',
        prosthesis: 'restores',
      },
      criteriaDescription: [
        'Any pattern of tooth loss',
        'Prosthesis (dentures, bridges, implants) DOES satisfactorily restore masticatory function',
      ],
      evidenceNeeded: [
        'Documentation of tooth loss',
        'Evidence that prosthesis allows normal chewing',
      ],
    },
  ],

  definitions: {
    anteriorTeeth: {
      term: 'Anterior Teeth',
      definition: 'The front teeth (incisors and canines). There are 12 anterior teeth total - 6 upper and 6 lower.',
    },
    posteriorTeeth: {
      term: 'Posterior Teeth',
      definition: 'The back teeth used for chewing (premolars and molars). There are 20 posterior teeth total - 10 upper and 10 lower.',
    },
    masticatoryFunction: {
      term: 'Masticatory Function',
      definition: 'The ability to chew food properly. A prosthesis "restores function" if it allows normal chewing of various food types. It "does NOT restore function" if it is ill-fitting, causes pain, or prevents adequate chewing.',
    },
    boneLoss: {
      term: 'Bone Loss',
      definition: 'Tooth loss must be due to loss of bone supporting the teeth from trauma, osteomyelitis, or disease - NOT from periodontal disease alone. The underlying bone/jaw condition must be documented.',
      examples: [
        'Bone loss from jaw trauma or injury',
        'Bone loss from osteomyelitis (bone infection)',
        'Bone loss from radiation therapy',
        'Bone loss from jaw tumor/neoplasm',
      ],
    },
  },

  importantNotes: [
    ' CRITICAL: Tooth loss is only ratable if due to bone loss from trauma or disease',
    'Tooth loss from periodontal disease alone is NOT compensable by the VA',
    'Prosthesis that "does NOT restore function" means ill-fitting, painful, or inadequate for chewing',
    'If prosthesis DOES restore function, rating is 0% (compensable but not disabling)',
    'Document the cause of tooth loss (trauma, osteomyelitis, radiation, etc.)',
    'Multiple tooth loss patterns combine under a single rating (choose highest applicable)',
  ],
};

// ============================================
// MANDIBLE NONUNION CRITERIA (DC 9903)
// ============================================
export const MANDIBLE_NONUNION_CRITERIA = {
  diagnosticCode: '9903',
  condition: 'Mandible (Lower Jaw) Nonunion or Malunion',
  cfrReference: '38 CFR 4.150, Diagnostic Codes 9903-9904',

  ratings: [
    {
      percent: 30,
      summary: 'Nonunion or severe malunion with marked functional impairment',
      criteria: {
        severity: 'severe',
        functionalImpairment: 'marked',
      },
      criteriaDescription: [
        'Fracture has not healed (nonunion) or healed incorrectly (severe malunion)',
        'Marked impairment of mastication (chewing)',
        'Jaw instability',
        'Facial asymmetry',
      ],
      evidenceNeeded: [
        'X-rays or CT scans showing nonunion or malunion',
        'Documentation of persistent jaw instability',
        'Evidence of severe chewing difficulty',
        'Surgical records if applicable',
        'Measurements of jaw opening limitation',
      ],
    },
    {
      percent: 10,
      summary: 'Moderate malunion with some functional impairment',
      criteria: {
        severity: 'moderate',
        functionalImpairment: 'moderate',
      },
      criteriaDescription: [
        'Fracture healed incorrectly (malunion)',
        'Some impairment of jaw function',
        'May have bite problems or mild facial asymmetry',
      ],
      evidenceNeeded: [
        'X-rays showing malunion',
        'Documentation of functional limitations',
        'Evidence of bite problems',
      ],
    },
  ],

  definitions: {
    nonunion: {
      term: 'Nonunion',
      definition: 'A fracture that has failed to heal. The bone ends remain separate, causing instability and functional impairment.',
    },
    malunion: {
      term: 'Malunion',
      definition: 'A fracture that has healed in an incorrect position, resulting in deformity, bite problems, or functional limitation.',
    },
  },

  importantNotes: [
    'These ratings apply to mandible (lower jaw) fractures that did not heal properly',
    'Document the impact on chewing, speaking, and jaw stability',
    'Imaging studies (X-rays, CT) are critical evidence',
    'May combine with TMJ rating if both conditions are present',
  ],
};

// ============================================
// MALIGNANT ORAL NEOPLASM CRITERIA (DC 9918)
// ============================================
export const MALIGNANT_ORAL_NEOPLASM_CRITERIA = {
  diagnosticCode: '9918',
  condition: 'Malignant Neoplasm of Oral Cavity',
  cfrReference: '38 CFR 4.150, Diagnostic Code 9918',

  ratings: [
    {
      percent: 100,
      summary: 'During active treatment and for 6 months after completion',
      criteria: {
        malignant: true,
        activeTreatment: true,
      },
      criteriaDescription: [
        'Malignant (cancerous) tumor of mouth, tongue, lips, or jaw',
        'During active treatment (surgery, chemotherapy, radiation)',
        'For 6 months following completion of treatment',
      ],
      evidenceNeeded: [
        'Biopsy confirming malignancy',
        'Treatment records (surgery, chemo, radiation)',
        'Oncology records',
        'Dates of treatment start and completion',
      ],
    },
    {
      percent: 'varies',
      summary: 'After 6-month post-treatment period - rate residuals',
      criteria: {
        malignant: true,
        postTreatment: true,
      },
      criteriaDescription: [
        'After the mandatory 6-month 100% period',
        'Rate based on residual effects:',
        '   Tissue loss (DC 9900-9916)',
        '   Disfigurement/scarring (DC 7800)',
        '   Speech impairment (DC 6515)',
        '   Swallowing difficulty',
        '   TMJ dysfunction (DC 9905)',
        '   Dental disability (DC 9913)',
      ],
      evidenceNeeded: [
        'Documentation of cancer-free status or recurrence',
        'Evidence of residual effects',
        'Functional assessments',
        'Imaging showing tissue loss',
      ],
    },
  ],

  definitions: {
    malignantNeoplasm: {
      term: 'Malignant Neoplasm',
      definition: 'Cancer of the oral cavity, including mouth, tongue, lips, jaw bones, or soft tissues. This is distinct from benign (non-cancerous) growths.',
    },
    residuals: {
      term: 'Residuals',
      definition: 'The lasting effects after cancer treatment, such as tissue loss, scarring, difficulty swallowing, speech problems, or jaw dysfunction. These are rated separately after the 6-month period.',
    },
  },

  importantNotes: [
    ' Malignant oral cancers automatically rate 100% during treatment and for 6 months after',
    'After the 6-month period, rate based on specific residual impairments',
    'Multiple residuals may be combined for a total disability rating',
    'Recurrence restarts the 100% rating period',
    'Document all treatment dates carefully',
  ],
};

// ============================================
// BENIGN ORAL NEOPLASM CRITERIA (DC 9917)
// ============================================
export const BENIGN_ORAL_NEOPLASM_CRITERIA = {
  diagnosticCode: '9917',
  condition: 'Benign (Non-cancerous) Neoplasm of Oral Cavity',
  cfrReference: '38 CFR 4.150, Diagnostic Code 9917',

  ratings: [
    {
      percent: 'varies',
      summary: 'Rate based on loss of supporting structures or functional impairment',
      criteria: {
        benign: true,
        functionalImpairment: true,
      },
      criteriaDescription: [
        'Non-cancerous tumor or growth of mouth, tongue, lips, or jaw',
        'Rate based on:',
        '   Loss of jaw/bone structure (DC 9900-9916)',
        '   TMJ dysfunction if present (DC 9905)',
        '   Dental/tooth loss if applicable (DC 9913)',
        '   Disfigurement (DC 7800)',
        '   Functional impairment of speech or swallowing',
      ],
      evidenceNeeded: [
        'Biopsy confirming benign neoplasm',
        'Documentation of size and location',
        'Evidence of functional impairment',
        'Imaging studies',
        'Treatment records if removed surgically',
      ],
    },
  ],

  definitions: {
    benignNeoplasm: {
      term: 'Benign Neoplasm',
      definition: 'A non-cancerous tumor or growth. While not malignant, it can still cause functional problems depending on size and location.',
    },
  },

  importantNotes: [
    'Benign oral neoplasms do not receive the automatic 100% rating',
    'Rate based on functional impairment and residual effects',
    'May require rating under multiple diagnostic codes if causing various impairments',
    'Document impact on chewing, swallowing, speaking, and appearance',
  ],
};

// ============================================
// PHASE 8A: MENTAL HEALTH EXPANSION - RATING CRITERIA
// High-Priority Trackable Conditions
// ============================================

// ============================================
// SOMATIC SYMPTOM DISORDER CRITERIA (DC 9421)
// ============================================

export const SOMATIC_SYMPTOM_DISORDER_CRITERIA = {
  diagnosticCode: '9421',
  condition: 'Somatic Symptom Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9421',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    somaticSymptomDisorder: {
      term: 'Somatic Symptom Disorder',
      definition: 'One or more somatic symptoms that are distressing or result in significant disruption of daily life, with excessive thoughts, feelings, or behaviors related to the somatic symptoms.',
    },
    healthAnxiety: {
      term: 'Health Anxiety',
      definition: 'Excessive worry and preoccupation with having or acquiring a serious illness, despite medical reassurance.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Focus is on psychological response to physical symptoms, not the physical symptoms themselves',
    'Document frequency of medical visits and how symptoms affect daily functioning',
    'Time spent worrying about health is key evidence',
  ],
};

// ============================================
// OTHER SPECIFIED SOMATIC SYMPTOM DISORDER CRITERIA (DC 9422)
// ============================================

export const OTHER_SPECIFIED_SOMATIC_CRITERIA = {
  diagnosticCode: '9422',
  condition: 'Other Specified Somatic Symptom and Related Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9422',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: SOMATIC_SYMPTOM_DISORDER_CRITERIA.definitions,
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Used when somatic symptoms cause distress but do not meet full criteria for specific somatic disorder',
    'Rated using the same General Rating Formula as other mental disorders',
  ],
};

// ============================================
// UNSPECIFIED SOMATIC SYMPTOM DISORDER CRITERIA (DC 9423)
// ============================================

export const UNSPECIFIED_SOMATIC_CRITERIA = {
  diagnosticCode: '9423',
  condition: 'Unspecified Somatic Symptom and Related Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9423',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: SOMATIC_SYMPTOM_DISORDER_CRITERIA.definitions,
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Used when somatic symptoms are present but do not meet full criteria for a specific disorder',
    'Rated using the same General Rating Formula',
  ],
};

// ============================================
// ILLNESS ANXIETY DISORDER CRITERIA (DC 9425)
// ============================================

export const ILLNESS_ANXIETY_CRITERIA = {
  diagnosticCode: '9425',
  condition: 'Illness Anxiety Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9425',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    illnessAnxiety: {
      term: 'Illness Anxiety Disorder',
      definition: 'Preoccupation with having or acquiring a serious illness. Somatic symptoms are not present or are only mild. High level of health anxiety and excessive health-related behaviors.',
    },
    bodySurveillance: {
      term: 'Body Surveillance',
      definition: 'Excessive self-examination and monitoring of the body for signs of illness, often leading to increased anxiety.',
    },
    reassuranceSeeking: {
      term: 'Reassurance Seeking',
      definition: 'Repeatedly seeking medical evaluations, diagnostic tests, or reassurance from doctors despite negative results.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Different from Somatic Symptom Disorder - minimal physical symptoms present',
    'Focus is on anxiety about having illness despite medical evidence to contrary',
    'Document frequency of doctor visits, tests requested, and reassurance seeking',
  ],
};

// ============================================
// OTHER SPECIFIED ANXIETY DISORDER CRITERIA (DC 9410)
// ============================================

export const OTHER_SPECIFIED_ANXIETY_CRITERIA = {
  diagnosticCode: '9410',
  condition: 'Other Specified Anxiety Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9410',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: MENTAL_HEALTH_SHARED_CRITERIA.definitions,
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Used when anxiety symptoms cause distress but do not meet full criteria for specific anxiety disorder',
    'Rated using the same General Rating Formula as other anxiety disorders',
  ],
};

// ============================================
// DEPERSONALIZATION/DEREALIZATION DISORDER CRITERIA (DC 9417)
// ============================================

export const DEPERSONALIZATION_DEREALIZATION_CRITERIA = {
  diagnosticCode: '9417',
  condition: 'Depersonalization/Derealization Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9417',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    depersonalization: {
      term: 'Depersonalization',
      definition: 'Experiences of unreality, detachment, or being an outside observer with respect to one\'s thoughts, feelings, sensations, body, or actions (e.g., feeling like a robot, in a dream, or on autopilot).',
    },
    derealization: {
      term: 'Derealization',
      definition: 'Experiences of unreality or detachment with respect to surroundings (e.g., individuals or objects are experienced as unreal, dreamlike, foggy, lifeless, or visually distorted).',
    },
    realityTesting: {
      term: 'Reality Testing',
      definition: 'The ability to distinguish reality from fantasy. In depersonalization/derealization, reality testing remains intact - the person knows the feelings are not real.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Reality testing remains intact - person knows experiences are not real',
    'Document frequency and duration of episodes',
    'Track impact on daily functioning and relationships',
    'Different from psychosis - no delusions or hallucinations',
  ],
};

// ============================================
// CYCLOTHYMIC DISORDER CRITERIA (DC 9431)
// ============================================

export const CYCLOTHYMIC_CRITERIA = {
  diagnosticCode: '9431',
  condition: 'Cyclothymic Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9431',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    cyclothymia: {
      term: 'Cyclothymic Disorder',
      definition: 'A chronic fluctuating mood disturbance with numerous periods of hypomanic symptoms and depressive symptoms for at least 2 years. Less severe than bipolar disorder but persistent.',
    },
    hypomanicSymptoms: {
      term: 'Hypomanic Symptoms',
      definition: 'Elevated mood, increased activity or energy that is clearly different from normal but not as severe as full mania. Does not cause marked impairment.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Chronic mood instability for at least 2 years',
    'Less severe than Bipolar Disorder but more persistent',
    'Document pattern of mood swings over time',
    'Track impact on work, relationships, and daily functioning',
  ],
};

// ============================================
// EATING DISORDERS - SPECIAL RATING FORMULA
// Different from General Mental Health Rating Formula
// Based on weight loss and incapacitating episodes
// ============================================

// ============================================
// ANOREXIA NERVOSA CRITERIA (DC 9520)
// ============================================

export const ANOREXIA_NERVOSA_CRITERIA = {
  diagnosticCode: '9520',
  condition: 'Anorexia Nervosa',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9520',
  usesSharedCriteria: false, // SPECIAL RATING FORMULA

  ratingFormula: 'General Rating Formula for Eating Disorders',

  ratings: [
    {
      percent: 100,
      criteria: [
        'Self-induced weight loss to less than 80% of expected minimum weight',
        'Incapacitating episodes of at least 6 weeks total duration per year',
        'Requiring hospitalization more than twice a year for parenteral nutrition or tube feeding',
      ],
      description: 'Severe, life-threatening weight loss with frequent hospitalizations',
    },
    {
      percent: 60,
      criteria: [
        'Self-induced weight loss to less than 85% of expected minimum weight',
        'Incapacitating episodes of 6 or more weeks total duration per year',
      ],
      description: 'Severe weight loss with extended incapacitating episodes',
    },
    {
      percent: 30,
      criteria: [
        'Self-induced weight loss to less than 85% of expected minimum weight',
        'Incapacitating episodes of more than 2 but less than 6 weeks total duration per year',
      ],
      description: 'Significant weight loss with moderate incapacitating episodes',
    },
    {
      percent: 10,
      criteria: [
        'Binge eating followed by self-induced vomiting or other measures to prevent weight gain',
        'OR resistance to weight gain even when below expected minimum weight',
        'With diagnosis of an eating disorder but without incapacitating episodes',
      ],
      description: 'Eating disorder behaviors present but minimal incapacitation',
    },
    {
      percent: 0,
      criteria: [
        'Diagnosed eating disorder in remission with no current symptoms',
      ],
      description: 'Diagnosis established but currently asymptomatic',
    },
  ],

  definitions: {
    incapacitatingEpisode: {
      term: 'Incapacitating Episode',
      definition: 'A period during which bed rest and treatment by a physician are required. This is different from outpatient treatment or counseling.',
    },
    expectedMinimumWeight: {
      term: 'Expected Minimum Weight',
      definition: 'The minimum healthy weight for a person\'s height, age, and sex based on medical standards (typically BMI of 18.5 or above).',
    },
    parenteralNutrition: {
      term: 'Parenteral Nutrition',
      definition: 'Intravenous feeding - nutrition delivered directly into the bloodstream when oral intake is inadequate.',
    },
    tubeFeeding: {
      term: 'Tube Feeding',
      definition: 'Nasogastric or gastric tube feeding when unable or unwilling to consume adequate nutrition orally.',
    },
    selfInducedWeightLoss: {
      term: 'Self-Induced Weight Loss',
      definition: 'Weight loss through deliberate restriction of food intake, purging, excessive exercise, or other compensatory behaviors.',
    },
  },

  importantNotes: [
    'Eating disorders use a DIFFERENT rating formula than other mental health conditions',
    'Focus on weight loss percentage and incapacitating episodes requiring bed rest/hospitalization',
    'An "incapacitating episode" requires bed rest and physician treatment - not just therapy',
    'Document actual weight vs. expected minimum weight for height/age/sex',
    'Track hospitalizations, tube feeding, and parenteral nutrition',
    'Medical records showing weight, treatment, and hospitalizations are critical',
  ],
};

// ============================================
// BULIMIA NERVOSA CRITERIA (DC 9521)
// ============================================

export const BULIMIA_NERVOSA_CRITERIA = {
  diagnosticCode: '9521',
  condition: 'Bulimia Nervosa',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9521',
  usesSharedCriteria: false, // SPECIAL RATING FORMULA

  ratingFormula: 'General Rating Formula for Eating Disorders',

  ratings: ANOREXIA_NERVOSA_CRITERIA.ratings, // Same rating scale as anorexia

  definitions: {
    ...ANOREXIA_NERVOSA_CRITERIA.definitions,
    bingeEating: {
      term: 'Binge Eating',
      definition: 'Eating an abnormally large amount of food in a discrete period of time with a sense of lack of control over eating during the episode.',
    },
    purging: {
      term: 'Purging',
      definition: 'Self-induced vomiting or misuse of laxatives, diuretics, or enemas to prevent weight gain after binge eating.',
    },
    compensatoryBehaviors: {
      term: 'Compensatory Behaviors',
      definition: 'Behaviors used to prevent weight gain from binge eating, including fasting, excessive exercise, or misuse of medications.',
    },
  },

  importantNotes: [
    'Bulimia uses the SAME special rating formula as Anorexia - not the general mental health formula',
    'Focus on binge-purge cycles and weight-control behaviors',
    'Document frequency of binge/purge episodes',
    'Track incapacitating episodes requiring bed rest and physician treatment',
    'Weight may be normal or above normal, unlike anorexia',
    'Medical complications from purging should be documented separately',
  ],
};

// SCHIZOPHRENIA CRITERIA (DC 9201)
// ============================================
export const SCHIZOPHRENIA_CRITERIA = {
  diagnosticCode: '9201',
  condition: 'Schizophrenia',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9201',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    positiveSymptoms: {
      term: 'Positive Symptoms',
      definition: 'Symptoms that represent an excess or distortion of normal functions: hallucinations, delusions, disorganized speech, disorganized/catatonic behavior.',
    },
    negativeSymptoms: {
      term: 'Negative Symptoms',
      definition: 'Symptoms that represent a diminution or loss of normal functions: flat affect, alogia (poverty of speech), avolition (lack of motivation), anhedonia (inability to feel pleasure), social withdrawal.',
    },
    hallucinations: {
      term: 'Hallucinations',
      definition: 'Perception-like experiences without external stimulus. Most common in schizophrenia are auditory (hearing voices), but can also be visual, tactile, olfactory, or gustatory.',
    },
    delusions: {
      term: 'Delusions',
      definition: 'Fixed false beliefs not shared by others in the same culture. Common types: persecutory (being harmed), grandiose (special powers), referential (messages directed at person), somatic (about body).',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Schizophrenia typically requires hospitalization during acute episodes - document all hospitalizations',
    'Persistent hallucinations or delusions are specifically mentioned in 100% criteria',
    'Grossly inappropriate behavior is a 100% indicator',
    'Continuous medication is often necessary - document compliance and side effects',
    'Track both positive symptoms (hallucinations, delusions) and negative symptoms (flat affect, withdrawal)',
  ],
};

// ============================================
// SCHIZOAFFECTIVE DISORDER CRITERIA (DC 9202)
// ============================================
export const SCHIZOAFFECTIVE_DISORDER_CRITERIA = {
  diagnosticCode: '9202',
  condition: 'Schizoaffective Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9202',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    schizoaffective: {
      term: 'Schizoaffective Disorder',
      definition: 'A condition combining symptoms of schizophrenia (hallucinations, delusions) with mood disorder symptoms (depression or mania). Must have psychotic symptoms independent of mood episodes.',
    },
    moodEpisode: {
      term: 'Mood Episode',
      definition: 'Period of major depression, mania, or mixed features that occurs alongside psychotic symptoms in schizoaffective disorder.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Schizoaffective combines features of both schizophrenia and mood disorders',
    'Document both psychotic symptoms AND mood episodes (depression or mania)',
    'Treatment typically requires both antipsychotics and mood stabilizers',
  ],
};

// ============================================
// DELUSIONAL DISORDER CRITERIA (DC 9203)
// ============================================
export const DELUSIONAL_DISORDER_CRITERIA = {
  diagnosticCode: '9203',
  condition: 'Delusional Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9203',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    delusionalDisorder: {
      term: 'Delusional Disorder',
      definition: 'Persistent delusions without other psychotic symptoms. Person functions relatively normally except in areas affected by the delusion.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Characterized by persistent delusions without hallucinations or other schizophrenia symptoms',
    'Functional impairment may be limited to areas directly affected by the delusion',
    'Document how delusions impact occupational and social functioning',
  ],
};

// ============================================
// PSYCHOTIC DISORDER NOS CRITERIA (DC 9204)
// ============================================
export const PSYCHOTIC_DISORDER_NOS_CRITERIA = {
  diagnosticCode: '9204',
  condition: 'Psychotic Disorder NOS',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9204',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    nos: {
      term: 'NOS (Not Otherwise Specified)',
      definition: 'Used when psychotic symptoms are present but don\'t meet full criteria for a specific psychotic disorder.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Catch-all diagnosis for psychotic symptoms that don\'t fit other categories',
    'Document all psychotic symptoms and their functional impact',
  ],
};

// ============================================
// BRIEF PSYCHOTIC DISORDER CRITERIA (DC 9205)
// ============================================
export const BRIEF_PSYCHOTIC_DISORDER_CRITERIA = {
  diagnosticCode: '9205',
  condition: 'Brief Psychotic Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9205',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    briefPsychotic: {
      term: 'Brief Psychotic Disorder',
      definition: 'Psychotic symptoms lasting at least 1 day but less than 1 month, with eventual full return to normal functioning.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Duration is key: symptoms last less than 1 month',
    'If symptoms persist beyond 1 month, diagnosis may change to schizophreniform or schizophrenia',
    'Document episode frequency, duration, and recovery between episodes',
    'Multiple episodes may warrant higher ratings',
  ],
};

// ============================================
// BINGE EATING DISORDER CRITERIA (DC 9520)
// ============================================
export const BINGE_EATING_DISORDER_CRITERIA = {
  diagnosticCode: '9520',
  condition: 'Binge Eating Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9520',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    bingeEating: {
      term: 'Binge Eating',
      definition: 'Eating significantly more food than most people would in a similar period, with a sense of lack of control over eating during the episode.',
    },
    lossOfControl: {
      term: 'Loss of Control',
      definition: 'Feeling unable to stop eating or control what or how much one is eating during a binge episode.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Unlike anorexia/bulimia, binge eating disorder typically involves weight GAIN, not loss',
    'NO compensatory behaviors (purging, excessive exercise) - this distinguishes it from bulimia',
    'Frequency matters: episodes typically occur at least once weekly for 3 months',
    'Document obesity-related health complications (diabetes, hypertension, sleep apnea)',
    'Marked distress about binge eating is a key diagnostic criterion',
  ],
};

// ============================================
// DISSOCIATIVE IDENTITY DISORDER CRITERIA (DC 9416)
// ============================================
export const DISSOCIATIVE_IDENTITY_DISORDER_CRITERIA = {
  diagnosticCode: '9416',
  condition: 'Dissociative Identity Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9416',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    dissociativeIdentity: {
      term: 'Dissociative Identity Disorder (DID)',
      definition: 'Formerly Multiple Personality Disorder. Characterized by two or more distinct personality states with gaps in recall of everyday events, personal information, and/or traumatic events.',
    },
    identitySwitching: {
      term: 'Identity Switching',
      definition: 'Transition from one personality state to another, often accompanied by changes in behavior, voice, mannerisms, and memory.',
    },
    dissociativeAmnesia: {
      term: 'Dissociative Amnesia',
      definition: 'Inability to recall important autobiographical information, usually of a traumatic or stressful nature, inconsistent with ordinary forgetting.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Often co-occurs with PTSD due to trauma history',
    'Document identity switching episodes, amnesia periods, and impact on functioning',
    'Memory gaps for time periods and important events are key evidence',
    'Track number of identities and their characteristics if disclosed in therapy',
  ],
};

// ============================================
// DISSOCIATIVE AMNESIA CRITERIA (DC 9417)
// ============================================
export const DISSOCIATIVE_AMNESIA_CRITERIA = {
  diagnosticCode: '9417',
  condition: 'Dissociative Amnesia',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9417',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    dissociativeAmnesia: {
      term: 'Dissociative Amnesia',
      definition: 'Inability to recall important autobiographical information, usually traumatic or stressful, that is inconsistent with ordinary forgetting.',
    },
    fugueState: {
      term: 'Dissociative Fugue',
      definition: 'A subtype of dissociative amnesia involving sudden, unexpected travel away from home with inability to recall one\'s past and confusion about identity.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Memory loss is for specific events, time periods, or autobiographical information',
    'Not due to substance use, medical condition, or normal forgetting',
    'Fugue states (if present) are particularly impairing - document thoroughly',
    'Document time periods of amnesia and any recovery of memories',
  ],
};

// ============================================
// ACUTE STRESS DISORDER CRITERIA (DC 9413)
// ============================================
export const ACUTE_STRESS_DISORDER_CRITERIA = {
  diagnosticCode: '9413',
  condition: 'Acute Stress Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9413',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    acuteStress: {
      term: 'Acute Stress Disorder',
      definition: 'Similar to PTSD but occurs within 3 days to 1 month after trauma exposure. If symptoms persist beyond 1 month, diagnosis typically changes to PTSD.',
    },
    dissociativeSymptoms: {
      term: 'Dissociative Symptoms in ASD',
      definition: 'Altered sense of reality, detachment, numbing, reduced awareness of surroundings, derealization, or depersonalization that occurs after trauma.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Timing is critical: occurs 3 days to 1 month after trauma',
    'If symptoms persist beyond 1 month, diagnosis becomes PTSD',
    'Document the traumatic stressor, onset of symptoms, and timeline',
    'Dissociative symptoms are prominent in acute stress disorder',
  ],
};

// ============================================
// ANTISOCIAL PERSONALITY DISORDER CRITERIA (DC 9301)
// ============================================
export const ANTISOCIAL_PERSONALITY_DISORDER_CRITERIA = {
  diagnosticCode: '9301',
  condition: 'Antisocial Personality Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9301',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    antisocialPersonality: {
      term: 'Antisocial Personality Disorder',
      definition: 'Pattern of disregard for and violation of the rights of others, occurring since age 15. Characterized by deceitfulness, impulsivity, irritability, lack of remorse.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Document pattern of interpersonal conflicts and legal issues',
    'Employment history often shows frequent job changes or terminations',
    'Track treatment compliance - often poor in antisocial personality',
    'Focus documentation on occupational and social impairment',
  ],
};

// ============================================
// BORDERLINE PERSONALITY DISORDER CRITERIA (DC 9301)
// ============================================
export const BORDERLINE_PERSONALITY_DISORDER_CRITERIA = {
  diagnosticCode: '9301',
  condition: 'Borderline Personality Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9301',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    borderlinePersonality: {
      term: 'Borderline Personality Disorder',
      definition: 'Pattern of instability in interpersonal relationships, self-image, and emotions. Marked impulsivity, fear of abandonment, identity disturbance, and self-harm.',
    },
    fearOfAbandonment: {
      term: 'Fear of Abandonment',
      definition: 'Frantic efforts to avoid real or imagined abandonment, leading to impulsive actions or relationship instability.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Self-harm and suicidal behavior are common - document all incidents',
    'Hospitalization for safety is often necessary - track frequency',
    'Unstable relationships and fear of abandonment cause significant impairment',
    'Document identity disturbance and emotional instability',
    'Dialectical Behavior Therapy (DBT) is evidence-based treatment',
  ],
};

// ============================================
// NARCISSISTIC PERSONALITY DISORDER CRITERIA (DC 9301)
// ============================================
export const NARCISSISTIC_PERSONALITY_DISORDER_CRITERIA = {
  diagnosticCode: '9301',
  condition: 'Narcissistic Personality Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9301',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    narcissisticPersonality: {
      term: 'Narcissistic Personality Disorder',
      definition: 'Pattern of grandiosity, need for admiration, and lack of empathy. Characterized by sense of entitlement, exploitative interpersonal relationships.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Document interpersonal conflicts and relationship failures',
    'Employment issues often stem from conflicts with authority or peers',
    'Lack of empathy causes significant social impairment',
    'Treatment compliance is often poor',
  ],
};

// ============================================
// AVOIDANT PERSONALITY DISORDER CRITERIA (DC 9301)
// ============================================
export const AVOIDANT_PERSONALITY_DISORDER_CRITERIA = {
  diagnosticCode: '9301',
  condition: 'Avoidant Personality Disorder',
  cfrReference: '38 CFR 4.130, Diagnostic Code 9301',
  usesSharedCriteria: true,
  sharedCriteria: MENTAL_HEALTH_SHARED_CRITERIA,
  ratings: MENTAL_HEALTH_SHARED_CRITERIA.ratings,
  definitions: {
    ...MENTAL_HEALTH_SHARED_CRITERIA.definitions,
    avoidantPersonality: {
      term: 'Avoidant Personality Disorder',
      definition: 'Pattern of social inhibition, feelings of inadequacy, and hypersensitivity to negative evaluation. Avoids social situations due to fear of criticism or rejection.',
    },
  },
  importantNotes: [
    ...MENTAL_HEALTH_SHARED_CRITERIA.importantNotes,
    'Social avoidance causes significant occupational impairment',
    'May avoid job promotions or opportunities due to fear of increased social demands',
    'Relationship difficulties due to fear of rejection',
    'Document missed opportunities and social avoidance patterns',
  ],
};

// ============================================
// PHASE 9: CARDIOVASCULAR CONDITIONS
// ============================================

// DC 7020: Cardiomyopathy
export const CARDIOMYOPATHY_CRITERIA = {
  diagnosticCode: '7020',
  condition: 'Cardiomyopathy',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7020',

  note: 'Cardiomyopathy is rated under the General Rating Formula for Diseases of the Heart. Rating is based on METs (metabolic equivalents) at which symptoms develop, or on documented cardiac hypertrophy/dilatation.',

  ratings: [
    {
      percent: 100,
      summary: 'Workload <=3.0 METs causes heart failure symptoms',
      criteriaDescription: [
        'Workload of 3.0 METs or less results in heart failure symptoms',
        'Heart failure symptoms include: breathlessness, fatigue, angina, dizziness, syncope, palpitations',
        'Severely limited - symptoms with minimal activity (eating, dressing, walking slowly)',
      ],
      evidenceNeeded: [
        'Exercise stress test showing symptoms at <=3.0 METs',
        'OR medical estimate with specific activity examples',
        'Echocardiogram or equivalent showing cardiac impairment',
        'Symptom logs documenting limitations',
      ],
    },
    {
      percent: 60,
      summary: 'Workload 3.1-5.0 METs causes heart failure symptoms',
      criteriaDescription: [
        'Workload of 3.1 to 5.0 METs results in heart failure symptoms',
        'Moderate limitation - symptoms with light housework, walking 2-3 mph',
      ],
      evidenceNeeded: [
        'Exercise stress test or medical estimate',
        'Documentation of symptoms at specified activity level',
        'Echocardiogram showing cardiac changes',
      ],
    },
    {
      percent: 30,
      summary: 'Workload 5.1-7.0 METs causes symptoms OR cardiac hypertrophy/dilatation',
      criteriaDescription: [
        'Workload of 5.1 to 7.0 METs results in heart failure symptoms, OR',
        'Evidence of cardiac hypertrophy or dilatation confirmed by echocardiogram or equivalent',
        'Mild-moderate limitation - symptoms with climbing stairs, brisk walking',
      ],
      evidenceNeeded: [
        'Exercise stress test or medical estimate',
        'OR echocardiogram/MRI showing hypertrophy or dilatation',
        'Symptom documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Workload 7.1-10.0 METs causes symptoms OR continuous medication required',
      criteriaDescription: [
        'Workload of 7.1 to 10.0 METs results in heart failure symptoms, OR',
        'Continuous medication required for control',
        'Minimal limitation - symptoms only with moderate exertion',
      ],
      evidenceNeeded: [
        'Exercise stress test or medical estimate',
        'Prescription records showing continuous medication',
        'Symptom logs',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic or symptoms only above 10 METs',
      criteriaDescription: [
        'No symptoms at workloads up to 10 METs',
        'OR asymptomatic with normal cardiac function',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    METs: {
      term: 'METs (Metabolic Equivalents)',
      definition: 'One MET is the energy cost of standing quietly at rest (oxygen uptake of 3.5 mL/kg/min). Higher METs indicate greater exertion capacity.',
      examples: [
        '1-3 METs: Eating, dressing, walking slowly around home',
        '3-5 METs: Light housework, walking 2-3 mph',
        '5-7 METs: Climbing one flight of stairs, walking 4 mph',
        '7-10 METs: Heavy housework, moderate cycling',
        '>10 METs: Vigorous exercise, running, competitive sports',
      ],
    },
    heartFailureSymptoms: {
      term: 'Heart Failure Symptoms',
      definition: 'Symptoms that indicate the heart is not pumping effectively.',
      examples: [
        'Breathlessness/dyspnea',
        'Fatigue with exertion',
        'Angina/chest pain',
        'Dizziness',
        'Syncope (fainting)',
        'Palpitations',
        'Arrhythmia',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged cardiomyopathy symptoms and any recorded METs capacity or ejection fraction. Document symptoms at specific activity levels and record any cardiac testing results.',
};

// DC 7010: Supraventricular Tachycardia (SVT)
export const SVT_CRITERIA = {
  diagnosticCode: '7010',
  condition: 'Supraventricular Tachycardia',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7010',

  note: 'SVT includes: atrial fibrillation, atrial flutter, sinus tachycardia, AVNRT, AVRT, atrial tachycardia, junctional tachycardia, and multifocal atrial tachycardia. A treatment intervention is when a symptomatic patient requires IV medication, cardioversion, or ablation.',

  ratings: [
    {
      percent: 30,
      summary: 'ECG-confirmed SVT with 5+ treatment interventions per year',
      criteriaDescription: [
        'Supraventricular tachycardia confirmed by ECG',
        'WITH five or more treatment interventions per year',
        'Treatment interventions: IV pharmacologic adjustment, cardioversion, and/or ablation',
      ],
      evidenceNeeded: [
        'ECG documentation of SVT episodes',
        'Medical records of treatment interventions',
        'Hospital/ER visit records',
        'Procedure records for cardioversion or ablation',
      ],
    },
    {
      percent: 10,
      summary: 'ECG-confirmed SVT with 1-4 interventions/year OR continuous oral meds OR vagal maneuvers',
      criteriaDescription: [
        'Supraventricular tachycardia confirmed by ECG with ONE of:',
        ' 1 to 4 treatment interventions per year',
        ' Continuous use of oral medications to control',
        ' Use of vagal maneuvers to control',
      ],
      evidenceNeeded: [
        'ECG documentation of SVT',
        'Medication records for oral antiarrhythmics',
        'Documentation of vagal maneuver use',
        'Medical records of any interventions',
      ],
    },
    {
      percent: 0,
      summary: 'SVT present but not requiring treatment',
      criteriaDescription: [
        'Documented SVT that does not require medication or interventions',
        'Asymptomatic or self-limiting episodes',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    treatmentIntervention: {
      term: 'Treatment Intervention',
      definition: 'For DC 7010, an intervention is when a symptomatic patient requires IV pharmacologic adjustment, cardioversion, and/or ablation for symptom relief.',
      examples: [
        'IV adenosine administration',
        'IV beta-blocker or calcium channel blocker',
        'Electrical cardioversion',
        'Catheter ablation procedure',
      ],
    },
    vagalManeuver: {
      term: 'Vagal Maneuver',
      definition: 'Physical techniques used to stimulate the vagus nerve to slow heart rate.',
      examples: [
        'Valsalva maneuver (bearing down)',
        'Carotid sinus massage',
        'Cold water face immersion',
        'Coughing',
      ],
    },
  },

  disclaimer: 'This analysis is based on logged SVT episodes and treatments. Document each episode with date, ECG confirmation if available, and any treatment required (IV meds, cardioversion, ablation, vagal maneuvers, or oral medications).',
};

// DC 7011: Ventricular Arrhythmias
export const VENTRICULAR_ARRHYTHMIA_CRITERIA = {
  diagnosticCode: '7011',
  condition: 'Ventricular Arrhythmias (Sustained)',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7011',

  note: 'A 100% rating applies during hospitalization for initial therapy or ventricular aneurysmectomy, or with an AICD in place. After stabilization, rate under the General Rating Formula for Diseases of the Heart.',

  ratings: [
    {
      percent: 100,
      summary: 'Hospitalization for ventricular arrhythmia OR AICD in place',
      criteriaDescription: [
        'For indefinite period from date of hospital admission for initial medical therapy for sustained ventricular arrhythmia, OR',
        'For indefinite period from date of hospital admission for ventricular aneurysmectomy, OR',
        'With an automatic implantable cardioverter-defibrillator (AICD) in place',
      ],
      evidenceNeeded: [
        'Hospital admission records for ventricular arrhythmia',
        'OR AICD implantation records',
        'Cardiology follow-up documentation',
      ],
    },
    {
      percent: 60,
      summary: 'Post-stabilization: 3.1-5.0 METs causes symptoms (General Rating Formula)',
      criteriaDescription: [
        'After stabilization, rate under General Rating Formula',
        'Workload of 3.1 to 5.0 METs results in heart failure symptoms',
      ],
      evidenceNeeded: [
        'Exercise stress test or medical estimate post-stabilization',
        'Symptom documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Post-stabilization: 5.1-7.0 METs causes symptoms OR cardiac hypertrophy/dilatation',
      criteriaDescription: [
        'After stabilization, rate under General Rating Formula',
        'Workload of 5.1 to 7.0 METs results in symptoms, OR',
        'Cardiac hypertrophy or dilatation on echocardiogram',
      ],
      evidenceNeeded: [
        'Post-stabilization cardiac testing',
        'Echocardiogram results',
      ],
    },
    {
      percent: 10,
      summary: 'Post-stabilization: 7.1-10.0 METs causes symptoms OR continuous medication',
      criteriaDescription: [
        'After stabilization, rate under General Rating Formula',
        'Workload of 7.1 to 10.0 METs results in symptoms, OR',
        'Continuous medication required for control',
      ],
      evidenceNeeded: [
        'Medication records',
        'Symptom documentation',
      ],
    },
  ],

  definitions: {
    AICD: {
      term: 'AICD (Automatic Implantable Cardioverter-Defibrillator)',
      definition: 'A device implanted in the chest that monitors heart rhythm and delivers shocks to correct life-threatening arrhythmias.',
      examples: [
        'Also called ICD (Implantable Cardioverter-Defibrillator)',
        'Monitors for ventricular tachycardia/fibrillation',
        'Delivers shock to restore normal rhythm',
      ],
    },
    sustainedVentricularArrhythmia: {
      term: 'Sustained Ventricular Arrhythmia',
      definition: 'Ventricular tachycardia or fibrillation lasting more than 30 seconds or requiring intervention to terminate.',
    },
  },

  disclaimer: 'This analysis is based on logged ventricular arrhythmia events. If you have an AICD, document the implant date. After stabilization, document METs capacity and symptoms for ongoing rating determination.',
};

// DC 7002: Pericarditis
export const PERICARDITIS_CRITERIA = {
  diagnosticCode: '7002',
  condition: 'Pericarditis',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7002',

  note: 'During active infection with cardiac involvement and for 3 months following cessation of therapy, rate at 100%. Thereafter, rate under the General Rating Formula for Diseases of the Heart with diagnosis confirmed by physical exam and echo/Doppler/catheterization.',

  ratings: [
    {
      percent: 100,
      summary: 'Active infection with cardiac involvement (and 3 months post-treatment)',
      criteriaDescription: [
        'During active infection with cardiac involvement',
        'AND for three months following cessation of therapy for the active infection',
        'Requires confirmed pericarditis with ongoing treatment',
      ],
      evidenceNeeded: [
        'Medical diagnosis of active pericarditis',
        'Treatment records showing therapy dates',
        'Echocardiogram or imaging showing pericardial involvement',
      ],
    },
    {
      percent: 60,
      summary: 'Post-active: 3.1-5.0 METs causes symptoms',
      criteriaDescription: [
        'After active infection resolves (more than 3 months post-treatment)',
        'Workload of 3.1 to 5.0 METs results in heart failure symptoms',
        'Diagnosis confirmed by echo, Doppler, or catheterization',
      ],
      evidenceNeeded: [
        'Post-treatment cardiac evaluation',
        'Exercise stress test or medical estimate',
        'Echo/Doppler confirmation',
      ],
    },
    {
      percent: 30,
      summary: 'Post-active: 5.1-7.0 METs causes symptoms OR cardiac hypertrophy/dilatation',
      criteriaDescription: [
        'After active infection resolves',
        'Workload of 5.1 to 7.0 METs results in symptoms, OR',
        'Cardiac hypertrophy or dilatation on echo',
      ],
      evidenceNeeded: [
        'Cardiac testing results',
        'Symptom documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Post-active: 7.1-10.0 METs causes symptoms OR continuous medication',
      criteriaDescription: [
        'After active infection resolves',
        'Workload of 7.1 to 10.0 METs results in symptoms, OR',
        'Continuous medication required for control',
      ],
      evidenceNeeded: [
        'Medication records',
        'Symptom documentation',
      ],
    },
    {
      percent: 0,
      summary: 'Resolved pericarditis with no residual symptoms',
      criteriaDescription: [
        'History of pericarditis, fully resolved',
        'No symptoms at workloads up to 10 METs',
        'No ongoing cardiac impairment',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    pericarditis: {
      term: 'Pericarditis',
      definition: 'Inflammation of the pericardium (the sac surrounding the heart). Can be acute, recurrent, or constrictive.',
      symptoms: [
        'Sharp chest pain (worse with breathing or lying down)',
        'Pain relieved by sitting up and leaning forward',
        'Pericardial friction rub on exam',
        'Fever',
        'Shortness of breath',
      ],
    },
    pericardialEffusion: {
      term: 'Pericardial Effusion',
      definition: 'Accumulation of fluid in the pericardial sac, which can occur with pericarditis.',
    },
  },

  disclaimer: 'This analysis is based on logged pericarditis symptoms. Document active infection periods, treatment dates, and any residual symptoms. After resolution, track symptoms at various activity levels.',
};

// DC 7121: Post-Phlebitic Syndrome
export const POST_PHLEBITIC_CRITERIA = {
  diagnosticCode: '7121',
  condition: 'Post-Phlebitic Syndrome',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7121',

  note: 'Post-phlebitic syndrome results from deep vein thrombosis (DVT) and causes chronic venous insufficiency. Rate each extremity separately and combine using the bilateral factor if applicable.',

  ratings: [
    {
      percent: 100,
      summary: 'Massive board-like edema with constant pain at rest',
      criteriaDescription: [
        'Massive board-like edema',
        'WITH constant pain at rest',
        'Findings attributed to venous disease',
      ],
      evidenceNeeded: [
        'Medical documentation of severe edema',
        'Pain logs showing constant rest pain',
        'Photos of affected extremity',
        'History of DVT',
      ],
    },
    {
      percent: 60,
      summary: 'Persistent edema, stasis pigmentation/eczema, AND persistent ulceration',
      criteriaDescription: [
        'Persistent edema or subcutaneous induration',
        'Stasis pigmentation or eczema',
        'AND persistent ulceration',
        'All findings attributed to venous disease',
      ],
      evidenceNeeded: [
        'Medical documentation of all three findings',
        'Photos of skin changes and ulcers',
        'Wound care records',
      ],
    },
    {
      percent: 40,
      summary: 'Persistent edema AND stasis pigmentation/eczema, with/without intermittent ulceration',
      criteriaDescription: [
        'Persistent edema',
        'AND stasis pigmentation or eczema',
        'With or without intermittent ulceration',
      ],
      evidenceNeeded: [
        'Medical documentation of edema and skin changes',
        'Photos showing pigmentation',
        'Ulcer history if applicable',
      ],
    },
    {
      percent: 20,
      summary: 'Persistent edema incompletely relieved by elevation, with/without beginning stasis pigmentation',
      criteriaDescription: [
        'Persistent edema incompletely relieved by elevation of extremity',
        'With or without beginning stasis pigmentation or eczema',
      ],
      evidenceNeeded: [
        'Documentation of persistent swelling',
        'Notes on response to elevation',
      ],
    },
    {
      percent: 10,
      summary: 'Intermittent edema OR aching/fatigue after standing/walking, relieved by elevation/compression',
      criteriaDescription: [
        'Intermittent edema of extremity, OR',
        'Aching and fatigue in leg after prolonged standing or walking',
        'Symptoms relieved by elevation of extremity or compression hosiery',
      ],
      evidenceNeeded: [
        'Symptom logs',
        'Notes on what provides relief',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic post-DVT',
      criteriaDescription: [
        'History of DVT but no current symptoms',
        'No edema, pigmentation changes, or ulceration',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    postPhlebiticSyndrome: {
      term: 'Post-Phlebitic Syndrome',
      definition: 'Chronic venous insufficiency that develops after deep vein thrombosis (DVT). Also called post-thrombotic syndrome.',
      causes: [
        'Prior deep vein thrombosis (DVT)',
        'Damage to venous valves',
        'Chronic venous hypertension',
      ],
    },
    stasisPigmentation: {
      term: 'Stasis Pigmentation',
      definition: 'Brownish discoloration of skin from chronic poor circulation and hemosiderin deposition.',
    },
    venousUlcer: {
      term: 'Venous Ulcer',
      definition: 'Open wound caused by venous insufficiency, typically occurring above the ankle.',
    },
  },

  bilateralNote: 'Rate each extremity separately and combine using the bilateral factor (38 CFR 4.26) if both legs are affected.',

  disclaimer: 'This analysis is based on logged post-phlebitic syndrome symptoms. Document symptoms for each affected leg separately. Key factors are edema persistence, skin changes, and ulceration.',
};


// ============================================
// PHASE 2A: CORONARY ARTERY DISEASE (DC 7005)
// ============================================

export const CAD_CRITERIA = {
  diagnosticCode: '7005',
  condition: 'Coronary Artery Disease (Arteriosclerotic Heart Disease)',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7005',

  note: 'CAD is rated under the General Rating Formula for Diseases of the Heart based on METs capacity at which cardiac symptoms develop. Includes conditions such as angina pectoris, atherosclerotic heart disease, and ischemic heart disease.',

  ratings: [
    {
      percent: 100,
      summary: 'Documented CHF OR workload <=3.0 METs causes symptoms',
      criteriaDescription: [
        'Chronic congestive heart failure (CHF) documented, OR',
        'Workload of 3.0 METs or less results in dyspnea, fatigue, angina, dizziness, or syncope',
        'Severely limited - symptoms with minimal activity (eating, dressing, walking slowly)',
      ],
      evidenceNeeded: [
        'Medical diagnosis of CHF with treatment records',
        'OR exercise stress test showing symptoms at <=3.0 METs',
        'OR medical estimate with specific activity limitations',
        'Ejection fraction if available',
        'Symptom logs documenting severe limitations',
      ],
    },
    {
      percent: 60,
      summary: 'More than one MI OR workload 3.1-5.0 METs causes symptoms',
      criteriaDescription: [
        'More than one documented myocardial infarction, OR',
        'Workload of 3.1 to 5.0 METs results in cardiac symptoms',
        'Moderate limitation - symptoms with light housework, walking 2-3 mph',
      ],
      evidenceNeeded: [
        'Medical records documenting multiple MIs',
        'OR exercise stress test results',
        'Cardiac catheterization or imaging results',
        'Symptom documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Workload 5.1-7.0 METs causes symptoms OR cardiac hypertrophy/dilatation',
      criteriaDescription: [
        'Workload of 5.1 to 7.0 METs results in cardiac symptoms, OR',
        'Evidence of cardiac hypertrophy or dilatation on echo/imaging',
        'Mild-moderate limitation - symptoms climbing stairs, brisk walking',
      ],
      evidenceNeeded: [
        'Exercise stress test or medical estimate',
        'OR echocardiogram showing hypertrophy/dilatation',
        'Coronary angiography if available',
      ],
    },
    {
      percent: 10,
      summary: 'Workload 7.1-10.0 METs causes symptoms OR continuous medication required',
      criteriaDescription: [
        'Workload of 7.1 to 10.0 METs results in cardiac symptoms, OR',
        'Continuous medication required for control (beta blockers, statins, nitrates, etc.)',
        'Mild limitation - symptoms only with moderate to heavy exertion',
      ],
      evidenceNeeded: [
        'Exercise stress test or medical estimate',
        'Prescription records showing continuous cardiac medications',
        'Symptom logs at various activity levels',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic or symptoms only above 10 METs',
      criteriaDescription: [
        'CAD diagnosis but no symptoms at workloads up to 10 METs',
        'Normal exercise capacity despite coronary disease',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    METs: {
      term: 'METs (Metabolic Equivalents)',
      definition: 'One MET is the energy cost of standing quietly at rest. Higher METs indicate greater exertion capacity.',
      examples: [
        '1-3 METs: Eating, dressing, walking slowly around home',
        '3-5 METs: Light housework, walking 2-3 mph',
        '5-7 METs: Climbing one flight of stairs, walking 4 mph',
        '7-10 METs: Heavy housework, moderate cycling',
        '>10 METs: Vigorous exercise, running, competitive sports',
      ],
    },
    angina: {
      term: 'Angina Pectoris',
      definition: 'Chest pain or discomfort caused by reduced blood flow to the heart muscle.',
      types: [
        'Stable angina: Predictable, triggered by exertion, relieved by rest or nitroglycerin',
        'Unstable angina: Unpredictable, may occur at rest, requires urgent evaluation',
      ],
    },
    CHF: {
      term: 'Congestive Heart Failure',
      definition: 'Condition where the heart cannot pump blood efficiently, causing fluid backup in lungs and tissues.',
      symptoms: ['Shortness of breath', 'Fatigue', 'Swelling in legs/ankles', 'Persistent cough'],
    },
  },

  disclaimer: 'This analysis is based on logged CAD symptoms and any recorded METs capacity. Document angina episodes, activity limitations, and medication use. METs testing provides the most accurate rating determination.',
};

// ============================================
// PHASE 2A: MYOCARDIAL INFARCTION (DC 7006)
// ============================================

export const POST_MI_CRITERIA = {
  diagnosticCode: '7006',
  condition: 'Myocardial Infarction (Heart Attack)',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7006',

  note: 'During and for 3 months following a myocardial infarction documented by laboratory tests, the rating is 100%. Thereafter, rate under the General Rating Formula for Diseases of the Heart based on METs capacity.',

  ratings: [
    {
      percent: 100,
      summary: 'During MI and for 3 months following',
      criteriaDescription: [
        'During the acute myocardial infarction period',
        'AND for three months following the MI documented by lab tests',
        'This rating is automatic during recovery period',
      ],
      evidenceNeeded: [
        'Medical records confirming MI (troponin levels, EKG changes)',
        'Hospital admission records',
        'Discharge summary with MI diagnosis',
        'Date of MI for calculating 3-month period',
      ],
    },
    {
      percent: 60,
      summary: 'Post-recovery: More than one MI OR 3.1-5.0 METs causes symptoms',
      criteriaDescription: [
        'After 3-month recovery period:',
        'History of more than one documented MI, OR',
        'Workload of 3.1 to 5.0 METs results in cardiac symptoms',
      ],
      evidenceNeeded: [
        'Records of multiple MI events',
        'OR exercise stress test results',
        'Post-MI cardiac evaluation',
      ],
    },
    {
      percent: 30,
      summary: 'Post-recovery: 5.1-7.0 METs causes symptoms OR cardiac hypertrophy/dilatation',
      criteriaDescription: [
        'After 3-month recovery period:',
        'Workload of 5.1 to 7.0 METs results in symptoms, OR',
        'Cardiac hypertrophy or dilatation on echocardiogram',
      ],
      evidenceNeeded: [
        'Post-MI stress test',
        'Echocardiogram results',
        'Symptom documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Post-recovery: 7.1-10.0 METs causes symptoms OR continuous medication',
      criteriaDescription: [
        'After 3-month recovery period:',
        'Workload of 7.1 to 10.0 METs results in symptoms, OR',
        'Continuous medication required (aspirin, beta blockers, statins, ACE inhibitors)',
      ],
      evidenceNeeded: [
        'Post-MI medication list',
        'Exercise tolerance documentation',
        'Follow-up cardiac evaluations',
      ],
    },
    {
      percent: 0,
      summary: 'Post-recovery: Asymptomatic with no limitations',
      criteriaDescription: [
        'History of MI, fully recovered',
        'No symptoms at workloads up to 10 METs',
        'Normal cardiac function restored',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    myocardialInfarction: {
      term: 'Myocardial Infarction (MI)',
      definition: 'Death of heart muscle tissue due to blocked blood flow, commonly called a heart attack.',
      labMarkers: [
        'Elevated troponin levels',
        'EKG changes (ST elevation, Q waves)',
        'Imaging showing wall motion abnormalities',
      ],
    },
    recoveryPeriod: {
      term: '3-Month Recovery Period',
      definition: 'The VA provides an automatic 100% rating during the MI and for 3 months following to allow for cardiac rehabilitation and recovery.',
    },
  },

  disclaimer: 'This analysis is based on logged post-MI symptoms. Document the date of your MI, any subsequent cardiac events, and current activity limitations. Keep records of cardiac rehabilitation participation.',
};

// ============================================
// PHASE 2A: HYPERTENSIVE HEART DISEASE (DC 7007)
// ============================================

export const HYPERTENSIVE_HEART_CRITERIA = {
  diagnosticCode: '7007',
  condition: 'Hypertensive Heart Disease',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7007',

  note: 'Hypertensive heart disease requires documented hypertension with cardiac involvement. Rate under the General Rating Formula for Diseases of the Heart. Hypertension alone is rated under DC 7101.',

  ratings: [
    {
      percent: 100,
      summary: 'Documented CHF OR workload <=3.0 METs causes symptoms',
      criteriaDescription: [
        'Chronic congestive heart failure documented, OR',
        'Workload of 3.0 METs or less results in dyspnea, fatigue, angina, dizziness, or syncope',
        'Hypertension must be documented as cause of cardiac impairment',
      ],
      evidenceNeeded: [
        'Diagnosis of CHF secondary to hypertension',
        'History of documented hypertension',
        'Exercise stress test or medical estimate',
        'Echocardiogram showing cardiac changes',
      ],
    },
    {
      percent: 60,
      summary: 'Workload 3.1-5.0 METs causes symptoms',
      criteriaDescription: [
        'Workload of 3.1 to 5.0 METs results in cardiac symptoms',
        'With documented hypertension as underlying cause',
        'Symptoms include dyspnea, fatigue, angina, dizziness',
      ],
      evidenceNeeded: [
        'Blood pressure records showing hypertension',
        'Exercise stress test results',
        'Documentation linking cardiac symptoms to hypertension',
      ],
    },
    {
      percent: 30,
      summary: 'Workload 5.1-7.0 METs causes symptoms OR cardiac hypertrophy/dilatation',
      criteriaDescription: [
        'Workload of 5.1 to 7.0 METs results in symptoms, OR',
        'Left ventricular hypertrophy (LVH) on echocardiogram, OR',
        'Cardiac dilatation documented',
        'With underlying hypertension',
      ],
      evidenceNeeded: [
        'Echocardiogram showing LVH or dilatation',
        'Blood pressure history',
        'Exercise tolerance documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Workload 7.1-10.0 METs causes symptoms OR continuous medication required',
      criteriaDescription: [
        'Workload of 7.1 to 10.0 METs results in symptoms, OR',
        'Continuous medication required for blood pressure AND cardiac control',
        'Minimal cardiac limitation with controlled hypertension',
      ],
      evidenceNeeded: [
        'Medication records',
        'Blood pressure logs',
        'Symptom documentation',
      ],
    },
    {
      percent: 0,
      summary: 'Hypertension without cardiac involvement',
      criteriaDescription: [
        'Hypertension present but no cardiac symptoms or structural changes',
        'Should be rated under DC 7101 (Hypertension) instead',
      ],
      evidenceNeeded: [],
    },
  ],

  definitions: {
    hypertensiveHeartDisease: {
      term: 'Hypertensive Heart Disease',
      definition: 'Heart conditions caused by chronically elevated blood pressure, including left ventricular hypertrophy and heart failure.',
      manifestations: [
        'Left ventricular hypertrophy (LVH)',
        'Diastolic dysfunction',
        'Heart failure with preserved or reduced ejection fraction',
        'Coronary artery disease',
      ],
    },
    LVH: {
      term: 'Left Ventricular Hypertrophy (LVH)',
      definition: 'Thickening of the heart\'s main pumping chamber wall, often caused by chronic high blood pressure.',
    },
  },

  disclaimer: 'This analysis is based on logged hypertensive heart disease symptoms. Document both your blood pressure readings AND cardiac symptoms. The key distinction is having cardiac involvement beyond hypertension alone.',
};


// ============================================
// PHASE 2B: COLD INJURY RESIDUALS (DC 7122)
// ============================================

export const COLD_INJURY_CRITERIA = {
  diagnosticCode: '7122',
  condition: 'Cold Injury Residuals (Frostbite)',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7122',

  note: 'Cold injury residuals are rated per affected body part (hand, foot, ear, nose). Each part is rated separately and combined. Amputations, peripheral neuropathy, and Raynaud\'s phenomenon are rated separately unless used to support DC 7122 rating.',

  ratings: [
    {
      percent: 30,
      summary: 'Pain/numbness/cold sensitivity PLUS two or more additional findings',
      criteriaDescription: [
        'Arthralgia or other pain, numbness, or cold sensitivity, PLUS',
        'Two or more of the following:',
        '- Tissue loss',
        '- Nail abnormalities',
        '- Color changes',
        '- Locally impaired sensation',
        '- Hyperhidrosis (excessive sweating)',
        '- X-ray abnormalities (osteoporosis, subarticular punched out lesions, or osteoarthritis)',
      ],
      evidenceNeeded: [
        'Documentation of pain, numbness, or cold sensitivity',
        'Medical evidence of at least two additional findings',
        'X-rays if bone changes present',
        'Symptom logs with specific body part identification',
      ],
    },
    {
      percent: 20,
      summary: 'Pain/numbness/cold sensitivity PLUS one additional finding',
      criteriaDescription: [
        'Arthralgia or other pain, numbness, or cold sensitivity, PLUS',
        'One of the following:',
        '- Tissue loss',
        '- Nail abnormalities',
        '- Color changes',
        '- Locally impaired sensation',
        '- Hyperhidrosis',
        '- X-ray abnormalities',
      ],
      evidenceNeeded: [
        'Documentation of primary symptoms',
        'Medical evidence of one additional finding',
        'Body part specific symptom logs',
      ],
    },
    {
      percent: 10,
      summary: 'Pain/numbness/cold sensitivity alone',
      criteriaDescription: [
        'Arthralgia or other pain, numbness, or cold sensitivity',
        'Without additional objective findings',
      ],
      evidenceNeeded: [
        'Symptom logs documenting pain, numbness, or cold sensitivity',
        'History of cold injury exposure',
      ],
    },
  ],

  definitions: {
    coldInjury: {
      term: 'Cold Injury',
      definition: 'Tissue damage from exposure to extreme cold, including frostbite and non-freezing cold injury (trench foot). Long-term effects can persist for decades.',
    },
    hyperhidrosis: {
      term: 'Hyperhidrosis',
      definition: 'Excessive sweating in the affected area, a common long-term sequela of cold injury.',
    },
    trophicChanges: {
      term: 'Trophic Changes',
      definition: 'Changes to skin, nails, and soft tissue resulting from impaired circulation and nerve damage.',
    },
  },

  disclaimer: 'Each affected body part (hand, foot, ear, nose) is rated separately and combined. Document which specific body parts are affected. Raynaud\'s syndrome should be rated separately unless used to support this rating.',
};

// ============================================
// PHASE 2B: PERIPHERAL ARTERIAL DISEASE (DC 7114)
// ============================================

export const PAD_CRITERIA = {
  diagnosticCode: '7114',
  condition: 'Peripheral Arterial Disease (Arteriosclerosis Obliterans)',
  cfrReference: '38 CFR 4.104, Diagnostic Code 7114',

  note: 'PAD is rated based on claudication distance, trophic changes, and ankle-brachial index (ABI). Each affected extremity is rated separately and combined with bilateral factor if applicable.',

  ratings: [
    {
      percent: 100,
      summary: 'Ischemic rest pain AND deep ulcers or ABI <=0.4',
      criteriaDescription: [
        'Ischemic limb pain at rest, AND',
        'Either deep ischemic ulcers OR ankle/brachial index (ABI) of 0.4 or less',
      ],
      evidenceNeeded: [
        'Documentation of rest pain (pain without activity)',
        'Wound care records showing ischemic ulcers, OR',
        'ABI measurement of 0.4 or less',
        'Vascular studies (Doppler ultrasound)',
      ],
    },
    {
      percent: 60,
      summary: 'Claudication <25 yards AND persistent coldness or ABI <=0.5',
      criteriaDescription: [
        'Claudication on walking less than 25 yards on level grade at 2 mph, AND',
        'Either persistent coldness of the extremity OR ABI of 0.5 or less',
      ],
      evidenceNeeded: [
        'Documentation of severe claudication distance',
        'Evidence of persistent coldness OR ABI <=0.5',
        'Symptom logs with walking distance documented',
      ],
    },
    {
      percent: 40,
      summary: 'Claudication 25-100 yards AND trophic changes or ABI <=0.7',
      criteriaDescription: [
        'Claudication on walking between 25 and 100 yards on level grade at 2 mph, AND',
        'Either trophic changes (thin skin, absence of hair, dystrophic nails) OR ABI of 0.7 or less',
      ],
      evidenceNeeded: [
        'Documentation of moderate claudication',
        'Photos or medical records of trophic changes, OR',
        'ABI measurement of 0.7 or less',
      ],
    },
    {
      percent: 20,
      summary: 'Claudication >100 yards AND diminished pulses or ABI <=0.9',
      criteriaDescription: [
        'Claudication on walking more than 100 yards, AND',
        'Either diminished peripheral pulses OR ABI of 0.9 or less',
      ],
      evidenceNeeded: [
        'Documentation of claudication symptoms',
        'Physical exam showing diminished pulses, OR',
        'ABI of 0.9 or less',
      ],
    },
  ],

  definitions: {
    claudication: {
      term: 'Intermittent Claudication',
      definition: 'Cramping leg pain that occurs with walking and is relieved by rest. Caused by inadequate blood flow to muscles.',
    },
    ABI: {
      term: 'Ankle-Brachial Index (ABI)',
      definition: 'Ratio of blood pressure at ankle divided by blood pressure at arm. Normal is 1.0 or greater. Lower values indicate arterial disease.',
      ranges: [
        'Normal: >=1.0',
        'Mild PAD: 0.9-0.99 (20% rating threshold)',
        'Moderate PAD: 0.7-0.89 (40% rating threshold)',
        'Moderate-Severe PAD: 0.5-0.69 (60% rating threshold)',
        'Severe PAD: <=0.4 (100% rating threshold)',
      ],
    },
    trophicChanges: {
      term: 'Trophic Changes',
      definition: 'Skin and tissue changes from poor blood flow including thin/shiny skin, hair loss on legs/feet, and thickened/dystrophic nails.',
    },
  },

  disclaimer: 'Each affected extremity is rated separately and combined. Document ABI measurements when available, as they provide objective evidence. Claudication distance should be documented consistently.',
};

// ============================================
// PHASE 10: CIRRHOSIS (DC 7312)
// ============================================

export const CIRRHOSIS_CRITERIA = {
  diagnosticCode: '7312',
  condition: 'Cirrhosis of the Liver',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7312',

  note: 'Cirrhosis is rated based on MELD score when available, or on symptomatology. Biochemical studies, imaging, or biopsy must confirm liver dysfunction.',

  ratings: [
    {
      percent: 100,
      summary: 'MELD >=15 OR daily debilitating symptoms with major complication',
      criteriaDescription: [
        'Liver disease with MELD score >=15, OR',
        'Continuous daily debilitating symptoms with generalized weakness AND at least one of:',
        '- Ascites (fluid in abdomen)',
        '- History of spontaneous bacterial peritonitis',
        '- Hepatic encephalopathy',
        '- Variceal hemorrhage',
        '- Coagulopathy',
        '- Portal gastropathy',
        '- Hepatopulmonary or hepatorenal syndrome',
      ],
      evidenceNeeded: [
        'MELD score calculation from lab values',
        'Documentation of major complications',
        'Hospitalization records',
        'Daily symptom logs',
      ],
    },
    {
      percent: 60,
      summary: 'MELD 12-14 OR daily fatigue with variceal bleed/encephalopathy in past year',
      criteriaDescription: [
        'Liver disease with MELD score 12-14, OR',
        'Daily fatigue AND at least one episode in past year of:',
        '- Variceal hemorrhage, OR',
        '- Portal gastropathy or hepatic encephalopathy',
      ],
      evidenceNeeded: [
        'MELD score documentation',
        'Episode documentation with dates',
        'Hospital/ER records',
      ],
    },
    {
      percent: 30,
      summary: 'MELD 10-11 OR portal hypertension signs with symptoms',
      criteriaDescription: [
        'Liver disease with MELD score 10-11, OR',
        'Signs of portal hypertension (splenomegaly or ascites) AND either:',
        '- Weakness, anorexia, abdominal pain, or malaise',
      ],
      evidenceNeeded: [
        'MELD score or imaging showing portal hypertension',
        'Symptom logs documenting weakness/anorexia/pain/malaise',
      ],
    },
    {
      percent: 10,
      summary: 'MELD 7-9 OR symptoms (anorexia, weakness, pain, malaise)',
      criteriaDescription: [
        'Liver disease with MELD score 7-9, OR',
        'Evidence of anorexia, weakness, abdominal pain, or malaise',
      ],
      evidenceNeeded: [
        'Lab values for MELD calculation',
        'Symptom logs',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic with history of liver disease',
      criteriaDescription: [
        'History of liver disease, currently asymptomatic',
        'No active symptoms or complications',
      ],
      evidenceNeeded: [
        'Medical records confirming diagnosis',
      ],
    },
  ],

  definitions: {
    meld: {
      term: 'MELD Score',
      definition: 'Model for End-Stage Liver Disease score. Calculated from bilirubin, INR, creatinine, and sodium. Higher scores indicate more severe liver disease.',
    },
    ascites: {
      term: 'Ascites',
      definition: 'Accumulation of fluid in the abdominal cavity, often causing abdominal swelling and discomfort.',
    },
    hepaticEncephalopathy: {
      term: 'Hepatic Encephalopathy',
      definition: 'Brain dysfunction caused by liver failure. Symptoms include confusion, altered consciousness, personality changes.',
    },
    varicealHemorrhage: {
      term: 'Variceal Hemorrhage',
      definition: 'Bleeding from enlarged veins (varices) in the esophagus or stomach due to portal hypertension.',
    },
  },

  importantNotes: [
    'MELD score is the primary rating factor when available',
    'Without MELD score, rate based on symptomatology per Note (3)',
    'Hepatocellular carcinoma with cirrhosis is rated under DC 7343 instead',
    'Lab confirmation of liver dysfunction required (hyponatremia, thrombocytopenia, coagulopathy)',
  ],

  disclaimer: 'This analysis is based on logged cirrhosis symptoms and any MELD scores recorded. VA rating requires confirmed diagnosis and documented complications. Continue hepatology care and track all symptoms and lab values.',
};

// ============================================
// PHASE 10: GASTRITIS (DC 7307) - Rates as DC 7304
// ============================================

export const GASTRITIS_CRITERIA = {
  diagnosticCode: '7307',
  condition: 'Gastritis, Chronic',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7307',

  note: 'Chronic gastritis is rated as peptic ulcer disease (DC 7304). This includes H. pylori infection, drug-induced gastritis, Zollinger-Ellison syndrome, and portal-hypertensive gastropathy.',

  ratings: [
    {
      percent: 60,
      summary: 'Continuous pain, intermittent vomiting, bleeding with anemia, hospitalization 1+/year',
      criteriaDescription: [
        'Continuous abdominal pain with intermittent vomiting',
        'Recurrent hematemesis (vomiting blood) or melena (tarry stools)',
        'Manifestations of anemia',
        'Requires hospitalization at least once in the past 12 months',
      ],
      evidenceNeeded: [
        'Daily pain logs',
        'Documentation of vomiting episodes',
        'Lab work showing anemia',
        'Hospital admission records',
      ],
    },
    {
      percent: 40,
      summary: 'Episodes lasting 3+ days, 4+ times/year, daily medication',
      criteriaDescription: [
        'Episodes of abdominal pain, nausea, or vomiting that:',
        '- Last for at least three consecutive days',
        '- Occur four or more times in the past 12 months',
        '- Are managed by daily prescribed medication',
      ],
      evidenceNeeded: [
        'Symptom logs showing episode duration and frequency',
        'Prescription records for daily medication (PPIs, H2 blockers)',
      ],
    },
    {
      percent: 20,
      summary: 'Episodes lasting 3+ days, 1-3 times/year, daily medication',
      criteriaDescription: [
        'Episodes of abdominal pain, nausea, or vomiting that:',
        '- Last for at least three consecutive days',
        '- Occur one to three times in the past 12 months',
        '- Are managed by daily prescribed medication',
      ],
      evidenceNeeded: [
        'Symptom logs showing episode duration and frequency',
        'Prescription records for daily medication',
      ],
    },
    {
      percent: 0,
      summary: 'History documented, currently asymptomatic',
      criteriaDescription: [
        'History of gastritis documented by endoscopy or diagnostic imaging',
        'Currently asymptomatic or well-controlled',
      ],
      evidenceNeeded: [
        'Endoscopy or imaging records showing gastritis',
      ],
    },
  ],

  definitions: {
    chronicGastritis: {
      term: 'Chronic Gastritis',
      definition: 'Long-term inflammation of the stomach lining. Can be caused by H. pylori, NSAIDs, alcohol, or autoimmune conditions.',
    },
  },

  importantNotes: [
    'Gastritis is rated using peptic ulcer disease criteria (DC 7304)',
    'Includes H. pylori infection, drug-induced gastritis, Zollinger-Ellison syndrome',
    'Episode duration (3+ consecutive days) is key for compensable rating',
    'Daily medication requirement must be documented',
  ],

  disclaimer: 'This analysis is based on logged gastritis symptoms. VA requires documented diagnosis and pattern of episodes. Track symptom episodes with duration and medication use.',
};

// ============================================
// PHASE 10: CHRONIC PANCREATITIS (DC 7347)
// ============================================

export const PANCREATITIS_CRITERIA = {
  diagnosticCode: '7347',
  condition: 'Pancreatitis, Chronic',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7347',

  note: 'Chronic pancreatitis is rated based on pain episodes, hospitalizations, and maldigestion/malabsorption requiring dietary restriction and enzyme supplementation.',

  ratings: [
    {
      percent: 100,
      summary: 'Daily pain requiring 3+ hospitalizations/year, physician pain management, maldigestion requiring enzymes',
      criteriaDescription: [
        'Daily episodes of abdominal or mid-back pain requiring:',
        '- Three or more hospitalizations per year, AND',
        '- Pain management by a physician, AND',
        '- Maldigestion and malabsorption requiring dietary restriction and pancreatic enzyme supplementation',
      ],
      evidenceNeeded: [
        'Hospital admission records (3+ per year)',
        'Pain management documentation',
        'Prescription for pancreatic enzymes',
        'Dietary restriction documentation',
      ],
    },
    {
      percent: 60,
      summary: '3+ pain episodes/year with 1+ hospitalization for complications or tube feeding',
      criteriaDescription: [
        'Three or more episodes of abdominal or mid-back pain per year, AND',
        'At least one episode per year requiring hospitalization for:',
        '- Complications related to abdominal pain, OR',
        '- Complications of tube enteral feeding',
      ],
      evidenceNeeded: [
        'Pain episode logs (3+ per year)',
        'Hospital admission records',
        'Documentation of complications',
      ],
    },
    {
      percent: 30,
      summary: '1+ episode/year requiring ongoing outpatient treatment for pain or complications',
      criteriaDescription: [
        'At least one episode per year of abdominal or mid-back pain requiring:',
        '- Ongoing outpatient medical treatment for pain, OR',
        '- Treatment for digestive problems, OR',
        '- Management of complications (cyst, pseudocyst, obstruction, ascites)',
      ],
      evidenceNeeded: [
        'Pain episode documentation',
        'Outpatient treatment records',
        'Imaging showing complications if present',
      ],
    },
  ],

  definitions: {
    maldigestion: {
      term: 'Maldigestion',
      definition: 'Impaired breakdown of food in the digestive tract due to pancreatic enzyme deficiency.',
    },
    steatorrhea: {
      term: 'Steatorrhea',
      definition: 'Fatty, foul-smelling stools indicating fat malabsorption from pancreatic insufficiency.',
    },
    pseudocyst: {
      term: 'Pancreatic Pseudocyst',
      definition: 'Fluid collection enclosed by fibrous tissue, often developing after pancreatitis episodes.',
    },
  },

  importantNotes: [
    'Diagnostic studies must confirm that abdominal pain results from pancreatitis',
    'Diabetes from pancreatic insufficiency is rated separately under DC 7913',
    'Hospitalizations are key rating factor for higher percentages',
    'Enzyme supplementation requirement indicates maldigestion',
  ],

  disclaimer: 'This analysis is based on logged pancreatitis symptoms. VA requires confirmed diagnosis with imaging and pattern of pain episodes. Track all hospitalizations, treatments, and enzyme/dietary requirements.',
};

// ============================================
// PHASE 10: CHRONIC BILIARY TRACT DISEASE (DC 7314)
// ============================================

export const BILIARY_TRACT_CRITERIA = {
  diagnosticCode: '7314',
  condition: 'Chronic Biliary Tract Disease',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7314',

  note: 'Chronic biliary tract disease is rated based on frequency of clinically documented attacks. This includes cholangitis, biliary strictures, Sphincter of Oddi dysfunction, bile duct injury, and choledochal cyst.',

  ratings: [
    {
      percent: 30,
      summary: '3+ documented attacks with nausea/vomiting in past 12 months, OR stricture dilation required',
      criteriaDescription: [
        'Three or more clinically documented attacks of right upper quadrant pain with nausea and vomiting during the past 12 months, OR',
        'Requiring dilation of biliary tract strictures at least once during the past 12 months',
      ],
      evidenceNeeded: [
        'Medical documentation of 3+ attacks with symptoms',
        'OR procedure records for stricture dilation',
        'ER/urgent care visit records',
      ],
    },
    {
      percent: 10,
      summary: '1-2 documented attacks with nausea/vomiting in past 12 months',
      criteriaDescription: [
        'One or two clinically documented attacks of right upper quadrant pain with nausea and vomiting in the past 12 months',
      ],
      evidenceNeeded: [
        'Medical documentation of attacks',
        'ER/clinic visit records showing symptoms',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic, no documented attacks in past 12 months',
      criteriaDescription: [
        'Asymptomatic, without history of a clinically documented attack of right upper quadrant pain with nausea and vomiting in the past 12 months',
      ],
      evidenceNeeded: [
        'Medical records confirming diagnosis',
      ],
    },
  ],

  definitions: {
    ruqPain: {
      term: 'Right Upper Quadrant (RUQ) Pain',
      definition: 'Pain in the upper right area of the abdomen, typically associated with gallbladder or biliary tract issues.',
    },
    cholangitis: {
      term: 'Cholangitis',
      definition: 'Infection of the bile ducts, often presenting with fever, jaundice, and abdominal pain (Charcot triad).',
    },
    sphincterOfOddi: {
      term: 'Sphincter of Oddi Dysfunction',
      definition: 'Disorder affecting the valve controlling bile and pancreatic juice flow into the small intestine.',
    },
  },

  importantNotes: [
    'Attacks must be "clinically documented" - self-reported logs support but may need medical visit confirmation',
    'RUQ pain with nausea AND vomiting required for attack to count',
    'Stricture dilation procedure qualifies for 30% even without multiple attacks',
    'Includes cholangitis, strictures, Sphincter of Oddi dysfunction, bile duct injury, choledochal cyst',
  ],

  disclaimer: 'This analysis is based on logged biliary tract symptoms. VA requires clinically documented attacks. Seek medical evaluation during attacks to establish documentation.',
};

// ============================================
// PHASE 5A: HERNIA (DC 7338)
// ============================================

export const HERNIA_CRITERIA = {
  diagnosticCode: '7338',
  condition: 'Hernia',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7338',

  note: 'DC 7338 covers all hernia types including inguinal, femoral, umbilical, ventral, incisional, and other hernias (excluding hiatal). Ratings are based on hernia size, duration, repairability, and pain with specific activities.',

  ratings: [
    {
      percent: 100,
      summary: 'Irreparable hernia >=15cm for 12+ months with pain during 3+ activities',
      criteriaDescription: [
        'Irreparable hernia (new or recurrent) present for 12 months or more',
        'Size equal to 15 cm or greater in one dimension for 12+ months',
        'Pain when performing at least three of: (1) bending over, (2) ADLs, (3) walking, (4) climbing stairs',
      ],
      evidenceNeeded: [
        'Medical documentation of hernia size >=15cm',
        'Documentation hernia is irreparable',
        'Symptom logs showing pain with 3+ activities',
        'Duration of 12+ months documented',
      ],
    },
    {
      percent: 60,
      summary: 'Irreparable hernia >=15cm for 12+ months with pain during 2 activities',
      criteriaDescription: [
        'Irreparable hernia (new or recurrent) present for 12 months or more',
        'Size equal to 15 cm or greater in one dimension for 12+ months',
        'Pain when performing two of: (1) bending over, (2) ADLs, (3) walking, (4) climbing stairs',
      ],
      evidenceNeeded: [
        'Medical documentation of hernia size >=15cm',
        'Documentation hernia is irreparable',
        'Symptom logs showing pain with 2 activities',
        'Duration of 12+ months documented',
      ],
    },
    {
      percent: 30,
      summary: 'Irreparable hernia 3-15cm for 12+ months with pain during 2+ activities',
      criteriaDescription: [
        'Irreparable hernia (new or recurrent) present for 12 months or more',
        'Size equal to 3 cm or greater but less than 15 cm in one dimension for 12+ months',
        'Pain when performing at least two of: (1) bending over, (2) ADLs, (3) walking, (4) climbing stairs',
      ],
      evidenceNeeded: [
        'Medical documentation of hernia size 3-15cm',
        'Documentation hernia is irreparable',
        'Symptom logs showing pain with 2+ activities',
        'Duration of 12+ months documented',
      ],
    },
    {
      percent: 20,
      summary: 'Irreparable hernia 3-15cm for 12+ months with pain during 1 activity',
      criteriaDescription: [
        'Irreparable hernia (new or recurrent) present for 12 months or more',
        'Size equal to 3 cm or greater but less than 15 cm in one dimension for 12+ months',
        'Pain when performing one of: (1) bending over, (2) ADLs, (3) walking, (4) climbing stairs',
      ],
      evidenceNeeded: [
        'Medical documentation of hernia size 3-15cm',
        'Documentation hernia is irreparable',
        'Symptom logs showing pain with 1 activity',
        'Duration of 12+ months documented',
      ],
    },
    {
      percent: 10,
      summary: 'Irreparable hernia <3cm for 12+ months',
      criteriaDescription: [
        'Irreparable hernia (new or recurrent) present for 12 months or more',
        'Hernia size smaller than 3 cm',
      ],
      evidenceNeeded: [
        'Medical documentation of hernia size <3cm',
        'Documentation hernia is irreparable',
        'Duration of 12+ months documented',
      ],
    },
    {
      percent: 0,
      summary: 'Asymptomatic hernia - present and repairable, or repaired',
      criteriaDescription: [
        'Asymptomatic hernia; present and repairable, or already repaired',
      ],
      evidenceNeeded: [
        'Medical documentation of hernia status',
        'Surgical records if repaired',
      ],
    },
  ],

  definitions: {
    irreparableHernia: {
      term: 'Irreparable Hernia',
      definition: 'A hernia that cannot be surgically repaired or has failed previous repair attempts.',
    },
    adls: {
      term: 'Activities of Daily Living (ADLs)',
      definition: 'Basic self-care activities including bathing, dressing, hygiene, and transfers.',
    },
    incarcerated: {
      term: 'Incarcerated Hernia',
      definition: 'A hernia that cannot be pushed back into place (irreducible), with tissue trapped outside the abdominal wall.',
    },
    strangulated: {
      term: 'Strangulated Hernia',
      definition: 'A hernia where blood supply to trapped tissue is cut off - a surgical emergency.',
    },
  },

  importantNotes: [
    'With two compensable inguinal hernias, evaluate the more severe first, then add 10% for the second (unless first is 100%)',
    'Any ADL (bathing, dressing, hygiene, transfers) counts as one activity',
    'Hernia must be present for 12+ months to qualify for compensable rating',
    'Hiatal hernias are rated separately under DC 7346',
  ],

  disclaimer: 'This analysis is based on logged hernia symptoms. VA ratings require medical documentation of hernia size and repairability status.',
};

// ============================================
// PHASE 5A: PERITONEAL ADHESIONS (DC 7301)
// ============================================

export const PERITONEAL_ADHESIONS_CRITERIA = {
  diagnosticCode: '7301',
  condition: 'Peritoneal Adhesions',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7301',

  note: 'Peritoneal adhesions are rated based on severity of obstruction, dietary modification requirements, hospitalization history, and associated symptoms. Adhesions may result from surgery, trauma, inflammatory disease (Crohn\'s, cholecystitis), or infection.',

  ratings: [
    {
      percent: 80,
      summary: 'Persistent partial obstruction - inoperable/refractory or requires TPN',
      criteriaDescription: [
        'Persistent partial bowel obstruction that is either inoperable and refractory to treatment, OR',
        'Requires total parenteral nutrition (TPN) for obstructive symptoms',
      ],
      evidenceNeeded: [
        'Medical documentation of persistent partial obstruction',
        'Documentation obstruction is inoperable or refractory',
        'TPN orders and administration records if applicable',
      ],
    },
    {
      percent: 50,
      summary: 'Symptomatic with hospitalization 1+/year, dietary modification, and GI symptoms',
      criteriaDescription: [
        'Symptomatic peritoneal adhesions persisting/recurring after surgery, trauma, or inflammatory disease',
        'Clinical evidence of recurrent obstruction requiring hospitalization at least once a year',
        'Medically-directed dietary modification (not TPN)',
        'At least one of: abdominal pain, nausea, vomiting, colic, constipation, or diarrhea',
      ],
      evidenceNeeded: [
        'Medical documentation of symptomatic adhesions',
        'Hospitalization records for obstruction (1+/year)',
        'Dietary modification orders from healthcare provider',
        'Symptom logs documenting GI symptoms',
      ],
    },
    {
      percent: 30,
      summary: 'Symptomatic with dietary modification and GI symptoms (no hospitalization required)',
      criteriaDescription: [
        'Symptomatic peritoneal adhesions persisting/recurring after surgery, trauma, or inflammatory disease',
        'Medically-directed dietary modification (not TPN)',
        'At least one of: abdominal pain, nausea, vomiting, colic, constipation, or diarrhea',
      ],
      evidenceNeeded: [
        'Medical documentation of symptomatic adhesions',
        'Dietary modification orders from healthcare provider',
        'Symptom logs documenting GI symptoms',
      ],
    },
    {
      percent: 10,
      summary: 'Symptomatic with GI symptoms only (no dietary modification)',
      criteriaDescription: [
        'Symptomatic peritoneal adhesions persisting/recurring after surgery, trauma, or inflammatory disease',
        'At least one of: abdominal pain, nausea, vomiting, colic, constipation, or diarrhea',
      ],
      evidenceNeeded: [
        'Medical documentation of symptomatic adhesions',
        'Symptom logs documenting GI symptoms',
      ],
    },
    {
      percent: 0,
      summary: 'History of adhesions, currently asymptomatic',
      criteriaDescription: [
        'History of peritoneal adhesions',
        'Currently asymptomatic',
      ],
      evidenceNeeded: [
        'Medical documentation confirming adhesion history',
      ],
    },
  ],

  definitions: {
    peritonealAdhesions: {
      term: 'Peritoneal Adhesions',
      definition: 'Bands of scar tissue that form between abdominal organs and tissues, often after surgery, causing organs to stick together.',
    },
    tpn: {
      term: 'Total Parenteral Nutrition (TPN)',
      definition: 'Intravenous feeding that bypasses the digestive system entirely, delivering nutrients directly into the bloodstream.',
    },
    partialObstruction: {
      term: 'Partial Bowel Obstruction',
      definition: 'Incomplete blockage of the intestine that restricts but does not completely stop the passage of contents.',
    },
    colic: {
      term: 'Colic',
      definition: 'Severe spasmodic abdominal pain caused by intestinal obstruction or spasm.',
    },
  },

  importantNotes: [
    'Adhesions must be "symptomatic" and confirmed by healthcare provider',
    'Can result from surgery, trauma, inflammatory disease (Crohn\'s, cholecystitis), or infection',
    'Dietary modification must be medically-directed (not self-imposed)',
    'Hospitalization requirement is "at least once a year" for 50% rating',
    'TPN requirement or inoperable status needed for 80% rating',
  ],

  disclaimer: 'This analysis is based on logged adhesion symptoms. VA ratings require medical documentation of adhesions and their cause.',
};


// ============================================
// PHASE 5B: ESOPHAGEAL STRICTURE (DC 7203)
// ============================================

export const ESOPHAGEAL_STRICTURE_CRITERIA = {
  diagnosticCode: '7203',
  condition: 'Esophageal Stricture',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7203',

  note: 'Esophageal stricture is rated based on severity of dysphagia, dilatation requirements, aspiration risk, and nutritional impact. Also used for rating DC 7204 (Esophageal Spasm/Motility Disorders).',

  ratings: [
    {
      percent: 80,
      summary: 'Refractory stricture with aspiration, undernutrition, and PEG tube',
      criteriaDescription: [
        'Recurrent or refractory stricture with aspiration',
        'Undernutrition requiring PEG tube',
      ],
      evidenceNeeded: [
        'Medical documentation of refractory stricture (cannot achieve target after 5+ dilatations)',
        'Documentation of aspiration events',
        'Nutritional assessment showing undernutrition',
        'PEG tube placement records',
      ],
    },
    {
      percent: 50,
      summary: 'Refractory stricture with dysphagia, aspiration, and undernutrition OR >=3 dilatations/year',
      criteriaDescription: [
        'Recurrent or refractory stricture with dysphagia, aspiration, and undernutrition, OR',
        'Requiring dilatation three or more times per 12-month period',
      ],
      evidenceNeeded: [
        'Medical documentation of stricture characteristics',
        'Documentation of aspiration and undernutrition, OR',
        'Procedure records showing 3+ dilatations per year',
      ],
    },
    {
      percent: 30,
      summary: 'Recurrent stricture with dysphagia requiring <=2 dilatations/year',
      criteriaDescription: [
        'Recurrent stricture with dysphagia',
        'Requiring dilatation two or fewer times per 12-month period',
      ],
      evidenceNeeded: [
        'Medical documentation of recurrent stricture',
        'Swallowing study or endoscopy findings',
        'Procedure records showing dilatation frequency',
      ],
    },
    {
      percent: 10,
      summary: 'Dysphagia controlled with daily medication',
      criteriaDescription: [
        'Dysphagia controlled by daily medication',
      ],
      evidenceNeeded: [
        'Medical documentation of dysphagia diagnosis',
        'Medication records showing daily treatment',
      ],
    },
    {
      percent: 0,
      summary: 'History of esophageal stricture, asymptomatic',
      criteriaDescription: [
        'History of esophageal stricture',
        'Currently asymptomatic without treatment',
      ],
      evidenceNeeded: [
        'Medical records confirming diagnosis history',
      ],
    },
  ],

  definitions: {
    recurrentStricture: {
      term: 'Recurrent Stricture',
      definition: 'A stricture that cannot maintain a target diameter of greater than 14mm for more than 4 weeks.',
    },
    refractoryStricture: {
      term: 'Refractory Stricture',
      definition: 'A stricture that cannot achieve a target diameter of 14mm after five dilation sessions at two-week intervals.',
    },
    dysphagia: {
      term: 'Dysphagia',
      definition: 'Difficulty swallowing food, liquids, or medications.',
    },
    pegTube: {
      term: 'PEG Tube',
      definition: 'Percutaneous endoscopic gastrostomy - a feeding tube placed through the abdominal wall into the stomach.',
    },
    aspiration: {
      term: 'Aspiration',
      definition: 'Entry of food, liquid, or secretions into the airway and lungs.',
    },
  },

  importantNotes: [
    'DC 7204 (Esophageal Spasm/Motility) is rated using DC 7203 criteria',
    'Includes achalasia, diffuse esophageal spasm, corkscrew esophagus, nutcracker esophagus',
    'Dilatation frequency is key differentiator between 30% and 50% ratings',
    'PEG tube requirement indicates severe nutritional compromise (80%)',
  ],

  disclaimer: 'This analysis is based on logged esophageal symptoms. VA ratings require medical documentation of stricture characteristics and treatment history.',
};

// ============================================
// PHASE 5B: POSTGASTRECTOMY SYNDROME (DC 7308)
// Rated as Chronic Complications of Upper GI Surgery (DC 7303)
// ============================================

export const POSTGASTRECTOMY_CRITERIA = {
  diagnosticCode: '7308',
  condition: 'Postgastrectomy Syndrome',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7308 (rated as DC 7303)',

  note: 'Postgastrectomy syndrome is rated under DC 7303 (Chronic Complications of Upper GI Surgery). Ratings are based on severity of dumping syndrome, nutritional requirements, and symptom frequency.',

  ratings: [
    {
      percent: 80,
      summary: 'Requires TPN or tube feeding for 30+ days during 12-month period',
      criteriaDescription: [
        'Chronic complications requiring total parenteral nutrition (TPN) or tube feeding',
        'Nutritional support required for a period of 30 or more consecutive days during a 12-month period',
      ],
      evidenceNeeded: [
        'TPN or tube feeding orders and administration records',
        'Documentation of 30+ consecutive days of nutritional support',
        'Medical records showing chronic post-surgical complications',
      ],
    },
    {
      percent: 50,
      summary: 'Daily vomiting OR 6+ watery BMs/day OR explosive unpredictable BMs',
      criteriaDescription: [
        'Chronic complications with daily vomiting despite dietary modification, OR',
        'Six or more watery bowel movements per day despite dietary modification, OR',
        'Explosive, unpredictable bowel movements that interfere with daily activities',
      ],
      evidenceNeeded: [
        'Symptom logs documenting daily vomiting frequency',
        'Documentation of watery bowel movement frequency (6+/day)',
        'Records of explosive/unpredictable bowel movements',
        'Evidence of dietary modification attempts',
      ],
    },
    {
      percent: 30,
      summary: 'Post-prandial syncope with sweating OR medication required for dumping',
      criteriaDescription: [
        'Chronic complications with post-prandial syncope associated with sweating, OR',
        'Requires medication for control of dumping syndrome',
      ],
      evidenceNeeded: [
        'Documentation of syncope/lightheadedness after meals',
        'Records of associated sweating episodes',
        'Medication records for dumping syndrome treatment',
      ],
    },
    {
      percent: 10,
      summary: 'Chronic symptoms controlled with dietary modification only',
      criteriaDescription: [
        'Chronic complications controlled by dietary modification alone',
        'No medication required for symptom control',
      ],
      evidenceNeeded: [
        'Documentation of chronic post-surgical symptoms',
        'Dietary modification plan from healthcare provider',
        'Symptom logs showing control with diet',
      ],
    },
    {
      percent: 0,
      summary: 'History of gastrectomy, asymptomatic',
      criteriaDescription: [
        'History of gastrectomy or gastric surgery',
        'Currently asymptomatic',
      ],
      evidenceNeeded: [
        'Surgical records confirming procedure',
      ],
    },
  ],

  definitions: {
    dumpingSyndrome: {
      term: 'Dumping Syndrome',
      definition: 'Rapid gastric emptying causing symptoms either early (within 30 minutes - cramping, diarrhea, sweating) or late (1-3 hours - hypoglycemia symptoms).',
    },
    postPrandialSyncope: {
      term: 'Post-Prandial Syncope',
      definition: 'Fainting or near-fainting that occurs after eating, often due to rapid blood sugar changes.',
    },
    tpn: {
      term: 'Total Parenteral Nutrition (TPN)',
      definition: 'Intravenous feeding that bypasses the digestive system entirely.',
    },
    tubFeeding: {
      term: 'Tube Feeding',
      definition: 'Enteral nutrition delivered via nasogastric, gastrostomy, or jejunostomy tube.',
    },
  },

  importantNotes: [
    'DC 7308 is rated under DC 7303 (Chronic Complications of Upper GI Surgery)',
    'Early dumping: symptoms within 30 min (cramping, diarrhea, sweating, dizziness)',
    'Late dumping: symptoms 1-3 hours after eating (weakness, sweating, shakiness)',
    'Dietary modification must be medically-directed and documented',
    '30 consecutive days of TPN/tube feeding required for 80% rating',
  ],

  disclaimer: 'This analysis is based on logged postgastrectomy symptoms. VA ratings require medical documentation of surgery and chronic complications.',
};

// ============================================
// PHASE 5B: INTESTINAL FISTULA (DC 7330)
// ============================================

export const INTESTINAL_FISTULA_CRITERIA = {
  diagnosticCode: '7330',
  condition: 'Intestinal Fistula',
  cfrReference: '38 CFR 4.114, Diagnostic Code 7330',

  note: 'Intestinal fistula (external) is rated based on nutritional requirements, discharge amount, and BMI impact. Ratings consider TPN needs, drainage volume, and duration.',

  ratings: [
    {
      percent: 100,
      summary: 'Requires TPN for fistula-related symptoms',
      criteriaDescription: [
        'Intestinal fistula requiring total parenteral nutrition (TPN) for fistula-related symptoms',
      ],
      evidenceNeeded: [
        'Medical documentation of intestinal fistula',
        'TPN orders and administration records',
        'Documentation linking TPN to fistula symptoms',
      ],
    },
    {
      percent: 60,
      summary: 'Requires enteral nutrition OR heavy drainage (3+ bags/10+ pads daily) with low BMI',
      criteriaDescription: [
        'Requires enteral nutrition for fistula-related symptoms, OR',
        'Discharge filling 3+ ostomy bags (130cc sized) OR 10+ pads per day with BMI <16, OR',
        'Discharge filling 3+ ostomy bags OR 10+ pads per day with drainage 3+ months',
      ],
      evidenceNeeded: [
        'Enteral nutrition orders if applicable',
        'Daily drainage volume documentation',
        'BMI measurements if applicable',
        'Duration of drainage documentation',
      ],
    },
    {
      percent: 30,
      summary: 'Persistent drainage 1-3 months OR moderate drainage with low BMI',
      criteriaDescription: [
        'Discharge filling 3+ ostomy bags OR 10+ pads per day with BMI 16-18, OR',
        'Discharge filling 3+ ostomy bags OR 10+ pads per day with drainage 1-3 months, OR',
        'Discharge filling less than 3 bags OR 10 pads per day with BMI <16',
      ],
      evidenceNeeded: [
        'Daily drainage documentation',
        'BMI measurements',
        'Duration of fistula drainage',
      ],
    },
  ],

  definitions: {
    intestinalFistula: {
      term: 'Intestinal Fistula',
      definition: 'An abnormal connection between the intestine and the skin surface (external fistula) or another organ.',
    },
    enteralNutrition: {
      term: 'Enteral Nutrition',
      definition: 'Nutrition delivered directly to the stomach or intestine via feeding tube.',
    },
    tpn: {
      term: 'Total Parenteral Nutrition (TPN)',
      definition: 'Complete nutrition delivered intravenously, bypassing the digestive system.',
    },
    ostomyBag: {
      term: 'Ostomy Bag',
      definition: 'A pouching system used to collect waste; standard size referenced is 130cc.',
    },
  },

  importantNotes: [
    'TPN requirement for fistula symptoms qualifies for 100% rating',
    'Drainage volume measured by ostomy bags (130cc size) or pad changes',
    'BMI is a key factor in determining rating level',
    'Duration of drainage (1-3 months vs 3+ months) affects rating',
    'Both drainage amount AND either BMI or duration required for 60%/30%',
  ],

  disclaimer: 'This analysis is based on logged fistula symptoms. VA ratings require medical documentation of fistula, drainage measurements, and nutritional status.',
};

// ============================================
// PHASE 6A: ACNE CRITERIA (DC 7828)
// ============================================

export const ACNE_CRITERIA = {
  diagnosticCode: '7828',
  condition: 'Acne',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7828',

  note: 'Acne is rated based on depth (superficial vs deep) and extent of involvement. Deep acne involves inflamed nodules and pus-filled cysts. Alternatively may be rated as disfigurement (DC 7800) or scars (DC 7801-7805) if that provides a higher rating.',

  ratings: [
    {
      percent: 30,
      summary: 'Deep acne affecting 40% or more of face and neck',
      criteriaDescription: [
        'Deep acne (deep inflamed nodules and pus-filled cysts)',
        'Affecting 40 percent or more of the face and neck',
      ],
      evidenceNeeded: [
        'Medical documentation of deep acne with nodules/cysts',
        'Documentation that 40%+ of face and neck is affected',
        'Photographs during active breakouts',
        'Dermatology treatment records',
      ],
    },
    {
      percent: 10,
      summary: 'Deep acne affecting less than 40% of face/neck, OR deep acne on body',
      criteriaDescription: [
        'Deep acne (deep inflamed nodules and pus-filled cysts) affecting less than 40% of the face and neck, OR',
        'Deep acne affecting areas other than the face and neck',
      ],
      evidenceNeeded: [
        'Medical documentation of deep acne',
        'Documentation of affected areas',
        'Photographs of lesions',
        'Treatment records',
      ],
    },
    {
      percent: 0,
      summary: 'Superficial acne of any extent',
      criteriaDescription: [
        'Superficial acne (comedones, papules, pustules) of any extent',
        'No deep nodules or pus-filled cysts',
      ],
      evidenceNeeded: [
        'Documentation of acne type',
        'Note: Consider rating as scars if significant scarring present',
      ],
    },
  ],

  definitions: {
    deepAcne: {
      term: 'Deep Acne',
      definition: 'Acne characterized by deep inflamed nodules and pus-filled cysts that extend into deeper skin layers.',
    },
    superficialAcne: {
      term: 'Superficial Acne',
      definition: 'Acne limited to the outer skin layers, including comedones (blackheads/whiteheads), papules, and pustules.',
    },
    comedones: {
      term: 'Comedones',
      definition: 'Non-inflamed clogged pores; blackheads (open) or whiteheads (closed).',
    },
    nodules: {
      term: 'Nodules',
      definition: 'Large, solid, painful lesions lodged deep within the skin.',
    },
    cysts: {
      term: 'Cysts',
      definition: 'Deep, pus-filled lesions that can cause scarring.',
    },
  },

  importantNotes: [
    'Deep acne involves nodules and cysts, not just surface-level breakouts',
    '40% threshold applies specifically to face and neck for highest rating',
    'Body acne (non-face/neck) with deep lesions rates at 10%',
    'Alternative rating as disfigurement or scars may be higher',
    'Document treatment history including topical and systemic medications',
  ],

  disclaimer: 'This analysis is based on logged acne symptoms. VA ratings require medical documentation of acne type, severity, and extent of involvement.',
};

// ============================================
// PHASE 6A: CHLORACNE CRITERIA (DC 7829)
// ============================================

export const CHLORACNE_CRITERIA = {
  diagnosticCode: '7829',
  condition: 'Chloracne',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7829',

  note: 'Chloracne is an Agent Orange presumptive condition. Rating criteria are similar to acne but include additional consideration for intertriginous areas. Must manifest within one year of last herbicide exposure for presumptive service connection.',

  ratings: [
    {
      percent: 30,
      summary: 'Deep chloracne affecting 40% or more of face and neck',
      criteriaDescription: [
        'Deep acne (deep inflamed nodules and pus-filled cysts)',
        'Affecting 40 percent or more of the face and neck',
      ],
      evidenceNeeded: [
        'Documentation of herbicide/dioxin exposure',
        'Medical documentation of deep chloracne',
        'Documentation that 40%+ of face and neck is affected',
        'Evidence of onset within one year of exposure',
      ],
    },
    {
      percent: 20,
      summary: 'Deep chloracne affecting intertriginous areas',
      criteriaDescription: [
        'Deep acne (deep inflamed nodules and pus-filled cysts)',
        'Affecting intertriginous areas: axilla (armpit), anogenital region, skin folds of breasts, or between digits',
      ],
      evidenceNeeded: [
        'Documentation of chloracne in skin fold areas',
        'Medical records identifying intertriginous involvement',
        'Exposure history documentation',
      ],
    },
    {
      percent: 10,
      summary: 'Deep chloracne affecting less than 40% of face/neck OR non-intertriginous body areas',
      criteriaDescription: [
        'Deep acne affecting less than 40% of the face and neck, OR',
        'Deep acne affecting non-intertriginous areas of the body (other than face and neck)',
      ],
      evidenceNeeded: [
        'Documentation of deep chloracne',
        'Documentation of affected areas',
        'Exposure history',
      ],
    },
    {
      percent: 0,
      summary: 'Superficial chloracne of any extent',
      criteriaDescription: [
        'Superficial acne (comedones, papules, pustules) of any extent',
        'No deep nodules or pus-filled cysts',
      ],
      evidenceNeeded: [
        'Documentation of chloracne type',
        'Note: Consider rating as scars or disfigurement',
      ],
    },
  ],

  definitions: {
    chloracne: {
      term: 'Chloracne',
      definition: 'A skin condition caused by exposure to dioxins, chlorinated compounds, or herbicides (including Agent Orange). Characterized by acne-like lesions.',
    },
    intertriginousAreas: {
      term: 'Intertriginous Areas',
      definition: 'Skin fold areas where skin contacts skin: axilla (armpits), anogenital region, skin folds of breasts, or between fingers/toes.',
    },
    agentOrange: {
      term: 'Agent Orange',
      definition: 'An herbicide used during the Vietnam War containing dioxin. Exposure is presumed for veterans who served in Vietnam, Thailand, or certain other locations.',
    },
    presumptiveCondition: {
      term: 'Presumptive Condition',
      definition: 'A condition that VA presumes is related to military service based on scientific/medical evidence, reducing the burden of proof for service connection.',
    },
  },

  importantNotes: [
    'Chloracne is a VA presumptive condition for Agent Orange exposure',
    'Must appear within one year of last herbicide exposure for presumptive service connection',
    'Intertriginous area involvement (20%) is unique to chloracne, not in regular acne criteria',
    'Document exposure history and onset timing',
    'Alternative rating as disfigurement or scars may provide higher rating',
  ],

  disclaimer: 'This analysis is based on logged chloracne symptoms. Chloracne is an Agent Orange presumptive condition. VA ratings require medical documentation and evidence of herbicide exposure.',
};

// ============================================
// PHASE 6A: ALOPECIA AREATA CRITERIA (DC 7831)
// ============================================

export const ALOPECIA_AREATA_CRITERIA = {
  diagnosticCode: '7831',
  condition: 'Alopecia Areata',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7831',

  note: 'Alopecia areata is rated based on extent of hair loss. Only two rating levels exist: 10% for loss of all body hair, and 0% for hair loss limited to scalp and face.',

  ratings: [
    {
      percent: 10,
      summary: 'Loss of all body hair (alopecia universalis)',
      criteriaDescription: [
        'Loss of all body hair',
        'Also known as alopecia universalis',
        'Includes scalp, face, AND all other body areas',
      ],
      evidenceNeeded: [
        'Medical documentation of alopecia areata diagnosis',
        'Documentation of complete body hair loss',
        'Dermatology records confirming extent',
        'Photographs showing hair loss',
      ],
    },
    {
      percent: 0,
      summary: 'Hair loss limited to scalp and face only',
      criteriaDescription: [
        'Hair loss limited to scalp and face',
        'Body hair still present',
        'Includes alopecia totalis (complete scalp loss)',
      ],
      evidenceNeeded: [
        'Documentation of alopecia areata diagnosis',
        'Note extent of hair loss for records',
        'Consider psychological impact for separate rating',
      ],
    },
  ],

  definitions: {
    alopeciaAreata: {
      term: 'Alopecia Areata',
      definition: 'An autoimmune condition causing patchy hair loss on the scalp, face, or body.',
    },
    alopeciaTotalis: {
      term: 'Alopecia Totalis',
      definition: 'Complete loss of all scalp hair (still rates 0% under DC 7831).',
    },
    alopeciaUniversalis: {
      term: 'Alopecia Universalis',
      definition: 'Complete loss of all body hair including scalp, face, eyebrows, eyelashes, and body hair (rates 10%).',
    },
    exclamationPointHairs: {
      term: 'Exclamation Point Hairs',
      definition: 'Short broken hairs that taper at the base, characteristic of active alopecia areata.',
    },
  },

  importantNotes: [
    'Only 10% rating available, and only for complete body hair loss',
    'Scalp-only or face-only hair loss rates 0%',
    'Alopecia totalis (complete scalp loss) still rates 0% without body hair loss',
    'Consider secondary conditions: depression, anxiety for separate ratings',
    'Scarring alopecia (DC 7830) has different criteria based on scalp percentage',
  ],

  disclaimer: 'This analysis is based on logged alopecia symptoms. VA ratings require medical documentation of hair loss extent and diagnosis.',
};

// ============================================
// PHASE 6A: HYPERHIDROSIS CRITERIA (DC 7832)
// ============================================

export const HYPERHIDROSIS_CRITERIA = {
  diagnosticCode: '7832',
  condition: 'Hyperhidrosis',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7832',

  note: 'Hyperhidrosis is rated based on functional impairment and response to therapy. The key criterion is ability to handle paper or tools. Only two rating levels exist: 30% and 0%.',

  ratings: [
    {
      percent: 30,
      summary: 'Unable to handle paper or tools due to moisture, unresponsive to therapy',
      criteriaDescription: [
        'Unable to handle paper or tools because of moisture',
        'Condition is unresponsive to therapy',
        'Both criteria must be met',
      ],
      evidenceNeeded: [
        'Medical documentation of hyperhidrosis diagnosis',
        'Documentation of functional impairment with paper/tools',
        'Treatment records showing therapy attempts',
        'Documentation that condition persists despite treatment',
        'Occupational impact statements',
      ],
    },
    {
      percent: 0,
      summary: 'Able to handle paper or tools after therapy',
      criteriaDescription: [
        'Hyperhidrosis present but controllable with therapy',
        'Able to handle paper or tools after treatment',
      ],
      evidenceNeeded: [
        'Documentation of diagnosis',
        'Treatment records',
        'Note: Document all functional impacts even if controlled',
      ],
    },
  ],

  definitions: {
    hyperhidrosis: {
      term: 'Hyperhidrosis',
      definition: 'A condition characterized by excessive sweating beyond what is needed for thermoregulation.',
    },
    palmarHyperhidrosis: {
      term: 'Palmar Hyperhidrosis',
      definition: 'Excessive sweating of the palms/hands.',
    },
    plantarHyperhidrosis: {
      term: 'Plantar Hyperhidrosis',
      definition: 'Excessive sweating of the soles/feet.',
    },
    axillaryHyperhidrosis: {
      term: 'Axillary Hyperhidrosis',
      definition: 'Excessive sweating of the underarms.',
    },
    iontophoresis: {
      term: 'Iontophoresis',
      definition: 'Treatment using mild electrical current through water to temporarily block sweat glands.',
    },
    sympathectomy: {
      term: 'Sympathectomy',
      definition: 'Surgical procedure to interrupt nerve signals that trigger sweating.',
    },
  },

  importantNotes: [
    'Key criterion is inability to handle paper or tools due to moisture',
    'Must be unresponsive to therapy for 30% rating',
    'Document all treatments tried and their effectiveness',
    'Occupational impact documentation is valuable',
    'Secondary conditions (skin infections, maceration) may warrant separate ratings',
    'Consider impact on daily activities and employment',
  ],

  disclaimer: 'This analysis is based on logged hyperhidrosis symptoms. VA ratings require medical documentation of diagnosis, treatment history, and functional impairment.',
};

// ============================================
// PHASE 6B: GENERAL RATING FORMULA FOR THE SKIN
// Used by DC 7809, 7813, 7815, 7820 (and others)
// ============================================

export const GENERAL_SKIN_FORMULA_CRITERIA = {
  description: 'General Rating Formula for the Skin - applies to multiple skin conditions',
  cfrReference: '38 CFR 4.118',

  ratings: [
    {
      percent: 60,
      summary: '>40% body/exposed areas OR constant systemic therapy',
      criteriaDescription: [
        'Characteristic lesions involving more than 40% of the entire body, OR',
        'More than 40% of exposed areas affected, OR',
        'Constant or near-constant systemic therapy required over past 12 months',
        '(corticosteroids, phototherapy, retinoids, biologics, PUVA, immunosuppressives)',
      ],
      evidenceNeeded: [
        'Medical documentation of body surface area involvement',
        'Prescription records for systemic medications',
        'Treatment duration documentation',
        'Photographs of affected areas',
      ],
    },
    {
      percent: 30,
      summary: '20-40% body/exposed areas OR systemic therapy >=6 weeks',
      criteriaDescription: [
        'Characteristic lesions involving 20-40% of the entire body, OR',
        '20-40% of exposed areas affected, OR',
        'Systemic therapy required >=6 weeks but not constantly over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of affected body percentage',
        'Treatment records showing systemic therapy duration',
        'Dermatology records',
      ],
    },
    {
      percent: 10,
      summary: '5-20% body/exposed areas OR intermittent systemic therapy <6 weeks',
      criteriaDescription: [
        'Characteristic lesions involving 5-20% of the entire body, OR',
        '5-20% of exposed areas affected, OR',
        'Intermittent systemic therapy <6 weeks over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of affected areas',
        'Treatment records',
      ],
    },
    {
      percent: 0,
      summary: '<5% body/exposed areas with topical therapy only',
      criteriaDescription: [
        'Characteristic lesions involving less than 5% of entire body, OR',
        'Less than 5% of exposed areas affected',
        'No more than topical therapy required over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of condition presence',
        'Note: May qualify for rating under scars or disfigurement',
      ],
    },
  ],

  definitions: {
    exposedAreas: {
      term: 'Exposed Areas',
      definition: 'Areas normally visible: head, face, neck, hands.',
    },
    systemicTherapy: {
      term: 'Systemic Therapy',
      definition: 'Medications affecting the whole body: oral/injectable corticosteroids, immunosuppressives, biologics, retinoids, phototherapy (PUVA, UVB).',
    },
    topicalTherapy: {
      term: 'Topical Therapy',
      definition: 'Medications applied directly to skin: creams, ointments, lotions.',
    },
    constantTherapy: {
      term: 'Constant/Near-Constant Therapy',
      definition: 'Continuous treatment with minimal breaks over 12-month period.',
    },
  },

  importantNotes: [
    'This formula applies to multiple skin DCs: 7806, 7809, 7813-7816, 7820-7822, 7824',
    'Alternative rating as disfigurement (DC 7800) or scars (DC 7801-7805) may be higher',
    'Document both body surface area AND treatment requirements',
    'Exposed areas and total body are rated the same',
  ],
};

// ============================================
// PHASE 6B: DISCOID LUPUS ERYTHEMATOSUS (DC 7809)
// ============================================

export const DISCOID_LUPUS_CRITERIA = {
  diagnosticCode: '7809',
  condition: 'Discoid Lupus Erythematosus',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7809',

  note: 'Discoid lupus is rated under the General Rating Formula for the Skin. Do NOT combine with ratings under DC 6350 (Systemic Lupus Erythematosus).',

  ratings: [
    {
      percent: 60,
      summary: '>40% body/exposed areas OR constant systemic therapy',
      criteriaDescription: [
        'Discoid lesions involving more than 40% of entire body or exposed areas, OR',
        'Constant or near-constant systemic therapy (corticosteroids, antimalarials, immunosuppressives) over past 12 months',
      ],
      evidenceNeeded: [
        'Dermatology documentation of lesion extent',
        'Body surface area assessment',
        'Prescription records for systemic medications',
        'Photographs documenting involvement',
      ],
    },
    {
      percent: 30,
      summary: '20-40% body/exposed areas OR systemic therapy >=6 weeks',
      criteriaDescription: [
        'Discoid lesions involving 20-40% of entire body or exposed areas, OR',
        'Systemic therapy required >=6 weeks but not constantly over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of affected percentage',
        'Treatment duration records',
      ],
    },
    {
      percent: 10,
      summary: '5-20% body/exposed areas OR intermittent systemic therapy',
      criteriaDescription: [
        'Discoid lesions involving 5-20% of entire body or exposed areas, OR',
        'Intermittent systemic therapy <6 weeks over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of lesion locations and extent',
        'Treatment records',
      ],
    },
    {
      percent: 0,
      summary: '<5% body/exposed areas with topical therapy only',
      criteriaDescription: [
        'Discoid lesions involving less than 5% of body or exposed areas',
        'Only topical therapy required',
      ],
      evidenceNeeded: [
        'Documentation of diagnosis',
        'Consider scarring/disfigurement for separate rating',
      ],
    },
  ],

  definitions: {
    discoidLupus: {
      term: 'Discoid Lupus Erythematosus',
      definition: 'A chronic autoimmune skin condition causing coin-shaped (discoid) lesions that can cause scarring and pigment changes.',
    },
    discoidLesions: {
      term: 'Discoid Lesions',
      definition: 'Round or oval, scaly, erythematous plaques that may lead to scarring, hyperpigmentation, or hypopigmentation.',
    },
    photosensitivity: {
      term: 'Photosensitivity',
      definition: 'Abnormal skin reaction to sunlight, common in discoid lupus.',
    },
    follicularPlugging: {
      term: 'Follicular Plugging',
      definition: 'Blockage of hair follicles with keratin, seen in discoid lupus lesions.',
    },
  },

  importantNotes: [
    'Do NOT combine with systemic lupus (DC 6350) ratings',
    'Scarring from healed lesions may warrant separate rating under DC 7800-7805',
    'Hair loss from scalp involvement may be rated under DC 7830 (scarring alopecia)',
    'Document photosensitivity and sun protection requirements',
    'Common treatments: hydroxychloroquine, topical steroids, immunosuppressives',
  ],

  disclaimer: 'This analysis is based on logged discoid lupus symptoms. VA ratings require dermatology documentation and assessment of body surface area involvement.',
};

// ============================================
// PHASE 6B: BULLOUS DISORDERS (DC 7815)
// ============================================

export const BULLOUS_DISORDERS_CRITERIA = {
  diagnosticCode: '7815',
  condition: 'Bullous Disorders',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7815',

  note: 'Includes pemphigus vulgaris, pemphigus foliaceous, bullous pemphigoid, dermatitis herpetiformis, epidermolysis bullosa acquisita, Hailey-Hailey, and porphyria cutanea tarda. Rate mucosal complications separately.',

  ratings: [
    {
      percent: 60,
      summary: '>40% body/exposed areas OR constant systemic therapy',
      criteriaDescription: [
        'Bullous lesions involving more than 40% of entire body or exposed areas, OR',
        'Constant or near-constant systemic therapy (corticosteroids, immunosuppressives, biologics) over past 12 months',
      ],
      evidenceNeeded: [
        'Dermatology documentation with biopsy confirmation',
        'Body surface area assessment',
        'Systemic medication records',
        'Photographs of active disease',
      ],
    },
    {
      percent: 30,
      summary: '20-40% body/exposed areas OR systemic therapy >=6 weeks',
      criteriaDescription: [
        'Bullous lesions involving 20-40% of entire body or exposed areas, OR',
        'Systemic therapy required >=6 weeks but not constantly over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of lesion extent',
        'Treatment records',
      ],
    },
    {
      percent: 10,
      summary: '5-20% body/exposed areas OR intermittent systemic therapy',
      criteriaDescription: [
        'Bullous lesions involving 5-20% of entire body or exposed areas, OR',
        'Intermittent systemic therapy <6 weeks over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of affected areas',
        'Treatment records',
      ],
    },
    {
      percent: 0,
      summary: '<5% body/exposed areas with topical therapy only',
      criteriaDescription: [
        'Bullous lesions involving less than 5% of body or exposed areas',
        'Only topical therapy required',
      ],
      evidenceNeeded: [
        'Documentation of diagnosis',
      ],
    },
  ],

  definitions: {
    bullousDisorders: {
      term: 'Bullous Disorders',
      definition: 'Group of autoimmune conditions causing blistering of skin and/or mucous membranes.',
    },
    pemphigus: {
      term: 'Pemphigus',
      definition: 'Autoimmune blistering where antibodies attack connections between skin cells.',
    },
    bullae: {
      term: 'Bullae',
      definition: 'Large fluid-filled blisters greater than 5mm in diameter.',
    },
    nikolskySign: {
      term: 'Nikolsky Sign',
      definition: 'When slight rubbing causes skin to separate - indicates active pemphigus.',
    },
  },

  importantNotes: [
    'Rate mucosal involvement (ocular, oral, GI, respiratory, GU) SEPARATELY under appropriate DC',
    'Biopsy typically required for definitive diagnosis',
    'These conditions can be life-threatening and require aggressive treatment',
    'Scarring from healed lesions may warrant additional rating',
    'Document infection risks and hospitalizations',
  ],

  disclaimer: 'This analysis is based on logged bullous disorder symptoms. VA ratings require dermatology documentation including biopsy results. Mucosal complications are rated separately.',
};

// ============================================
// PHASE 6B: PRIMARY CUTANEOUS VASCULITIS (DC 7826)
// ============================================

export const CUTANEOUS_VASCULITIS_CRITERIA = {
  diagnosticCode: '7826',
  condition: 'Primary Cutaneous Vasculitis',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7826',

  note: 'Rated by frequency of documented vasculitic episodes and immunosuppressive therapy requirements. Alternative rating as disfigurement or scars may apply.',

  ratings: [
    {
      percent: 60,
      summary: 'Persistent episodes refractory to continuous immunosuppressive therapy',
      criteriaDescription: [
        'Persistent documented vasculitis episodes',
        'Refractory to continuous immunosuppressive therapy',
        'Disease continues despite aggressive treatment',
      ],
      evidenceNeeded: [
        'Medical documentation of persistent vasculitis',
        'Records of continuous immunosuppressive therapy',
        'Documentation of treatment failure/refractory disease',
        'Biopsy results confirming vasculitis',
      ],
    },
    {
      percent: 30,
      summary: '4+ episodes/year requiring intermittent immunosuppressive therapy',
      criteriaDescription: [
        'Recurrent documented vasculitic episodes occurring 4+ times over past 12 months, AND',
        'Requiring intermittent systemic immunosuppressive therapy for control',
      ],
      evidenceNeeded: [
        'Documentation of at least 4 episodes in 12 months',
        'Records of immunosuppressive therapy',
        'Dates and descriptions of each episode',
      ],
    },
    {
      percent: 10,
      summary: '1-3 episodes/year with immunosuppressive OR continuous systemic medication',
      criteriaDescription: [
        '1-3 documented vasculitic episodes over past 12 months requiring intermittent immunosuppressive therapy, OR',
        'No recurrent episodes but requires continuous systemic medication for control',
      ],
      evidenceNeeded: [
        'Documentation of episodes',
        'Medication records',
      ],
    },
  ],

  definitions: {
    cutaneousVasculitis: {
      term: 'Primary Cutaneous Vasculitis',
      definition: 'Inflammation of blood vessels limited to the skin, causing purpura, ulcers, and tissue damage.',
    },
    purpura: {
      term: 'Purpura',
      definition: 'Purple or red discoloration from bleeding under the skin due to vessel inflammation.',
    },
    livedoReticularis: {
      term: 'Livedo Reticularis',
      definition: 'Mottled, net-like purple discoloration of the skin from vascular changes.',
    },
    vasculiticEpisode: {
      term: 'Documented Vasculitic Episode',
      definition: 'A medically documented flare of vasculitis with clinical findings and/or biopsy confirmation.',
    },
  },

  importantNotes: [
    'Episodes must be medically DOCUMENTED for rating purposes',
    'Biopsy confirmation strengthens the claim significantly',
    'Alternative rating as disfigurement (DC 7800) or scars may be higher',
    'Track each episode with dates, symptoms, and treatment',
    'Systemic involvement may warrant additional ratings under other DCs',
  ],

  disclaimer: 'This analysis is based on logged vasculitis symptoms. VA ratings require medical documentation of each vasculitic episode and treatment records.',
};

// ============================================
// PHASE 6B: DERMATOPHYTOSIS (DC 7813)
// ============================================

export const DERMATOPHYTOSIS_CRITERIA = {
  diagnosticCode: '7813',
  condition: 'Dermatophytosis',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7813',

  note: 'Includes ringworm (tinea corporis, capitis, pedis, barbae, cruris), nail fungus (onychomycosis), and tinea versicolor. Rated under General Rating Formula for the Skin.',

  ratings: [
    {
      percent: 60,
      summary: '>40% body/exposed areas OR constant systemic antifungal therapy',
      criteriaDescription: [
        'Fungal infection involving more than 40% of entire body or exposed areas, OR',
        'Constant or near-constant systemic antifungal therapy over past 12 months',
      ],
      evidenceNeeded: [
        'Dermatology documentation of extent',
        'Fungal culture or KOH prep results',
        'Oral antifungal prescription records',
        'Duration of treatment documentation',
      ],
    },
    {
      percent: 30,
      summary: '20-40% body/exposed areas OR systemic therapy >=6 weeks',
      criteriaDescription: [
        'Fungal infection involving 20-40% of entire body or exposed areas, OR',
        'Systemic antifungal therapy >=6 weeks but not constantly over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of affected areas',
        'Treatment records',
      ],
    },
    {
      percent: 10,
      summary: '5-20% body/exposed areas OR intermittent systemic therapy',
      criteriaDescription: [
        'Fungal infection involving 5-20% of entire body or exposed areas, OR',
        'Intermittent systemic antifungal therapy <6 weeks over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of infection locations',
        'Treatment records',
      ],
    },
    {
      percent: 0,
      summary: '<5% body/exposed areas with topical therapy only',
      criteriaDescription: [
        'Fungal infection involving less than 5% of body or exposed areas',
        'Only topical antifungals required',
      ],
      evidenceNeeded: [
        'Documentation of condition',
      ],
    },
  ],

  definitions: {
    dermatophytosis: {
      term: 'Dermatophytosis',
      definition: 'Fungal infections of skin, hair, or nails caused by dermatophyte fungi.',
    },
    tineaCorporis: {
      term: 'Tinea Corporis',
      definition: 'Ringworm of the body - circular, scaly, itchy patches.',
    },
    tineaPedis: {
      term: 'Tinea Pedis',
      definition: 'Athlete\'s foot - fungal infection between toes and on feet.',
    },
    onychomycosis: {
      term: 'Onychomycosis',
      definition: 'Fungal nail infection causing thickening, discoloration, and crumbling.',
    },
    tineaVersicolor: {
      term: 'Tinea Versicolor',
      definition: 'Yeast overgrowth causing discolored patches on skin.',
    },
  },

  importantNotes: [
    'Nail fungus (onychomycosis) often requires prolonged oral antifungal therapy',
    'Recurrent infections should be documented carefully',
    'Systemic therapy includes oral terbinafine, itraconazole, fluconazole, griseofulvin',
    'Military service in humid environments increases risk',
    'Document treatment failures and recurrences',
  ],

  disclaimer: 'This analysis is based on logged dermatophytosis symptoms. VA ratings require documentation of fungal infection extent and treatment requirements.',
};

// ============================================
// PHASE 6B: SKIN INFECTIONS (DC 7820)
// ============================================

export const SKIN_INFECTIONS_CRITERIA = {
  diagnosticCode: '7820',
  condition: 'Skin Infections',
  cfrReference: '38 CFR 4.118, Diagnostic Code 7820',

  note: 'Covers bacterial, fungal, viral, treponemal, and parasitic skin infections not listed elsewhere. Rated under General Rating Formula for the Skin.',

  ratings: [
    {
      percent: 60,
      summary: '>40% body/exposed areas OR constant systemic therapy',
      criteriaDescription: [
        'Skin infection involving more than 40% of entire body or exposed areas, OR',
        'Constant or near-constant systemic therapy (antibiotics, antivirals, etc.) over past 12 months',
      ],
      evidenceNeeded: [
        'Medical documentation of infection extent',
        'Culture results if available',
        'Systemic medication records',
        'Hospitalization records if applicable',
      ],
    },
    {
      percent: 30,
      summary: '20-40% body/exposed areas OR systemic therapy >=6 weeks',
      criteriaDescription: [
        'Skin infection involving 20-40% of entire body or exposed areas, OR',
        'Systemic therapy >=6 weeks but not constantly over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of affected areas',
        'Treatment duration records',
      ],
    },
    {
      percent: 10,
      summary: '5-20% body/exposed areas OR intermittent systemic therapy',
      criteriaDescription: [
        'Skin infection involving 5-20% of entire body or exposed areas, OR',
        'Intermittent systemic therapy <6 weeks over past 12 months',
      ],
      evidenceNeeded: [
        'Documentation of infections',
        'Treatment records',
      ],
    },
    {
      percent: 0,
      summary: '<5% body/exposed areas with topical therapy only',
      criteriaDescription: [
        'Skin infection involving less than 5% of body or exposed areas',
        'Only topical therapy required',
      ],
      evidenceNeeded: [
        'Documentation of condition',
      ],
    },
  ],

  definitions: {
    cellulitis: {
      term: 'Cellulitis',
      definition: 'Bacterial infection of deep skin layers causing redness, swelling, warmth, and pain.',
    },
    abscess: {
      term: 'Abscess',
      definition: 'Localized collection of pus from bacterial infection.',
    },
    folliculitis: {
      term: 'Folliculitis',
      definition: 'Infection of hair follicles causing red bumps or pustules.',
    },
    herpesZoster: {
      term: 'Herpes Zoster (Shingles)',
      definition: 'Reactivation of varicella-zoster virus causing painful blistering rash.',
    },
    impetigo: {
      term: 'Impetigo',
      definition: 'Contagious bacterial skin infection with honey-colored crusted sores.',
    },
  },

  importantNotes: [
    'Recurrent infections (same site or multiple sites) strengthen claims',
    'Document each infection episode with dates and treatment',
    'Post-herpetic neuralgia from shingles may warrant separate neurological rating',
    'MRSA or resistant infections may require prolonged therapy',
    'Consider underlying immune issues if infections are frequent',
  ],

  disclaimer: 'This analysis is based on logged skin infection symptoms. VA ratings require medical documentation of infection type, extent, and treatment requirements.',
};

// ============================================
// PHASE 7A: EYE CONDITIONS CRITERIA
// ============================================

// GENERAL RATING FORMULA FOR DISEASES OF THE EYE
// Used by: DC 6000 (Uveitis), DC 6001 (Keratitis), DC 6002 (Scleritis), DC 6018 (Conjunctivitis)
// Per 38 CFR 4.79
export const GENERAL_EYE_FORMULA_CRITERIA = {
  condition: 'General Rating Formula for Diseases of the Eye',
  diagnosticCode: 'Various (6000-6091)',
  cfrReference: '38 CFR 4.79',
  note: 'Evaluate on the basis of either visual impairment due to the particular condition or on incapacitating episodes, whichever results in a higher evaluation. An incapacitating episode is an eye condition severe enough to require a clinic visit to a provider specifically for treatment purposes.',
  ratings: [
    {
      percent: 60,
      summary: '7+ treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring 7 or more treatment visits for an eye condition during the past 12 months'
      ],
      evidenceNeeded: [
        'Medical records documenting 7+ clinic visits specifically for eye condition treatment',
        'Treatment notes showing active disease requiring intervention',
        'Documentation of treatments received (injections, laser, surgery, systemic medications)'
      ]
    },
    {
      percent: 40,
      summary: '5-6 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 5 but less than 7 treatment visits for an eye condition during the past 12 months'
      ],
      evidenceNeeded: [
        'Medical records documenting 5-6 clinic visits specifically for eye condition treatment',
        'Treatment notes showing active disease requiring intervention',
        'Documentation of treatments received'
      ]
    },
    {
      percent: 20,
      summary: '3-4 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 3 but less than 5 treatment visits for an eye condition during the past 12 months'
      ],
      evidenceNeeded: [
        'Medical records documenting 3-4 clinic visits specifically for eye condition treatment',
        'Treatment notes showing disease activity',
        'Documentation of treatments received'
      ]
    },
    {
      percent: 10,
      summary: '1-2 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 1 but less than 3 treatment visits for an eye condition during the past 12 months'
      ],
      evidenceNeeded: [
        'Medical records documenting 1-2 clinic visits specifically for eye condition treatment',
        'Treatment notes',
        'Documentation of diagnosis and treatment'
      ]
    },
    {
      percent: 0,
      summary: 'No treatment visits required',
      criteriaDescription: [
        'Eye condition not requiring treatment visits in past 12 months',
        'Or inactive condition with no residuals'
      ],
      evidenceNeeded: [
        'Documentation of diagnosis',
        'Evidence condition is controlled or resolved'
      ]
    }
  ],
  definitions: {
    'incapacitating episode': 'An eye condition severe enough to require a clinic visit to a provider specifically for treatment purposes. This is different from routine follow-up or monitoring.',
    'treatment visit': 'A clinic visit specifically for treatment of the eye condition, not routine monitoring. Examples include visits for medication adjustments, injections, laser treatments, or surgical interventions.',
    'systemic immunosuppressants': 'Medications that suppress the immune system throughout the body (e.g., methotrexate, azathioprine, mycophenolate, cyclosporine)',
    'biologic agents': 'Targeted immune therapies such as TNF inhibitors (adalimumab, infliximab) or other biologics (rituximab, tocilizumab)',
    'intravitreal injection': 'Injection of medication directly into the vitreous cavity of the eye',
    'periocular injection': 'Injection of medication around the eye (subconjunctival, sub-Tenon, or orbital)',
    'laser treatment': 'Therapeutic laser procedures including photocoagulation, trabeculoplasty, or other laser interventions',
    'visual impairment': 'If visual impairment results in a higher rating than incapacitating episodes, rate under DC 6061-6091 for visual acuity or visual field loss'
  },
  disclaimer: 'This analysis is for documentation purposes only. The VA makes all final rating determinations. Visual impairment from the eye condition may be rated separately under DC 6061-6091 if it results in a higher evaluation.'
};

// DC 6000: UVEITIS / CHOROIDOPATHY CRITERIA
// Includes: uveitis, iritis, cyclitis, choroiditis
export const UVEITIS_CRITERIA = {
  condition: 'Uveitis / Choroidopathy',
  diagnosticCode: '6000',
  cfrReference: '38 CFR 4.79',
  note: 'Choroidopathy, including uveitis, iritis, cyclitis, or choroiditis. Evaluate on the basis of either visual impairment due to the particular condition or on incapacitating episodes, whichever results in a higher evaluation.',
  ratings: [
    {
      percent: 60,
      summary: '7+ treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring 7 or more treatment visits for uveitis during the past 12 months',
        'Severe or refractory uveitis requiring frequent intervention'
      ],
      evidenceNeeded: [
        'Medical records documenting 7+ clinic visits specifically for uveitis treatment',
        'Documentation of treatments (steroid injections, immunosuppressants, biologics, surgery)',
        'Ophthalmology notes showing disease activity and treatment response'
      ]
    },
    {
      percent: 40,
      summary: '5-6 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 5 but less than 7 treatment visits for uveitis during the past 12 months',
        'Moderate to severe uveitis with frequent flares'
      ],
      evidenceNeeded: [
        'Medical records documenting 5-6 clinic visits specifically for uveitis treatment',
        'Treatment records showing active management',
        'Documentation of uveitis type and location (anterior, intermediate, posterior, panuveitis)'
      ]
    },
    {
      percent: 20,
      summary: '3-4 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 3 but less than 5 treatment visits for uveitis during the past 12 months',
        'Moderate uveitis with periodic flares'
      ],
      evidenceNeeded: [
        'Medical records documenting 3-4 clinic visits specifically for uveitis treatment',
        'Documentation of flares and treatment response',
        'Ophthalmology examination records'
      ]
    },
    {
      percent: 10,
      summary: '1-2 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 1 but less than 3 treatment visits for uveitis during the past 12 months',
        'Mild or well-controlled uveitis with occasional flares'
      ],
      evidenceNeeded: [
        'Medical records documenting 1-2 clinic visits specifically for uveitis treatment',
        'Documentation of diagnosis and treatment',
        'Evidence of disease activity requiring intervention'
      ]
    },
    {
      percent: 0,
      summary: 'No treatment visits required or inactive',
      criteriaDescription: [
        'Uveitis not requiring treatment visits in past 12 months',
        'Or condition in remission without active treatment'
      ],
      evidenceNeeded: [
        'Documentation of uveitis diagnosis',
        'Evidence condition is controlled or in remission'
      ]
    }
  ],
  definitions: {
    'uveitis': 'Inflammation of the uveal tract (iris, ciliary body, and/or choroid). Can be infectious or non-infectious (autoimmune).',
    'anterior uveitis': 'Inflammation of the iris (iritis) and/or ciliary body (cyclitis). Most common form. Causes eye pain, redness, and light sensitivity.',
    'intermediate uveitis': 'Inflammation primarily affecting the vitreous and peripheral retina. Also called pars planitis.',
    'posterior uveitis': 'Inflammation of the choroid (choroiditis) and/or retina. Can cause significant vision loss.',
    'panuveitis': 'Inflammation involving all layers of the uvea - anterior, intermediate, and posterior.',
    'iritis': 'Inflammation of the iris, the colored part of the eye. A type of anterior uveitis.',
    'cyclitis': 'Inflammation of the ciliary body. Often occurs with iritis as iridocyclitis.',
    'choroiditis': 'Inflammation of the choroid, the vascular layer between retina and sclera.',
    'synechiae': 'Adhesions between the iris and lens (posterior synechiae) or cornea (anterior synechiae) that can result from uveitis.',
    'hypopyon': 'Accumulation of white blood cells in the anterior chamber, seen in severe anterior uveitis.',
    'macular edema': 'Swelling of the macula (central retina) that can occur as a complication of uveitis, causing decreased central vision.',
    'incapacitating episode': 'A uveitis flare severe enough to require a clinic visit specifically for treatment purposes.'
  },
  disclaimer: 'This analysis is for documentation purposes only. The VA makes all final rating determinations. Visual impairment from uveitis complications may be rated separately under DC 6061-6091 if it results in a higher evaluation.'
};

// DC 6001: KERATITIS / KERATOPATHY CRITERIA
// Corneal inflammation and disease
export const KERATITIS_CRITERIA = {
  condition: 'Keratitis / Keratopathy',
  diagnosticCode: '6001',
  cfrReference: '38 CFR 4.79',
  note: 'Keratopathy (corneal disease/inflammation). Evaluate on the basis of either visual impairment due to the particular condition or on incapacitating episodes, whichever results in a higher evaluation.',
  ratings: [
    {
      percent: 60,
      summary: '7+ treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring 7 or more treatment visits for keratitis during the past 12 months',
        'Severe or recurrent keratitis requiring frequent intervention'
      ],
      evidenceNeeded: [
        'Medical records documenting 7+ clinic visits specifically for keratitis treatment',
        'Documentation of treatments (antibiotics, antivirals, corneal procedures)',
        'Ophthalmology notes showing disease activity and complications'
      ]
    },
    {
      percent: 40,
      summary: '5-6 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 5 but less than 7 treatment visits for keratitis during the past 12 months',
        'Moderate to severe keratitis with frequent recurrences'
      ],
      evidenceNeeded: [
        'Medical records documenting 5-6 clinic visits specifically for keratitis treatment',
        'Treatment records showing active management',
        'Documentation of keratitis type (bacterial, viral, fungal, etc.)'
      ]
    },
    {
      percent: 20,
      summary: '3-4 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 3 but less than 5 treatment visits for keratitis during the past 12 months',
        'Moderate keratitis with periodic episodes'
      ],
      evidenceNeeded: [
        'Medical records documenting 3-4 clinic visits specifically for keratitis treatment',
        'Documentation of episodes and treatment response',
        'Ophthalmology examination records'
      ]
    },
    {
      percent: 10,
      summary: '1-2 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 1 but less than 3 treatment visits for keratitis during the past 12 months',
        'Mild or occasional keratitis episodes'
      ],
      evidenceNeeded: [
        'Medical records documenting 1-2 clinic visits specifically for keratitis treatment',
        'Documentation of diagnosis and treatment',
        'Evidence of disease activity requiring intervention'
      ]
    },
    {
      percent: 0,
      summary: 'No treatment visits required or resolved',
      criteriaDescription: [
        'Keratitis not requiring treatment visits in past 12 months',
        'Or condition resolved without active disease'
      ],
      evidenceNeeded: [
        'Documentation of keratitis diagnosis',
        'Evidence condition is controlled or resolved'
      ]
    }
  ],
  definitions: {
    'keratitis': 'Inflammation of the cornea, the clear front surface of the eye. Can be infectious or non-infectious.',
    'keratopathy': 'Any disease or abnormality of the cornea.',
    'bacterial keratitis': 'Corneal infection caused by bacteria. Often associated with contact lens wear. Requires aggressive antibiotic treatment.',
    'viral keratitis': 'Corneal infection caused by viruses, most commonly herpes simplex virus (HSV) or varicella-zoster virus (VZV/shingles).',
    'herpes simplex keratitis': 'HSV infection of the cornea. Can cause recurrent episodes and corneal scarring. Treated with antivirals.',
    'herpes zoster ophthalmicus': 'Shingles affecting the eye, including the cornea. Can cause severe keratitis and chronic problems.',
    'fungal keratitis': 'Corneal infection caused by fungi. Often occurs after plant/organic material injury. Difficult to treat.',
    'acanthamoeba keratitis': 'Parasitic corneal infection associated with contact lens use and water exposure. Very painful and difficult to treat.',
    'exposure keratopathy': 'Corneal damage due to inadequate eyelid closure (lagophthalmos), causing drying and breakdown of the corneal surface.',
    'neurotrophic keratopathy': 'Corneal disease due to decreased corneal sensation, leading to poor healing and breakdown.',
    'corneal ulcer': 'An open sore on the cornea, usually caused by infection. Can lead to permanent scarring and vision loss.',
    'corneal scarring': 'Permanent opacity of the cornea that can result from keratitis, reducing vision.',
    'corneal perforation': 'A hole through the full thickness of the cornea - a serious complication requiring emergency treatment.',
    'incapacitating episode': 'A keratitis episode severe enough to require a clinic visit specifically for treatment purposes.'
  },
  disclaimer: 'This analysis is for documentation purposes only. The VA makes all final rating determinations. Visual impairment from corneal scarring may be rated separately under DC 6061-6091 if it results in a higher evaluation.'
};

// DC 6018: CHRONIC CONJUNCTIVITIS CRITERIA
// Nontrachomatous chronic conjunctivitis
// Active: General Rating Formula, minimum 10%
// Inactive: Rate based on residuals
export const CHRONIC_CONJUNCTIVITIS_CRITERIA = {
  condition: 'Chronic Conjunctivitis',
  diagnosticCode: '6018',
  cfrReference: '38 CFR 4.79',
  note: 'Chronic conjunctivitis (nontrachomatous). ACTIVE: Evaluate under the General Rating Formula for Diseases of the Eye, minimum rating 10%. INACTIVE: Evaluate based on residuals, such as visual impairment and disfigurement (DC 7800).',
  ratings: [
    {
      percent: 60,
      summary: '7+ treatment visits in past 12 months (Active)',
      criteriaDescription: [
        'ACTIVE conjunctivitis with documented incapacitating episodes requiring 7 or more treatment visits during the past 12 months',
        'Severe chronic conjunctivitis requiring frequent intervention'
      ],
      evidenceNeeded: [
        'Medical records documenting 7+ clinic visits specifically for conjunctivitis treatment',
        'Documentation of active disease status',
        'Treatment records showing ongoing management'
      ]
    },
    {
      percent: 40,
      summary: '5-6 treatment visits in past 12 months (Active)',
      criteriaDescription: [
        'ACTIVE conjunctivitis with documented incapacitating episodes requiring at least 5 but less than 7 treatment visits during the past 12 months',
        'Moderate to severe chronic conjunctivitis'
      ],
      evidenceNeeded: [
        'Medical records documenting 5-6 clinic visits specifically for conjunctivitis treatment',
        'Documentation of active disease',
        'Treatment records'
      ]
    },
    {
      percent: 20,
      summary: '3-4 treatment visits in past 12 months (Active)',
      criteriaDescription: [
        'ACTIVE conjunctivitis with documented incapacitating episodes requiring at least 3 but less than 5 treatment visits during the past 12 months',
        'Moderate chronic conjunctivitis with periodic flares'
      ],
      evidenceNeeded: [
        'Medical records documenting 3-4 clinic visits specifically for conjunctivitis treatment',
        'Documentation of active disease episodes',
        'Ophthalmology examination records'
      ]
    },
    {
      percent: 10,
      summary: '1-2 treatment visits OR active disease (minimum)',
      criteriaDescription: [
        'ACTIVE conjunctivitis with documented incapacitating episodes requiring at least 1 but less than 3 treatment visits during the past 12 months',
        'OR any active chronic conjunctivitis (minimum rating for active disease)',
        'Mild chronic conjunctivitis with occasional symptoms'
      ],
      evidenceNeeded: [
        'Medical records documenting active conjunctivitis',
        'Documentation of chronic nature (symptoms >4 weeks or recurrent)',
        'Treatment records showing ongoing management needed'
      ]
    },
    {
      percent: 0,
      summary: 'Inactive with no residuals',
      criteriaDescription: [
        'INACTIVE conjunctivitis with no visual impairment or disfigurement',
        'Condition resolved without lasting effects'
      ],
      evidenceNeeded: [
        'Documentation of prior conjunctivitis diagnosis',
        'Evidence condition is inactive/resolved',
        'Documentation of no residual visual impairment or disfigurement'
      ]
    }
  ],
  definitions: {
    'chronic conjunctivitis': 'Inflammation of the conjunctiva (the clear membrane covering the white of the eye and inner eyelids) lasting more than 4 weeks or recurring frequently.',
    'active conjunctivitis': 'Conjunctivitis with current symptoms requiring treatment. Rated under the General Rating Formula with minimum 10%.',
    'inactive conjunctivitis': 'Conjunctivitis that has resolved or is in remission. Rated based on residuals only.',
    'allergic conjunctivitis': 'Conjunctivitis triggered by allergens (pollen, dust, pet dander). Causes itching, redness, and tearing.',
    'bacterial conjunctivitis': 'Conjunctivitis caused by bacterial infection. Causes purulent discharge and crusting.',
    'viral conjunctivitis': 'Conjunctivitis caused by viral infection. Highly contagious. Causes watery discharge.',
    'giant papillary conjunctivitis': 'Conjunctivitis associated with contact lens wear. Causes large bumps under the upper eyelid.',
    'atopic keratoconjunctivitis': 'Severe allergic conjunctivitis associated with atopic dermatitis. Can cause corneal damage.',
    'nontrachomatous': 'Conjunctivitis NOT caused by trachoma (Chlamydia trachomatis infection). Trachomatous conjunctivitis is rated under DC 6017.',
    'residuals': 'Lasting effects after the active disease resolves, including scarring, dry eye, or visual impairment.',
    'symblepharon': 'Adhesion between the conjunctiva of the eyelid and the eyeball, a potential complication of severe conjunctivitis.',
    'disfigurement': 'Visible scarring or changes to the eye/eyelids that may be rated under DC 7800.',
    'incapacitating episode': 'A conjunctivitis flare severe enough to require a clinic visit specifically for treatment purposes.'
  },
  disclaimer: 'This analysis is for documentation purposes only. The VA makes all final rating determinations. INACTIVE conjunctivitis is rated based on residuals such as visual impairment (DC 6061-6091) or disfigurement (DC 7800).'
};

// DC 6002: SCLERITIS CRITERIA
// Inflammation of the sclera
export const SCLERITIS_CRITERIA = {
  condition: 'Scleritis',
  diagnosticCode: '6002',
  cfrReference: '38 CFR 4.79',
  note: 'Scleritis (inflammation of the sclera). Evaluate on the basis of either visual impairment due to the particular condition or on incapacitating episodes, whichever results in a higher evaluation. Scleritis is often associated with systemic autoimmune diseases.',
  ratings: [
    {
      percent: 60,
      summary: '7+ treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring 7 or more treatment visits for scleritis during the past 12 months',
        'Severe or refractory scleritis requiring frequent intervention',
        'May include necrotizing scleritis or scleritis with systemic disease'
      ],
      evidenceNeeded: [
        'Medical records documenting 7+ clinic visits specifically for scleritis treatment',
        'Documentation of treatments (systemic steroids, immunosuppressants, biologics)',
        'Ophthalmology and/or rheumatology notes showing disease activity'
      ]
    },
    {
      percent: 40,
      summary: '5-6 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 5 but less than 7 treatment visits for scleritis during the past 12 months',
        'Moderate to severe scleritis with frequent flares'
      ],
      evidenceNeeded: [
        'Medical records documenting 5-6 clinic visits specifically for scleritis treatment',
        'Treatment records showing active management',
        'Documentation of scleritis type (anterior, posterior, necrotizing)'
      ]
    },
    {
      percent: 20,
      summary: '3-4 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 3 but less than 5 treatment visits for scleritis during the past 12 months',
        'Moderate scleritis with periodic flares'
      ],
      evidenceNeeded: [
        'Medical records documenting 3-4 clinic visits specifically for scleritis treatment',
        'Documentation of episodes and treatment response',
        'Ophthalmology examination records'
      ]
    },
    {
      percent: 10,
      summary: '1-2 treatment visits in past 12 months',
      criteriaDescription: [
        'Documented incapacitating episodes requiring at least 1 but less than 3 treatment visits for scleritis during the past 12 months',
        'Mild scleritis or well-controlled with occasional flares'
      ],
      evidenceNeeded: [
        'Medical records documenting 1-2 clinic visits specifically for scleritis treatment',
        'Documentation of diagnosis and treatment',
        'Evidence of disease activity requiring intervention'
      ]
    },
    {
      percent: 0,
      summary: 'No treatment visits required or inactive',
      criteriaDescription: [
        'Scleritis not requiring treatment visits in past 12 months',
        'Or condition in remission without active treatment'
      ],
      evidenceNeeded: [
        'Documentation of scleritis diagnosis',
        'Evidence condition is controlled or in remission'
      ]
    }
  ],
  definitions: {
    'scleritis': 'Inflammation of the sclera, the white outer coat of the eye. Causes severe, deep, boring pain. More serious than episcleritis.',
    'sclera': 'The tough, white outer layer of the eyeball that provides structure and protection.',
    'anterior scleritis': 'Scleritis affecting the front portion of the sclera (visible part). Most common type.',
    'diffuse anterior scleritis': 'Widespread inflammation of the anterior sclera. Most benign form.',
    'nodular anterior scleritis': 'Localized, tender nodule(s) on the sclera.',
    'necrotizing scleritis': 'Most severe form with tissue destruction. High risk of vision loss and perforation. Often associated with systemic disease.',
    'posterior scleritis': 'Inflammation of the back portion of the sclera. Can cause retinal detachment, macular edema, and optic nerve swelling.',
    'scleromalacia perforans': 'Necrotizing scleritis without inflammation, seen in severe rheumatoid arthritis. Risk of perforation.',
    'episcleritis': 'Inflammation of the episclera (layer between conjunctiva and sclera). Less severe than scleritis, usually self-limiting.',
    'autoimmune association': 'Scleritis is often associated with systemic autoimmune diseases including rheumatoid arthritis, granulomatosis with polyangiitis, lupus, and inflammatory bowel disease.',
    'scleral thinning': 'Thinning of the sclera that can result from inflammation, increasing risk of perforation.',
    'incapacitating episode': 'A scleritis episode severe enough to require a clinic visit specifically for treatment purposes.'
  },
  disclaimer: 'This analysis is for documentation purposes only. The VA makes all final rating determinations. Visual impairment from scleritis complications may be rated separately under DC 6061-6091 if it results in a higher evaluation. Associated systemic conditions should be rated separately.'
};


// ============================================
// PHASE 7B: EAR CONDITIONS
// ============================================

export const PERIPHERAL_VESTIBULAR_CRITERIA = {
  diagnosticCode: '6204',
  condition: 'Peripheral Vestibular Disorders',
  cfrReference: '38 CFR 4.87, Diagnostic Code 6204',

  ratings: [
    {
      percent: 30,
      summary: 'Dizziness and occasional staggering',
      criteriaDescription: [
        'Dizziness present',
        'Occasional staggering gait documented',
        'Both symptoms must be present for 30% rating',
        'Objective findings supporting vestibular disequilibrium required',
      ],
    },
    {
      percent: 10,
      summary: 'Occasional dizziness',
      criteriaDescription: [
        'Occasional dizziness documented',
        'No staggering gait',
        'Objective findings supporting vestibular disequilibrium required',
      ],
    },
  ],

  definitions: {
    peripheralVestibular: {
      term: 'Peripheral Vestibular Disorder',
      definition: 'Disorder of the vestibular system (inner ear balance organs or vestibular nerve) causing dizziness and balance problems.',
    },
    vertigo: {
      term: 'Vertigo',
      definition: 'False sensation of spinning or movement. Can be triggered by head position changes or occur spontaneously.',
    },
    dizziness: {
      term: 'Dizziness',
      definition: 'General term for sensations of lightheadedness, unsteadiness, or disorientation.',
    },
    staggering: {
      term: 'Staggering',
      definition: 'Unsteady gait with stumbling or weaving. Key criterion distinguishing 30% from 10% rating.',
    },
    vestibularDisequilibrium: {
      term: 'Vestibular Disequilibrium',
      definition: 'Imbalance caused by vestibular system dysfunction. Must have objective findings for compensable rating.',
    },
    objectiveFindings: {
      term: 'Objective Findings',
      definition: 'Clinical signs documented by healthcare provider (e.g., nystagmus, abnormal vestibular testing, positive Dix-Hallpike). Required for compensable rating.',
    },
    nystagmus: {
      term: 'Nystagmus',
      definition: 'Involuntary, rhythmic eye movements. Common objective finding in vestibular disorders.',
    },
    bppv: {
      term: 'BPPV (Benign Paroxysmal Positional Vertigo)',
      definition: 'Common vestibular disorder causing brief vertigo episodes triggered by head position changes.',
    },
    labyrinthitis: {
      term: 'Labyrinthitis',
      definition: 'Inflammation of the inner ear labyrinth, causing vertigo and hearing changes.',
    },
    vestibularNeuritis: {
      term: 'Vestibular Neuritis',
      definition: 'Inflammation of the vestibular nerve causing sudden severe vertigo without hearing loss.',
    },
  },

  note: 'Objective findings supporting vestibular disequilibrium are REQUIRED for compensable rating. Rate hearing impairment and suppuration separately and combine.',

  disclaimer: 'This analysis is based on logged vestibular symptoms. VA rating requires objective clinical findings documented by a healthcare provider.',
};

export const CHRONIC_SUPPURATIVE_OTITIS_MEDIA_CRITERIA = {
  diagnosticCode: '6200',
  condition: 'Chronic Suppurative Otitis Media',
  cfrReference: '38 CFR 4.87, Diagnostic Code 6200',

  ratings: [
    {
      percent: 10,
      summary: 'During suppuration, or with aural polyps',
      criteriaDescription: [
        'Active suppuration (pus drainage) from ear, OR',
        'Presence of aural polyps',
        'Includes mastoiditis and cholesteatoma',
        'Maximum rating under this code is 10%',
      ],
    },
  ],

  definitions: {
    suppurativeOtitisMedia: {
      term: 'Suppurative Otitis Media',
      definition: 'Middle ear infection with pus formation and drainage, usually through a perforated eardrum.',
    },
    suppuration: {
      term: 'Suppuration',
      definition: 'Formation and discharge of pus. Key criterion for 10% rating.',
    },
    auralPolyp: {
      term: 'Aural Polyp',
      definition: 'Benign growth in the ear canal or middle ear, often from chronic inflammation. Key criterion for 10% rating.',
    },
    cholesteatoma: {
      term: 'Cholesteatoma',
      definition: 'Abnormal skin growth in the middle ear that can erode bone. Requires surgical treatment.',
    },
    mastoiditis: {
      term: 'Mastoiditis',
      definition: 'Infection of the mastoid bone behind the ear, complication of otitis media.',
    },
    tympanicPerforation: {
      term: 'Tympanic Membrane Perforation',
      definition: 'Hole in the eardrum, often from chronic infection or trauma.',
    },
    chronicOtitisMedia: {
      term: 'Chronic Otitis Media',
      definition: 'Middle ear infection lasting more than 3 months or recurring frequently.',
    },
  },

  complications: [
    {
      condition: 'Hearing Impairment',
      note: 'Evaluate separately under DC 6100 and combine',
    },
    {
      condition: 'Labyrinthitis',
      note: 'Evaluate separately and combine',
    },
    {
      condition: 'Tinnitus',
      note: 'Evaluate separately under DC 6260 and combine',
    },
    {
      condition: 'Facial Nerve Paralysis',
      note: 'Evaluate separately under appropriate neurological code',
    },
    {
      condition: 'Bone Loss of Skull',
      note: 'Evaluate separately and combine',
    },
  ],

  note: 'Maximum rating under DC 6200 is 10%. Hearing impairment and complications (labyrinthitis, tinnitus, facial nerve paralysis, bone loss) are rated SEPARATELY and combined.',

  disclaimer: 'This analysis is based on logged otitis media symptoms. VA rating requires ENT examination documenting active suppuration or polyps.',
};

export const CHRONIC_OTITIS_EXTERNA_CRITERIA = {
  diagnosticCode: '6210',
  condition: 'Chronic Otitis Externa',
  cfrReference: '38 CFR 4.87, Diagnostic Code 6210',

  ratings: [
    {
      percent: 10,
      summary: 'Swelling, dry/scaly or serous discharge, and itching requiring frequent and prolonged treatment',
      criteriaDescription: [
        'Swelling of ear canal present, AND',
        'Dry and scaly OR serous discharge present, AND',
        'Itching present, AND',
        'Requires frequent AND prolonged treatment',
        'ALL criteria must be met for 10% rating',
      ],
    },
  ],

  definitions: {
    otitisExterna: {
      term: 'Otitis Externa',
      definition: 'Inflammation of the external ear canal (outer ear infection), also known as swimmer\'s ear.',
    },
    chronicOtitisExterna: {
      term: 'Chronic Otitis Externa',
      definition: 'External ear canal inflammation lasting more than 3 months or recurring frequently.',
    },
    swelling: {
      term: 'Swelling',
      definition: 'Edema or inflammation of the ear canal skin. One of the required symptoms for rating.',
    },
    dryScaly: {
      term: 'Dry and Scaly',
      definition: 'Flaking, scaling skin in the ear canal. One of the discharge/skin criteria.',
    },
    serousDischarge: {
      term: 'Serous Discharge',
      definition: 'Clear, watery drainage from the ear canal. Alternative to dry/scaly for rating.',
    },
    itching: {
      term: 'Itching',
      definition: 'Pruritus of the ear canal. Required symptom for compensable rating.',
    },
    frequentTreatment: {
      term: 'Frequent Treatment',
      definition: 'Treatment needed on a regular, recurring basis.',
    },
    prolongedTreatment: {
      term: 'Prolonged Treatment',
      definition: 'Treatment required for extended periods, not just brief courses.',
    },
    bacterialOtitisExterna: {
      term: 'Bacterial Otitis Externa',
      definition: 'External ear infection caused by bacteria, most commonly Pseudomonas aeruginosa.',
    },
    fungalOtitisExterna: {
      term: 'Fungal Otitis Externa (Otomycosis)',
      definition: 'External ear infection caused by fungi, typically Aspergillus or Candida.',
    },
    eczematousOtitisExterna: {
      term: 'Eczematous Otitis Externa',
      definition: 'External ear inflammation related to eczema or dermatitis.',
    },
  },

  note: 'ALL criteria must be met: swelling + (dry/scaly OR serous discharge) + itching + frequent/prolonged treatment. Maximum rating is 10%.',

  disclaimer: 'This analysis is based on logged otitis externa symptoms. VA rating requires ENT documentation of examination findings and treatment frequency.',
};

export const CHRONIC_NONSUPPURATIVE_OTITIS_MEDIA_CRITERIA = {
  diagnosticCode: '6201',
  condition: 'Chronic Nonsuppurative Otitis Media',
  cfrReference: '38 CFR 4.87, Diagnostic Code 6201',

  ratings: [
    {
      percent: 'Variable',
      summary: 'Rate hearing impairment under DC 6100',
      criteriaDescription: [
        'No specific rating percentage under DC 6201',
        'Rate based on resulting hearing impairment',
        'Use audiometric testing results',
        'Apply DC 6100 hearing loss criteria',
      ],
    },
  ],

  definitions: {
    nonsuppurativeOtitisMedia: {
      term: 'Nonsuppurative Otitis Media',
      definition: 'Middle ear inflammation with fluid accumulation but without pus formation or active infection.',
    },
    serousOtitisMedia: {
      term: 'Serous Otitis Media (Otitis Media with Effusion)',
      definition: 'Fluid in the middle ear without signs of acute infection. Common in adults with eustachian tube dysfunction.',
    },
    middleEarEffusion: {
      term: 'Middle Ear Effusion',
      definition: 'Accumulation of fluid in the middle ear space behind the eardrum.',
    },
    eustachianTubeDysfunction: {
      term: 'Eustachian Tube Dysfunction',
      definition: 'Impaired function of the tube connecting middle ear to throat, leading to pressure/fluid problems.',
    },
    conductiveHearingLoss: {
      term: 'Conductive Hearing Loss',
      definition: 'Hearing loss from impaired sound transmission through outer or middle ear. Common result of effusion.',
    },
    tympanostomyTubes: {
      term: 'Tympanostomy Tubes',
      definition: 'Small tubes placed through eardrum to ventilate middle ear and drain fluid.',
    },
    chronicEffusion: {
      term: 'Chronic Effusion',
      definition: 'Middle ear fluid persisting for more than 3 months.',
    },
  },

  note: 'DC 6201 does not have its own rating percentages. Rate based on hearing impairment under DC 6100 using audiometric testing.',

  disclaimer: 'This analysis tracks nonsuppurative otitis media symptoms. VA rating requires audiometric testing to determine hearing impairment level.',
};

// ============================================
// PHASE 1A: MULTIPLE SCLEROSIS CRITERIA (DC 8018)
// ============================================

export const MULTIPLE_SCLEROSIS_CRITERIA = {
  diagnosticCode: '8018',
  condition: 'Multiple Sclerosis',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8018',

  minimumRating: 30,
  ratingNote: 'MS has a minimum rating of 30%. Higher ratings are based on specific residuals rated under appropriate diagnostic codes.',

  ratings: [
    {
      percent: 30,
      summary: 'Minimum rating - ascertainable residuals present',
      criteria: {
        residualsPresent: true,
        minimumRating: true,
      },
      criteriaDescription: [
        'Minimum rating assigned when ascertainable residuals are present',
        'Residuals may include fatigue, numbness, weakness, cognitive issues, bladder dysfunction, etc.',
        'Higher ratings require evaluation of specific residuals under appropriate DCs',
      ],
      evidenceNeeded: [
        'MS diagnosis confirmed by neurologist',
        'Documentation of current residual symptoms',
        'Symptom logs showing ongoing functional impact',
      ],
    },
  ],

  additionalRatingGuidance: [
    {
      residual: 'Visual Impairment',
      description: 'Optic neuritis or other visual deficits',
      ratingMethod: 'Rate under DC 6066 (visual impairment) based on corrected visual acuity',
    },
    {
      residual: 'Bladder Dysfunction',
      description: 'Neurogenic bladder, incontinence, or voiding dysfunction',
      ratingMethod: 'Rate under DC 7542 (neurogenic bladder) or voiding dysfunction criteria',
    },
    {
      residual: 'Bowel Dysfunction',
      description: 'Constipation, incontinence, or bowel control issues',
      ratingMethod: 'Rate under DC 7332 (sphincter impairment)',
    },
    {
      residual: 'Extremity Weakness/Paralysis',
      description: 'Weakness or paralysis of upper or lower extremities',
      ratingMethod: 'Rate under peripheral nerve codes (DC 8510-8530) based on affected nerve',
    },
    {
      residual: 'Cognitive Impairment',
      description: 'Memory issues, concentration problems, processing speed',
      ratingMethod: 'May be rated under DC 9326 (dementia) if severe, or as part of minimum rating',
    },
    {
      residual: 'Fatigue',
      description: 'MS-related fatigue (lassitude)',
      ratingMethod: 'Considered in minimum rating; may also support CFS rating if criteria met',
    },
    {
      residual: 'Spasticity',
      description: 'Muscle stiffness, spasms, increased tone',
      ratingMethod: 'Rate based on functional limitation of affected extremity',
    },
    {
      residual: 'Tremor/Ataxia',
      description: 'Intention tremor or coordination problems',
      ratingMethod: 'Rate based on functional impairment of affected extremity',
    },
  ],

  definitions: {
    multipleSclerosis: {
      term: 'Multiple Sclerosis',
      definition: 'A chronic autoimmune disease affecting the central nervous system where the immune system attacks the protective myelin sheath covering nerve fibers, causing communication problems between the brain and body.',
      examples: [
        'Relapsing-remitting MS (RRMS) - most common form with flares and remissions',
        'Secondary progressive MS (SPMS) - follows RRMS with gradual worsening',
        'Primary progressive MS (PPMS) - steady progression from onset',
      ],
    },
    relapse: {
      term: 'Relapse/Exacerbation',
      definition: 'A new neurological symptom or worsening of existing symptoms lasting at least 24 hours, not attributed to fever or infection. Also called flare, attack, or exacerbation.',
      examples: [
        'New numbness or weakness lasting more than 24 hours',
        'Vision problems (optic neuritis)',
        'Increased spasticity or walking difficulty',
        'New bladder dysfunction',
      ],
    },
    uhthoffPhenomenon: {
      term: "Uhthoff's Phenomenon",
      definition: 'Temporary worsening of MS symptoms triggered by increased body temperature (heat, exercise, fever). Symptoms resolve when body temperature returns to normal.',
      examples: [
        'Vision blurring after exercise or hot shower',
        'Increased weakness in warm weather',
        'Worsening fatigue with heat exposure',
      ],
    },
    lhermittesSign: {
      term: "Lhermitte's Sign",
      definition: 'An electric shock-like sensation running down the spine and into the limbs when bending the neck forward. Indicates demyelination in the cervical spinal cord.',
      examples: [
        'Electric shock down spine when looking down',
        'Tingling in arms/legs with neck flexion',
        'Brief, reproducible sensation',
      ],
    },
    spasticity: {
      term: 'Spasticity',
      definition: 'Abnormal muscle stiffness and involuntary spasms due to damage to nerve pathways. Common in MS affecting legs more than arms.',
      examples: [
        'Stiff, heavy-feeling legs',
        'Muscle spasms, especially at night',
        'Difficulty with walking due to stiffness',
        'Clonus (rhythmic contractions)',
      ],
    },
  },

  disclaimer: 'MS has a minimum rating of 30% when ascertainable residuals are present. Additional ratings may be assigned for specific residuals (vision, bladder, bowel, extremity weakness, etc.) under their respective diagnostic codes. The combined rating uses VA combined ratings table. This analysis tracks symptoms to document residuals and their functional impact.',
};

// ============================================
// PHASE 1A: PARKINSON\'S DISEASE CRITERIA (DC 8004)
// ============================================

export const PARKINSONS_DISEASE_CRITERIA = {
  diagnosticCode: '8004',
  condition: "Parkinson's Disease",
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8004',

  minimumRating: 30,
  ratingNote: "Parkinson's disease (Paralysis Agitans) has a minimum rating of 30%. Higher ratings based on specific residuals under appropriate diagnostic codes.",

  ratings: [
    {
      percent: 30,
      summary: 'Minimum rating - ascertainable residuals present',
      criteria: {
        residualsPresent: true,
        minimumRating: true,
      },
      criteriaDescription: [
        'Minimum rating assigned when ascertainable residuals are present',
        'Cardinal motor symptoms: tremor, rigidity, bradykinesia, postural instability',
        'Non-motor symptoms also considered: sleep, cognitive, autonomic',
        'Higher ratings require evaluation of specific residuals under appropriate DCs',
      ],
      evidenceNeeded: [
        "Parkinson's disease diagnosis confirmed by neurologist",
        'Documentation of motor symptoms (tremor, rigidity, bradykinesia)',
        'Documentation of non-motor symptoms (sleep, cognitive, autonomic)',
        'Symptom logs showing ongoing functional impact',
        'Medication requirements and response',
      ],
    },
  ],

  additionalRatingGuidance: [
    {
      residual: 'Tremor',
      description: 'Resting tremor affecting daily activities',
      ratingMethod: 'Rate based on functional impairment of affected extremity under peripheral nerve codes',
    },
    {
      residual: 'Rigidity/Bradykinesia',
      description: 'Muscle stiffness and slowness of movement',
      ratingMethod: 'Rate based on limitation of motion and functional impairment',
    },
    {
      residual: 'Gait/Balance Impairment',
      description: 'Shuffling gait, freezing, falls, postural instability',
      ratingMethod: 'Consider under minimum rating; severe cases may warrant separate evaluation',
    },
    {
      residual: 'Speech Impairment',
      description: 'Soft speech (hypophonia), slurred speech',
      ratingMethod: 'May be rated under DC 8210 (vagus nerve) if severe',
    },
    {
      residual: 'Swallowing Difficulty',
      description: 'Dysphagia affecting nutrition',
      ratingMethod: 'Rate under digestive system codes if severe',
    },
    {
      residual: 'Cognitive Impairment',
      description: "Parkinson's dementia or cognitive changes",
      ratingMethod: 'Rate under DC 9326 (dementia) if meeting criteria',
    },
    {
      residual: 'Depression/Anxiety',
      description: 'PD-related mood disorders',
      ratingMethod: 'Rate under mental health codes (DC 9434/9400)',
    },
    {
      residual: 'Sleep Disorders',
      description: 'REM sleep behavior disorder, insomnia',
      ratingMethod: 'Consider under minimum rating or rate separately if meeting sleep disorder criteria',
    },
    {
      residual: 'Bladder Dysfunction',
      description: 'Urinary urgency, frequency, incontinence',
      ratingMethod: 'Rate under voiding dysfunction criteria',
    },
    {
      residual: 'Constipation',
      description: 'Autonomic dysfunction affecting bowel',
      ratingMethod: 'Consider under minimum rating',
    },
  ],

  definitions: {
    parkinsonsDisease: {
      term: "Parkinson's Disease",
      definition: 'A progressive neurodegenerative disorder caused by loss of dopamine-producing neurons in the brain. Characterized by motor symptoms (tremor, rigidity, bradykinesia, postural instability) and non-motor symptoms.',
      examples: [
        'Idiopathic PD - most common, cause unknown',
        'Early-onset PD - diagnosed before age 50',
        'Parkinsonism - similar symptoms from other causes',
      ],
    },
    restingTremor: {
      term: 'Resting Tremor',
      definition: 'Involuntary shaking that occurs when muscles are relaxed, characteristic of PD. Often starts on one side, typically in hand ("pill-rolling" tremor). Decreases with intentional movement.',
      examples: [
        'Hand tremor at rest, stops when reaching for object',
        'Jaw or lip tremor',
        'Leg tremor when sitting',
      ],
    },
    bradykinesia: {
      term: 'Bradykinesia',
      definition: 'Slowness of movement and difficulty initiating movement. A cardinal feature of PD affecting daily activities.',
      examples: [
        'Slow to start walking',
        'Decreased arm swing when walking',
        'Difficulty with fine motor tasks (buttons, writing)',
        'Reduced facial expression (masked face)',
      ],
    },
    rigidity: {
      term: 'Rigidity',
      definition: 'Muscle stiffness throughout the range of motion (different from spasticity). Can be "cogwheel" (ratchety) or "lead-pipe" (smooth resistance).',
      examples: [
        'Stiff muscles in arms, legs, trunk',
        'Difficulty turning in bed',
        'Reduced arm swing',
        'Stooped posture',
      ],
    },
    freezingOfGait: {
      term: 'Freezing of Gait',
      definition: 'Sudden, brief inability to move feet forward despite intention to walk. Feet feel "glued to floor." Common trigger of falls.',
      examples: [
        'Freezing when starting to walk',
        'Freezing in doorways or narrow spaces',
        'Freezing when turning',
        'Freezing when approaching destination',
      ],
    },
    offEpisodes: {
      term: 'OFF Episodes',
      definition: 'Periods when PD medication wears off before next dose, causing return of symptoms. More common as disease progresses.',
      examples: [
        'Predictable wearing off before next dose',
        'Sudden unexpected OFF periods',
        'Morning akinesia before first dose',
      ],
    },
    dyskinesia: {
      term: 'Dyskinesia',
      definition: 'Involuntary, uncontrolled movements often caused by long-term levodopa use. Different from tremor - more flowing/writhing.',
      examples: [
        'Choreiform movements (dance-like)',
        'Dystonia (sustained muscle contractions)',
        'Peak-dose dyskinesia',
        'Diphasic dyskinesia (beginning/end of dose)',
      ],
    },
  },

  disclaimer: "Parkinson's disease has a minimum rating of 30% when ascertainable residuals are present. Additional ratings may be assigned for specific residuals under their respective diagnostic codes and combined using VA combined ratings table. This analysis tracks both motor and non-motor symptoms to document disease progression and functional impact.",
};

// ============================================
// PHASE 1A: MYASTHENIA GRAVIS CRITERIA (DC 8025)
// ============================================

export const MYASTHENIA_GRAVIS_CRITERIA = {
  diagnosticCode: '8025',
  condition: 'Myasthenia Gravis',
  cfrReference: '38 CFR 4.124a, Diagnostic Code 8025',

  minimumRating: 30,
  ratingNote: 'Myasthenia Gravis has a minimum rating of 30%. Higher ratings based on specific muscle group involvement and functional impairment.',

  ratings: [
    {
      percent: 30,
      summary: 'Minimum rating - ascertainable residuals present',
      criteria: {
        residualsPresent: true,
        minimumRating: true,
      },
      criteriaDescription: [
        'Minimum rating assigned when ascertainable residuals are present',
        'May include ocular symptoms (ptosis, diplopia) or generalized weakness',
        'Symptoms characteristically worsen with activity and improve with rest',
        'Higher ratings for severe involvement of specific muscle groups',
      ],
      evidenceNeeded: [
        'MG diagnosis confirmed (antibody testing, EMG, response to treatment)',
        'Documentation of affected muscle groups',
        'Pattern of fatigable weakness (worse with activity, better with rest)',
        'Current treatment regimen and response',
        'Symptom logs showing functional impact',
      ],
    },
  ],

  additionalRatingGuidance: [
    {
      residual: 'Ocular Myasthenia',
      description: 'Ptosis (drooping eyelid) and/or diplopia (double vision)',
      ratingMethod: 'Rate under eye codes if vision affected; may be part of minimum rating if mild',
    },
    {
      residual: 'Bulbar Weakness',
      description: 'Difficulty chewing, swallowing, speaking',
      ratingMethod: 'Rate based on functional impairment; severe cases may warrant additional rating',
    },
    {
      residual: 'Limb Weakness',
      description: 'Proximal arm/leg weakness affecting function',
      ratingMethod: 'Rate under appropriate peripheral nerve codes based on affected muscles',
    },
    {
      residual: 'Respiratory Weakness',
      description: 'Weakness of breathing muscles',
      ratingMethod: 'Rate under respiratory codes if FVC affected; myasthenic crisis warrants 100%',
    },
    {
      residual: 'Neck Weakness',
      description: 'Head drop from neck extensor weakness',
      ratingMethod: 'Consider under minimum rating or rate based on functional limitation',
    },
  ],

  mgfaClassification: [
    {
      class: 'I',
      description: 'Ocular MG - weakness limited to eye muscles',
      symptoms: ['Ptosis', 'Diplopia'],
    },
    {
      class: 'II',
      description: 'Mild generalized MG',
      subclasses: [
        { id: 'IIa', description: 'Predominantly limb/axial muscles' },
        { id: 'IIb', description: 'Predominantly bulbar/respiratory muscles' },
      ],
    },
    {
      class: 'III',
      description: 'Moderate generalized MG',
      subclasses: [
        { id: 'IIIa', description: 'Predominantly limb/axial muscles' },
        { id: 'IIIb', description: 'Predominantly bulbar/respiratory muscles' },
      ],
    },
    {
      class: 'IV',
      description: 'Severe generalized MG',
      subclasses: [
        { id: 'IVa', description: 'Predominantly limb/axial muscles' },
        { id: 'IVb', description: 'Predominantly bulbar/respiratory muscles' },
      ],
    },
    {
      class: 'V',
      description: 'Intubation required (with or without mechanical ventilation)',
      symptoms: ['Myasthenic crisis'],
    },
  ],

  definitions: {
    myastheniaGravis: {
      term: 'Myasthenia Gravis',
      definition: 'An autoimmune neuromuscular disorder caused by antibodies blocking acetylcholine receptors at the neuromuscular junction. Characterized by fatigable muscle weakness that worsens with activity and improves with rest.',
      examples: [
        'Ocular MG - affects only eye muscles',
        'Generalized MG - affects multiple muscle groups',
        'MG with thymoma - associated with thymus tumor',
      ],
    },
    fatigableWeakness: {
      term: 'Fatigable Weakness',
      definition: 'The hallmark of MG - muscles become weaker with repeated use and recover strength after rest. Different from fatigue (tiredness).',
      examples: [
        'Voice becomes softer after talking',
        'Chewing difficulty worsens during meal',
        'Arm weakness when holding arms up',
        'Ptosis worsens throughout day',
      ],
    },
    ptosis: {
      term: 'Ptosis',
      definition: 'Drooping of one or both upper eyelids due to weakness of the levator palpebrae muscle. Often the first symptom of MG.',
      examples: [
        'Unilateral or bilateral eyelid drooping',
        'Worse at end of day or with sustained upward gaze',
        'May shift from one eye to other',
        'Ice pack test may temporarily improve',
      ],
    },
    diplopia: {
      term: 'Diplopia',
      definition: 'Double vision caused by weakness of extraocular muscles. Common early symptom of MG.',
      examples: [
        'Horizontal or vertical double vision',
        'Worse with sustained gaze',
        'May be intermittent',
        'Improves with rest or one eye closed',
      ],
    },
    myasthenicCrisis: {
      term: 'Myasthenic Crisis',
      definition: 'Life-threatening worsening of MG with severe weakness of respiratory muscles requiring mechanical ventilation. Medical emergency.',
      examples: [
        'Severe shortness of breath',
        'Inability to clear secretions',
        'Respiratory failure requiring intubation',
        'Triggered by infection, surgery, medication changes',
      ],
    },
    bulbarSymptoms: {
      term: 'Bulbar Symptoms',
      definition: 'Symptoms affecting muscles controlled by cranial nerves from the brainstem - swallowing, speech, and facial muscles.',
      examples: [
        'Difficulty chewing (jaw fatigue)',
        'Difficulty swallowing (dysphagia)',
        'Nasal or slurred speech',
        'Facial weakness (expressionless face)',
      ],
    },
  },

  disclaimer: 'Myasthenia Gravis has a minimum rating of 30% when ascertainable residuals are present. The characteristic pattern of fatigable weakness (worsening with activity, improving with rest) should be documented. Additional ratings may be assigned for specific residuals affecting vision, swallowing, respiration, or limb function. Myasthenic crisis requiring ventilation warrants 100% during the acute period.',
};

// ============================================
// PHASE 1B: ADDITIONAL NEUROLOGICAL - CRITERIA
// ============================================

// Narcolepsy (DC 8108) - 38 CFR 4.124a
export const NARCOLEPSY_CRITERIA = {
  diagnosticCode: '8108',
  condition: 'Narcolepsy',
  cfrReference: '38 CFR 4.124a',

  ratings: [
    {
      percent: 80,
      summary: 'Severe - daily sleep attacks, frequent cataplexy, major occupational impairment',
      criteria: ['Daily or near-daily sleep attacks', 'Frequent cataplexy episodes', 'Unable to maintain employment', 'Symptoms uncontrolled despite treatment'],
    },
    {
      percent: 60,
      summary: 'Moderately severe - frequent sleep attacks, cataplexy present, significant impairment',
      criteria: ['Multiple sleep attacks per week', 'Cataplexy episodes present', 'Significant occupational impairment', 'Partial response to treatment'],
    },
    {
      percent: 40,
      summary: 'Moderate - regular sleep attacks, mild cataplexy, moderate impairment',
      criteria: ['Weekly sleep attacks', 'Mild or infrequent cataplexy', 'Moderate occupational impact', 'Requires medication management'],
    },
    {
      percent: 20,
      summary: 'Mild - occasional sleep attacks, controlled with medication',
      criteria: ['Occasional sleep attacks (less than weekly)', 'No or rare cataplexy', 'Mild occupational impact', 'Well-controlled on medication'],
    },
    {
      percent: 10,
      summary: 'Minimal - rare symptoms, well controlled',
      criteria: ['Rare sleep attacks', 'No cataplexy', 'Minimal functional impairment', 'Excellent response to treatment'],
    },
  ],

  note: 'Narcolepsy is rated based on frequency of sleep attacks, presence and severity of cataplexy, and overall functional impairment. Document sleep study results (MSLT showing sleep latency <8 minutes and 2+ SOREMPs), medication use, and impact on daily activities and employment.',

  definitions: {
    sleepAttack: {
      term: 'Sleep Attack',
      definition: 'Sudden, irresistible episode of sleep occurring at inappropriate times, often without warning. May last seconds to minutes.',
    },
    cataplexy: {
      term: 'Cataplexy',
      definition: 'Sudden loss of muscle tone triggered by strong emotions (laughter, surprise, anger). Pathognomonic for Type 1 narcolepsy. Can range from mild (facial drooping, slurred speech) to complete collapse.',
    },
    hypnagogicHallucination: {
      term: 'Hypnagogic Hallucination',
      definition: 'Vivid, often frightening hallucinations occurring at sleep onset. May be visual, auditory, or tactile.',
    },
    sleepParalysis: {
      term: 'Sleep Paralysis',
      definition: 'Temporary inability to move or speak while falling asleep or waking up. Often accompanied by hallucinations and sense of presence.',
    },
    automaticBehavior: {
      term: 'Automatic Behavior',
      definition: 'Performing routine tasks without conscious awareness during microsleep episodes. May result in errors, memory gaps, or dangerous situations.',
    },
  },

  disclaimer: 'This analysis is for documentation purposes only. VA rating decisions require sleep study confirmation (MSLT) and C&P examination findings.',
};

// ALS - Amyotrophic Lateral Sclerosis (DC 8017) - 38 CFR 4.124a
export const ALS_CRITERIA = {
  diagnosticCode: '8017',
  condition: 'Amyotrophic Lateral Sclerosis (ALS)',
  cfrReference: '38 CFR 4.124a',

  ratings: [
    {
      percent: 100,
      summary: 'Total disability - complete dependence, respiratory failure, or terminal stage',
      criteria: ['Complete dependence for all ADLs', 'Respiratory failure requiring ventilatory support', 'Unable to communicate or swallow', 'Terminal stage of disease'],
    },
    {
      percent: 80,
      summary: 'Severe - marked weakness in multiple regions, significant respiratory/bulbar involvement',
      criteria: ['Marked weakness in 3+ body regions', 'Significant respiratory compromise (FVC <50%)', 'Severe dysphagia requiring modified diet or feeding tube', 'Requires wheelchair or bed-bound'],
    },
    {
      percent: 60,
      summary: 'Moderately severe - progressive weakness, moderate respiratory/bulbar symptoms',
      criteria: ['Progressive weakness in 2+ body regions', 'Moderate respiratory involvement (FVC 50-70%)', 'Moderate dysphagia', 'Requires assistance with ADLs'],
    },
    {
      percent: 40,
      summary: 'Moderate - definite weakness, early bulbar or respiratory involvement',
      criteria: ['Definite weakness affecting function', 'Early respiratory or bulbar symptoms', 'Can perform most ADLs with difficulty', 'Ambulatory with assistance'],
    },
    {
      percent: 30,
      summary: 'Minimum rating - confirmed ALS diagnosis with symptoms',
      criteria: ['Confirmed ALS diagnosis', 'Early motor symptoms present', 'Mild functional impairment', 'Ambulatory and independent'],
    },
  ],

  note: 'ALS is a progressive, fatal motor neuron disease. VA presumes service connection for veterans who develop ALS. Given the progressive nature, ratings should be reviewed regularly. Additional ratings may apply for respiratory failure, dysphagia, speech impairment, and depression.',

  definitions: {
    upperMotorNeuron: {
      term: 'Upper Motor Neuron Signs',
      definition: 'Signs of corticospinal tract involvement: spasticity, hyperreflexia, Babinski sign, clonus.',
    },
    lowerMotorNeuron: {
      term: 'Lower Motor Neuron Signs',
      definition: 'Signs of anterior horn cell involvement: weakness, atrophy, fasciculations, hyporeflexia.',
    },
    bulbarSymptoms: {
      term: 'Bulbar Symptoms',
      definition: 'Symptoms from brainstem motor neuron involvement: dysarthria (slurred speech), dysphagia (difficulty swallowing), sialorrhea (drooling), emotional lability.',
    },
    fasciculations: {
      term: 'Fasciculations',
      definition: 'Visible spontaneous muscle twitches caused by denervation of muscle fibers. Common early sign of ALS.',
    },
    fvc: {
      term: 'Forced Vital Capacity (FVC)',
      definition: 'Measure of respiratory muscle strength. FVC <50% indicates significant respiratory compromise in ALS.',
    },
  },

  disclaimer: 'This analysis is for documentation purposes only. ALS is presumptively service-connected for veterans. VA rating decisions require neurological examination and EMG/nerve conduction studies.',
};

// Syringomyelia (DC 8024) - 38 CFR 4.124a
export const SYRINGOMYELIA_CRITERIA = {
  diagnosticCode: '8024',
  condition: 'Syringomyelia',
  cfrReference: '38 CFR 4.124a',

  ratings: [
    {
      percent: 100,
      summary: 'Severe - profound sensory/motor deficits, complete dependence',
      criteria: ['Profound sensory loss', 'Severe weakness or paralysis', 'Complete dependence for ADLs', 'Severe pain uncontrolled by treatment'],
    },
    {
      percent: 80,
      summary: 'Marked sensory loss, significant weakness, major functional impairment',
      criteria: ['Marked cape-distribution sensory loss', 'Significant upper extremity weakness', 'Requires assistance for most ADLs', 'Chronic pain with limited control'],
    },
    {
      percent: 60,
      summary: 'Moderate sensory/motor deficits with functional limitations',
      criteria: ['Moderate sensory loss affecting function', 'Moderate weakness', 'Burns/injuries from sensory loss', 'Significant pain requiring treatment'],
    },
    {
      percent: 40,
      summary: 'Definite sensory changes and mild weakness',
      criteria: ['Definite dissociated sensory loss', 'Mild weakness', 'Some functional impairment', 'Intermittent pain'],
    },
    {
      percent: 20,
      summary: 'Mild symptoms with minimal functional impact',
      criteria: ['Mild sensory changes', 'Minimal or no weakness', 'Minor functional impairment', 'Symptoms controlled'],
    },
  ],

  note: 'Syringomyelia is rated based on the extent of sensory loss, motor weakness, pain, and functional impairment. The characteristic "cape-like" or "suspended" sensory loss pattern (loss of pain/temperature sensation with preserved touch) is pathognomonic. Document MRI findings showing syrinx location and size.',

  definitions: {
    syrinx: {
      term: 'Syrinx',
      definition: 'Fluid-filled cavity (cyst) within the spinal cord that damages nerve fibers and causes progressive neurological symptoms.',
    },
    dissociatedSensoryLoss: {
      term: 'Dissociated Sensory Loss',
      definition: 'Loss of pain and temperature sensation with preserved light touch and proprioception. Caused by damage to crossing spinothalamic fibers.',
    },
    capeDistribution: {
      term: 'Cape Distribution',
      definition: 'Pattern of sensory loss affecting shoulders, arms, and upper back in a cape-like pattern, characteristic of cervical syringomyelia.',
    },
    charcotJoint: {
      term: 'Charcot Joint',
      definition: 'Neuropathic arthropathy (joint destruction) resulting from loss of protective pain sensation.',
    },
  },

  disclaimer: 'This analysis is for documentation purposes only. VA rating decisions require MRI confirmation and neurological examination.',
};

// Myelitis (DC 8010) - 38 CFR 4.124a
export const MYELITIS_CRITERIA = {
  diagnosticCode: '8010',
  condition: 'Myelitis',
  cfrReference: '38 CFR 4.124a',

  ratings: [
    {
      percent: 100,
      summary: 'Complete or near-complete paralysis, total dependence',
      criteria: ['Complete or near-complete paralysis below lesion level', 'Total loss of bladder/bowel control', 'Complete dependence for all ADLs', 'Respiratory compromise if cervical'],
    },
    {
      percent: 80,
      summary: 'Severe - marked weakness/paralysis, significant bladder/bowel dysfunction',
      criteria: ['Marked weakness or incomplete paralysis', 'Significant bladder/bowel dysfunction', 'Requires wheelchair or significant assistance', 'Severe sensory loss'],
    },
    {
      percent: 60,
      summary: 'Moderately severe - significant weakness, bladder/bowel involvement',
      criteria: ['Significant weakness affecting ambulation', 'Moderate bladder/bowel dysfunction', 'Requires assistive devices', 'Moderate sensory impairment'],
    },
    {
      percent: 40,
      summary: 'Moderate - definite weakness, some bladder/bowel symptoms',
      criteria: ['Definite weakness', 'Mild bladder/bowel symptoms', 'Ambulatory with difficulty', 'Sensory changes present'],
    },
    {
      percent: 20,
      summary: 'Mild residuals with minimal functional impact',
      criteria: ['Mild weakness', 'Minimal or resolved bladder/bowel symptoms', 'Minor sensory changes', 'Good functional recovery'],
    },
  ],

  note: 'Myelitis (including transverse myelitis) is rated based on residual deficits after acute phase resolves. The level of spinal cord involvement determines affected body regions. Additional ratings may apply for bladder dysfunction (DC 7542), bowel dysfunction (DC 7332), and sexual dysfunction.',

  definitions: {
    transverseMyelitis: {
      term: 'Transverse Myelitis',
      definition: 'Inflammation across the full width of the spinal cord at one or more levels, causing motor, sensory, and autonomic dysfunction below the lesion.',
    },
    sensoryLevel: {
      term: 'Sensory Level',
      definition: 'The highest spinal cord level at which sensation is impaired, indicating the location of the lesion.',
    },
    spasticity: {
      term: 'Spasticity',
      definition: 'Increased muscle tone and stiffness due to upper motor neuron damage, often seen in chronic myelitis.',
    },
    neurogenicBladder: {
      term: 'Neurogenic Bladder',
      definition: 'Bladder dysfunction resulting from spinal cord damage, may cause retention, incontinence, or both.',
    },
  },

  disclaimer: 'This analysis is for documentation purposes only. VA rating decisions require MRI findings, lumbar puncture results (if available), and neurological examination.',
};

// ============================================
// PHASE 1C: PERIPHERAL NERVE CRITERIA
// 38 CFR 4.124a - Diseases of the Peripheral Nerves
// ============================================

// UPPER RADICULAR GROUP (C5-C6) - DC 8510/8610/8710
export const UPPER_RADICULAR_GROUP_CRITERIA = {
  diagnosticCodes: { paralysis: '8510', neuritis: '8610', neuralgia: '8710' },
  condition: 'Upper Radicular Group (C5-C6) Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 70,
      summary: 'Complete paralysis (major extremity) - all shoulder and elbow movements lost or severely affected',
      criteria: ['Complete paralysis of upper radicular group', 'All shoulder movements lost or severely affected', 'All elbow movements lost or severely affected', 'Hand and wrist movements not affected'],
      extremity: 'major'
    },
    {
      percent: 60,
      summary: 'Complete paralysis (minor extremity) - all shoulder and elbow movements lost or severely affected',
      criteria: ['Complete paralysis of upper radicular group', 'All shoulder movements lost or severely affected', 'All elbow movements lost or severely affected', 'Hand and wrist movements not affected'],
      extremity: 'minor'
    },
    {
      percent: 50,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant loss of shoulder function', 'Significant loss of elbow function', 'Motor and sensory involvement'],
      extremity: 'major'
    },
    {
      percent: 40,
      summary: 'Severe incomplete paralysis (minor) OR Moderate incomplete paralysis (major)',
      criteria: ['Severe incomplete paralysis (minor extremity)', 'OR Moderate incomplete paralysis (major extremity)', 'Moderate functional impairment', 'Mixed motor and sensory symptoms'],
      extremity: 'both'
    },
    {
      percent: 30,
      summary: 'Moderate incomplete paralysis (minor extremity)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable weakness', 'Some sensory changes', 'Functional limitations present'],
      extremity: 'minor'
    },
    {
      percent: 20,
      summary: 'Mild incomplete paralysis (major or minor extremity)',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Minor functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The upper radicular group involves C5-C6 nerve roots affecting shoulder and elbow function. Ratings differ based on major (dominant) vs minor (non-dominant) extremity. When involvement is wholly sensory, rate as mild or at most moderate. Neuritis (8610) and neuralgia (8710) are rated using the same criteria.',
  definitions: {
    'complete paralysis': {
      term: 'Complete Paralysis',
      definition: 'Total loss of motor function in muscles supplied by the affected nerve group. For upper radicular group: all shoulder and elbow movements lost or severely affected.'
    },
    'incomplete paralysis': {
      term: 'Incomplete Paralysis',
      definition: 'Degree of lost or impaired function substantially less than complete paralysis. May be due to varied level of nerve lesion or partial regeneration.'
    },
    'major extremity': {
      term: 'Major Extremity',
      definition: 'The dominant arm for upper extremity conditions. Higher ratings apply due to greater functional impact.'
    },
    'minor extremity': {
      term: 'Minor Extremity',
      definition: 'The non-dominant arm for upper extremity conditions. Lower ratings apply compared to major extremity.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Peripheral nerve ratings require neurological examination documenting motor and sensory deficits. VA determines major/minor extremity based on handedness.',
};

// MIDDLE RADICULAR GROUP (C7) - DC 8511/8611/8711
export const MIDDLE_RADICULAR_GROUP_CRITERIA = {
  diagnosticCodes: { paralysis: '8511', neuritis: '8611', neuralgia: '8711' },
  condition: 'Middle Radicular Group (C7) Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 70,
      summary: 'Complete paralysis (major) - arm adduction/abduction/rotation, elbow flexion, wrist extension lost',
      criteria: ['Complete paralysis of middle radicular group', 'Adduction of arm lost or severely affected', 'Abduction and rotation of arm lost or severely affected', 'Flexion of elbow lost or severely affected', 'Extension of wrist lost or severely affected'],
      extremity: 'major'
    },
    {
      percent: 60,
      summary: 'Complete paralysis (minor) - arm adduction/abduction/rotation, elbow flexion, wrist extension lost',
      criteria: ['Complete paralysis of middle radicular group', 'Adduction of arm lost or severely affected', 'Abduction and rotation of arm lost or severely affected', 'Flexion of elbow lost or severely affected', 'Extension of wrist lost or severely affected'],
      extremity: 'minor'
    },
    {
      percent: 50,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant loss of arm rotation', 'Significant elbow flexion weakness', 'Significant wrist extension weakness'],
      extremity: 'major'
    },
    {
      percent: 40,
      summary: 'Severe incomplete paralysis (minor) OR Moderate incomplete paralysis (major)',
      criteria: ['Severe incomplete paralysis (minor)', 'OR Moderate incomplete paralysis (major)', 'Moderate functional limitations', 'Mixed motor and sensory deficits'],
      extremity: 'both'
    },
    {
      percent: 30,
      summary: 'Moderate incomplete paralysis (minor extremity)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable weakness in C7 distribution', 'Some sensory changes', 'Functional limitations present'],
      extremity: 'minor'
    },
    {
      percent: 20,
      summary: 'Mild incomplete paralysis (major or minor extremity)',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Minor functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The middle radicular group involves the C7 nerve root affecting arm rotation, elbow flexion, and wrist extension. Neuritis (8611) and neuralgia (8711) use the same rating criteria.',
  definitions: {
    'complete paralysis': {
      term: 'Complete Paralysis',
      definition: 'Total loss of motor function. For middle radicular group: arm adduction, abduction, rotation, elbow flexion, and wrist extension all lost or severely affected.'
    },
    'incomplete paralysis': {
      term: 'Incomplete Paralysis',
      definition: 'Partial loss of function substantially less than complete paralysis picture.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Peripheral nerve ratings require neurological examination documenting motor and sensory deficits.',
};

// LOWER RADICULAR GROUP (C8-T1) - DC 8512/8612/8712
export const LOWER_RADICULAR_GROUP_CRITERIA = {
  diagnosticCodes: { paralysis: '8512', neuritis: '8612', neuralgia: '8712' },
  condition: 'Lower Radicular Group (C8-T1) Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 70,
      summary: 'Complete paralysis (major) - all intrinsic hand muscles paralyzed, substantial loss of hand use',
      criteria: ['Complete paralysis of lower radicular group', 'All intrinsic muscles of hand paralyzed', 'Some or all flexors of wrist and fingers paralyzed', 'Substantial loss of use of hand'],
      extremity: 'major'
    },
    {
      percent: 60,
      summary: 'Complete paralysis (minor) - all intrinsic hand muscles paralyzed, substantial loss of hand use',
      criteria: ['Complete paralysis of lower radicular group', 'All intrinsic muscles of hand paralyzed', 'Some or all flexors of wrist and fingers paralyzed', 'Substantial loss of use of hand'],
      extremity: 'minor'
    },
    {
      percent: 50,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant intrinsic hand muscle weakness', 'Significant grip impairment', 'Major functional loss'],
      extremity: 'major'
    },
    {
      percent: 40,
      summary: 'Severe incomplete paralysis (minor) OR Moderate incomplete paralysis (major)',
      criteria: ['Severe incomplete paralysis (minor)', 'OR Moderate incomplete paralysis (major)', 'Moderate hand function impairment', 'Mixed motor and sensory deficits'],
      extremity: 'both'
    },
    {
      percent: 30,
      summary: 'Moderate incomplete paralysis (minor extremity)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable hand weakness', 'Grip strength reduced', 'Fine motor difficulties'],
      extremity: 'minor'
    },
    {
      percent: 20,
      summary: 'Mild incomplete paralysis (major or minor extremity)',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Minor functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The lower radicular group involves C8-T1 nerve roots affecting hand intrinsic muscles and finger/wrist flexors. Neuritis (8612) and neuralgia (8712) use the same rating criteria.',
  definitions: {
    'complete paralysis': {
      term: 'Complete Paralysis',
      definition: 'Total loss of motor function. For lower radicular group: all intrinsic muscles of hand and some or all flexors of wrist and fingers paralyzed, resulting in substantial loss of use of hand.'
    },
    'intrinsic muscles': {
      term: 'Intrinsic Hand Muscles',
      definition: 'Small muscles within the hand that control fine motor movements, including the lumbricals, interossei, thenar, and hypothenar muscles.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Peripheral nerve ratings require neurological examination documenting motor and sensory deficits.',
};

// ALL RADICULAR GROUPS (BRACHIAL PLEXUS) - DC 8513/8613/8713
export const ALL_RADICULAR_GROUPS_CRITERIA = {
  diagnosticCodes: { paralysis: '8513', neuritis: '8613', neuralgia: '8713' },
  condition: 'All Radicular Groups (Complete Brachial Plexus) Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 90,
      summary: 'Complete paralysis (major extremity) - total loss of arm function',
      criteria: ['Complete paralysis of all radicular groups', 'Total loss of shoulder, elbow, wrist, and hand function', 'Complete brachial plexus injury', 'Arm essentially non-functional'],
      extremity: 'major'
    },
    {
      percent: 80,
      summary: 'Complete paralysis (minor extremity) - total loss of arm function',
      criteria: ['Complete paralysis of all radicular groups', 'Total loss of shoulder, elbow, wrist, and hand function', 'Complete brachial plexus injury', 'Arm essentially non-functional'],
      extremity: 'minor'
    },
    {
      percent: 70,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant loss of function at all levels', 'Multiple radicular group involvement', 'Major functional impairment'],
      extremity: 'major'
    },
    {
      percent: 60,
      summary: 'Severe incomplete paralysis (minor extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant loss of function at all levels', 'Multiple radicular group involvement', 'Major functional impairment'],
      extremity: 'minor'
    },
    {
      percent: 40,
      summary: 'Moderate incomplete paralysis (major extremity)',
      criteria: ['Moderate incomplete paralysis', 'Moderate loss at multiple levels', 'Mixed motor and sensory deficits', 'Moderate functional limitations'],
      extremity: 'major'
    },
    {
      percent: 30,
      summary: 'Moderate incomplete paralysis (minor extremity)',
      criteria: ['Moderate incomplete paralysis', 'Moderate loss at multiple levels', 'Mixed motor and sensory deficits', 'Moderate functional limitations'],
      extremity: 'minor'
    },
    {
      percent: 20,
      summary: 'Mild incomplete paralysis (major or minor extremity)',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness at multiple levels', 'Primarily sensory symptoms', 'Minor functional impact'],
      extremity: 'both'
    },
  ],
  note: 'All radicular groups involvement indicates complete brachial plexus injury affecting C5-T1. This is the most severe upper extremity nerve rating. Neuritis (8613) and neuralgia (8713) use the same criteria.',
  definitions: {
    'brachial plexus': {
      term: 'Brachial Plexus',
      definition: 'Network of nerves formed by C5-T1 nerve roots that controls movement and sensation in the shoulder, arm, and hand.'
    },
    'complete paralysis': {
      term: 'Complete Paralysis',
      definition: 'Total loss of motor function throughout the entire arm from shoulder to hand.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Brachial plexus injury ratings require comprehensive neurological examination.',
};

// RADIAL NERVE (MUSCULOSPIRAL) - DC 8514/8614/8714
export const RADIAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8514', neuritis: '8614', neuralgia: '8714' },
  condition: 'Radial Nerve (Musculospiral) Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 70,
      summary: 'Complete paralysis (major) - wrist drop, finger drop, cannot extend hand/fingers/thumb',
      criteria: ['Complete paralysis of radial nerve', 'Drop of hand and fingers', 'Wrist and fingers perpetually flexed', 'Thumb adducted falling within line of outer border of index finger', 'Cannot extend hand at wrist', 'Cannot extend proximal phalanges of fingers', 'Cannot extend thumb', 'Cannot make lateral movement of wrist', 'Supination of hand weakened', 'Extension and flexion of elbow weakened', 'Loss of synergic motion of extensors impairs hand grip seriously'],
      extremity: 'major'
    },
    {
      percent: 60,
      summary: 'Complete paralysis (minor) - wrist drop, finger drop, cannot extend hand/fingers/thumb',
      criteria: ['Complete paralysis of radial nerve', 'Drop of hand and fingers', 'Wrist and fingers perpetually flexed', 'Thumb adducted', 'Cannot extend hand, fingers, or thumb', 'Cannot make lateral wrist movement', 'Weakened supination and elbow function'],
      extremity: 'minor'
    },
    {
      percent: 50,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant wrist extension weakness', 'Significant finger extension weakness', 'Marked functional impairment'],
      extremity: 'major'
    },
    {
      percent: 40,
      summary: 'Severe incomplete paralysis (minor extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant wrist extension weakness', 'Significant finger extension weakness', 'Marked functional impairment'],
      extremity: 'minor'
    },
    {
      percent: 30,
      summary: 'Moderate incomplete paralysis (major extremity)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable extension weakness', 'Some grip impairment', 'Moderate functional limitations'],
      extremity: 'major'
    },
    {
      percent: 20,
      summary: 'Moderate incomplete paralysis (minor) OR Mild incomplete paralysis (major or minor)',
      criteria: ['Moderate incomplete paralysis (minor)', 'OR Mild incomplete paralysis (either extremity)', 'Mild to moderate weakness', 'Some sensory symptoms', 'Minor to moderate functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The radial nerve controls wrist and finger extension. Complete paralysis results in classic "wrist drop." Note: Lesions involving only dissociation of extensor communis digitorum or paralysis below the extensor communis digitorum will not exceed moderate rating. Total paralysis of the triceps occurs only as the greatest rarity.',
  definitions: {
    'wrist drop': {
      term: 'Wrist Drop',
      definition: 'Inability to extend the wrist, causing the hand to hang limply. Classic sign of radial nerve palsy.'
    },
    'synergic motion': {
      term: 'Synergic Motion',
      definition: 'Coordinated movement of multiple muscles working together. Loss impairs complex movements like grip.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Radial nerve ratings require neurological examination documenting motor and sensory deficits.',
};

// MEDIAN NERVE - DC 8515/8615/8715
export const MEDIAN_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8515', neuritis: '8615', neuralgia: '8715' },
  condition: 'Median Nerve Paralysis (Carpal Tunnel Syndrome)',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 70,
      summary: 'Complete paralysis (major) - ape hand deformity, cannot make fist, thumb opposition lost',
      criteria: ['Complete paralysis of median nerve', 'Hand inclined to ulnar side', 'Index and middle fingers more extended than normal', 'Considerable atrophy of thenar eminence muscles', 'Thumb in plane of hand (ape hand)', 'Pronation incomplete and defective', 'Absence of flexion of index finger', 'Feeble flexion of middle finger', 'Cannot make a fist', 'Index and middle fingers remain extended', 'Cannot flex distal phalanx of thumb', 'Defective opposition and abduction of thumb at right angles to palm', 'Flexion of wrist weakened', 'Pain with trophic disturbances'],
      extremity: 'major'
    },
    {
      percent: 60,
      summary: 'Complete paralysis (minor) - ape hand deformity, cannot make fist, thumb opposition lost',
      criteria: ['Complete paralysis of median nerve', 'Ape hand deformity', 'Cannot make a fist', 'Thenar atrophy', 'Lost thumb opposition', 'Pain with trophic disturbances'],
      extremity: 'minor'
    },
    {
      percent: 50,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant thenar weakness/atrophy', 'Marked sensory loss in median distribution', 'Significant functional impairment', 'Difficulty with pinch and grip'],
      extremity: 'major'
    },
    {
      percent: 40,
      summary: 'Severe incomplete paralysis (minor extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant thenar weakness/atrophy', 'Marked sensory loss', 'Significant functional impairment'],
      extremity: 'minor'
    },
    {
      percent: 30,
      summary: 'Moderate incomplete paralysis (major extremity)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable thenar weakness', 'Moderate sensory symptoms', 'Moderate functional limitations', 'Night symptoms common'],
      extremity: 'major'
    },
    {
      percent: 20,
      summary: 'Moderate incomplete paralysis (minor extremity)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable thenar weakness', 'Moderate sensory symptoms', 'Moderate functional limitations'],
      extremity: 'minor'
    },
    {
      percent: 10,
      summary: 'Mild incomplete paralysis (major or minor extremity)',
      criteria: ['Mild incomplete paralysis', 'Primarily sensory symptoms', 'Numbness and tingling in median distribution', 'Minimal weakness', 'Minor functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The median nerve is most commonly affected at the wrist (carpal tunnel syndrome). It controls thumb opposition, index/middle finger flexion, and sensation to the palmar thumb, index, middle, and half of ring finger. When involvement is wholly sensory, rate as mild or at most moderate.',
  definitions: {
    'ape hand': {
      term: 'Ape Hand Deformity',
      definition: 'Flattening of the thenar eminence with thumb lying in the same plane as the palm, resembling an ape hand. Results from thenar muscle atrophy due to median nerve damage.'
    },
    'thenar eminence': {
      term: 'Thenar Eminence',
      definition: 'The fleshy mound at the base of the thumb formed by the thenar muscles (abductor pollicis brevis, flexor pollicis brevis, opponens pollicis).'
    },
    'carpal tunnel syndrome': {
      term: 'Carpal Tunnel Syndrome',
      definition: 'Compression of the median nerve at the wrist causing numbness, tingling, and weakness in the hand. Most common entrapment neuropathy.'
    },
    'trophic disturbances': {
      term: 'Trophic Disturbances',
      definition: 'Changes in skin, nails, or hair due to nerve damage, including dry/shiny skin, brittle nails, and hair loss in affected areas.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Median nerve/carpal tunnel ratings require nerve conduction studies and clinical examination.',
};

// ULNAR NERVE - DC 8516/8616/8716
export const ULNAR_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8516', neuritis: '8616', neuralgia: '8716' },
  condition: 'Ulnar Nerve Paralysis (Cubital Tunnel Syndrome)',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 60,
      summary: 'Complete paralysis (major) - claw hand deformity, cannot spread fingers, lost thumb adduction',
      criteria: ['Complete paralysis of ulnar nerve', 'Griffin claw deformity due to flexor contraction of ring and little fingers', 'Atrophy very marked in dorsal interspace', 'Atrophy of thenar and hypothenar eminences', 'Loss of extension of ring and little fingers', 'Cannot spread the fingers (or reverse)', 'Cannot adduct the thumb', 'Flexion of wrist weakened'],
      extremity: 'major'
    },
    {
      percent: 50,
      summary: 'Complete paralysis (minor) - claw hand deformity, cannot spread fingers, lost thumb adduction',
      criteria: ['Complete paralysis of ulnar nerve', 'Griffin claw deformity', 'Marked interosseous atrophy', 'Thenar and hypothenar atrophy', 'Cannot spread or adduct fingers', 'Cannot adduct thumb', 'Weakened wrist flexion'],
      extremity: 'minor'
    },
    {
      percent: 40,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant interosseous weakness/atrophy', 'Marked grip weakness', 'Significant sensory loss in ulnar distribution', 'Major functional impairment'],
      extremity: 'major'
    },
    {
      percent: 30,
      summary: 'Severe incomplete paralysis (minor) OR Moderate incomplete paralysis (major)',
      criteria: ['Severe incomplete paralysis (minor)', 'OR Moderate incomplete paralysis (major)', 'Noticeable weakness and atrophy', 'Moderate to significant sensory symptoms', 'Moderate to significant functional limitations'],
      extremity: 'both'
    },
    {
      percent: 20,
      summary: 'Moderate incomplete paralysis (minor extremity)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable weakness', 'Moderate sensory symptoms', 'Moderate functional limitations'],
      extremity: 'minor'
    },
    {
      percent: 10,
      summary: 'Mild incomplete paralysis (major or minor extremity)',
      criteria: ['Mild incomplete paralysis', 'Primarily sensory symptoms', 'Numbness in ring/little fingers', 'Minimal weakness', 'Minor functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The ulnar nerve is commonly affected at the elbow (cubital tunnel syndrome). It controls finger spreading/adduction, thumb adduction, and sensation to the little finger and half of ring finger. Claw hand deformity is characteristic of complete ulnar nerve palsy.',
  definitions: {
    'claw hand': {
      term: 'Claw Hand (Griffin Claw)',
      definition: 'Deformity with hyperextension at MCP joints and flexion at IP joints of ring and little fingers, due to loss of intrinsic muscle function with intact extrinsic flexors.'
    },
    'interossei muscles': {
      term: 'Interossei Muscles',
      definition: 'Small muscles between the metacarpal bones that spread (dorsal interossei) and adduct (palmar interossei) the fingers.'
    },
    'hypothenar eminence': {
      term: 'Hypothenar Eminence',
      definition: 'The fleshy mound on the ulnar side of the palm at the base of the little finger.'
    },
    'cubital tunnel syndrome': {
      term: 'Cubital Tunnel Syndrome',
      definition: 'Compression of the ulnar nerve at the elbow causing numbness in the ring/little fingers and hand weakness. Second most common entrapment neuropathy.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Ulnar nerve/cubital tunnel ratings require nerve conduction studies and clinical examination.',
};

// MUSCULOCUTANEOUS NERVE - DC 8517/8617/8717
export const MUSCULOCUTANEOUS_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8517', neuritis: '8617', neuralgia: '8717' },
  condition: 'Musculocutaneous Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 30,
      summary: 'Complete paralysis (major) - weakness but not loss of elbow flexion and forearm supination',
      criteria: ['Complete paralysis of musculocutaneous nerve', 'Weakness of elbow flexion', 'Weakness of forearm supination', 'Biceps weakness', 'Note: Not complete loss due to other muscle compensation'],
      extremity: 'major'
    },
    {
      percent: 20,
      summary: 'Complete paralysis (minor) OR Severe incomplete paralysis (major or minor)',
      criteria: ['Complete paralysis (minor extremity)', 'OR Severe incomplete paralysis (either)', 'Significant biceps weakness', 'Elbow flexion impaired', 'Supination weakness'],
      extremity: 'both'
    },
    {
      percent: 10,
      summary: 'Moderate incomplete paralysis (major or minor)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable biceps weakness', 'Some elbow flexion weakness', 'Sensory symptoms in lateral forearm'],
      extremity: 'both'
    },
    {
      percent: 0,
      summary: 'Mild incomplete paralysis (major or minor)',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'No significant functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The musculocutaneous nerve innervates the biceps and brachialis muscles (elbow flexion) and provides sensation to the lateral forearm. Complete paralysis does not result in total loss of elbow flexion because other muscles (brachioradialis) can compensate.',
  definitions: {
    'musculocutaneous nerve': {
      term: 'Musculocutaneous Nerve',
      definition: 'Nerve arising from C5-C7 that innervates the biceps, brachialis, and coracobrachialis muscles and provides sensory innervation to the lateral forearm.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Musculocutaneous nerve ratings require neurological examination.',
};

// CIRCUMFLEX (AXILLARY) NERVE - DC 8518/8618/8718
export const CIRCUMFLEX_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8518', neuritis: '8618', neuralgia: '8718' },
  condition: 'Circumflex (Axillary) Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 50,
      summary: 'Complete paralysis (major) - arm abduction impossible, outward rotation weakened',
      criteria: ['Complete paralysis of circumflex nerve', 'Abduction of arm is impossible', 'Outward rotation is weakened', 'Deltoid muscle paralyzed', 'Teres minor muscle paralyzed'],
      extremity: 'major'
    },
    {
      percent: 40,
      summary: 'Complete paralysis (minor) - arm abduction impossible, outward rotation weakened',
      criteria: ['Complete paralysis of circumflex nerve', 'Abduction of arm is impossible', 'Outward rotation is weakened', 'Deltoid and teres minor paralyzed'],
      extremity: 'minor'
    },
    {
      percent: 30,
      summary: 'Severe incomplete paralysis (major extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant deltoid weakness', 'Marked difficulty with arm abduction', 'Significant functional impairment'],
      extremity: 'major'
    },
    {
      percent: 20,
      summary: 'Severe incomplete paralysis (minor extremity)',
      criteria: ['Severe incomplete paralysis', 'Significant deltoid weakness', 'Marked difficulty with arm abduction'],
      extremity: 'minor'
    },
    {
      percent: 10,
      summary: 'Moderate incomplete paralysis (major or minor)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable shoulder weakness', 'Some abduction difficulty', 'Sensory loss over lateral shoulder'],
      extremity: 'both'
    },
    {
      percent: 0,
      summary: 'Mild incomplete paralysis (major or minor)',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'No significant functional impact'],
      extremity: 'both'
    },
  ],
  note: 'The circumflex (axillary) nerve innervates the deltoid and teres minor muscles. It is commonly injured with shoulder dislocations. The muscles supplied control arm abduction and external rotation.',
  definitions: {
    'circumflex nerve': {
      term: 'Circumflex (Axillary) Nerve',
      definition: 'Nerve arising from C5-C6 that innervates the deltoid and teres minor muscles and provides sensation to the lateral shoulder ("badge area").'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Circumflex nerve ratings require neurological examination.',
};

// LONG THORACIC NERVE - DC 8519/8619/8719
export const LONG_THORACIC_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8519', neuritis: '8619', neuralgia: '8719' },
  condition: 'Long Thoracic Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'upper',
  ratings: [
    {
      percent: 30,
      summary: 'Complete paralysis (major) - cannot raise arm above shoulder, winged scapula',
      criteria: ['Complete paralysis of long thoracic nerve', 'Inability to raise arm above shoulder level', 'Winged scapula deformity', 'Serratus anterior muscle paralyzed'],
      extremity: 'major'
    },
    {
      percent: 20,
      summary: 'Complete paralysis (minor) OR Severe incomplete paralysis (major or minor)',
      criteria: ['Complete paralysis (minor extremity)', 'OR Severe incomplete paralysis (either)', 'Significant scapular winging', 'Difficulty raising arm above shoulder', 'Serratus anterior weakness'],
      extremity: 'both'
    },
    {
      percent: 10,
      summary: 'Moderate incomplete paralysis (major or minor)',
      criteria: ['Moderate incomplete paralysis', 'Noticeable scapular winging with effort', 'Some difficulty with overhead activities', 'Moderate serratus weakness'],
      extremity: 'both'
    },
    {
      percent: 0,
      summary: 'Mild incomplete paralysis (major or minor)',
      criteria: ['Mild incomplete paralysis', 'Minimal scapular winging', 'Minor functional impact', 'Slight serratus weakness'],
      extremity: 'both'
    },
  ],
  note: 'The long thoracic nerve innervates the serratus anterior muscle which stabilizes the scapula. Paralysis results in "winged scapula" and inability to raise the arm above shoulder level. Note: Not to be combined with lost motion above shoulder level.',
  definitions: {
    'winged scapula': {
      term: 'Winged Scapula',
      definition: 'Prominence of the medial border of the scapula away from the chest wall due to serratus anterior weakness, most visible when pushing against a wall.'
    },
    'serratus anterior': {
      term: 'Serratus Anterior Muscle',
      definition: 'Muscle that anchors the scapula to the chest wall and rotates it upward during arm elevation. Essential for overhead arm movements.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Long thoracic nerve ratings require neurological examination.',
};


// ============================================
// LOWER EXTREMITY PERIPHERAL NERVE CRITERIA
// ============================================

// SCIATIC NERVE - DC 8520/8620/8720
export const SCIATIC_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8520', neuritis: '8620', neuralgia: '8720' },
  condition: 'Sciatic Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 80,
      summary: 'Complete paralysis - foot dangles and drops, no movement below knee, knee flexion weakened or lost',
      criteria: ['Complete paralysis of sciatic nerve', 'Foot dangles and drops', 'No active movement possible of muscles below the knee', 'Flexion of knee weakened or (very rarely) lost'],
    },
    {
      percent: 60,
      summary: 'Severe incomplete paralysis with marked muscular atrophy',
      criteria: ['Severe incomplete paralysis', 'Marked muscular atrophy', 'Significant weakness below knee', 'Significant functional impairment', 'Foot drop may be present'],
    },
    {
      percent: 40,
      summary: 'Moderately severe incomplete paralysis',
      criteria: ['Moderately severe incomplete paralysis', 'Moderate to significant weakness', 'Some muscular atrophy', 'Noticeable gait disturbance', 'Moderate functional limitations'],
    },
    {
      percent: 20,
      summary: 'Moderate incomplete paralysis',
      criteria: ['Moderate incomplete paralysis', 'Noticeable weakness', 'Some sensory changes', 'Mild gait disturbance', 'Moderate functional impact'],
    },
    {
      percent: 10,
      summary: 'Mild incomplete paralysis',
      criteria: ['Mild incomplete paralysis', 'Primarily sensory symptoms', 'Minimal weakness', 'Radiating pain', 'Minor functional impact'],
    },
  ],
  note: 'The sciatic nerve is the largest nerve in the body, controlling most leg and foot muscles. It divides into the tibial and common peroneal nerves. Complete paralysis results in foot drop and loss of all movement below the knee. Lower extremity nerves do not have major/minor distinction.',
  definitions: {
    'sciatic nerve': {
      term: 'Sciatic Nerve',
      definition: 'Largest nerve in the body arising from L4-S3, running from lower back through buttock and down the leg. Controls muscles of posterior thigh, entire leg below knee, and most foot muscles.'
    },
    'foot drop': {
      term: 'Foot Drop',
      definition: 'Inability to dorsiflex the foot, causing the foot to drag during walking. Results from weakness of anterior leg muscles.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Sciatic nerve ratings require neurological examination documenting motor and sensory deficits.',
};

// COMMON PERONEAL (EXTERNAL POPLITEAL) NERVE - DC 8521/8621/8721
export const COMMON_PERONEAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8521', neuritis: '8621', neuralgia: '8721' },
  condition: 'Common Peroneal (External Popliteal) Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 40,
      summary: 'Complete paralysis - foot drop, cannot dorsiflex foot, toe extension lost',
      criteria: ['Complete paralysis of common peroneal nerve', 'Foot drop and slight droop of first phalanges of all toes', 'Cannot dorsiflex the foot', 'Extension (dorsal flexion) of proximal phalanges of toes lost', 'Abduction of foot lost', 'Adduction weakened', 'Anesthesia covers entire dorsum of foot and toes'],
    },
    {
      percent: 30,
      summary: 'Severe incomplete paralysis',
      criteria: ['Severe incomplete paralysis', 'Significant foot drop', 'Marked dorsiflexion weakness', 'Significant toe extension weakness', 'Steppage gait', 'Significant sensory loss'],
    },
    {
      percent: 20,
      summary: 'Moderate incomplete paralysis',
      criteria: ['Moderate incomplete paralysis', 'Noticeable dorsiflexion weakness', 'Some foot drop tendency', 'Tripping or stumbling', 'Moderate sensory symptoms'],
    },
    {
      percent: 10,
      summary: 'Mild incomplete paralysis',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Numbness on dorsum of foot', 'Minor functional impact'],
    },
  ],
  note: 'The common peroneal nerve wraps around the fibular head and is vulnerable to compression. It controls foot dorsiflexion and eversion. Complete paralysis results in classic foot drop with steppage gait.',
  definitions: {
    'common peroneal nerve': {
      term: 'Common Peroneal Nerve',
      definition: 'Branch of sciatic nerve that wraps around the fibular head, controlling dorsiflexion and eversion of the foot. Most commonly injured lower extremity nerve.'
    },
    'steppage gait': {
      term: 'Steppage Gait',
      definition: 'High-stepping gait pattern used to compensate for foot drop, lifting the knee high to clear the dragging foot.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Common peroneal nerve ratings require neurological examination.',
};

// SUPERFICIAL PERONEAL NERVE - DC 8522/8622/8722
export const SUPERFICIAL_PERONEAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8522', neuritis: '8622', neuralgia: '8722' },
  condition: 'Superficial Peroneal (Musculocutaneous) Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 30,
      summary: 'Complete paralysis - foot eversion weakened',
      criteria: ['Complete paralysis of superficial peroneal nerve', 'Eversion of foot weakened', 'Peroneus longus and brevis paralyzed', 'Ankle instability'],
    },
    {
      percent: 20,
      summary: 'Severe incomplete paralysis',
      criteria: ['Severe incomplete paralysis', 'Significant eversion weakness', 'Noticeable ankle instability', 'Significant sensory loss'],
    },
    {
      percent: 10,
      summary: 'Moderate incomplete paralysis',
      criteria: ['Moderate incomplete paralysis', 'Some eversion weakness', 'Moderate sensory symptoms', 'Numbness on lower leg and dorsum of foot'],
    },
    {
      percent: 0,
      summary: 'Mild incomplete paralysis',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Minor functional impact'],
    },
  ],
  note: 'The superficial peroneal nerve controls foot eversion (peroneus longus and brevis) and provides sensation to the lower lateral leg and dorsum of foot (except first web space).',
  definitions: {
    'superficial peroneal nerve': {
      term: 'Superficial Peroneal Nerve',
      definition: 'Branch of common peroneal nerve that innervates the peroneus longus and brevis (foot eversion) and provides sensation to lower lateral leg and most of foot dorsum.'
    },
    'eversion': {
      term: 'Foot Eversion',
      definition: 'Turning the sole of the foot outward. Controlled by the peroneal muscles.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Superficial peroneal nerve ratings require neurological examination.',
};

// DEEP PERONEAL (ANTERIOR TIBIAL) NERVE - DC 8523/8623/8723
export const DEEP_PERONEAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8523', neuritis: '8623', neuralgia: '8723' },
  condition: 'Deep Peroneal (Anterior Tibial) Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 30,
      summary: 'Complete paralysis - dorsal flexion of foot lost',
      criteria: ['Complete paralysis of deep peroneal nerve', 'Dorsal flexion of foot lost', 'Tibialis anterior paralyzed', 'Toe extensors paralyzed', 'Foot drop'],
    },
    {
      percent: 20,
      summary: 'Severe incomplete paralysis',
      criteria: ['Severe incomplete paralysis', 'Significant dorsiflexion weakness', 'Marked toe extension weakness', 'Foot drop tendency'],
    },
    {
      percent: 10,
      summary: 'Moderate incomplete paralysis',
      criteria: ['Moderate incomplete paralysis', 'Noticeable dorsiflexion weakness', 'Some toe extension weakness', 'Sensory loss in first web space'],
    },
    {
      percent: 0,
      summary: 'Mild incomplete paralysis',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Numbness in first web space', 'Minor functional impact'],
    },
  ],
  note: 'The deep peroneal nerve controls foot dorsiflexion (tibialis anterior) and toe extension. It provides sensation only to the first web space between the great and second toes.',
  definitions: {
    'deep peroneal nerve': {
      term: 'Deep Peroneal Nerve',
      definition: 'Branch of common peroneal nerve that innervates the tibialis anterior (foot dorsiflexion) and toe extensors. Sensory only to first web space.'
    },
    'dorsiflexion': {
      term: 'Dorsiflexion',
      definition: 'Bending the foot upward toward the shin. Essential for clearing the foot during walking.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Deep peroneal nerve ratings require neurological examination.',
};

// TIBIAL (INTERNAL POPLITEAL) NERVE - DC 8524/8624/8724
export const TIBIAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8524', neuritis: '8624', neuralgia: '8724' },
  condition: 'Tibial (Internal Popliteal) Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 40,
      summary: 'Complete paralysis - plantar flexion lost, toe flexion/separation abolished, cannot move sole muscles',
      criteria: ['Complete paralysis of tibial nerve', 'Plantar flexion lost', 'Frank adduction of foot impossible', 'Flexion and separation of toes abolished', 'No muscle in sole can move', 'In lesions high in popliteal fossa, plantar flexion of foot is lost'],
    },
    {
      percent: 30,
      summary: 'Severe incomplete paralysis',
      criteria: ['Severe incomplete paralysis', 'Significant plantar flexion weakness', 'Marked toe flexion weakness', 'Cannot walk on tiptoes', 'Significant sensory loss on sole'],
    },
    {
      percent: 20,
      summary: 'Moderate incomplete paralysis',
      criteria: ['Moderate incomplete paralysis', 'Noticeable calf weakness', 'Some plantar flexion weakness', 'Difficulty with tiptoe walking', 'Moderate sensory symptoms'],
    },
    {
      percent: 10,
      summary: 'Mild incomplete paralysis',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Burning or numbness in sole', 'Minor functional impact'],
    },
  ],
  note: 'The tibial nerve controls plantar flexion (calf muscles), toe flexion, and foot inversion. It provides sensation to the sole of the foot. High lesions in the popliteal fossa affect all tibial nerve functions.',
  definitions: {
    'tibial nerve': {
      term: 'Tibial Nerve',
      definition: 'Branch of sciatic nerve that controls the calf muscles (plantar flexion), toe flexors, and provides sensation to the sole of the foot.'
    },
    'plantar flexion': {
      term: 'Plantar Flexion',
      definition: 'Pointing the foot downward, as when standing on tiptoes. Controlled by the gastrocnemius and soleus muscles.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Tibial nerve ratings require neurological examination.',
};

// POSTERIOR TIBIAL NERVE - DC 8525/8625/8725
export const POSTERIOR_TIBIAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8525', neuritis: '8625', neuralgia: '8725' },
  condition: 'Posterior Tibial Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 30,
      summary: 'Complete paralysis - sole paralysis, often with painful paralysis of causalgic nature',
      criteria: ['Complete paralysis of posterior tibial nerve', 'Paralysis of all muscles of sole of foot', 'Frequently with painful paralysis of a causalgic nature', 'Toes cannot be flexed', 'Adduction is weakened', 'Plantar flexion is impaired'],
    },
    {
      percent: 20,
      summary: 'Severe incomplete paralysis',
      criteria: ['Severe incomplete paralysis', 'Significant sole muscle weakness', 'Marked toe flexion weakness', 'Significant sensory loss', 'May have causalgic pain'],
    },
    {
      percent: 10,
      summary: 'Moderate OR Mild incomplete paralysis',
      criteria: ['Moderate or mild incomplete paralysis', 'Some intrinsic foot weakness', 'Sensory symptoms on sole', 'Tarsal tunnel syndrome symptoms', 'Burning or numbness'],
    },
  ],
  note: 'The posterior tibial nerve passes through the tarsal tunnel at the ankle. It controls the intrinsic muscles of the sole and provides sensation to the sole. Tarsal tunnel syndrome is compression at this level. Causalgic (burning) pain is common with this nerve injury.',
  definitions: {
    'posterior tibial nerve': {
      term: 'Posterior Tibial Nerve',
      definition: 'Terminal branch of the tibial nerve that passes behind the medial malleolus through the tarsal tunnel, innervating intrinsic foot muscles and sole sensation.'
    },
    'tarsal tunnel syndrome': {
      term: 'Tarsal Tunnel Syndrome',
      definition: 'Compression of the posterior tibial nerve at the ankle causing burning pain, numbness, and tingling on the sole of the foot.'
    },
    'causalgia': {
      term: 'Causalgia',
      definition: 'Severe burning pain due to nerve injury, often accompanied by skin changes. Now termed Complex Regional Pain Syndrome Type II.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Posterior tibial nerve ratings require neurological examination.',
};

// FEMORAL (ANTERIOR CRURAL) NERVE - DC 8526/8626/8726
export const FEMORAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8526', neuritis: '8626', neuralgia: '8726' },
  condition: 'Femoral (Anterior Crural) Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 40,
      summary: 'Complete paralysis - quadriceps extensor muscles paralyzed',
      criteria: ['Complete paralysis of femoral nerve', 'Paralysis of quadriceps extensor muscles', 'Cannot extend knee', 'Knee buckling/giving way', 'Cannot climb stairs', 'Difficulty rising from seated position'],
    },
    {
      percent: 30,
      summary: 'Severe incomplete paralysis',
      criteria: ['Severe incomplete paralysis', 'Significant quadriceps weakness', 'Knee frequently gives way', 'Marked difficulty with stairs', 'Significant functional impairment'],
    },
    {
      percent: 20,
      summary: 'Moderate incomplete paralysis',
      criteria: ['Moderate incomplete paralysis', 'Noticeable quadriceps weakness', 'Some knee instability', 'Difficulty with stairs', 'Sensory loss on anterior thigh'],
    },
    {
      percent: 10,
      summary: 'Mild incomplete paralysis',
      criteria: ['Mild incomplete paralysis', 'Minimal weakness', 'Primarily sensory symptoms', 'Numbness on anterior thigh', 'Minor functional impact'],
    },
  ],
  note: 'The femoral nerve controls the quadriceps muscle (knee extension) and provides sensation to the anterior thigh and medial leg. Complete paralysis results in inability to extend the knee and frequent falls.',
  definitions: {
    'femoral nerve': {
      term: 'Femoral Nerve',
      definition: 'Major nerve of the anterior thigh arising from L2-L4, innervating the quadriceps (knee extension) and providing sensation to anterior thigh and medial leg via saphenous branch.'
    },
    'quadriceps': {
      term: 'Quadriceps Muscle',
      definition: 'Large four-headed muscle of the anterior thigh responsible for knee extension. Essential for walking, climbing stairs, and rising from sitting.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Femoral nerve ratings require neurological examination.',
};

// SAPHENOUS (INTERNAL SAPHENOUS) NERVE - DC 8527/8627/8727
export const SAPHENOUS_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8527', neuritis: '8627', neuralgia: '8727' },
  condition: 'Saphenous (Internal Saphenous) Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 10,
      summary: 'Severe to complete paralysis',
      criteria: ['Severe to complete involvement', 'Significant sensory loss along medial leg', 'Sensory loss from knee to medial ankle', 'No motor component (purely sensory nerve)'],
    },
    {
      percent: 0,
      summary: 'Mild to moderate involvement',
      criteria: ['Mild to moderate involvement', 'Some numbness along medial leg', 'Tingling or burning', 'Minor sensory symptoms'],
    },
  ],
  note: 'The saphenous nerve is a purely sensory branch of the femoral nerve. It has no motor function. It provides sensation to the medial leg from knee to ankle. Maximum rating is 10% even for complete involvement due to sensory-only function.',
  definitions: {
    'saphenous nerve': {
      term: 'Saphenous Nerve',
      definition: 'Purely sensory branch of the femoral nerve providing sensation to the medial leg from knee to ankle. Commonly injured during vein stripping or knee surgery.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Saphenous nerve ratings require sensory examination.',
};

// OBTURATOR NERVE - DC 8528/8628/8728
export const OBTURATOR_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8528', neuritis: '8628', neuralgia: '8728' },
  condition: 'Obturator Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 10,
      summary: 'Severe to complete paralysis',
      criteria: ['Severe to complete paralysis', 'Thigh adduction significantly weakened', 'Gait instability', 'Sensory loss on medial thigh'],
    },
    {
      percent: 0,
      summary: 'Mild to moderate involvement',
      criteria: ['Mild to moderate involvement', 'Some adduction weakness', 'Minor sensory symptoms', 'Minimal functional impact'],
    },
  ],
  note: 'The obturator nerve controls thigh adduction (bringing legs together) and provides sensation to the medial thigh. It is uncommonly injured in isolation. Maximum rating is 10% due to limited functional impact.',
  definitions: {
    'obturator nerve': {
      term: 'Obturator Nerve',
      definition: 'Nerve arising from L2-L4 that innervates the adductor muscles of the thigh and provides sensation to the medial thigh.'
    },
    'adduction': {
      term: 'Thigh Adduction',
      definition: 'Movement of the thigh toward the midline (bringing legs together). Controlled by the adductor muscles.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Obturator nerve ratings require neurological examination.',
};

// LATERAL FEMORAL CUTANEOUS NERVE (MERALGIA PARESTHETICA) - DC 8529/8629/8729
export const LATERAL_FEMORAL_CUTANEOUS_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8529', neuritis: '8629', neuralgia: '8729' },
  condition: 'Lateral Femoral Cutaneous Nerve (Meralgia Paresthetica)',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 10,
      summary: 'Severe to complete involvement',
      criteria: ['Severe to complete involvement', 'Significant numbness on lateral thigh', 'Burning pain (meralgia paresthetica)', 'Hypersensitivity to touch', 'Pain worse with standing/walking'],
    },
    {
      percent: 0,
      summary: 'Mild to moderate involvement',
      criteria: ['Mild to moderate involvement', 'Some numbness or tingling', 'Intermittent symptoms', 'Minor functional impact'],
    },
  ],
  note: 'The lateral femoral cutaneous nerve is purely sensory, providing sensation to the lateral thigh. Meralgia paresthetica is compression of this nerve at the inguinal ligament, causing burning pain and numbness on the outer thigh. Maximum rating is 10% due to sensory-only function.',
  definitions: {
    'lateral femoral cutaneous nerve': {
      term: 'Lateral Femoral Cutaneous Nerve',
      definition: 'Purely sensory nerve arising from L2-L3 that provides sensation to the lateral (outer) thigh.'
    },
    'meralgia paresthetica': {
      term: 'Meralgia Paresthetica',
      definition: 'Condition caused by compression of the lateral femoral cutaneous nerve, typically at the inguinal ligament, causing burning pain, numbness, and tingling on the outer thigh.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Lateral femoral cutaneous nerve ratings require sensory examination.',
};

// ILIO-INGUINAL NERVE - DC 8530/8630/8730
export const ILIOINGUINAL_NERVE_CRITERIA = {
  diagnosticCodes: { paralysis: '8530', neuritis: '8630', neuralgia: '8730' },
  condition: 'Ilio-inguinal Nerve Paralysis',
  cfrReference: '38 CFR 4.124a',
  bodyLocation: 'lower',
  ratings: [
    {
      percent: 10,
      summary: 'Severe to complete involvement',
      criteria: ['Severe to complete involvement', 'Significant groin/genital numbness', 'Pain in inguinal region', 'Hypersensitivity', 'Pain with movement or coughing'],
    },
    {
      percent: 0,
      summary: 'Mild to moderate involvement',
      criteria: ['Mild to moderate involvement', 'Some groin numbness', 'Intermittent symptoms', 'Minor functional impact'],
    },
  ],
  note: 'The ilio-inguinal nerve provides sensation to the groin, upper medial thigh, and genital area. It is commonly injured during inguinal hernia repair or other lower abdominal surgeries. Maximum rating is 10% due to sensory-only function.',
  definitions: {
    'ilio-inguinal nerve': {
      term: 'Ilio-inguinal Nerve',
      definition: 'Sensory nerve arising from L1 that provides sensation to the groin, upper medial thigh, and parts of the external genitalia.'
    },
  },
  disclaimer: 'This analysis is for documentation purposes only. Ilio-inguinal nerve ratings require sensory examination.',
};

// ============================================
// ANALYSIS FUNCTIONS - MIGRAINE
// ============================================

/**
 * Analyzes migraine logs to determine supported rating level
 */
export const analyzeMigraineLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
    includeWorkImpact = false,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && getLogSymptomId(log) === 'migraine';
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No migraine logs found in the evaluation period',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging migraines to build your evidence'],
    };
  }

  const totalMigraines = relevantLogs.length;
  const prostratingMigraines = relevantLogs.filter(
      log => log.migraineData?.prostrating === true);
  const prostratingCount = prostratingMigraines.length;

  const prolongedDurations = ['4-24h', '1-2d', 'more-than-2d', 'ongoing'];
  const prolongedMigraines = prostratingMigraines.filter(log =>
      prolongedDurations.includes(log.migraineData?.duration),
  );
  const prolongedCount = prolongedMigraines.length;

  const monthsInPeriod = evaluationPeriodDays / 30;
  const totalPerMonth = totalMigraines / monthsInPeriod;
  const prostratingPerMonth = prostratingCount / monthsInPeriod;
  const prolongedProstratingPerMonth = prolongedCount / monthsInPeriod;

  const oldestLog = relevantLogs.reduce((oldest, log) =>
      new Date(log.timestamp) < new Date(oldest.timestamp) ? log : oldest,
  );
  const newestLog = relevantLogs.reduce((newest, log) =>
      new Date(log.timestamp) > new Date(newest.timestamp) ? log : newest,
  );

  const evidence = {
    evaluationPeriod: {
      startDate: oldestLog.timestamp,
      endDate: newestLog.timestamp,
      days: evaluationPeriodDays,
      months: monthsInPeriod.toFixed(1),
    },
    totalMigraines,
    prostratingCount,
    prolongedCount,
    monthlyRates: {
      total: totalPerMonth.toFixed(1),
      prostrating: prostratingPerMonth.toFixed(1),
      prolongedProstrating: prolongedProstratingPerMonth.toFixed(1),
    },
    severityBreakdown: {
      prostrating: prostratingCount,
      nonProstrating: totalMigraines - prostratingCount,
      prolongedProstrating: prolongedCount,
    },
  };

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (prostratingPerMonth >= 4 && prolongedCount > 0) {
    supportedRating = 50;
    ratingRationale = [
      `${prostratingPerMonth.toFixed(
          1)} prostrating attacks per month (>=4 required)`,
      `${prolongedCount} prolonged attacks documented`,
      'Pattern suggests very frequent, prostrating, prolonged attacks',
    ];
    gaps = [
      'Consider documenting work impact (missed days, reduced productivity)',
      'Note any job accommodations needed due to migraines',
    ];
  } else if (prostratingPerMonth >= 1) {
    supportedRating = 30;
    ratingRationale = [
      `${prostratingPerMonth.toFixed(
          1)} prostrating attacks per month (>=1 required)`,
      'Pattern supports characteristic prostrating attacks averaging monthly',
    ];
    gaps = [];
    if (prolongedCount === 0) {
      gaps.push(
          'Document duration of attacks (4+ hours supports higher rating)');
    }
    if (prostratingPerMonth < 4) {
      gaps.push(`Current frequency (${prostratingPerMonth.toFixed(
          1)}/month) - 4+/month may support 50% rating`);
    }
  } else if (prostratingPerMonth >= 0.5) {
    supportedRating = 10;
    ratingRationale = [
      `${prostratingPerMonth.toFixed(1)} prostrating attacks per month`,
      'Pattern supports prostrating attacks averaging once every 2 months',
    ];
    gaps = [
      `Increase documentation frequency - 1+/month may support 30% rating`,
      'Ensure all prostrating episodes are logged',
    ];
  } else {
    supportedRating = 0;
    if (prostratingCount === 0 && totalMigraines > 0) {
      ratingRationale = [
        `${totalMigraines} migraines logged, but none marked as prostrating`,
        'Non-prostrating migraines support 0% rating',
      ];
      gaps = [
        'If migraines prevent normal activities, mark them as "prostrating"',
        'Document severity accurately - prostrating attacks are key to higher ratings',
      ];
    } else if (prostratingCount > 0) {
      ratingRationale = [
        `${prostratingPerMonth.toFixed(2)} prostrating attacks per month`,
        'Frequency below threshold for 10% (need >=0.5/month)',
      ];
      gaps = [
        'Continue logging all prostrating episodes',
        'Ensure you\'re capturing every migraine that prevents normal activities',
      ];
    } else {
      ratingRationale = ['Insufficient data to determine rating'];
      gaps = ['Begin logging migraine episodes with severity and duration'];
    }
  }

  return {
    hasData: true,
    condition: 'Migraine',
    diagnosticCode: '8100',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: MIGRAINE_CRITERIA,
    disclaimer: 'This analysis is for documentation guidance only. The VA makes all final rating determinations based on the complete evidence of record.',
  };
};


// ============================================
// ANALYSIS FUNCTIONS - SLEEP APNEA
// ============================================

/**
 * Analyzes sleep apnea logs to determine supported rating level
 * @param {Array} logs - All symptom logs
 * @param {Object} sleepApneaProfile - User's sleep apnea profile data
 * @param {Object} options - Analysis options
 */
export const analyzeSleepApneaLogs = (
    logs, sleepApneaProfile = {}, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  // Extract profile data (would come from a separate sleep apnea settings area)
  const {
    usesBreathingDevice = null,  // true/false/null (unknown)
    deviceType = null,           // 'cpap', 'bipap', 'apap', 'inspire', 'other'
    hasDiagnosis = null,         // true/false/null
    diagnosisDate = null,
  } = sleepApneaProfile;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Find sleep-related logs
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const isSleepRelated = getLogSymptomId(log) === 'sleep-issues' ||
        getLogSymptomId(log) === 'sleep-apnea' ||
        log.sleepData;
    return logDate >= cutoffDate && isSleepRelated;
  });

  // Analyze daytime sleepiness from logs
  const sleepinessLogs = relevantLogs.filter(log => {
    // Look for indicators of daytime sleepiness
    return log.sleepData?.feelRested === false ||
        log.sleepData?.quality <= 3 ||
        (log.notes && log.notes.toLowerCase().includes('tired')) ||
        (log.notes && log.notes.toLowerCase().includes('sleepy')) ||
        (log.notes && log.notes.toLowerCase().includes('fatigue'));
  });

  // Calculate metrics
  const totalSleepLogs = relevantLogs.length;
  const daytimeSleepinessCount = sleepinessLogs.length;
  const monthsInPeriod = evaluationPeriodDays / 30;

  // Average sleep quality if available
  const logsWithQuality = relevantLogs.filter(log => log.sleepData?.quality);
  const avgSleepQuality = logsWithQuality.length > 0
      ?
      logsWithQuality.reduce((sum, log) => sum + log.sleepData.quality, 0) /
      logsWithQuality.length
      :
      null;

  // Count nights feeling unrested
  const unrestedNights = relevantLogs.filter(
      log => log.sleepData?.feelRested === false).length;

  // Average hours slept
  const logsWithHours = relevantLogs.filter(log => log.sleepData?.hoursSlept);
  const avgHoursSlept = logsWithHours.length > 0
      ?
      logsWithHours.reduce(
          (sum, log) => sum + parseFloat(log.sleepData.hoursSlept), 0) /
      logsWithHours.length
      :
      null;

  // Build evidence summary
  const evidence = {
    evaluationPeriod: {
      days: evaluationPeriodDays,
      months: monthsInPeriod.toFixed(1),
    },
    profile: {
      usesBreathingDevice,
      deviceType,
      hasDiagnosis,
    },
    sleepLogs: {
      total: totalSleepLogs,
      withDaytimeSleepiness: daytimeSleepinessCount,
      unrestedNights,
      avgSleepQuality: avgSleepQuality ? avgSleepQuality.toFixed(1) : null,
      avgHoursSlept: avgHoursSlept ? avgHoursSlept.toFixed(1) : null,
    },
  };

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];
  let requiresProfileSetup = false;

  // Determine rating based on profile and logs
  if (usesBreathingDevice === null) {
    // Profile not set up - need to collect this info
    requiresProfileSetup = true;
    supportedRating = null;
    ratingRationale = [
      'Sleep apnea profile not configured',
      'Need to know if you use a CPAP or other breathing device',
    ];
    gaps = [
      'Set up your Sleep Apnea profile in Settings',
      'Indicate whether you use a CPAP, BiPAP, or other breathing device',
      'Upload or note your sleep study diagnosis date',
    ];
  } else if (usesBreathingDevice === true) {
    // Uses breathing device = 50%
    supportedRating = 50;
    ratingRationale = [
      `Uses breathing assistance device (${deviceType || 'CPAP/BiPAP'})`,
      'Meets criteria for 50% rating under DC 6847',
    ];
    gaps = [
      'Maintain records of device compliance (usage data)',
      'Keep prescription and sleep study on file',
      'Document any issues or adjustments to treatment',
    ];

    // Note: 100% would require respiratory failure/tracheostomy - rare
    if (totalSleepLogs > 0) {
      ratingRationale.push(
          `${totalSleepLogs} sleep logs documented in evaluation period`);
    }
  } else if (usesBreathingDevice === false && hasDiagnosis === true) {
    // Has diagnosis but no device - check for daytime sleepiness
    const sleepinessRatio = totalSleepLogs > 0 ?
        daytimeSleepinessCount / totalSleepLogs :
        0;

    if (sleepinessRatio >= 0.5 || unrestedNights >= 10) {
      // Persistent daytime hypersomnolence = 30%
      supportedRating = 30;
      ratingRationale = [
        'Diagnosed sleep apnea without breathing device',
        `${unrestedNights} nights feeling unrested logged`,
        `${(sleepinessRatio * 100).toFixed(
            0)}% of logs indicate daytime sleepiness`,
        'Pattern suggests persistent daytime hypersomnolence',
      ];
      gaps = [
        'Continue documenting daytime sleepiness and fatigue',
        'Note impact on work and daily activities',
        'If sleepiness is severe, discuss CPAP with your doctor (would support 50%)',
      ];
    } else if (totalSleepLogs === 0) {
      supportedRating = 0;
      ratingRationale = [
        'Diagnosed sleep apnea',
        'No sleep logs in evaluation period',
        'Cannot assess daytime sleepiness without logged data',
      ];
      gaps = [
        'Start logging sleep quality and daytime sleepiness',
        'Document nights where you wake feeling unrested',
        'Note any daytime fatigue or difficulty staying awake',
      ];
    } else {
      // Asymptomatic or mild symptoms = 0%
      supportedRating = 0;
      ratingRationale = [
        'Diagnosed sleep apnea without breathing device',
        `${totalSleepLogs} sleep logs, but insufficient daytime sleepiness documented`,
        'Current evidence supports 0% (asymptomatic with documented diagnosis)',
      ];
      gaps = [
        'If you experience daytime sleepiness, document it consistently',
        'Log when you feel unrested after sleeping',
        'Consider whether a CPAP/BiPAP might be beneficial (would support 50%)',
      ];
    }
  } else {
    // No diagnosis or incomplete information
    supportedRating = null;
    requiresProfileSetup = true;
    ratingRationale = [
      'Insufficient profile information',
    ];
    gaps = [
      'Confirm whether you have a sleep apnea diagnosis',
      'If diagnosed, indicate whether you use a breathing device',
      'Obtain a sleep study if you suspect sleep apnea',
    ];
  }

  return {
    hasData: totalSleepLogs > 0 || usesBreathingDevice !== null,
    requiresProfileSetup,
    condition: 'Sleep Apnea',
    diagnosticCode: '6847',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: SLEEP_APNEA_CRITERIA,
    disclaimer: 'This analysis is for documentation guidance only. The VA makes all final rating determinations based on the complete evidence of record, including sleep studies and medical examinations.',
  };
};

// ============================================
// ANALYSIS FUNCTIONS - PTSD
// ============================================

// ============================================
// ANALYSIS FUNCTIONS - SHARED MENTAL HEALTH
// ============================================

/**
 * Shared analysis function for all mental health conditions
 * All mental health DCs (9201-9440) use the General Rating Formula
 *
 * @param {Array} logs - All symptom logs
 * @param {string} conditionId - Condition ID from CONDITIONS
 * @param {Array} symptomIds - Array of symptom IDs to filter for
 * @param {Object} conditionCriteria - The criteria object for this condition
 * @param {Object} options - Analysis options
 */
const analyzeMentalHealthCondition = (
    logs, conditionId, symptomIds, conditionCriteria, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter for condition-specific symptoms
  // Use helper function for backward compatibility with both log.symptomId and log.symptom
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: `No ${conditionCriteria.condition} symptom logs found in the evaluation period`,
      supportedRating: null,
      evidence: [],
      gaps: [
        `Start logging ${conditionCriteria.condition} symptoms`,
        'Include notes about how symptoms affect work and relationships',
        'Document treatment and medication if applicable',
      ],
      // Empty metrics for consistency
      metrics: {
        totalLogs: 0,
        avgSeverity: 0,
        severeSymptoms: 0,
        hospitalized: false,
        hospitalizationCount: 0,
        dangerToSelf: false,
        dangerToOthers: false,
      },
    };
  }

  // Count by symptom type
  const symptomCounts = {};
  symptomIds.forEach(id => {
    symptomCounts[id] = relevantLogs.filter(l => getLogSymptomId(l) === id).length;
  });

  const totalSymptoms = relevantLogs.length;
  const monthsInPeriod = evaluationPeriodDays / 30;
  const symptomsPerMonth = totalSymptoms / monthsInPeriod;

  // Calculate weekly panic attack frequency (key criterion for 50%)
  const weeksInPeriod = evaluationPeriodDays / 7;
  const panicSymptomIds = symptomIds.filter(id =>
      id.includes('panic') || id === 'ptsd-panic' || id === 'panic-attack',
  );
  const panicCount = relevantLogs.filter(
      l => panicSymptomIds.includes(getLogSymptomId(l))).length;
  const panicPerWeek = panicCount / weeksInPeriod;

  // Count unique symptom types present
  const symptomTypesPresent = Object.entries(symptomCounts).
      filter(([_, count]) => count > 0).
      map(([type, _]) => type);

  // Find oldest and newest logs
  const oldestLog = relevantLogs.reduce((oldest, log) =>
      new Date(log.timestamp) < new Date(oldest.timestamp) ? log : oldest,
  );
  const newestLog = relevantLogs.reduce((newest, log) =>
      new Date(log.timestamp) > new Date(newest.timestamp) ? log : newest,
  );

  // Analyze notes for functional impact keywords
  const impactKeywords = {
    work: [
      'work',
      'job',
      'employment',
      'productivity',
      'performance',
      'absent',
      'late',
      'called off'],
    social: [
      'relationship',
      'family',
      'friends',
      'isolated',
      'alone',
      'avoiding',
      'social'],
    daily: ['shower', 'hygiene', 'eat', 'sleep', 'basic', 'daily', 'routine'],
    severe: [
      'suicidal',
      'hospital',
      'emergency',
      'crisis',
      'violent',
      'dangerous'],
  };

  const notesAnalysis = {
    workImpact: 0,
    socialImpact: 0,
    dailyImpact: 0,
    severeSymptoms: 0,
  };

  relevantLogs.forEach(log => {
    const notes = (log.notes || '').toLowerCase();
    if (impactKeywords.work.some(
        kw => notes.includes(kw))) notesAnalysis.workImpact++;
    if (impactKeywords.social.some(
        kw => notes.includes(kw))) notesAnalysis.socialImpact++;
    if (impactKeywords.daily.some(
        kw => notes.includes(kw))) notesAnalysis.dailyImpact++;
    if (impactKeywords.severe.some(
        kw => notes.includes(kw))) notesAnalysis.severeSymptoms++;
  });

  const evidence = {
    evaluationPeriod: {
      startDate: oldestLog.timestamp,
      endDate: newestLog.timestamp,
      days: evaluationPeriodDays,
      months: monthsInPeriod.toFixed(1),
    },
    totalSymptoms,
    symptomsPerMonth: symptomsPerMonth.toFixed(1),
    symptomBreakdown: symptomCounts,
    symptomTypesPresent,
    panicAttacks: {
      total: panicCount,
      perWeek: panicPerWeek.toFixed(1),
    },
    functionalImpact: notesAnalysis,
  };

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];
  let assessmentLevel = 'preliminary';

  // IMPORTANT: Mental health ratings require professional evaluation
  // Symptom logs alone cannot determine ratings. This is guidance only.

  // Check for indicators of severe functional impairment
  if (notesAnalysis.severeSymptoms > 0) {
    supportedRating = '70-100';
    assessmentLevel = 'requires-professional-evaluation';
    ratingRationale = [
      'Logged symptoms indicate severe impairment requiring immediate professional evaluation',
      'Notes reference crisis-level symptoms',
      'CRITICAL: If experiencing suicidal thoughts, call Veterans Crisis Line: 988 then Press 1',
    ];
    gaps = [
      'Seek immediate mental health treatment',
      'Document all treatment and hospitalizations',
      'Request comprehensive functional assessment from mental health provider',
    ];
  }
  // Check for indicators suggesting 50-70% range
  else if (
      panicPerWeek > 1 ||
      (symptomsPerMonth > 12 && symptomTypesPresent.length >= 3) ||
      (notesAnalysis.workImpact > 5 && notesAnalysis.socialImpact > 5)
  ) {
    supportedRating = '50-70';
    assessmentLevel = 'requires-professional-evaluation';
    ratingRationale = [
      `${totalSymptoms} symptoms logged over ${monthsInPeriod.toFixed(
          1)} months`,
      panicPerWeek > 1 ?
          `Panic attacks: ${panicPerWeek.toFixed(
              1)} per week (>1/week supports 50%+)` :
          '',
      symptomTypesPresent.length >= 3 ? `Multiple symptom types present` : '',
      notesAnalysis.workImpact > 5 ?
          `${notesAnalysis.workImpact} logs mention work impact` :
          '',
      notesAnalysis.socialImpact > 5 ?
          `${notesAnalysis.socialImpact} logs mention social/relationship impact` :
          '',
      'Pattern suggests significant functional impairment',
    ].filter(Boolean);
    gaps = [
      'Professional evaluation required to assess functional impairment level',
      'Document specific work difficulties (attendance, productivity, relationships)',
      'Document social/relationship difficulties',
      'Maintain continuous mental health treatment records',
      'Request detailed statement from mental health provider about functional limitations',
    ];
  }
  // Check for indicators suggesting 30% range
  else if (
      (panicPerWeek >= 0.25 && panicPerWeek <= 1) ||
      (symptomsPerMonth >= 4 && symptomTypesPresent.length >= 2) ||
      (notesAnalysis.workImpact >= 2 || notesAnalysis.socialImpact >= 2)
  ) {
    supportedRating = '30';
    ratingRationale = [
      `${totalSymptoms} symptoms logged over ${monthsInPeriod.toFixed(
          1)} months`,
      panicPerWeek >= 0.25 ?
          `Panic-related symptoms: ${panicPerWeek.toFixed(
              1)} per week (weekly or less)` :
          '',
      `${symptomTypesPresent.length} symptom types documented`,
      'Pattern suggests occasional decrease in work efficiency',
    ].filter(Boolean);
    gaps = [
      'Continue documenting all symptoms consistently',
      'Include specific details about functional impact in notes',
      'Document any work accommodations or difficulties',
      'Maintain regular mental health treatment',
      'Request provider statement on functional limitations',
    ];
  }
  // Check for indicators suggesting 10% range
  else if (totalSymptoms >= 3 || symptomTypesPresent.length >= 1) {
    supportedRating = '10';
    ratingRationale = [
      `${totalSymptoms} symptoms logged over ${monthsInPeriod.toFixed(
          1)} months`,
      `Symptom types present: ${symptomTypesPresent.length}`,
      'Current evidence suggests mild or controlled symptoms',
    ];
    gaps = [
      `Ensure you have formal ${conditionCriteria.condition} diagnosis documentation`,
      'Document all treatment and medication',
      'If symptoms worsen, log them immediately with functional impact details',
      'Include notes about work or social impact when relevant',
    ];
  } else {
    supportedRating = '0-10';
    ratingRationale = [
      `${totalSymptoms} symptoms logged - limited evidence of ongoing symptoms`,
      'Formal diagnosis documentation required',
    ];
    gaps = [
      `Obtain formal ${conditionCriteria.condition} diagnosis from qualified mental health provider`,
      'Document all symptoms, even if mild',
      'Include treatment/medication records',
      'Log symptoms consistently to establish pattern',
    ];
  }

  // ===== CALCULATE METRICS FOR RATING CARD DISPLAY =====
  // Count logs with severity 8+ as severe episodes
  const severeSymptoms = relevantLogs.filter(log => log.severity >= 8).length;

  // Calculate average severity
  const logsWithSeverity = relevantLogs.filter(log => log.severity && log.severity > 0);
  const avgSeverity = logsWithSeverity.length > 0
    ? logsWithSeverity.reduce((sum, log) => sum + log.severity, 0) / logsWithSeverity.length
    : 0;

  // Check for hospitalization indicators
  const hospitalizationLogs = relevantLogs.filter(log => {
    const notes = (log.notes || '').toLowerCase();
    return notes.includes('hospital') || notes.includes('inpatient') || notes.includes('admitted');
  });
  const hospitalized = hospitalizationLogs.length > 0;
  const hospitalizationCount = hospitalizationLogs.length;

  // Check for danger indicators
  const dangerToSelf = relevantLogs.some(log => {
    const notes = (log.notes || '').toLowerCase();
    return notes.includes('suicidal') || notes.includes('self-harm') || notes.includes('danger to self');
  });
  const dangerToOthers = relevantLogs.some(log => {
    const notes = (log.notes || '').toLowerCase();
    return notes.includes('homicidal') || notes.includes('danger to others') || notes.includes('violent');
  });

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    assessmentLevel,
    evidence,
    gaps,
    criteria: conditionCriteria,
    // Metrics for rating card display
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity,
      severeSymptoms,
      hospitalized,
      hospitalizationCount,
      dangerToSelf,
      dangerToOthers,
    },
    disclaimer: 'CRITICAL DISCLAIMER: Mental health ratings are based on professional evaluation of functional impairment in work and social settings, not symptom frequency alone. This analysis helps you understand what your documentation might support, but a comprehensive mental health evaluation is required for any rating determination. All mental health concerns should be discussed with a qualified provider.',
    crisisResources: {
      veteransCrisisLine: '988 then Press 1',
      text: '838255',
      chat: 'https://www.veteranscrisisline.net/get-help-now/chat/',
    },
  };
};

// ============================================
// ANALYSIS FUNCTIONS - SPECIFIC MENTAL HEALTH CONDITIONS
// ============================================

/**
 * Analyzes PTSD symptom logs
 */
export const analyzePTSDLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'ptsd',
      CONDITIONS.PTSD.symptomIds,
      PTSD_CRITERIA,
      options,
  );
};

/**
 * Analyzes Major Depression symptom logs
 */
export const analyzeMajorDepressionLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'major-depression',
      CONDITIONS.MAJOR_DEPRESSION.symptomIds,
      MAJOR_DEPRESSION_CRITERIA,
      options,
  );
};

/**
 * Analyzes Generalized Anxiety Disorder symptom logs
 */
export const analyzeGeneralizedAnxietyLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'generalized-anxiety',
      CONDITIONS.GENERALIZED_ANXIETY.symptomIds,
      GENERALIZED_ANXIETY_CRITERIA,
      options,
  );
};

/**
 * Analyzes Panic Disorder symptom logs
 */
export const analyzePanicDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'panic-disorder',
      CONDITIONS.PANIC_DISORDER.symptomIds,
      PANIC_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Bipolar Disorder symptom logs
 */
export const analyzeBipolarLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'bipolar',
      CONDITIONS.BIPOLAR.symptomIds,
      BIPOLAR_CRITERIA,
      options,
  );
};

/**
 * Analyzes Social Anxiety Disorder symptom logs
 */
export const analyzeSocialAnxietyLogs = (logs, options = {}) => {
    return analyzeMentalHealthCondition(
        logs,
        'social-anxiety',
        CONDITIONS.SOCIAL_ANXIETY.symptomIds,
        SOCIAL_ANXIETY_CRITERIA,
        options,
    );
};

/**
 * Analyzes OCD symptom logs
 */
export const analyzeOCDLogs = (logs, options = {}) => {
    return analyzeMentalHealthCondition(
        logs,
        'ocd',
        CONDITIONS.OCD.symptomIds,
        OCD_CRITERIA,
        options,
    );
};

/**
 * Analyzes Persistent Depressive Disorder (Dysthymia) symptom logs
 */
export const analyzePersistentDepressiveLogs = (logs, options = {}) => {
    return analyzeMentalHealthCondition(
        logs,
        'persistent-depressive',
        CONDITIONS.PERSISTENT_DEPRESSIVE.symptomIds,
        PERSISTENT_DEPRESSIVE_CRITERIA,
        options,
    );
};

/**
 * Analyzes Chronic Adjustment Disorder symptom logs
 */
export const analyzeAdjustmentDisorderLogs = (logs, options = {}) => {
    return analyzeMentalHealthCondition(
        logs,
        'adjustment-disorder',
        CONDITIONS.ADJUSTMENT_DISORDER.symptomIds,
        ADJUSTMENT_DISORDER_CRITERIA,
        options,
    );
};

/**
 * Analyzes Unspecified Anxiety Disorder symptom logs
 */
export const analyzeUnspecifiedAnxietyLogs = (logs, options = {}) => {
    return analyzeMentalHealthCondition(
        logs,
        'unspecified-anxiety',
        CONDITIONS.UNSPECIFIED_ANXIETY.symptomIds,
        UNSPECIFIED_ANXIETY_CRITERIA,
        options,
    );
};

/**
 * Analyzes Unspecified Depressive Disorder symptom logs
 */
export const analyzeUnspecifiedDepressiveLogs = (logs, options = {}) => {
    return analyzeMentalHealthCondition(
        logs,
        'unspecified-depressive',
        CONDITIONS.UNSPECIFIED_DEPRESSIVE.symptomIds,
        UNSPECIFIED_DEPRESSIVE_CRITERIA,
        options,
    );
};


// ============================================
// ANALYSIS FUNCTIONS - MUSCULOSKELETAL CONDITIONS
// ============================================

/**
 * Analyzes Lumbosacral Strain (Low Back Pain) logs
 * NOTE: This requires clinical ROM measurements - symptom logging alone cannot determine rating
 */
export const analyzeLumbosacralStrainLogs = (logs, options = {}) => {
  const conditionCriteria = LUMBOSACRAL_STRAIN_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.LUMBOSACRAL_STRAIN.symptomIds;

  // Filter logs for back-related symptoms
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No back pain symptoms logged in evaluation period',
    };
  }

  // Count symptoms
  const totalSymptoms = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 0), 0) / totalSymptoms;
  const severeSymptoms = relevantLogs.filter(log => (log.severity || 0) >= 4).length;
  const symptomTypesPresent = [...new Set(relevantLogs.map(log => getLogSymptomId(log)))].length;

  // Check for indicators of functional impact
  const hasRadicularPain = relevantLogs.some(log => getLogSymptomId(log) === 'back-radicular' || getLogSymptomId(log) === 'back-numbness');
  const hasMuscleSpasm = relevantLogs.some(log => getLogSymptomId(log) === 'back-spasm');
  const hasStiffness = relevantLogs.some(log => getLogSymptomId(log) === 'back-stiffness');

  // Evidence collected
  const evidence = [
    `${totalSymptoms} back pain symptoms logged over ${(evaluationPeriodDays / 30).toFixed(1)} months`,
    `Average severity: ${avgSeverity.toFixed(1)}/5`,
    `${severeSymptoms} severe symptoms (severity 4-5)`,
    `Symptom types documented: ${symptomTypesPresent}`,
  ];

  if (hasRadicularPain) evidence.push('Radiating pain/numbness documented');
  if (hasMuscleSpasm) evidence.push('Muscle spasm episodes documented');
  if (hasStiffness) evidence.push('Back stiffness documented');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: 'Requires Clinical Measurement',
    ratingRationale: [
      'Back pain conditions require Range of Motion (ROM) measurements by a healthcare provider',
      'Symptom logs document pain patterns but cannot determine ROM limitations',
      'Your symptom documentation shows ongoing back pain that warrants clinical evaluation',
    ],
    assessmentLevel: 'Clinical Evaluation Required',
    evidence,
    gaps: [
      'CRITICAL: Schedule ROM evaluation with healthcare provider using goniometer',
      'Request formal documentation of forward flexion measurements',
      'Document any abnormal gait or spinal contour observed by provider',
      'Get imaging if not already done (X-ray, MRI)',
      'Document functional limitations: difficulty bending, lifting, walking',
    ],
    criteria: conditionCriteria,
    disclaimer: 'Musculoskeletal conditions require objective Range of Motion measurements performed by a healthcare provider. Your symptom documentation helps establish the pattern and severity of pain, but clinical examination is essential for rating determination.',
  };
};

/**
 * Analyzes Intervertebral Disc Syndrome logs
 * NOTE: This requires documentation of incapacitating episodes OR ROM measurements
 */
export const analyzeIntervertebralDiscLogs = (logs, options = {}) => {
  const conditionCriteria = INTERVERTEBRAL_DISC_CRITERIA;
  const evaluationPeriodDays = options.days || 365; // Use full year for episode tracking
  const symptomIds = CONDITIONS.INTERVERTEBRAL_DISC.symptomIds;

  // Filter relevant logs
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No disc-related symptoms logged in evaluation period',
    };
  }

  const totalSymptoms = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 0), 0) / totalSymptoms;
  const severeSymptoms = relevantLogs.filter(log => (log.severity || 0) >= 4).length;

  const hasDiscPain = relevantLogs.some(log => getLogSymptomId(log) === 'disc-pain');
  const hasRadicularPain = relevantLogs.some(log => getLogSymptomId(log) === 'back-radicular' || getLogSymptomId(log) === 'back-numbness');

  const evidence = [
    `${totalSymptoms} disc-related symptoms logged over ${(evaluationPeriodDays / 30).toFixed(1)} months`,
    `Average severity: ${avgSeverity.toFixed(1)}/5`,
    `${severeSymptoms} severe symptoms`,
  ];

  if (hasDiscPain) evidence.push('Disc pain specifically documented');
  if (hasRadicularPain) evidence.push('Nerve compression symptoms (radiating pain/numbness)');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: 'Requires Clinical Documentation',
    ratingRationale: [
      'Disc syndrome can be rated TWO ways: (1) Based on incapacitating episodes, OR (2) Based on ROM measurements',
      'Your symptom logs show ongoing disc-related pain',
      'To use incapacitating episodes method, you need physician-prescribed bed rest for each episode',
    ],
    assessmentLevel: 'Clinical Evaluation Required',
    evidence,
    gaps: [
      'CRITICAL: DC 5243 requires confirmed disc herniation with nerve root compression (MRI/CT)',
      'For incapacitating episodes rating: Each episode must have BOTH:',
      '  - Physician prescription for bed rest during episode',
      '  - Treatment by physician during episode',
      'Track total DURATION of incapacitating episodes over 12 months',
      'Alternative: Get ROM measurements for rating under General Formula',
      'Document functional limitations and impact on daily activities',
    ],
    criteria: conditionCriteria,
    disclaimer: 'Disc syndrome diagnosis requires imaging confirmation and can only be rated 5243 when there is disc herniation with nerve root compression/irritation. Otherwise, use DC 5242 for degenerative disc disease. Rating requires either documented incapacitating episodes OR clinical ROM measurements.',
  };
};

/**
 * Analyzes Knee Instability logs
 */
export const analyzeKneeInstabilityLogs = (logs, options = {}) => {
  const conditionCriteria = KNEE_INSTABILITY_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.KNEE_INSTABILITY.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No knee symptoms logged in evaluation period',
    };
  }

  const totalSymptoms = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 0), 0) / totalSymptoms;
  const instabilityEvents = relevantLogs.filter(log => getLogSymptomId(log) === 'knee-instability' || getLogSymptomId(log) === 'knee-locking').length;
  const severeSymptoms = relevantLogs.filter(log => (log.severity || 0) >= 4).length;

  const hasGivingWay = relevantLogs.some(log => getLogSymptomId(log) === 'knee-instability');
  const hasSwelling = relevantLogs.some(log => getLogSymptomId(log) === 'knee-swelling');
  const hasLocking = relevantLogs.some(log => getLogSymptomId(log) === 'knee-locking');

  const evidence = [
    `${totalSymptoms} knee symptoms logged over ${(evaluationPeriodDays / 30).toFixed(1)} months`,
    `${instabilityEvents} instability/locking events documented`,
    `Average severity: ${avgSeverity.toFixed(1)}/5`,
  ];

  if (hasGivingWay) evidence.push('Knee giving way/instability documented');
  if (hasSwelling) evidence.push('Knee swelling documented');
  if (hasLocking) evidence.push('Knee locking/catching documented');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: 'Requires Clinical Documentation',
    ratingRationale: [
      'Knee instability ratings depend on ligament injury status and prescribed assistive devices',
      'Your symptom logs document ongoing knee instability',
      'Rating determination requires medical documentation of ligament status',
    ],
    assessmentLevel: 'Clinical Evaluation Required',
    evidence,
    gaps: [
      'Get MRI or surgical records confirming ligament injury type (complete vs incomplete tear)',
      'Document repair status (unrepaired, repaired, or failed repair)',
      'If using assistive devices (cane, crutches, walker) or knee brace, get written prescription',
      'Clinical examination documenting instability tests (Lachman, drawer, pivot shift)',
      'Document functional limitations: stairs, squatting, walking on uneven ground',
      'Track frequency of giving-way episodes',
    ],
    criteria: conditionCriteria,
    disclaimer: 'Knee instability ratings require documentation of ligament injury status and whether medical providers have prescribed braces or assistive devices. Your symptom documentation establishes the ongoing nature of instability.',
  };
};

/**
 * Analyzes TBI cognitive symptom logs
 * NOTE: TBI ratings require comprehensive neuropsychological evaluation
 */
export const analyzeTBILogs = (logs, options = {}) => {
  const conditionCriteria = TBI_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.TBI.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No TBI-related cognitive symptoms logged in evaluation period',
    };
  }

  const totalSymptoms = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 0), 0) / totalSymptoms;
  const severeSymptoms = relevantLogs.filter(log => (log.severity || 0) >= 4).length;
  const symptomTypesPresent = [...new Set(relevantLogs.map(log => getLogSymptomId(log)))].length;

  const hasMemoryIssues = relevantLogs.some(log => getLogSymptomId(log) === 'tbi-memory');
  const hasConcentrationIssues = relevantLogs.some(log => getLogSymptomId(log) === 'tbi-concentration');
  const hasConfusion = relevantLogs.some(log => getLogSymptomId(log) === 'tbi-confusion');
  const hasMoodChanges = relevantLogs.some(log => getLogSymptomId(log) === 'tbi-mood');

  const evidence = [
    `${totalSymptoms} TBI-related cognitive symptoms logged over ${(evaluationPeriodDays / 30).toFixed(1)} months`,
    `Symptom types: ${symptomTypesPresent} different cognitive areas affected`,
    `Average severity: ${avgSeverity.toFixed(1)}/5`,
    `${severeSymptoms} severe symptoms documented`,
  ];

  if (hasMemoryIssues) evidence.push('Memory problems documented');
  if (hasConcentrationIssues) evidence.push('Concentration difficulties documented');
  if (hasConfusion) evidence.push('Confusion/disorientation documented');
  if (hasMoodChanges) evidence.push('Mood changes documented');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: 'Requires Neuropsychological Evaluation',
    ratingRationale: [
      'TBI is rated using a complex 10-facet system requiring professional evaluation',
      'Your symptom logs document ongoing cognitive difficulties',
      'Neuropsychological testing is essential to assess the level of impairment in each facet',
    ],
    assessmentLevel: 'Comprehensive Evaluation Required',
    evidence,
    gaps: [
      'CRITICAL: Request comprehensive neuropsychological evaluation',
      'Document TBI diagnosis and mechanism of injury',
      'Get functional capacity evaluation',
      'Document impact on: work, school, family relationships, self-care',
      'Track specific examples of cognitive difficulties in daily life',
      'Note: If you have a diagnosed mental health condition from TBI (depression, anxiety), rate that separately under DC 9434, 9400, etc.',
      'If you have physical symptoms (headaches, dizziness), consider rating under migraine (8100) or peripheral vestibular disorder (6204)',
    ],
    criteria: conditionCriteria,
    disclaimer: 'TBI involves complex multi-facet evaluation. Ratings are based on comprehensive neuropsychological testing, not symptom frequency alone. Your documentation helps establish pattern and impact, but professional cognitive assessment is required for rating. TBI may also cause mental health and physical conditions that should be rated separately.',
  };
};

/**
 * Analyze Hypertension logs and BP measurements for VA rating
 * DC 7101 - Hypertension
 *
 * This updated version uses actual blood pressure measurements instead of symptoms
 */
export const analyzeHypertensionLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  // Get blood pressure measurements (not symptom logs)
  const bpMeasurements = getMeasurements({
    type: 'blood-pressure',
    days: evaluationPeriodDays
  });

  // Also get symptom logs for additional context
  const hypertensionSymptoms = logs.filter(log =>
      CONDITIONS.HYPERTENSION.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  const hasData = bpMeasurements.length > 0 || hypertensionSymptoms.length > 0;

  if (!hasData) {
    return {
      condition: 'Hypertension',
      diagnosticCode: '7101',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No blood pressure measurements logged',
        'Log BP readings regularly to establish pattern',
        'Need readings on at least 3 different days',
        'VA requires "predominantly" (>50%) of readings at threshold',
      ],
      criteria: HYPERTENSION_CRITERIA,
      disclaimer: HYPERTENSION_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // ==================================================================
  // PRIMARY ANALYSIS: Blood Pressure Measurements
  // ==================================================================

  if (bpMeasurements.length > 0) {
    // Calculate average BP
    const avgBP = getAverageBloodPressure(evaluationPeriodDays);
    evidence.push(`${bpMeasurements.length} blood pressure readings over ${evaluationPeriodDays} days`);
    evidence.push(`Average BP: ${avgBP.systolic}/${avgBP.diastolic} mmHg`);

    // Check minimum reading requirement
    if (bpMeasurements.length < 3) {
      gaps.push('Need BP readings on at least 3 different days for reliable analysis');
    }

    // Analyze for each VA rating level (check highest first)

    // 60%: Diastolic predominantly 130 or more
    const diastolic130 = analyzeBloodPressurePredominance(evaluationPeriodDays, { diastolic: 130 });
    if (diastolic130.isPredominant) {
      supportedRating = '60';
      ratingRationale.push(
          `${diastolic130.percentage}% of readings show diastolic >=130 mmHg`,
          `Meets "predominantly" threshold (>50% required)`,
          `${diastolic130.qualifyingReadings} of ${diastolic130.totalReadings} readings qualify`
      );
      evidence.push(`${diastolic130.qualifyingReadings} readings with diastolic >=130`);
    }

    // 40%: Diastolic predominantly 120 or more
    else {
      const diastolic120 = analyzeBloodPressurePredominance(evaluationPeriodDays, { diastolic: 120 });
      if (diastolic120.isPredominant) {
        supportedRating = '40';
        ratingRationale.push(
            `${diastolic120.percentage}% of readings show diastolic >=120 mmHg`,
            `Meets "predominantly" threshold (>50% required)`,
            `${diastolic120.qualifyingReadings} of ${diastolic120.totalReadings} readings qualify`
        );
        evidence.push(`${diastolic120.qualifyingReadings} readings with diastolic >=120`);

        // Check if close to 60%
        if (diastolic130.percentage >= 40) {
          gaps.push(`${diastolic130.percentage}% of readings at 130+ (need >50% for 60% rating)`);
        }
      }

      // 20%: Diastolic predominantly 110 or systolic predominantly 200
      else {
        const diastolic110 = analyzeBloodPressurePredominance(evaluationPeriodDays, { diastolic: 110 });
        const systolic200 = analyzeBloodPressurePredominance(evaluationPeriodDays, { systolic: 200 });

        if (diastolic110.isPredominant || systolic200.isPredominant) {
          supportedRating = '20';
          if (diastolic110.isPredominant) {
            ratingRationale.push(
                `${diastolic110.percentage}% of readings show diastolic >=110 mmHg`,
                `Meets "predominantly" threshold (>50% required)`,
                `${diastolic110.qualifyingReadings} of ${diastolic110.totalReadings} readings qualify`
            );
            evidence.push(`${diastolic110.qualifyingReadings} readings with diastolic >=110`);
          }
          if (systolic200.isPredominant) {
            ratingRationale.push(
                `${systolic200.percentage}% of readings show systolic >=200 mmHg`,
                `Meets "predominantly" threshold (>50% required)`
            );
            evidence.push(`${systolic200.qualifyingReadings} readings with systolic >=200`);
          }

          // Check if close to 40%
          if (diastolic120.percentage >= 40) {
            gaps.push(`${diastolic120.percentage}% of readings at 120+ (need >50% for 40% rating)`);
          }
        }

        // 10%: Diastolic predominantly 100 OR systolic predominantly 160 OR requires continuous medication
        else {
          const diastolic100 = analyzeBloodPressurePredominance(evaluationPeriodDays, { diastolic: 100 });
          const systolic160 = analyzeBloodPressurePredominance(evaluationPeriodDays, { systolic: 160 });

          // Check if on medication
          const onMedication = bpMeasurements.some(m => m.metadata?.medicationTaken);

          if (diastolic100.isPredominant || systolic160.isPredominant) {
            supportedRating = '10';
            if (diastolic100.isPredominant) {
              ratingRationale.push(
                  `${diastolic100.percentage}% of readings show diastolic >=100 mmHg`,
                  `Meets "predominantly" threshold (>50% required)`,
                  `${diastolic100.qualifyingReadings} of ${diastolic100.totalReadings} readings qualify`
              );
              evidence.push(`${diastolic100.qualifyingReadings} readings with diastolic >=100`);
            }
            if (systolic160.isPredominant) {
              ratingRationale.push(
                  `${systolic160.percentage}% of readings show systolic >=160 mmHg`,
                  `Meets "predominantly" threshold (>50% required)`
              );
              evidence.push(`${systolic160.qualifyingReadings} readings with systolic >=160`);
            }

            // Check if close to 20%
            if (diastolic110.percentage >= 40) {
              gaps.push(`${diastolic110.percentage}% of readings at 110+ (need >50% for 20% rating)`);
            }
          } else if (onMedication) {
            // Check if there's a history of diastolic 100+
            const historyOf100 = bpMeasurements.some(m => m.values.diastolic >= 100);

            if (historyOf100) {
              supportedRating = '10';
              ratingRationale.push(
                  'On continuous BP medication',
                  'Has documented history of diastolic >=100 mmHg',
                  'Meets medication + history criteria for 10% rating'
              );
              evidence.push('Taking BP medication regularly');
              evidence.push('History of elevated diastolic readings');
            } else {
              gaps.push('On medication but no documented history of diastolic >=100');
              gaps.push('Need historical evidence of diastolic >=100 to support medication-based rating');
            }
          } else {
            // No rating supported
            ratingRationale.push(
                `Current readings don't meet "predominantly" threshold for any rating`,
                `Highest: Diastolic >=100 in ${diastolic100.percentage}% of readings (need >50%)`
            );
            gaps.push('Continue logging BP to establish pattern');

            if (diastolic100.percentage >= 30) {
              gaps.push(`Close to 10% rating threshold - ${diastolic100.percentage}% at diastolic >=100`);
            }
          }
        }
      }
    }

    // Additional gaps based on reading count
    if (bpMeasurements.length < 10) {
      gaps.push(`Only ${bpMeasurements.length} readings - more data strengthens claim`);
      gaps.push('Aim for readings on multiple days over 2-3 months');
    }

    // Check for medication documentation
    const medicationDocumented = bpMeasurements.some(m => m.metadata?.medicationTaken !== undefined);
    if (!medicationDocumented) {
      gaps.push('Document whether BP medication was taken with each reading');
    }

    // Check for readings on different days
    const uniqueDays = new Set(
        bpMeasurements.map(m => new Date(m.timestamp).toDateString())
    ).size;

    if (uniqueDays < 3) {
      gaps.push(`Readings from only ${uniqueDays} different days - need at least 3`);
    }

  } else {
    // No measurements, only symptoms
    gaps.push('No blood pressure measurements logged');
    gaps.push('Log BP readings to establish pattern for rating');
    gaps.push('Symptom tracking alone cannot determine hypertension rating');
    gaps.push('VA rating based on actual BP numbers, not symptoms');
  }

  // ==================================================================
  // SECONDARY ANALYSIS: Symptom Impact (for context)
  // ==================================================================

  if (hypertensionSymptoms.length > 0) {
    evidence.push(`${hypertensionSymptoms.length} hypertension-related symptoms logged`);

    // Common symptoms
    const symptomCounts = {};
    hypertensionSymptoms.forEach(log => {
      const symptom = log.symptomName || log.symptomId;
      symptomCounts[symptom] = (symptomCounts[symptom] || 0) + 1;
    });

    const topSymptoms = Object.entries(symptomCounts)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 3);

    if (topSymptoms.length > 0) {
      evidence.push(`Most frequent symptoms: ${topSymptoms.map(([s, c]) => `${s} (${c})`).join(', ')}`);
    }
  }

  return {
    condition: 'Hypertension',
    diagnosticCode: '7101',
    hasData,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: HYPERTENSION_CRITERIA,
    disclaimer: HYPERTENSION_CRITERIA.disclaimer,
    // Include measurements for chart display
    measurements: bpMeasurements,
  };
};

/**
 * Analyze Diabetes using glucose/HbA1c measurements for VA rating
 * DC 7913 - Diabetes Mellitus
 */
export const analyzeDiabetesLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  // Get glucose and HbA1c measurements
  const glucoseMeasurements = getMeasurements({
    type: 'blood-glucose',
    days: evaluationPeriodDays
  });

  const hba1cMeasurements = getMeasurements({
    type: 'hba1c',
    days: evaluationPeriodDays
  });

  // Get symptom logs for additional context
  const diabetesSymptoms = logs.filter(log =>
      CONDITIONS.DIABETES.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  const hasData = glucoseMeasurements.length > 0 || hba1cMeasurements.length > 0 || diabetesSymptoms.length > 0;

  if (!hasData) {
    return {
      condition: 'Diabetes Mellitus',
      diagnosticCode: '7913',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No glucose or HbA1c measurements logged',
        'Log blood glucose readings regularly to establish pattern',
        'Log HbA1c test results (every 3 months typical)',
        'Document insulin or oral medication use',
        'Track hypoglycemic episodes if they occur',
      ],
      criteria: DIABETES_CRITERIA,
      disclaimer: DIABETES_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // ==================================================================
  // ANALYZE GLUCOSE CONTROL
  // ==================================================================

  let avgGlucose = null;
  let fastingCount = 0;
  let elevatedCount = 0;
  let hypoglycemicCount = 0;
  let severeHypoglycemicCount = 0;

  if (glucoseMeasurements.length > 0) {
    // Calculate average glucose
    const totalGlucose = glucoseMeasurements.reduce((sum, m) => sum + m.values.glucose, 0);
    avgGlucose = Math.round(totalGlucose / glucoseMeasurements.length);

    // Count fasting vs non-fasting
    fastingCount = glucoseMeasurements.filter(m => m.metadata?.fasting).length;

    // Count elevated readings (>180 mg/dL)
    elevatedCount = glucoseMeasurements.filter(m => m.values.glucose > 180).length;

    // Count hypoglycemic episodes (<70 mg/dL)
    hypoglycemicCount = glucoseMeasurements.filter(m => m.values.glucose < 70).length;

    // Count severe hypoglycemia (<54 mg/dL)
    severeHypoglycemicCount = glucoseMeasurements.filter(m => m.values.glucose < 54).length;

    evidence.push(`${glucoseMeasurements.length} glucose readings over ${evaluationPeriodDays} days`);
    evidence.push(`Average glucose: ${avgGlucose} mg/dL`);

    if (fastingCount > 0) {
      evidence.push(`${fastingCount} fasting readings documented`);
    }

    if (hypoglycemicCount > 0) {
      evidence.push(`${hypoglycemicCount} hypoglycemic episodes (<70 mg/dL)`);
      if (severeHypoglycemicCount > 0) {
        evidence.push(`${severeHypoglycemicCount} severe hypoglycemia (<54 mg/dL)`);
      }
    }

    if (elevatedCount > 0) {
      const percentElevated = Math.round((elevatedCount / glucoseMeasurements.length) * 100);
      evidence.push(`${percentElevated}% of readings >180 mg/dL (${elevatedCount} readings)`);
    }
  }

  // ==================================================================
  // ANALYZE HbA1c (Long-term Control)
  // ==================================================================

  let latestHbA1c = null;
  let avgHbA1c = null;

  if (hba1cMeasurements.length > 0) {
    // Get most recent HbA1c
    const sortedHbA1c = [...hba1cMeasurements].sort(
        (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
    );
    latestHbA1c = sortedHbA1c[0].values.hba1c;

    // Calculate average HbA1c
    const totalHbA1c = hba1cMeasurements.reduce((sum, m) => sum + m.values.hba1c, 0);
    avgHbA1c = (totalHbA1c / hba1cMeasurements.length).toFixed(1);

    evidence.push(`${hba1cMeasurements.length} HbA1c test results`);
    evidence.push(`Most recent HbA1c: ${latestHbA1c}%`);
    if (hba1cMeasurements.length > 1) {
      evidence.push(`Average HbA1c: ${avgHbA1c}%`);
    }
  }

  // ==================================================================
  // CHECK FOR INSULIN/MEDICATION REQUIREMENT
  // ==================================================================

  const insulinDocumented = glucoseMeasurements.some(m =>
      m.metadata?.insulinTaken || m.metadata?.medicationTaken
  );

  const oralMedDocumented = glucoseMeasurements.some(m =>
      m.metadata?.medicationTaken && !m.metadata?.insulinTaken
  );

  if (insulinDocumented) {
    evidence.push('Insulin use documented with glucose readings');
  } else if (oralMedDocumented) {
    evidence.push('Oral medication documented with glucose readings');
  }

  // ==================================================================
  // DETERMINE VA RATING
  // ==================================================================

  // Need more detailed info for higher ratings
  // For now, we can support 10-40% based on measurements

  // Check for poor control suggesting higher rating
  const poorControl = (latestHbA1c && latestHbA1c >= 9) ||
      (avgGlucose && avgGlucose >= 250);

  if (poorControl && insulinDocumented && severeHypoglycemicCount >= 3) {
    // Possible 60-100% but needs hospitalization documentation
    supportedRating = 'Requires Clinical Documentation';
    ratingRationale.push(
        'Evidence suggests severe diabetes with poor control',
        `HbA1c ${latestHbA1c}% indicates very poor control`,
        `${severeHypoglycemicCount} severe hypoglycemic episodes documented`,
        'Insulin requirement documented'
    );
    gaps.push('60-100% ratings require documentation of hospitalizations');
    gaps.push('Document emergency room visits or hospital admissions for diabetes');
    gaps.push('Track frequency of severe hypoglycemia requiring assistance');
  }
  else if (insulinDocumented) {
    // 40%: Requires insulin, restricted diet, and regulation of activities
    supportedRating = '40';
    ratingRationale.push(
        'Insulin requirement documented',
        'Meets criteria for 40% rating (insulin + restricted diet + activity regulation)'
    );

    if (latestHbA1c) {
      ratingRationale.push(`HbA1c ${latestHbA1c}% indicates ${
          latestHbA1c >= 9 ? 'poor' :
              latestHbA1c >= 7.5 ? 'suboptimal' :
                  latestHbA1c >= 7 ? 'fair' : 'good'
      } control`);
    }

    // Check if this could qualify for higher
    if (latestHbA1c && latestHbA1c >= 7.5) {
      gaps.push('Poor control may support higher rating with hospitalization documentation');
    }
  }
  else if (oralMedDocumented) {
    // 20%: Requires oral medication and restricted diet
    supportedRating = '20';
    ratingRationale.push(
        'Oral hypoglycemic medication documented',
        'Meets criteria for 20% rating (oral medication + restricted diet)'
    );

    if (latestHbA1c) {
      ratingRationale.push(`HbA1c ${latestHbA1c}% with oral medication`);
    }

    // Check if this actually needs insulin
    if (poorControl) {
      gaps.push('Poor control despite oral medication - may need insulin therapy');
      gaps.push('Discuss with healthcare provider if insulin should be started');
    }
  }
  else if (latestHbA1c && latestHbA1c >= 6.5) {
    // Has diabetes diagnosis (HbA1c >=6.5%) but medication not documented
    supportedRating = '10';
    ratingRationale.push(
        `Diabetes diagnosis confirmed (HbA1c ${latestHbA1c}%)`,
        'Manageable with restricted diet',
        'Meets criteria for 10% rating (restricted diet only)'
    );

    gaps.push('Document if taking any diabetes medication');
    gaps.push('If on medication, rating could increase to 20-40%');
  }
  else if (avgGlucose && avgGlucose >= 126) {
    // Elevated fasting glucose suggesting diabetes
    supportedRating = '10';
    ratingRationale.push(
        `Average glucose ${avgGlucose} mg/dL suggests diabetes`,
        'Meets criteria for 10% rating if diagnosis confirmed',
        'Requires dietary management'
    );

    gaps.push('Get HbA1c test to confirm diagnosis');
    gaps.push('Document any diabetes medication use');
  }
  else {
    // Glucose control appears good
    supportedRating = '0 (Compensable)';
    ratingRationale.push(
        'Diabetes controlled by current treatment',
        'May qualify for compensable 0% rating if diagnosis documented'
    );

    if (latestHbA1c) {
      ratingRationale.push(`HbA1c ${latestHbA1c}% indicates good control`);
    }

    gaps.push('Maintain current treatment and monitoring');
    gaps.push('Document any changes in control or treatment needs');
  }

  // ==================================================================
  // ADDITIONAL DOCUMENTATION GAPS
  // ==================================================================

  if (glucoseMeasurements.length < 20) {
    gaps.push(`Only ${glucoseMeasurements.length} glucose readings - aim for 20+ over 90 days`);
  }

  if (!insulinDocumented && !oralMedDocumented && (latestHbA1c && latestHbA1c >= 6.5)) {
    gaps.push('Document medication status with each glucose reading');
  }

  if (hba1cMeasurements.length === 0) {
    gaps.push('Log HbA1c test results (typically done every 3 months)');
  }

  if (hba1cMeasurements.length === 1) {
    gaps.push('Multiple HbA1c values show pattern over time');
  }

  if (fastingCount < 5 && glucoseMeasurements.length >= 10) {
    gaps.push('Include more fasting glucose readings (before breakfast)');
  }

  if (severeHypoglycemicCount > 0) {
    gaps.push('Document any hospitalizations or ER visits for hypoglycemia');
    gaps.push('Track episodes requiring assistance from others');
  }

  // Higher ratings require additional documentation
  if (supportedRating === '40' || supportedRating === 'Requires Clinical Documentation') {
    gaps.push('Document activity restrictions due to diabetes');
    gaps.push('Document dietary restrictions and meal planning requirements');

    if (poorControl) {
      gaps.push('Document visits to endocrinologist or diabetes educator');
    }
  }

  // ==================================================================
  // SYMPTOM ANALYSIS (for context)
  // ==================================================================

  if (diabetesSymptoms.length > 0) {
    evidence.push(`${diabetesSymptoms.length} diabetes-related symptoms logged`);

    const symptomCounts = {};
    diabetesSymptoms.forEach(log => {
      const symptom = log.symptomName || log.symptomId;
      symptomCounts[symptom] = (symptomCounts[symptom] || 0) + 1;
    });

    const topSymptoms = Object.entries(symptomCounts)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 3);

    if (topSymptoms.length > 0) {
      evidence.push(`Most frequent symptoms: ${topSymptoms.map(([s, c]) => `${s} (${c})`).join(', ')}`);
    }
  }

  return {
    condition: 'Diabetes Mellitus',
    diagnosticCode: '7913',
    hasData,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: DIABETES_CRITERIA,
    disclaimer: DIABETES_CRITERIA.disclaimer,
    // Include measurements for chart display
    glucoseMeasurements,
    hba1cMeasurements,
    avgGlucose,
    latestHbA1c,
    avgHbA1c,
  };
};

/**
 * Analyze IBS logs for VA rating
 * DC 7319 - Irritable Bowel Syndrome
 */
export const analyzeIBSLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const ibsSymptoms = logs.filter(log =>
      CONDITIONS.IBS.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (ibsSymptoms.length === 0) {
    return {
      condition: 'Irritable Bowel Syndrome',
      diagnosticCode: '7319',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No IBS symptoms logged in evaluation period',
        'Log diarrhea, constipation, or bowel disturbance episodes',
        'Document abdominal pain or discomfort',
        'Track frequency and severity of episodes',
      ],
      criteria: IBS_CRITERIA,
      disclaimer: IBS_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count episodes by type
  const diarrheaCount = ibsSymptoms.filter(s => getLogSymptomId(s) === 'ibs-diarrhea').length;
  const constipationCount = ibsSymptoms.filter(s => getLogSymptomId(s) === 'ibs-constipation').length;
  const painCount = ibsSymptoms.filter(s => getLogSymptomId(s) === 'ibs-pain').length;
  const bloatingCount = ibsSymptoms.filter(s => getLogSymptomId(s) === 'ibs-bloating').length;
  const urgencyCount = ibsSymptoms.filter(s => getLogSymptomId(s) === 'ibs-urgency').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = ibsSymptoms.length / weeksInPeriod;

  evidence.push(`${ibsSymptoms.length} IBS episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (diarrheaCount > 0) evidence.push(`${diarrheaCount} diarrhea episodes`);
  if (constipationCount > 0) evidence.push(`${constipationCount} constipation episodes`);
  if (painCount > 0) evidence.push(`${painCount} abdominal pain episodes`);

  // Check for alternating pattern
  const hasAlternating = diarrheaCount > 0 && constipationCount > 0;
  if (hasAlternating) {
    evidence.push('Alternating diarrhea and constipation pattern documented');
  }

  // Determine rating
  // 30%: Frequent episodes (3+ per week) with diarrhea/alternating + distress
  if (episodesPerWeek >= 3 && (diarrheaCount > 0 || hasAlternating) && painCount > 0) {
    supportedRating = '30';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (meets "frequent" threshold)`,
        `${hasAlternating ? 'Alternating diarrhea/constipation' : 'Diarrhea episodes'} documented`,
        `Abdominal distress logged ${painCount} times`,
        'Meets criteria for severe IBS with frequent episodes'
    );
  }
  // 10%: Moderate symptoms, occasional episodes (1+ per week)
  else if (episodesPerWeek >= 1) {
    supportedRating = '10';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week`,
        'Meets criteria for moderate IBS with occasional episodes',
        'Bowel disturbance pattern established'
    );

    if (episodesPerWeek >= 2) {
      gaps.push(`Approaching 30% threshold - log more associated symptoms (pain, urgency)`);
    }
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week`,
        'Less than once weekly - may be diet-controlled',
        'Does not meet frequency for service-connected rating'
    );
  }

  // Documentation gaps
  if (ibsSymptoms.length < 12) {
    gaps.push(`Only ${ibsSymptoms.length} episodes logged - aim for 12+ over 90 days for pattern`);
  }

  if (painCount === 0) {
    gaps.push('No abdominal pain episodes logged - document distress for higher rating');
  }

  if (diarrheaCount === 0 && constipationCount === 0) {
    gaps.push('Log specific diarrhea or constipation episodes, not just pain');
  }

  if (!hasAlternating && constipationCount === 0 && diarrheaCount > 0) {
    gaps.push('Consider logging constipation episodes if alternating pattern present');
  }

  return {
    condition: 'Irritable Bowel Syndrome',
    diagnosticCode: '7319',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: IBS_CRITERIA,
    disclaimer: IBS_CRITERIA.disclaimer,
  };
};


/**
 * Analyze GERD logs for VA rating
 * DC 7346 - Gastroesophageal Reflux Disease
 */
export const analyzeGERDLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const gerdSymptoms = logs.filter(log =>
      CONDITIONS.GERD.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (gerdSymptoms.length === 0) {
    return {
      condition: 'Gastroesophageal Reflux Disease (GERD)',
      diagnosticCode: '7346',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No GERD symptoms logged in evaluation period',
        'Log heartburn (pyrosis) episodes',
        'Document regurgitation frequency',
        'Track chest pain, difficulty swallowing if present',
      ],
      criteria: GERD_CRITERIA,
      disclaimer: GERD_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const heartburnCount = gerdSymptoms.filter(s => getLogSymptomId(s) === 'gerd-heartburn').length;
  const regurgitationCount = gerdSymptoms.filter(s => getLogSymptomId(s) === 'gerd-regurgitation').length;
  const chestPainCount = gerdSymptoms.filter(s => getLogSymptomId(s) === 'gerd-chest-pain').length;
  const dysphagiaCount = gerdSymptoms.filter(s => getLogSymptomId(s) === 'gerd-difficulty-swallowing').length;
  const nauseaCount = gerdSymptoms.filter(s => getLogSymptomId(s) === 'gerd-nausea').length;

  // Count unique symptom types
  const uniqueSymptoms = new Set(gerdSymptoms.map(s => s.symptomId)).size;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = gerdSymptoms.length / weeksInPeriod;

  evidence.push(`${gerdSymptoms.length} GERD episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);
  evidence.push(`${uniqueSymptoms} different symptom types documented`);

  if (heartburnCount > 0) evidence.push(`${heartburnCount} heartburn episodes`);
  if (regurgitationCount > 0) evidence.push(`${regurgitationCount} regurgitation episodes`);
  if (chestPainCount > 0) evidence.push(`${chestPainCount} chest pain episodes`);
  if (dysphagiaCount > 0) evidence.push(`${dysphagiaCount} difficulty swallowing episodes`);

  // Determine rating
  // 60%: Requires weight loss, bleeding, anemia documentation
  // (Cannot be determined from symptoms alone)

  // 30%: Persistent recurrent symptoms with dysphagia, pyrosis, regurgitation + chest pain
  if (episodesPerWeek >= 3 && heartburnCount > 0 && regurgitationCount > 0 &&
      (chestPainCount > 0 || dysphagiaCount > 0)) {
    supportedRating = '30';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (persistently recurrent)`,
        'Heartburn (pyrosis) documented',
        'Regurgitation documented',
        chestPainCount > 0 ? 'Chest pain episodes logged' : 'Dysphagia (difficulty swallowing) logged',
        'Meets criteria for considerable impairment'
    );
  }
  // 10%: Two or more symptoms, less severe
  else if (uniqueSymptoms >= 2) {
    supportedRating = '10';
    ratingRationale.push(
        `${uniqueSymptoms} different GERD symptoms documented`,
        `${episodesPerWeek.toFixed(1)} episodes per week`,
        'Meets criteria for 10% (two or more symptoms of less severity)'
    );

    if (episodesPerWeek >= 2 && heartburnCount > 0 && regurgitationCount > 0) {
      gaps.push('Close to 30% - log chest pain or dysphagia if present');
      gaps.push('Document persistence and frequency for higher rating');
    }
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        'Symptoms appear controlled or minimal',
        'May be managed with medication',
        'Does not meet frequency for higher rating'
    );
  }

  // Documentation gaps
  if (gerdSymptoms.length < 12) {
    gaps.push(`Only ${gerdSymptoms.length} episodes logged - aim for 12+ over 90 days`);
  }

  if (uniqueSymptoms < 2) {
    gaps.push('Log multiple symptom types for higher rating consideration');
  }

  if (heartburnCount === 0) {
    gaps.push('Heartburn (pyrosis) is hallmark GERD symptom - document if present');
  }

  if (dysphagiaCount > 0) {
    gaps.push('Difficulty swallowing documented - get endoscopy results for claim');
  }

  // 60% requires clinical documentation
  gaps.push('60% rating requires medical documentation of weight loss, bleeding, or anemia');

  return {
    condition: 'Gastroesophageal Reflux Disease (GERD)',
    diagnosticCode: '7346',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: GERD_CRITERIA,
    disclaimer: GERD_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Radiculopathy logs for VA rating
 * DC 8520 - Radiculopathy
 */
export const analyzeRadiculopathyLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const radiculopathySymptoms = logs.filter(log =>
      CONDITIONS.RADICULOPATHY.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (radiculopathySymptoms.length === 0) {
    return {
      condition: 'Radiculopathy',
      diagnosticCode: '8520',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No radiculopathy symptoms logged in evaluation period',
        'Log radiating pain episodes',
        'Document numbness, tingling, or burning sensations',
        'Track weakness if present',
        'Note which nerve distribution (e.g., L5, S1, C6)',
      ],
      criteria: RADICULOPATHY_CRITERIA,
      disclaimer: RADICULOPATHY_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const painCount = radiculopathySymptoms.filter(s => getLogSymptomId(s) === 'radiculopathy-pain').length;
  const numbnessCount = radiculopathySymptoms.filter(s => getLogSymptomId(s) === 'radiculopathy-numbness').length;
  const tinglingCount = radiculopathySymptoms.filter(s => getLogSymptomId(s) === 'radiculopathy-tingling').length;
  const weaknessCount = radiculopathySymptoms.filter(s => getLogSymptomId(s) === 'radiculopathy-weakness').length;
  const burningCount = radiculopathySymptoms.filter(s => getLogSymptomId(s) === 'radiculopathy-burning').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = radiculopathySymptoms.length / weeksInPeriod;

  evidence.push(`${radiculopathySymptoms.length} radiculopathy episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (painCount > 0) evidence.push(`${painCount} radiating pain episodes`);
  if (numbnessCount > 0) evidence.push(`${numbnessCount} numbness episodes`);
  if (tinglingCount > 0) evidence.push(`${tinglingCount} tingling episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);
  if (burningCount > 0) evidence.push(`${burningCount} burning sensation episodes`);

  // Paresthesia count (numbness + tingling + burning)
  const paresthesiaCount = numbnessCount + tinglingCount + burningCount;

  // Determine rating
  // 40%: Severe with motor loss - requires clinical documentation
  // 20%: Moderate with weakness - requires clinical documentation

  // 10%: Mild with pain and paresthesia, no motor loss
  if (painCount > 0 && paresthesiaCount > 0 && weaknessCount === 0) {
    supportedRating = '10';
    ratingRationale.push(
        'Radiating pain documented',
        'Paresthesia (numbness/tingling/burning) present',
        'No motor weakness logged',
        'Meets criteria for mild radiculopathy (10%)'
    );

    if (weaknessCount > 0) {
      gaps.push('Weakness documented - clinical exam needed to assess motor loss for higher rating');
    }
  }
  else if (weaknessCount > 0) {
    supportedRating = 'Requires Clinical Documentation';
    ratingRationale.push(
        'Muscle weakness documented',
        'Higher ratings (20-40%) require clinical examination',
        'Need documentation of motor strength testing',
        'EMG/nerve conduction studies recommended'
    );
    gaps.push('Get clinical documentation of motor weakness degree');
    gaps.push('Request EMG/nerve conduction studies if not done');
    gaps.push('Document muscle atrophy if visible');
  }
  else if (painCount > 0 || paresthesiaCount > 0) {
    supportedRating = '10';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week`,
        'Radiculopathy symptoms present',
        'Meets criteria for minimal rating'
    );

    if (painCount === 0) {
      gaps.push('Log radiating pain episodes for stronger claim');
    }
    if (paresthesiaCount === 0) {
      gaps.push('Document paresthesia (numbness, tingling) if present');
    }
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        'Minimal or well-controlled symptoms',
        'Does not meet frequency for service-connected rating'
    );
  }

  // Documentation gaps
  if (radiculopathySymptoms.length < 12) {
    gaps.push(`Only ${radiculopathySymptoms.length} episodes logged - aim for 12+ over 90 days`);
  }

  if (painCount === 0) {
    gaps.push('Radiating pain is key symptom - document pain distribution');
  }

  if (paresthesiaCount === 0) {
    gaps.push('Document paresthesia pattern (which fingers/toes affected)');
  }

  gaps.push('Higher ratings require MRI showing nerve compression');
  gaps.push('EMG/nerve conduction studies strengthen claim');

  return {
    condition: 'Radiculopathy',
    diagnosticCode: '8520',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: RADICULOPATHY_CRITERIA,
    disclaimer: RADICULOPATHY_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Chronic Fatigue logs for VA rating
 * DC 6354 - Chronic Fatigue Syndrome
 */
export const analyzeChronicFatigueLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cfsSymptoms = logs.filter(log =>
      CONDITIONS.CHRONIC_FATIGUE.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (cfsSymptoms.length === 0) {
    return {
      condition: 'Chronic Fatigue Syndrome',
      diagnosticCode: '6354',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No CFS symptoms logged in evaluation period',
        'Log debilitating fatigue episodes',
        'Document cognitive impairment ("brain fog")',
        'Track sleep disturbance',
        'Note chronic pain if present',
      ],
      criteria: CHRONIC_FATIGUE_CRITERIA,
      disclaimer: CHRONIC_FATIGUE_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const fatigueCount = cfsSymptoms.filter(s => getLogSymptomId(s) === 'cfs-fatigue').length;
  const cognitiveCount = cfsSymptoms.filter(s => getLogSymptomId(s) === 'cfs-cognitive').length;
  const sleepCount = cfsSymptoms.filter(s => getLogSymptomId(s) === 'cfs-sleep').length;
  const painCount = cfsSymptoms.filter(s => getLogSymptomId(s) === 'cfs-pain').length;
  const headacheCount = cfsSymptoms.filter(s => getLogSymptomId(s) === 'cfs-headache').length;

  // Count unique symptom types
  const uniqueSymptoms = new Set(cfsSymptoms.map(s => s.symptomId)).size;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = cfsSymptoms.length / weeksInPeriod;

  evidence.push(`${cfsSymptoms.length} CFS episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);
  evidence.push(`${uniqueSymptoms} different symptom types documented`);

  if (fatigueCount > 0) evidence.push(`${fatigueCount} debilitating fatigue episodes`);
  if (cognitiveCount > 0) evidence.push(`${cognitiveCount} cognitive impairment episodes`);
  if (sleepCount > 0) evidence.push(`${sleepCount} sleep disturbance episodes`);
  if (painCount > 0) evidence.push(`${painCount} chronic pain episodes`);

  // Check for "substantially all" symptoms (need 4+ of 5 types)
  const hasSubstantiallyAll = uniqueSymptoms >= 4;

  // Determine rating based on frequency and symptom variety
  // 100%: Daily/near-daily + substantially all symptoms
  if (episodesPerWeek >= 5 && hasSubstantiallyAll) {
    supportedRating = '100';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (daily/near-daily)`,
        `${uniqueSymptoms} different symptom types (substantially all)`,
        'Debilitating fatigue documented',
        'Multiple associated symptoms present',
        'Meets criteria for incapacitating CFS'
    );
  }
  // 60%: Near-constant (4+ per week) + multiple symptoms
  else if (episodesPerWeek >= 4 && uniqueSymptoms >= 3) {
    supportedRating = '60';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (near-constant)`,
        `${uniqueSymptoms} different symptom types`,
        'Meets criteria for severe CFS with significant impairment'
    );
  }
  // 40%: Constant (3+ per week) + some additional symptoms
  else if (episodesPerWeek >= 3 && uniqueSymptoms >= 2) {
    supportedRating = '40';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (constant)`,
        `${uniqueSymptoms} different symptom types`,
        'Meets criteria for constant fatigue with additional symptoms'
    );
  }
  // 20%: Frequent (2+ per week)
  else if (episodesPerWeek >= 2) {
    supportedRating = '20';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (frequent)`,
        'Meets criteria for frequent fatigue'
    );

    if (uniqueSymptoms >= 2) {
      gaps.push('Close to 40% - increase logging frequency for higher rating');
    }
  }
  // 10%: Intermittent (1+ per week)
  else if (episodesPerWeek >= 1) {
    supportedRating = '10';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (intermittent)`,
        'Meets criteria for intermittent fatigue'
    );
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        'Less than weekly episodes',
        'May be well-controlled or minimal'
    );
  }

  // Documentation gaps
  if (cfsSymptoms.length < 20) {
    gaps.push(`Only ${cfsSymptoms.length} episodes logged - aim for 20+ over 90 days`);
  }

  if (fatigueCount === 0) {
    gaps.push('No debilitating fatigue episodes logged - this is the core symptom');
  }

  if (cognitiveCount === 0) {
    gaps.push('Log cognitive impairment ("brain fog") if present');
  }

  if (sleepCount === 0) {
    gaps.push('Document sleep disturbance if present');
  }

  if (uniqueSymptoms < 3) {
    gaps.push('Higher ratings require multiple symptom types - log all CFS symptoms');
  }

  gaps.push('Document inability to work or perform daily activities for higher ratings');
  gaps.push('Post-exertional malaise (crash after activity) supports diagnosis');

  return {
    condition: 'Chronic Fatigue Syndrome',
    diagnosticCode: '6354',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: CHRONIC_FATIGUE_CRITERIA,
    disclaimer: CHRONIC_FATIGUE_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Peripheral Neuropathy logs for VA rating
 * DC 8999 - Peripheral Neuropathy
 */
export const analyzePeripheralNeuropathyLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const pnSymptoms = logs.filter(log =>
      CONDITIONS.PERIPHERAL_NEUROPATHY.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (pnSymptoms.length === 0) {
    return {
      condition: 'Peripheral Neuropathy',
      diagnosticCode: '8999',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No peripheral neuropathy symptoms logged',
        'Log numbness, tingling, or burning in extremities',
        'Document affected areas (feet, hands, etc.)',
        'Track any weakness if present',
      ],
      criteria: PERIPHERAL_NEUROPATHY_CRITERIA,
      disclaimer: PERIPHERAL_NEUROPATHY_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const numbnessCount = pnSymptoms.filter(s => getLogSymptomId(s) === 'pn-numbness').length;
  const tinglingCount = pnSymptoms.filter(s => getLogSymptomId(s) === 'pn-tingling').length;
  const burningCount = pnSymptoms.filter(s => getLogSymptomId(s) === 'pn-burning').length;
  const painCount = pnSymptoms.filter(s => getLogSymptomId(s) === 'pn-pain').length;
  const weaknessCount = pnSymptoms.filter(s => getLogSymptomId(s) === 'pn-weakness').length;

  // Paresthesia count (numbness + tingling + burning)
  const paresthesiaCount = numbnessCount + tinglingCount + burningCount;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = pnSymptoms.length / weeksInPeriod;

  evidence.push(`${pnSymptoms.length} neuropathy episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (numbnessCount > 0) evidence.push(`${numbnessCount} numbness episodes`);
  if (tinglingCount > 0) evidence.push(`${tinglingCount} tingling episodes`);
  if (burningCount > 0) evidence.push(`${burningCount} burning sensation episodes`);
  if (painCount > 0) evidence.push(`${painCount} pain episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);

  // Determine rating
  // 40%: Severe with motor weakness - requires clinical documentation
  // 30%: Moderate with some motor
  // 20%: Mild-moderate with sensory
  // 10%: Mild intermittent sensory

  if (weaknessCount > 5 && paresthesiaCount > 10) {
    supportedRating = 'Requires Clinical Documentation';
    ratingRationale.push(
        'Significant weakness documented',
        'Extensive paresthesia',
        '30-40% ratings require clinical examination and EMG studies',
        'Need documentation of sensory/motor testing'
    );
    gaps.push('Get EMG/nerve conduction studies if not done');
    gaps.push('Request clinical sensory testing documentation');
    gaps.push('Document areas of sensory loss on body diagram');
  }
  else if (weaknessCount > 0 || (paresthesiaCount > 15 && episodesPerWeek >= 3)) {
    supportedRating = '20';
    ratingRationale.push(
        `${paresthesiaCount} paresthesia episodes (numbness/tingling/burning)`,
        weaknessCount > 0 ? `${weaknessCount} weakness episodes` : 'Persistent sensory symptoms',
        'Meets criteria for mild-moderate neuropathy'
    );

    if (weaknessCount > 2) {
      gaps.push('Weakness documented - clinical exam may support higher rating');
    }
  }
  else if (paresthesiaCount > 0 || painCount > 0) {
    supportedRating = '10';
    ratingRationale.push(
        `${pnSymptoms.length} neuropathy episodes`,
        'Sensory symptoms documented',
        'Meets criteria for mild peripheral neuropathy'
    );
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        'Minimal or well-controlled symptoms'
    );
  }

  // Documentation gaps
  if (pnSymptoms.length < 12) {
    gaps.push(`Only ${pnSymptoms.length} episodes logged - aim for 12+ over 90 days`);
  }

  if (paresthesiaCount === 0) {
    gaps.push('Document paresthesia (numbness, tingling, burning) if present');
  }

  if (weaknessCount > 0) {
    gaps.push('Weakness documented - get clinical motor strength testing');
  }

  gaps.push('Document which extremities affected (feet/hands/both)');
  gaps.push('EMG/nerve conduction studies strengthen claim significantly');
  gaps.push('Common causes: diabetes, Agent Orange, medications - document etiology');

  return {
    condition: 'Peripheral Neuropathy',
    diagnosticCode: '8999',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: PERIPHERAL_NEUROPATHY_CRITERIA,
    disclaimer: PERIPHERAL_NEUROPATHY_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Meniere's Disease logs for VA rating
 * DC 6205 - Meniere's Disease
 */
export const analyzeMenieresLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const menieresSymptoms = logs.filter(log =>
      CONDITIONS.MENIERES.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (menieresSymptoms.length === 0) {
    return {
      condition: "Meniere's Disease",
      diagnosticCode: '6205',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        "No Meniere's symptoms logged",
        'Log vertigo episodes (spinning sensation)',
        'Document tinnitus if present',
        'Note hearing loss or ear fullness',
        'Track duration and severity of attacks',
      ],
      criteria: MENIERES_CRITERIA,
      disclaimer: MENIERES_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const vertigoCount = menieresSymptoms.filter(s => getLogSymptomId(s) === 'menieres-vertigo').length;
  const tinnitusCount = menieresSymptoms.filter(s => getLogSymptomId(s) === 'menieres-tinnitus').length;
  const hearingLossCount = menieresSymptoms.filter(s => getLogSymptomId(s) === 'menieres-hearing-loss').length;
  const nauseaCount = menieresSymptoms.filter(s => getLogSymptomId(s) === 'menieres-nausea').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = menieresSymptoms.length / weeksInPeriod;

  evidence.push(`${menieresSymptoms.length} Meniere's episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (vertigoCount > 0) evidence.push(`${vertigoCount} vertigo attacks`);
  if (tinnitusCount > 0) evidence.push(`${tinnitusCount} tinnitus episodes`);
  if (hearingLossCount > 0) evidence.push(`${hearingLossCount} hearing loss episodes`);
  if (nauseaCount > 0) evidence.push(`${nauseaCount} nausea episodes`);

  // Check for classic triad: vertigo + tinnitus + hearing loss
  const hasTriad = vertigoCount > 0 && tinnitusCount > 0 && hearingLossCount > 0;

  // Determine rating
  // 100%: Multiple attacks per week, bed rest most of time
  if (episodesPerWeek >= 3 && vertigoCount >= 10 && hasTriad) {
    supportedRating = '100';
    ratingRationale.push(
        `${vertigoCount} vertigo attacks (multiple per week)`,
        'Classic triad documented (vertigo + tinnitus + hearing loss)',
        'Meets criteria for severe, prolonged attacks requiring bed rest'
    );
    gaps.push('Document that attacks require bed rest');
    gaps.push('Get audiometry showing hearing loss');
  }
  // 60%: Weekly+ attacks requiring bed rest
  else if (episodesPerWeek >= 1 && vertigoCount >= 4 && hasTriad) {
    supportedRating = '60';
    ratingRationale.push(
        `${vertigoCount} severe vertigo attacks`,
        'Classic triad present',
        'Meets criteria for attacks requiring bed rest'
    );
    gaps.push('Document that vertigo attacks require bed rest during episodes');
    gaps.push('Audiometry required for formal rating');
  }
  // 30%: Regular symptoms, less severe
  else if ((vertigoCount > 0 || tinnitusCount > 0) && episodesPerWeek >= 0.5) {
    supportedRating = '30';
    ratingRationale.push(
        `${menieresSymptoms.length} episodes documented`,
        'Vertigo and/or tinnitus present',
        'Meets criteria for less than severe symptoms'
    );

    if (!hasTriad) {
      gaps.push('30% rating requires hearing impairment + vertigo + tinnitus');
      gaps.push('Get audiometry to document hearing loss');
    }
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        'Symptoms minimal or well-controlled'
    );
  }

  // Documentation gaps
  if (menieresSymptoms.length < 8) {
    gaps.push(`Only ${menieresSymptoms.length} episodes logged - aim for 8+ over 90 days`);
  }

  if (vertigoCount === 0) {
    gaps.push('Vertigo is hallmark symptom - log spinning/rotational vertigo attacks');
  }

  if (!hasTriad) {
    gaps.push('Classic Meniere\'s triad: vertigo + tinnitus + hearing loss');
    if (tinnitusCount === 0) gaps.push('Document tinnitus if present');
    if (hearingLossCount === 0) gaps.push('Document hearing loss if present');
  }

  gaps.push('All ratings require ENT evaluation with audiometry');
  gaps.push('Document duration of vertigo attacks (minutes to hours)');
  gaps.push('Note if attacks require bed rest or emergency treatment');

  return {
    condition: "Meniere's Disease",
    diagnosticCode: '6205',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: MENIERES_CRITERIA,
    disclaimer: MENIERES_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Rhinitis logs for VA rating
 * DC 6522 - Rhinitis
 */
export const analyzeRhinitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const rhinitisSymptoms = logs.filter(log =>
      CONDITIONS.RHINITIS.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (rhinitisSymptoms.length === 0) {
    return {
      condition: 'Rhinitis (Allergic or Vasomotor)',
      diagnosticCode: '6522',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No rhinitis symptoms logged',
        'Log chronic congestion episodes',
        'Document post-nasal drainage',
        'Track sneezing or breathing difficulty',
        'Note triggers if known',
      ],
      criteria: RHINITIS_CRITERIA,
      disclaimer: RHINITIS_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const congestionCount = rhinitisSymptoms.filter(s => getLogSymptomId(s) === 'rhinitis-congestion').length;
  const drainageCount = rhinitisSymptoms.filter(s => getLogSymptomId(s) === 'rhinitis-drainage').length;
  const sneezingCount = rhinitisSymptoms.filter(s => getLogSymptomId(s) === 'rhinitis-sneezing').length;
  const breathingCount = rhinitisSymptoms.filter(s => getLogSymptomId(s) === 'rhinitis-breathing').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = rhinitisSymptoms.length / weeksInPeriod;

  evidence.push(`${rhinitisSymptoms.length} rhinitis episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (congestionCount > 0) evidence.push(`${congestionCount} congestion episodes`);
  if (drainageCount > 0) evidence.push(`${drainageCount} post-nasal drainage episodes`);
  if (sneezingCount > 0) evidence.push(`${sneezingCount} sneezing episodes`);
  if (breathingCount > 0) evidence.push(`${breathingCount} breathing difficulty episodes`);

  // Determine rating
  // 30%: With polyps (requires ENT documentation)
  // 10%: Chronic symptoms without polyps

  // Can only support 10% from symptom logging alone
  if (episodesPerWeek >= 2 || rhinitisSymptoms.length >= 15) {
    supportedRating = '10';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week`,
        'Chronic symptoms documented',
        'Meets criteria for 10% rating (without polyps)'
    );
  }
  else if (episodesPerWeek >= 1) {
    supportedRating = '10';
    ratingRationale.push(
        `${rhinitisSymptoms.length} episodes over ${evaluationPeriodDays} days`,
        'Regular symptoms documented',
        'Supports 10% rating'
    );
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        'Symptoms minimal or well-controlled'
    );
  }

  // Documentation gaps
  if (rhinitisSymptoms.length < 10) {
    gaps.push(`Only ${rhinitisSymptoms.length} episodes logged - aim for 10+ over 90 days`);
  }

  if (congestionCount === 0) {
    gaps.push('Chronic nasal congestion is key symptom - document if present');
  }

  gaps.push('30% rating requires ENT documentation of nasal polyps');
  gaps.push('Get nasal endoscopy or imaging if polyps suspected');
  gaps.push('Document if symptoms are seasonal or year-round');
  gaps.push('Note any triggers (allergens, weather, irritants)');

  return {
    condition: 'Rhinitis (Allergic or Vasomotor)',
    diagnosticCode: '6522',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: RHINITIS_CRITERIA,
    disclaimer: RHINITIS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze TMJ logs for VA rating
 * DC 9905 - TMJ Disorder
 */
export const analyzeTMJLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const tmjSymptoms = logs.filter(log =>
      CONDITIONS.TMJ.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (tmjSymptoms.length === 0) {
    return {
      condition: 'Temporomandibular Joint (TMJ) Disorder',
      diagnosticCode: '9905',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No TMJ symptoms logged',
        'Log jaw pain episodes',
        'Document clicking, popping, or locking',
        'Track difficulty with eating or talking',
        'Note if symptoms are on one or both sides',
      ],
      criteria: TMJ_CRITERIA,
      disclaimer: TMJ_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const painCount = tmjSymptoms.filter(s => getLogSymptomId(s) === 'tmj-pain').length;
  const clickingCount = tmjSymptoms.filter(s => getLogSymptomId(s) === 'tmj-clicking').length;
  const limitedOpeningCount = tmjSymptoms.filter(s => getLogSymptomId(s) === 'tmj-limited-opening').length;
  const lockingCount = tmjSymptoms.filter(s => getLogSymptomId(s) === 'tmj-locking').length;
  const headacheCount = tmjSymptoms.filter(s => getLogSymptomId(s) === 'tmj-headache').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = tmjSymptoms.length / weeksInPeriod;

  evidence.push(`${tmjSymptoms.length} TMJ episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (painCount > 0) evidence.push(`${painCount} pain episodes`);
  if (clickingCount > 0) evidence.push(`${clickingCount} clicking/popping episodes`);
  if (limitedOpeningCount > 0) evidence.push(`${limitedOpeningCount} limited opening episodes`);
  if (lockingCount > 0) evidence.push(`${lockingCount} jaw locking episodes`);
  if (headacheCount > 0) evidence.push(`${headacheCount} TMJ-related headaches`);

  // Determine rating
  // Need dental/oral surgery exam for formal rating, but can support with symptoms
  // 30%: Bilateral severe pain with limited motion
  // 20%: Bilateral moderate or unilateral severe
  // 10%: Mild symptoms

  if (episodesPerWeek >= 4 && painCount >= 10 && (limitedOpeningCount > 5 || lockingCount > 3)) {
    supportedRating = '20-30';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (frequent)`,
        `${painCount} pain episodes documented`,
        limitedOpeningCount > 0 ? `${limitedOpeningCount} limited opening episodes` : `${lockingCount} locking episodes`,
        'Symptoms suggest moderate to severe TMJ dysfunction'
    );
    gaps.push('Higher ratings (20-30%) require dental/oral surgery examination');
    gaps.push('Document if symptoms affect BOTH sides of jaw (bilateral)');
    gaps.push('Measure jaw opening: normal is 35-50mm, limited is <35mm');
  }
  else if (episodesPerWeek >= 2 || painCount >= 5) {
    supportedRating = '10';
    ratingRationale.push(
        `${tmjSymptoms.length} TMJ episodes documented`,
        'Regular pain and dysfunction',
        'Meets criteria for 10% rating (mild TMJ disorder)'
    );
  }
  else {
    supportedRating = '10';
    ratingRationale.push(
        'TMJ symptoms documented',
        'Supports 10% rating for mild disorder'
    );
  }

  // Documentation gaps
  if (tmjSymptoms.length < 8) {
    gaps.push(`Only ${tmjSymptoms.length} episodes logged - aim for 8+ over 90 days`);
  }

  if (painCount === 0) {
    gaps.push('Pain is primary TMJ symptom - document jaw pain episodes');
  }

  if (clickingCount === 0 && limitedOpeningCount === 0 && lockingCount === 0) {
    gaps.push('Log mechanical symptoms: clicking, limited opening, or locking');
  }

  gaps.push('All TMJ ratings require dental/oral surgery examination');
  gaps.push('Document bilateral (both sides) involvement for higher ratings');
  gaps.push('Track impact on eating, talking, yawning');

  return {
    condition: 'Temporomandibular Joint (TMJ) Disorder',
    diagnosticCode: '9905',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: TMJ_CRITERIA,
    disclaimer: TMJ_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Plantar Fasciitis logs for VA rating
 * DC 5276 - Plantar Fasciitis
 */
export const analyzePlantarFasciitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const pfSymptoms = logs.filter(log =>
      CONDITIONS.PLANTAR_FASCIITIS.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (pfSymptoms.length === 0) {
    return {
      condition: 'Plantar Fasciitis',
      diagnosticCode: '5276',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No plantar fasciitis symptoms logged',
        'Log heel pain episodes',
        'Document morning pain (first steps)',
        'Track arch pain and stiffness',
        'Note if symptoms affect one or both feet',
      ],
      criteria: PLANTAR_FASCIITIS_CRITERIA,
      disclaimer: PLANTAR_FASCIITIS_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const heelPainCount = pfSymptoms.filter(s => getLogSymptomId(s) === 'pf-heel-pain').length;
  const archPainCount = pfSymptoms.filter(s => getLogSymptomId(s) === 'pf-arch-pain').length;
  const morningPainCount = pfSymptoms.filter(s => getLogSymptomId(s) === 'pf-morning-pain').length;
  const stiffnessCount = pfSymptoms.filter(s => getLogSymptomId(s) === 'pf-stiffness').length;
  const walkingDifficultyCount = pfSymptoms.filter(s => getLogSymptomId(s) === 'pf-difficulty-walking').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = pfSymptoms.length / weeksInPeriod;

  evidence.push(`${pfSymptoms.length} plantar fasciitis episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (heelPainCount > 0) evidence.push(`${heelPainCount} heel pain episodes`);
  if (archPainCount > 0) evidence.push(`${archPainCount} arch pain episodes`);
  if (morningPainCount > 0) evidence.push(`${morningPainCount} morning pain episodes (characteristic symptom)`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (walkingDifficultyCount > 0) evidence.push(`${walkingDifficultyCount} walking difficulty episodes`);

  // Determine rating
  // 30%: Bilateral severe with marked limitation
  // 20%: Unilateral severe or bilateral moderate
  // 10%: Unilateral moderate or bilateral mild

  if (episodesPerWeek >= 5 && walkingDifficultyCount >= 8) {
    supportedRating = '20-30';
    ratingRationale.push(
        `${episodesPerWeek.toFixed(1)} episodes per week (frequent)`,
        `${walkingDifficultyCount} episodes affecting ability to walk`,
        'Symptoms suggest severe functional limitation'
    );
    gaps.push('Higher ratings require podiatry documentation of bilateral involvement');
    gaps.push('Document severity on BOTH feet for 30% rating');
    gaps.push('Track impact on weight-bearing and standing');
  }
  else if (episodesPerWeek >= 3 || walkingDifficultyCount > 0) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${pfSymptoms.length} episodes over ${evaluationPeriodDays} days`,
        walkingDifficultyCount > 0 ? 'Functional impairment documented' : 'Regular symptoms documented',
        'Supports 10-20% rating range'
    );
    gaps.push('Document if symptoms affect one foot (unilateral) or both (bilateral)');
  }
  else {
    supportedRating = '10';
    ratingRationale.push(
        `${pfSymptoms.length} plantar fasciitis episodes`,
        'Supports 10% rating for mild to moderate symptoms'
    );
  }

  // Documentation gaps
  if (pfSymptoms.length < 10) {
    gaps.push(`Only ${pfSymptoms.length} episodes logged - aim for 10+ over 90 days`);
  }

  if (morningPainCount === 0) {
    gaps.push('Morning pain (first steps) is characteristic - document if present');
  }

  if (walkingDifficultyCount === 0) {
    gaps.push('Document functional impact: difficulty walking, standing, or weight-bearing');
  }

  gaps.push('Higher ratings require bilateral (both feet) involvement');
  gaps.push('Podiatry examination strengthens claim');
  gaps.push('Document orthotics, injections, or physical therapy tried');

  return {
    condition: 'Plantar Fasciitis',
    diagnosticCode: '5276',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: PLANTAR_FASCIITIS_CRITERIA,
    disclaimer: PLANTAR_FASCIITIS_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Insomnia logs for VA rating
 * DC 8108 - Insomnia
 */
export const analyzeInsomniaLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const insomniaSymptoms = logs.filter(log =>
      CONDITIONS.INSOMNIA.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (insomniaSymptoms.length === 0) {
    return {
      condition: 'Insomnia (Sleep Disorder)',
      diagnosticCode: '8108',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No insomnia symptoms logged',
        'Log difficulty falling asleep',
        'Document difficulty staying asleep',
        'Track early morning awakening',
        'Note daytime fatigue and functional impact',
      ],
      criteria: INSOMNIA_CRITERIA,
      disclaimer: INSOMNIA_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const difficultyFallingCount = insomniaSymptoms.filter(s => getLogSymptomId(s) === 'insomnia-difficulty-falling-asleep').length;
  const difficultyStayingCount = insomniaSymptoms.filter(s => getLogSymptomId(s) === 'insomnia-difficulty-staying-asleep').length;
  const earlyWakingCount = insomniaSymptoms.filter(s => getLogSymptomId(s) === 'insomnia-early-waking').length;
  const fatigueCount = insomniaSymptoms.filter(s => getLogSymptomId(s) === 'insomnia-fatigue').length;
  const irritabilityCount = insomniaSymptoms.filter(s => getLogSymptomId(s) === 'insomnia-irritability').length;

  // Calculate per-week average (nights with insomnia)
  const weeksInPeriod = evaluationPeriodDays / 7;
  const nightsPerWeek = insomniaSymptoms.length / weeksInPeriod;

  evidence.push(`${insomniaSymptoms.length} insomnia episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${nightsPerWeek.toFixed(1)} nights per week with sleep disturbance`);

  if (difficultyFallingCount > 0) evidence.push(`${difficultyFallingCount} nights with difficulty falling asleep`);
  if (difficultyStayingCount > 0) evidence.push(`${difficultyStayingCount} nights with difficulty staying asleep`);
  if (earlyWakingCount > 0) evidence.push(`${earlyWakingCount} early morning awakenings`);
  if (fatigueCount > 0) evidence.push(`${fatigueCount} daytime fatigue episodes`);
  if (irritabilityCount > 0) evidence.push(`${irritabilityCount} irritability episodes from poor sleep`);

  // Determine rating based on frequency and functional impact
  // 100%: Daily/near-daily with total impairment
  // 50%: 4-5 nights/week with significant work impact
  // 30%: 3-4 nights/week with moderate impact
  // 10%: 1-2 nights/week with mild impact

  if (nightsPerWeek >= 6 && fatigueCount >= 15) {
    supportedRating = '50-100';
    ratingRationale.push(
        `${nightsPerWeek.toFixed(1)} nights per week with insomnia (daily/near-daily)`,
        `${fatigueCount} daytime dysfunction episodes`,
        'Chronic severe sleep deprivation',
        'Likely significant occupational/social impairment'
    );
    gaps.push('50-100% ratings require documentation of occupational impairment');
    gaps.push('Document work performance issues or inability to work');
    gaps.push('Sleep study results strengthen claim');
  }
  else if (nightsPerWeek >= 4 && fatigueCount >= 8) {
    supportedRating = '30-50';
    ratingRationale.push(
        `${nightsPerWeek.toFixed(1)} nights per week with insomnia (frequent)`,
        `${fatigueCount} daytime dysfunction episodes`,
        'Supports 30-50% rating range'
    );
    gaps.push('Document work performance impact for higher rating');
    gaps.push('Track missed work or reduced productivity');
  }
  else if (nightsPerWeek >= 3) {
    supportedRating = '30';
    ratingRationale.push(
        `${nightsPerWeek.toFixed(1)} nights per week with insomnia`,
        'Regular sleep disturbance',
        'Meets criteria for 30% rating'
    );
  }
  else if (nightsPerWeek >= 1) {
    supportedRating = '10';
    ratingRationale.push(
        `${nightsPerWeek.toFixed(1)} nights per week with insomnia`,
        'Intermittent sleep problems',
        'Meets criteria for 10% rating'
    );
  }
  else {
    supportedRating = '0';
    ratingRationale.push(
        'Infrequent sleep disturbance',
        'May be controlled with treatment'
    );
  }

  // Documentation gaps
  if (insomniaSymptoms.length < 12) {
    gaps.push(`Only ${insomniaSymptoms.length} episodes logged - aim for 12+ over 90 days`);
  }

  if (fatigueCount === 0 && irritabilityCount === 0) {
    gaps.push('Document daytime dysfunction (fatigue, irritability, concentration problems)');
  }

  if (difficultyFallingCount === 0 && difficultyStayingCount === 0 && earlyWakingCount === 0) {
    gaps.push('Specify type of insomnia: difficulty falling asleep, staying asleep, or early waking');
  }

  gaps.push('Often rated as secondary to PTSD, chronic pain, or other conditions');
  gaps.push('Sleep study may be required for higher ratings');
  gaps.push('Document treatments tried (medication, CBT-I, sleep hygiene)');

  return {
    condition: 'Insomnia (Sleep Disorder)',
    diagnosticCode: '8108',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: INSOMNIA_CRITERIA,
    disclaimer: INSOMNIA_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Sinusitis logs for VA rating
 * DC 6510 - Chronic Sinusitis
 */
export const analyzeSinusitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const sinusitisSymptoms = logs.filter(log =>
      CONDITIONS.SINUSITIS.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (sinusitisSymptoms.length === 0) {
    return {
      condition: 'Chronic Sinusitis',
      diagnosticCode: '6510',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No sinusitis symptoms logged',
        'Log facial pain/pressure episodes',
        'Document nasal congestion',
        'Track sinus headaches',
        'Note post-nasal drainage',
      ],
      criteria: SINUSITIS_CRITERIA,
      disclaimer: SINUSITIS_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const facialPainCount = sinusitisSymptoms.filter(s => getLogSymptomId(s) === 'sinusitis-facial-pain').length;
  const pressureCount = sinusitisSymptoms.filter(s => getLogSymptomId(s) === 'sinusitis-pressure').length;
  const congestionCount = sinusitisSymptoms.filter(s => getLogSymptomId(s) === 'sinusitis-congestion').length;
  const headacheCount = sinusitisSymptoms.filter(s => getLogSymptomId(s) === 'sinusitis-headache').length;
  const drainageCount = sinusitisSymptoms.filter(s => getLogSymptomId(s) === 'sinusitis-drainage').length;

  // Check if chronic (persistent symptoms) vs episodic (acute attacks)
  const daysWithSymptoms = new Set(sinusitisSymptoms.map(s =>
      new Date(s.timestamp).toDateString()
  )).size;

  const weeksInPeriod = evaluationPeriodDays / 7;

  evidence.push(`${sinusitisSymptoms.length} sinusitis episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`${daysWithSymptoms} different days with symptoms`);

  if (facialPainCount > 0) evidence.push(`${facialPainCount} facial pain episodes`);
  if (pressureCount > 0) evidence.push(`${pressureCount} sinus pressure episodes`);
  if (congestionCount > 0) evidence.push(`${congestionCount} congestion episodes`);
  if (headacheCount > 0) evidence.push(`${headacheCount} sinus headaches`);
  if (drainageCount > 0) evidence.push(`${drainageCount} post-nasal drainage episodes`);

  // Determine rating
  // 50%: Radical surgery or marked incapacitating episodes
  // 30%: 3+ incapacitating episodes/year
  // 10%: 1-2 episodes/year or chronic symptoms

  // Estimate annual episodes
  const estimatedAnnualEpisodes = (daysWithSymptoms / evaluationPeriodDays) * 365;

  if (daysWithSymptoms >= 60 && (facialPainCount >= 15 || headacheCount >= 15)) {
    supportedRating = '10-30';
    ratingRationale.push(
        `${daysWithSymptoms} days with symptoms over ${evaluationPeriodDays} days`,
        'Chronic sinusitis symptoms documented',
        'Likely supports 10-30% rating range'
    );
    gaps.push('30% rating requires 3+ incapacitating episodes per year');
    gaps.push('Document acute episodes requiring prolonged antibiotics (10-14 days)');
    gaps.push('ENT evaluation and CT imaging strengthen claim');
  }
  else if (daysWithSymptoms >= 20 || sinusitisSymptoms.length >= 15) {
    supportedRating = '10';
    ratingRationale.push(
        `${sinusitisSymptoms.length} episodes documented`,
        'Chronic or recurrent sinusitis symptoms',
        'Supports 10% rating'
    );
  }
  else {
    supportedRating = '10';
    ratingRationale.push(
        'Sinusitis symptoms documented',
        'Supports 10% rating for chronic symptoms'
    );
  }

  // Documentation gaps
  if (sinusitisSymptoms.length < 10) {
    gaps.push(`Only ${sinusitisSymptoms.length} episodes logged - aim for 10+ over 90 days`);
  }

  gaps.push('For 30% rating: document 3+ severe episodes per year requiring 10-14 day antibiotics');
  gaps.push('Track each acute episode: date, duration, antibiotic prescribed');
  gaps.push('ENT evaluation with nasal endoscopy strengthens claim');
  gaps.push('CT or MRI showing chronic sinus changes helpful');
  gaps.push('Document if symptoms persist despite treatment (chronic)');

  return {
    condition: 'Chronic Sinusitis',
    diagnosticCode: '6510',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: SINUSITIS_CRITERIA,
    disclaimer: SINUSITIS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Shoulder logs for VA rating
 * DC 5201-5203 - Shoulder Conditions
 */
export const analyzeShoulderLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const shoulderSymptoms = logs.filter(log =>
      CONDITIONS.SHOULDER.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (shoulderSymptoms.length === 0) {
    return {
      condition: 'Shoulder Conditions',
      diagnosticCode: '5201-5203',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No shoulder symptoms logged',
        'Log shoulder pain episodes',
        'Document limited range of motion',
        'Track instability or weakness',
        'Note impact on daily activities (reaching, lifting)',
      ],
      criteria: SHOULDER_CRITERIA,
      disclaimer: SHOULDER_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const painCount = shoulderSymptoms.filter(s => getLogSymptomId(s) === 'shoulder-pain').length;
  const limitedROMCount = shoulderSymptoms.filter(s => getLogSymptomId(s) === 'shoulder-limited-rom').length;
  const instabilityCount = shoulderSymptoms.filter(s => getLogSymptomId(s) === 'shoulder-instability').length;
  const weaknessCount = shoulderSymptoms.filter(s => getLogSymptomId(s) === 'shoulder-weakness').length;
  const stiffnessCount = shoulderSymptoms.filter(s => getLogSymptomId(s) === 'shoulder-stiffness').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = shoulderSymptoms.length / weeksInPeriod;

  evidence.push(`${shoulderSymptoms.length} shoulder episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (painCount > 0) evidence.push(`${painCount} pain episodes`);
  if (limitedROMCount > 0) evidence.push(`${limitedROMCount} limited range of motion episodes`);
  if (instabilityCount > 0) evidence.push(`${instabilityCount} instability episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);

  // Determine rating based on frequency and severity
  // Higher ratings require ROM measurements from orthopedic exam
  // 40%: Severe limitation (<90 forward elevation)
  // 30%: Moderate limitation (90-120)
  // 20%: Slight-moderate (120-160)
  // 10%: Slight impairment or recurrent instability

  if (limitedROMCount >= 10 && (painCount >= 10 || stiffnessCount >= 10)) {
    supportedRating = '30-40';
    ratingRationale.push(
        `${limitedROMCount} limited ROM episodes documented`,
        `${painCount} pain episodes`,
        'Suggests moderate to severe limitation of motion',
        'ROM measurements required for formal rating'
    );
    gaps.push('Orthopedic exam with ROM measurements required for 30-40% rating');
    gaps.push('Severe limitation: <90 forward elevation or abduction');
    gaps.push('Moderate limitation: 90-120 forward elevation');
  }
  else if (limitedROMCount >= 5 || (painCount >= 8 && episodesPerWeek >= 2)) {
    supportedRating = '20-30';
    ratingRationale.push(
        `${shoulderSymptoms.length} shoulder episodes`,
        limitedROMCount > 0 ? `${limitedROMCount} limited ROM episodes` : 'Regular pain limiting function',
        'Supports 20-30% rating range'
    );
    gaps.push('ROM measurements strengthen claim: 120-160 = 20%, 90-120 = 30%');
  }
  else if (instabilityCount > 0 || shoulderSymptoms.length >= 8) {
    supportedRating = '10';
    ratingRationale.push(
        `${shoulderSymptoms.length} episodes documented`,
        instabilityCount > 0 ? 'Recurrent instability documented' : 'Regular shoulder symptoms',
        'Supports 10% rating for slight impairment'
    );
  }
  else {
    supportedRating = '10';
    ratingRationale.push(
        'Shoulder symptoms documented',
        'Supports 10% rating'
    );
  }

  // Documentation gaps
  if (shoulderSymptoms.length < 8) {
    gaps.push(`Only ${shoulderSymptoms.length} episodes logged - aim for 8+ over 90 days`);
  }

  if (painCount === 0) {
    gaps.push('Pain is primary symptom - log shoulder pain episodes');
  }

  if (limitedROMCount === 0) {
    gaps.push('Document limited range of motion episodes');
  }

  gaps.push('All shoulder ratings require orthopedic examination with ROM measurements');
  gaps.push('Document which shoulder (left/right) or bilateral');
  gaps.push('Track impact on daily activities: reaching overhead, dressing, lifting');
  gaps.push('X-rays showing degenerative changes strengthen claim');

  return {
    condition: 'Shoulder Conditions',
    diagnosticCode: '5201-5203',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: SHOULDER_CRITERIA,
    disclaimer: SHOULDER_CRITERIA.disclaimer,
  };
};


/**
 * Analyze Hip logs for VA rating
 * DC 5252-5255 - Hip Conditions
 */
export const analyzeHipLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const hipSymptoms = logs.filter(log =>
      CONDITIONS.HIP.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (hipSymptoms.length === 0) {
    return {
      condition: 'Hip Conditions',
      diagnosticCode: '5252-5255',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No hip symptoms logged',
        'Log hip pain episodes',
        'Document limited range of motion',
        'Track stiffness and weakness',
        'Note impact on walking, stairs, sitting',
      ],
      criteria: HIP_CRITERIA,
      disclaimer: HIP_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptoms by type
  const painCount = hipSymptoms.filter(s => getLogSymptomId(s) === 'hip-pain').length;
  const limitedROMCount = hipSymptoms.filter(s => getLogSymptomId(s) === 'hip-limited-rom').length;
  const stiffnessCount = hipSymptoms.filter(s => getLogSymptomId(s) === 'hip-stiffness').length;
  const weaknessCount = hipSymptoms.filter(s => getLogSymptomId(s) === 'hip-weakness').length;
  const limpingCount = hipSymptoms.filter(s => getLogSymptomId(s) === 'hip-limping').length;

  // Calculate weekly average
  const weeksInPeriod = evaluationPeriodDays / 7;
  const episodesPerWeek = hipSymptoms.length / weeksInPeriod;

  evidence.push(`${hipSymptoms.length} hip episodes logged over ${evaluationPeriodDays} days`);
  evidence.push(`Average ${episodesPerWeek.toFixed(1)} episodes per week`);

  if (painCount > 0) evidence.push(`${painCount} pain episodes`);
  if (limitedROMCount > 0) evidence.push(`${limitedROMCount} limited range of motion episodes`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);
  if (limpingCount > 0) evidence.push(`${limpingCount} limping/gait disturbance episodes`);

  // Determine rating based on frequency and severity
  // Higher ratings require ROM measurements and functional assessment
  // 60-50%: Ankylosis (surgical fusion)
  // 40%: Marked limitation + severe pain
  // 30%: Moderate limitation
  // 20%: Slight-moderate limitation
  // 10%: Slight limitation

  if (limitedROMCount >= 10 && painCount >= 12 && (limpingCount >= 5 || weaknessCount >= 5)) {
    supportedRating = '30-40';
    ratingRationale.push(
        `${limitedROMCount} limited ROM episodes`,
        `${painCount} pain episodes (frequent)`,
        limpingCount > 0 ? `${limpingCount} gait disturbances` : `${weaknessCount} weakness episodes`,
        'Suggests moderate to marked functional limitation'
    );
    gaps.push('Orthopedic exam with ROM measurements required for 30-40% rating');
    gaps.push('Document severity: marked limitation = 40%, moderate = 30%');
  }
  else if (limitedROMCount >= 5 || (painCount >= 8 && episodesPerWeek >= 2)) {
    supportedRating = '20-30';
    ratingRationale.push(
        `${hipSymptoms.length} hip episodes`,
        painCount > 0 ? `${painCount} pain episodes` : 'Regular symptoms documented',
        'Supports 20-30% rating range'
    );
    gaps.push('ROM measurements strengthen claim');
  }
  else if (hipSymptoms.length >= 6) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${hipSymptoms.length} episodes documented`,
        'Regular hip symptoms',
        'Supports 10-20% rating range'
    );
  }
  else {
    supportedRating = '10';
    ratingRationale.push(
        'Hip symptoms documented',
        'Supports 10% rating for slight impairment'
    );
  }

  // Documentation gaps
  if (hipSymptoms.length < 8) {
    gaps.push(`Only ${hipSymptoms.length} episodes logged - aim for 8+ over 90 days`);
  }

  if (painCount === 0) {
    gaps.push('Pain is primary symptom - log hip pain episodes');
  }

  if (limitedROMCount === 0) {
    gaps.push('Document limited range of motion episodes');
  }

  if (limpingCount === 0) {
    gaps.push('Document gait changes or limping if present');
  }

  gaps.push('All hip ratings require orthopedic examination with ROM measurements');
  gaps.push('Document which hip (left/right) or bilateral');
  gaps.push('Track functional impact: walking distance, stairs, sitting, getting in/out of car');
  gaps.push('X-rays showing arthritis or other pathology strengthen claim');

  return {
    condition: 'Hip Conditions',
    diagnosticCode: '5252-5255',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: HIP_CRITERIA,
    disclaimer: HIP_CRITERIA.disclaimer,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - ANKLE
// ============================================

/**
 * Analyzes ankle symptom logs to determine supported VA rating level
 */
export const analyzeAnkleLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter ankle symptom logs
  const ankleSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.ANKLE.symptomIds.includes(getLogSymptomId(log));
  });

  if (ankleSymptoms.length === 0) {
    return {
      condition: 'Ankle Conditions',
      diagnosticCode: '5270-5271',
      hasData: false,
      message: 'No ankle symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const painCount = ankleSymptoms.filter(s => getLogSymptomId(s) === 'ankle-pain').length;
  const limitedROMCount = ankleSymptoms.filter(s => getLogSymptomId(s) === 'ankle-limited-rom').length;
  const stiffnessCount = ankleSymptoms.filter(s => getLogSymptomId(s) === 'ankle-stiffness').length;
  const instabilityCount = ankleSymptoms.filter(s => getLogSymptomId(s) === 'ankle-instability').length;
  const swellingCount = ankleSymptoms.filter(s => getLogSymptomId(s) === 'ankle-swelling').length;
  const weaknessCount = ankleSymptoms.filter(s => getLogSymptomId(s) === 'ankle-weakness').length;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (painCount > 0) evidence.push(`${painCount} ankle pain episodes documented`);
  if (limitedROMCount > 0) evidence.push(`${limitedROMCount} limited ROM episodes`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (instabilityCount > 0) evidence.push(`${instabilityCount} instability episodes`);
  if (swellingCount > 0) evidence.push(`${swellingCount} swelling episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);

  const totalEpisodes = ankleSymptoms.length;
  const episodesPerWeek = totalEpisodes / (evaluationPeriodDays / 7);

  evidence.push(`${totalEpisodes} total ankle episodes in ${evaluationPeriodDays} days (~${episodesPerWeek.toFixed(1)}/week)`);

  // Determine rating based on symptom patterns
  // 40%: Ankylosis with severe deformity (rare, requires surgical documentation)
  // 30%: Ankylosis in moderate position
  // 20%: Ankylosis <30 plantar flexion OR marked limitation (<5 dorsiflexion, <10 plantar)
  // 10%: Moderate limitation (<15 dorsiflexion, <30 plantar)

  if (limitedROMCount >= 12 && painCount >= 15 && (instabilityCount >= 5 || swellingCount >= 5)) {
    supportedRating = '20';
    ratingRationale.push(
        `${limitedROMCount} limited ROM episodes (frequent)`,
        `${painCount} pain episodes`,
        instabilityCount > 0 ? `${instabilityCount} instability episodes` : `${swellingCount} swelling episodes`,
        'Pattern suggests marked limitation - supports 20%'
    );
    gaps.push('Goniometer ROM measurements needed to confirm marked limitation');
    gaps.push('Marked limitation = <5 dorsiflexion OR <10 plantar flexion');
  }
  else if (limitedROMCount >= 6 || (painCount >= 10 && episodesPerWeek >= 2)) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${totalEpisodes} ankle episodes in ${evaluationPeriodDays} days`,
        painCount > 0 ? `${painCount} pain episodes` : 'Symptoms documented',
        'Supports 10-20% rating range'
    );
    gaps.push('ROM measurements will determine if 10% (moderate) or 20% (marked) limitation');
  }
  else if (totalEpisodes >= 4) {
    supportedRating = '10';
    ratingRationale.push(
        `${totalEpisodes} ankle episodes documented`,
        'Supports 10% rating for moderate limitation'
    );
  }
  else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited ankle symptoms documented',
        'May support 10% if ROM limitation confirmed'
    );
  }

  // Documentation gaps
  if (totalEpisodes < 8) {
    gaps.push(`Only ${totalEpisodes} episodes logged - aim for 8+ over 90 days`);
  }
  if (painCount === 0) {
    gaps.push('Pain is primary symptom - document ankle pain episodes');
  }
  if (limitedROMCount === 0) {
    gaps.push('Document limited ROM episodes for stronger claim');
  }
  gaps.push('Orthopedic exam with goniometer ROM measurements required');
  gaps.push('Document which ankle (left/right) or bilateral');
  gaps.push('Track functional impact: walking, stairs, standing, running');
  gaps.push('X-rays showing arthritis or pathology strengthen claim');

  return {
    condition: 'Ankle Conditions',
    diagnosticCode: '5270-5271',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: ANKLE_CRITERIA,
    disclaimer: ANKLE_CRITERIA.disclaimer,
  };
};


// ============================================
// ANALYSIS FUNCTIONS - WRIST
// ============================================

/**
 * Analyzes wrist symptom logs to determine supported VA rating level
 */
export const analyzeWristLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter wrist symptom logs
  const wristSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.WRIST.symptomIds.includes(getLogSymptomId(log));
  });

  if (wristSymptoms.length === 0) {
    return {
      condition: 'Wrist Conditions',
      diagnosticCode: '5214-5215',
      hasData: false,
      message: 'No wrist symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const painCount = wristSymptoms.filter(s => getLogSymptomId(s) === 'wrist-pain').length;
  const limitedROMCount = wristSymptoms.filter(s => getLogSymptomId(s) === 'wrist-limited-rom').length;
  const stiffnessCount = wristSymptoms.filter(s => getLogSymptomId(s) === 'wrist-stiffness').length;
  const weaknessCount = wristSymptoms.filter(s => getLogSymptomId(s) === 'wrist-weakness').length;
  const numbnessCount = wristSymptoms.filter(s => getLogSymptomId(s) === 'wrist-numbness').length;
  const swellingCount = wristSymptoms.filter(s => getLogSymptomId(s) === 'wrist-swelling').length;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (painCount > 0) evidence.push(`${painCount} wrist pain episodes documented`);
  if (limitedROMCount > 0) evidence.push(`${limitedROMCount} limited ROM episodes`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);
  if (numbnessCount > 0) evidence.push(`${numbnessCount} numbness/tingling episodes`);
  if (swellingCount > 0) evidence.push(`${swellingCount} swelling episodes`);

  const totalEpisodes = wristSymptoms.length;
  const episodesPerWeek = totalEpisodes / (evaluationPeriodDays / 7);

  evidence.push(`${totalEpisodes} total wrist episodes in ${evaluationPeriodDays} days (~${episodesPerWeek.toFixed(1)}/week)`);

  // Determine rating based on symptom patterns
  // Wrist limitation of motion: maximum 10% for limitation
  // Higher ratings (30-50%) require ankylosis (fusion)
  // 10%: Dorsiflexion <15 OR palmar flexion in line with forearm

  if (limitedROMCount >= 10 || (painCount >= 12 && episodesPerWeek >= 3)) {
    supportedRating = '10';
    ratingRationale.push(
        `${totalEpisodes} wrist episodes documented`,
        `${painCount} pain episodes`,
        'Supports 10% rating for limited motion'
    );
    ratingRationale.push('Higher ratings (30-50%) require documented ankylosis (fusion)');
  }
  else if (totalEpisodes >= 6) {
    supportedRating = '10';
    ratingRationale.push(
        `${totalEpisodes} wrist episodes in ${evaluationPeriodDays} days`,
        'Supports 10% for limitation of motion'
    );
  }
  else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited wrist symptoms documented',
        'May support 10% if ROM limitation confirmed'
    );
  }

  // Documentation gaps
  if (totalEpisodes < 8) {
    gaps.push(`Only ${totalEpisodes} episodes logged - aim for 8+ over 90 days`);
  }
  if (painCount === 0) {
    gaps.push('Document wrist pain episodes');
  }
  if (limitedROMCount === 0) {
    gaps.push('Document limited ROM episodes');
  }
  gaps.push('Orthopedic exam with ROM measurements required');
  gaps.push('Document which wrist (dominant/non-dominant) - affects rating');
  gaps.push('Note: Wrist limitation max is 10%. Higher ratings require ankylosis.');
  gaps.push('If numbness present, consider separate peripheral nerve evaluation');
  gaps.push('X-rays showing arthritis or carpal abnormalities strengthen claim');

  return {
    condition: 'Wrist Conditions',
    diagnosticCode: '5214-5215',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: WRIST_CRITERIA,
    disclaimer: WRIST_CRITERIA.disclaimer,
  };
};


// ============================================
// ANALYSIS FUNCTIONS - ELBOW
// ============================================

/**
 * Analyzes elbow symptom logs to determine supported VA rating level
 */
export const analyzeElbowLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter elbow symptom logs
  const elbowSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.ELBOW.symptomIds.includes(getLogSymptomId(log));
  });

  if (elbowSymptoms.length === 0) {
    return {
      condition: 'Elbow Conditions',
      diagnosticCode: '5205-5207',
      hasData: false,
      message: 'No elbow symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const painCount = elbowSymptoms.filter(s => getLogSymptomId(s) === 'elbow-pain').length;
  const limitedFlexionCount = elbowSymptoms.filter(s => getLogSymptomId(s) === 'elbow-limited-flexion').length;
  const limitedExtensionCount = elbowSymptoms.filter(s => getLogSymptomId(s) === 'elbow-limited-extension').length;
  const stiffnessCount = elbowSymptoms.filter(s => getLogSymptomId(s) === 'elbow-stiffness').length;
  const weaknessCount = elbowSymptoms.filter(s => getLogSymptomId(s) === 'elbow-weakness').length;
  const instabilityCount = elbowSymptoms.filter(s => getLogSymptomId(s) === 'elbow-instability').length;

  const totalLimitedROM = limitedFlexionCount + limitedExtensionCount;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (painCount > 0) evidence.push(`${painCount} elbow pain episodes documented`);
  if (limitedFlexionCount > 0) evidence.push(`${limitedFlexionCount} limited flexion episodes`);
  if (limitedExtensionCount > 0) evidence.push(`${limitedExtensionCount} limited extension episodes`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);
  if (instabilityCount > 0) evidence.push(`${instabilityCount} instability episodes`);

  const totalEpisodes = elbowSymptoms.length;
  const episodesPerWeek = totalEpisodes / (evaluationPeriodDays / 7);

  evidence.push(`${totalEpisodes} total elbow episodes in ${evaluationPeriodDays} days (~${episodesPerWeek.toFixed(1)}/week)`);

  // Determine rating based on symptom patterns
  // Elbow ratings range from 10% (slight limitation) to 60% (ankylosis)
  // Flexion limited to 100 = 10%
  // Flexion limited to 90 = 20%
  // Flexion limited to 70 = 30%
  // Extension limited to 45-60 = 10%
  // Extension limited to 75 = 20%

  if (totalLimitedROM >= 15 && painCount >= 15) {
    supportedRating = '20-30';
    ratingRationale.push(
        `${totalLimitedROM} limited ROM episodes`,
        `${painCount} pain episodes`,
        'Pattern suggests significant limitation'
    );
    gaps.push('ROM measurements will determine actual rating (20-30%)');
    gaps.push('Flexion to 70 = 30%, to 90 = 20%');
    gaps.push('Extension to 75 = 20%, to 90 = 30%');
  }
  else if (totalLimitedROM >= 8 || (painCount >= 10 && episodesPerWeek >= 2)) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${totalEpisodes} elbow episodes`,
        'Supports 10-20% rating range'
    );
    gaps.push('ROM measurements determine rating level');
  }
  else if (totalEpisodes >= 6) {
    supportedRating = '10';
    ratingRationale.push(
        `${totalEpisodes} elbow episodes documented`,
        'Supports 10% for limitation'
    );
  }
  else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited elbow symptoms documented',
        'May support 10% if limitation confirmed'
    );
  }

  // Documentation gaps
  if (totalEpisodes < 8) {
    gaps.push(`Only ${totalEpisodes} episodes logged - aim for 8+ over 90 days`);
  }
  if (painCount === 0) {
    gaps.push('Document elbow pain episodes');
  }
  if (totalLimitedROM === 0) {
    gaps.push('Document limited flexion and/or extension episodes');
  }
  gaps.push('Orthopedic exam with ROM measurements required');
  gaps.push('Document which arm (dominant/non-dominant) - affects rating');
  gaps.push('Track functional impact: lifting, carrying, reaching');
  gaps.push('X-rays showing arthritis or abnormalities strengthen claim');

  return {
    condition: 'Elbow Conditions',
    diagnosticCode: '5205-5207',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: ELBOW_CRITERIA,
    disclaimer: ELBOW_CRITERIA.disclaimer,
  };
};


// ============================================
// ANALYSIS FUNCTIONS - DEGENERATIVE ARTHRITIS
// ============================================

/**
 * Analyzes degenerative arthritis symptom logs to determine supported VA rating level
 */
export const analyzeDegenerativeArthritisLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter arthritis symptom logs
  const arthritisSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.DEGENERATIVE_ARTHRITIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (arthritisSymptoms.length === 0) {
    return {
      condition: 'Degenerative Arthritis (Osteoarthritis)',
      diagnosticCode: '5003',
      hasData: false,
      message: 'No arthritis symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const jointPainCount = arthritisSymptoms.filter(s => getLogSymptomId(s) === 'arthritis-joint-pain').length;
  const morningStiffnessCount = arthritisSymptoms.filter(s => getLogSymptomId(s) === 'arthritis-morning-stiffness').length;
  const flareCount = arthritisSymptoms.filter(s => getLogSymptomId(s) === 'arthritis-flare').length;
  const reducedFunctionCount = arthritisSymptoms.filter(s => getLogSymptomId(s) === 'arthritis-reduced-function').length;
  const swellingCount = arthritisSymptoms.filter(s => getLogSymptomId(s) === 'arthritis-swelling').length;
  const crepitusCount = arthritisSymptoms.filter(s => getLogSymptomId(s) === 'arthritis-crepitus').length;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (jointPainCount > 0) evidence.push(`${jointPainCount} joint pain episodes documented`);
  if (morningStiffnessCount > 0) evidence.push(`${morningStiffnessCount} morning stiffness episodes`);
  if (flareCount > 0) evidence.push(`${flareCount} flare-ups/exacerbations`);
  if (reducedFunctionCount > 0) evidence.push(`${reducedFunctionCount} reduced function episodes`);
  if (swellingCount > 0) evidence.push(`${swellingCount} swelling episodes`);
  if (crepitusCount > 0) evidence.push(`${crepitusCount} grinding/crepitus episodes`);

  const totalEpisodes = arthritisSymptoms.length;
  const episodesPerWeek = totalEpisodes / (evaluationPeriodDays / 7);

  evidence.push(`${totalEpisodes} total arthritis episodes in ${evaluationPeriodDays} days (~${episodesPerWeek.toFixed(1)}/week)`);

  // Determine rating based on symptom patterns
  // DC 5003 ratings when ROM limitation is noncompensable:
  // 20%: X-ray evidence in 2+ major joints WITH incapacitating exacerbations
  // 10%: X-ray evidence in 2+ major joints WITHOUT incapacitating exacerbations
  // When ROM limitation IS compensable, rate under specific joint code

  if (flareCount >= 3 && (jointPainCount >= 15 || episodesPerWeek >= 3)) {
    supportedRating = '20';
    ratingRationale.push(
        `${flareCount} flare-ups/exacerbations documented`,
        `${totalEpisodes} total episodes`,
        'Pattern suggests incapacitating exacerbations'
    );
    gaps.push('X-rays of affected joints required for 20% rating');
    gaps.push('Document 2 or more major joints affected');
    gaps.push('Document flare-ups that limit work or daily activities');
  }
  else if (totalEpisodes >= 10 || episodesPerWeek >= 2) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${totalEpisodes} arthritis episodes documented`,
        'Supports 10-20% rating depending on X-ray findings'
    );
    gaps.push('X-rays of affected joints needed');
    gaps.push('20% requires incapacitating exacerbations');
  }
  else if (totalEpisodes >= 5) {
    supportedRating = '10';
    ratingRationale.push(
        `${totalEpisodes} arthritis episodes`,
        'Supports 10% with X-ray evidence of 2+ joints'
    );
  }
  else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited arthritis symptoms documented',
        'Continue logging for stronger documentation'
    );
  }

  // Documentation gaps
  if (totalEpisodes < 8) {
    gaps.push(`Only ${totalEpisodes} episodes logged - aim for 8+ over 90 days`);
  }
  if (jointPainCount === 0) {
    gaps.push('Joint pain is primary symptom - document pain episodes');
  }
  if (morningStiffnessCount === 0) {
    gaps.push('Morning stiffness is key indicator - document duration');
  }
  if (flareCount === 0) {
    gaps.push('Document flare-ups that limit activities');
  }

  gaps.push('X-ray evidence is REQUIRED for DC 5003 rating');
  gaps.push('Document which joints are affected (name specific joints)');
  gaps.push('Major joints: shoulder, elbow, wrist, hip, knee, ankle');
  gaps.push('If a specific joint has compensable ROM limitation, rate under that joint code instead');

  return {
    condition: 'Degenerative Arthritis (Osteoarthritis)',
    diagnosticCode: '5003',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: DEGENERATIVE_ARTHRITIS_CRITERIA,
    disclaimer: DEGENERATIVE_ARTHRITIS_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 4A: ANALYSIS FUNCTIONS - GOUT (DC 5017)
// ============================================

/**
 * Analyzes gout symptom logs to determine supported VA rating level
 * Rated as degenerative arthritis per 38 CFR 4.71a Note to DCs 5013-5024
 */
export const analyzeGoutLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter gout symptom logs
  const goutSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.GOUT.symptomIds.includes(getLogSymptomId(log));
  });

  if (goutSymptoms.length === 0) {
    return {
      condition: 'Gout',
      diagnosticCode: '5017',
      hasData: false,
      message: 'No gout symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const acuteAttackCount = goutSymptoms.filter(s => getLogSymptomId(s) === 'gout-acute-attack').length;
  const jointPainCount = goutSymptoms.filter(s => getLogSymptomId(s) === 'gout-joint-pain').length;
  const swellingCount = goutSymptoms.filter(s => getLogSymptomId(s) === 'gout-swelling').length;
  const rednessCount = goutSymptoms.filter(s => getLogSymptomId(s) === 'gout-redness').length;
  const limitedMotionCount = goutSymptoms.filter(s => getLogSymptomId(s) === 'gout-limited-motion').length;
  const tophiCount = goutSymptoms.filter(s => getLogSymptomId(s) === 'gout-tophi').length;
  const functionalLossCount = goutSymptoms.filter(s => getLogSymptomId(s) === 'gout-functional-loss').length;

  // Calculate average severity for pain logs
  const painLogs = goutSymptoms.filter(s =>
      ['gout-acute-attack', 'gout-joint-pain'].includes(getLogSymptomId(s)) && s.severity
  );
  const avgSeverity = painLogs.length > 0
      ? (painLogs.reduce((sum, log) => sum + log.severity, 0) / painLogs.length).toFixed(1)
      : null;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (acuteAttackCount > 0) evidence.push(`${acuteAttackCount} acute gout attacks documented`);
  if (jointPainCount > 0) evidence.push(`${jointPainCount} joint pain episodes`);
  if (swellingCount > 0) evidence.push(`${swellingCount} swelling episodes`);
  if (rednessCount > 0) evidence.push(`${rednessCount} redness/warmth episodes`);
  if (limitedMotionCount > 0) evidence.push(`${limitedMotionCount} limited motion episodes`);
  if (tophiCount > 0) evidence.push(`${tophiCount} tophi documented`);
  if (functionalLossCount > 0) evidence.push(`${functionalLossCount} functional loss episodes`);

  const totalEpisodes = goutSymptoms.length;
  const attacksPerMonth = (acuteAttackCount / (evaluationPeriodDays / 30)).toFixed(1);

  evidence.push(`${totalEpisodes} total gout episodes in ${evaluationPeriodDays} days`);
  evidence.push(`~${attacksPerMonth} acute attacks per month`);

  // Determine rating based on symptom patterns
  // Rated as degenerative arthritis: 20% with incapacitating exacerbations, 10% without
  if ((acuteAttackCount >= 3 && functionalLossCount >= 2) || (acuteAttackCount >= 4)) {
    supportedRating = 20;
    ratingRationale.push(
        `${acuteAttackCount} acute gout attacks documented`,
        `${functionalLossCount} episodes with functional loss`,
        'Pattern suggests incapacitating exacerbations'
    );
    gaps.push('X-rays or imaging showing gouty changes required for rating');
    gaps.push('Document if multiple joints are affected');
    gaps.push('Lab values (uric acid levels) strengthen the claim');
  } else if (acuteAttackCount >= 2 || totalEpisodes >= 10) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${acuteAttackCount} acute attacks documented`,
        `${totalEpisodes} total gout episodes`,
        'Supports 10-20% rating depending on imaging and functional impact'
    );
    gaps.push('X-rays or imaging needed for rating');
    gaps.push('20% requires incapacitating exacerbations');
  } else if (totalEpisodes >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        `${totalEpisodes} gout episodes documented`,
        'Supports 10% with imaging evidence'
    );
  } else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited gout symptoms documented',
        'Continue logging for stronger documentation'
    );
  }

  // Documentation gaps
  if (acuteAttackCount === 0) {
    gaps.push('Document acute gout attacks with date and affected joint');
  }
  if (tophiCount === 0) {
    gaps.push('Document any tophi (urate crystal deposits) if present');
  }
  if (limitedMotionCount === 0) {
    gaps.push('Document limitation of motion during attacks');
  }
  gaps.push('Lab values showing elevated uric acid strengthen the claim');
  gaps.push('X-ray or imaging evidence required for VA rating');
  gaps.push('Document which specific joint(s) are affected');
  gaps.push('If ROM limitation is compensable, rate under specific joint code');

  return {
    condition: 'Gout',
    diagnosticCode: '5017',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: totalEpisodes,
      acuteAttacks: acuteAttackCount,
      painDays: jointPainCount + acuteAttackCount,
      avgPain: avgSeverity,
      limitedROM: limitedMotionCount,
      flareUps: acuteAttackCount,
    },
    criteria: GOUT_CRITERIA,
    disclaimer: GOUT_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 4A: ANALYSIS FUNCTIONS - BURSITIS (DC 5019)
// ============================================

/**
 * Analyzes bursitis symptom logs to determine supported VA rating level
 * Rated as degenerative arthritis per 38 CFR 4.71a Note to DCs 5013-5024
 */
export const analyzeBursitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter bursitis symptom logs
  const bursitisSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.BURSITIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (bursitisSymptoms.length === 0) {
    return {
      condition: 'Bursitis',
      diagnosticCode: '5019',
      hasData: false,
      message: 'No bursitis symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const painCount = bursitisSymptoms.filter(s => getLogSymptomId(s) === 'bursitis-pain').length;
  const swellingCount = bursitisSymptoms.filter(s => getLogSymptomId(s) === 'bursitis-swelling').length;
  const tendernessCount = bursitisSymptoms.filter(s => getLogSymptomId(s) === 'bursitis-tenderness').length;
  const limitedMotionCount = bursitisSymptoms.filter(s => getLogSymptomId(s) === 'bursitis-limited-motion').length;
  const stiffnessCount = bursitisSymptoms.filter(s => getLogSymptomId(s) === 'bursitis-stiffness').length;
  const flareCount = bursitisSymptoms.filter(s => getLogSymptomId(s) === 'bursitis-flare').length;
  const functionalLossCount = bursitisSymptoms.filter(s => getLogSymptomId(s) === 'bursitis-functional-loss').length;

  // Calculate average severity
  const painLogs = bursitisSymptoms.filter(s =>
      ['bursitis-pain', 'bursitis-flare'].includes(getLogSymptomId(s)) && s.severity
  );
  const avgSeverity = painLogs.length > 0
      ? (painLogs.reduce((sum, log) => sum + log.severity, 0) / painLogs.length).toFixed(1)
      : null;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (painCount > 0) evidence.push(`${painCount} pain episodes documented`);
  if (swellingCount > 0) evidence.push(`${swellingCount} swelling episodes`);
  if (tendernessCount > 0) evidence.push(`${tendernessCount} tenderness episodes`);
  if (limitedMotionCount > 0) evidence.push(`${limitedMotionCount} limited motion episodes`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (flareCount > 0) evidence.push(`${flareCount} flare-ups documented`);
  if (functionalLossCount > 0) evidence.push(`${functionalLossCount} functional loss episodes`);

  const totalEpisodes = bursitisSymptoms.length;
  const flaresPerMonth = (flareCount / (evaluationPeriodDays / 30)).toFixed(1);

  evidence.push(`${totalEpisodes} total bursitis episodes in ${evaluationPeriodDays} days`);

  // Determine rating based on symptom patterns
  if ((flareCount >= 3 && functionalLossCount >= 2) || (flareCount >= 4 && limitedMotionCount >= 3)) {
    supportedRating = 20;
    ratingRationale.push(
        `${flareCount} flare-ups documented`,
        `${functionalLossCount} episodes with functional loss`,
        'Pattern suggests incapacitating exacerbations'
    );
    gaps.push('Imaging (ultrasound/MRI) showing bursitis required for rating');
    gaps.push('Document if multiple bursae/joints are affected');
  } else if (flareCount >= 2 || totalEpisodes >= 10) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${flareCount} flare-ups documented`,
        `${totalEpisodes} total bursitis episodes`,
        'Supports 10-20% rating depending on imaging and functional impact'
    );
    gaps.push('Imaging evidence needed for rating');
    gaps.push('20% requires incapacitating exacerbations');
  } else if (totalEpisodes >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        `${totalEpisodes} bursitis episodes documented`,
        'Supports 10% with imaging evidence'
    );
  } else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited bursitis symptoms documented',
        'Continue logging for stronger documentation'
    );
  }

  // Documentation gaps
  if (painCount === 0) {
    gaps.push('Document pain episodes at affected bursa');
  }
  if (limitedMotionCount === 0) {
    gaps.push('Document limitation of motion');
  }
  if (flareCount === 0) {
    gaps.push('Document flare-ups that limit activities');
  }
  gaps.push('Imaging (ultrasound/MRI) required for VA rating');
  gaps.push('Document which specific bursa/joint is affected');
  gaps.push('Injection records strengthen claims');
  gaps.push('If ROM limitation is compensable, rate under specific joint code');

  return {
    condition: 'Bursitis',
    diagnosticCode: '5019',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: totalEpisodes,
      painDays: painCount,
      avgPain: avgSeverity,
      limitedROM: limitedMotionCount,
      flareUps: flareCount,
    },
    criteria: BURSITIS_CRITERIA,
    disclaimer: BURSITIS_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 4A: ANALYSIS FUNCTIONS - TENDINITIS (DC 5024)
// ============================================

/**
 * Analyzes tendinitis symptom logs to determine supported VA rating level
 * Rated as degenerative arthritis per 38 CFR 4.71a Note to DCs 5013-5024
 */
export const analyzeTendinitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter tendinitis symptom logs
  const tendinitisSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.TENDINITIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (tendinitisSymptoms.length === 0) {
    return {
      condition: 'Tendinitis/Tenosynovitis',
      diagnosticCode: '5024',
      hasData: false,
      message: 'No tendinitis symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const painCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-pain').length;
  const swellingCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-swelling').length;
  const tendernessCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-tenderness').length;
  const limitedMotionCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-limited-motion').length;
  const stiffnessCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-stiffness').length;
  const crepitusCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-crepitus').length;
  const weaknessCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-weakness').length;
  const flareCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-flare').length;
  const functionalLossCount = tendinitisSymptoms.filter(s => getLogSymptomId(s) === 'tendinitis-functional-loss').length;

  // Calculate average severity
  const painLogs = tendinitisSymptoms.filter(s =>
      ['tendinitis-pain', 'tendinitis-flare'].includes(getLogSymptomId(s)) && s.severity
  );
  const avgSeverity = painLogs.length > 0
      ? (painLogs.reduce((sum, log) => sum + log.severity, 0) / painLogs.length).toFixed(1)
      : null;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (painCount > 0) evidence.push(`${painCount} pain episodes documented`);
  if (swellingCount > 0) evidence.push(`${swellingCount} swelling episodes`);
  if (tendernessCount > 0) evidence.push(`${tendernessCount} tenderness episodes`);
  if (limitedMotionCount > 0) evidence.push(`${limitedMotionCount} limited motion episodes`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (crepitusCount > 0) evidence.push(`${crepitusCount} crepitus/clicking episodes`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);
  if (flareCount > 0) evidence.push(`${flareCount} flare-ups documented`);
  if (functionalLossCount > 0) evidence.push(`${functionalLossCount} functional loss episodes`);

  const totalEpisodes = tendinitisSymptoms.length;

  evidence.push(`${totalEpisodes} total tendinitis episodes in ${evaluationPeriodDays} days`);

  // Determine rating based on symptom patterns
  if ((flareCount >= 3 && functionalLossCount >= 2) || (flareCount >= 4 && limitedMotionCount >= 3)) {
    supportedRating = 20;
    ratingRationale.push(
        `${flareCount} flare-ups documented`,
        `${functionalLossCount} episodes with functional loss`,
        'Pattern suggests incapacitating exacerbations'
    );
    gaps.push('Imaging (ultrasound/MRI) showing tendon pathology required for rating');
    gaps.push('Document if multiple tendons are affected');
  } else if (flareCount >= 2 || totalEpisodes >= 10) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${flareCount} flare-ups documented`,
        `${totalEpisodes} total tendinitis episodes`,
        'Supports 10-20% rating depending on imaging and functional impact'
    );
    gaps.push('Imaging evidence needed for rating');
    gaps.push('20% requires incapacitating exacerbations');
  } else if (totalEpisodes >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        `${totalEpisodes} tendinitis episodes documented`,
        'Supports 10% with imaging evidence'
    );
  } else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited tendinitis symptoms documented',
        'Continue logging for stronger documentation'
    );
  }

  // Documentation gaps
  if (painCount === 0) {
    gaps.push('Document pain along affected tendon');
  }
  if (limitedMotionCount === 0) {
    gaps.push('Document limitation of motion');
  }
  if (flareCount === 0) {
    gaps.push('Document flare-ups that limit activities');
  }
  gaps.push('Imaging (ultrasound/MRI) required for VA rating');
  gaps.push('Document which specific tendon is affected');
  gaps.push('Common types: rotator cuff, tennis/golfer\'s elbow, Achilles, patellar');
  gaps.push('If ROM limitation is compensable, rate under specific joint code');

  return {
    condition: 'Tendinitis/Tenosynovitis',
    diagnosticCode: '5024',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: totalEpisodes,
      painDays: painCount,
      avgPain: avgSeverity,
      limitedROM: limitedMotionCount,
      flareUps: flareCount,
    },
    criteria: TENDINITIS_CRITERIA,
    disclaimer: TENDINITIS_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 4B: ANALYSIS FUNCTIONS - MYOSITIS (DC 5021)
// ============================================

/**
 * Analyzes myositis symptom logs to determine supported VA rating level
 * Rated as degenerative arthritis per 38 CFR 4.71a Note to DCs 5013-5024
 */
export const analyzeMyositisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter myositis symptom logs
  const myositisSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.MYOSITIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (myositisSymptoms.length === 0) {
    return {
      condition: 'Myositis',
      diagnosticCode: '5021',
      hasData: false,
      message: 'No myositis symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const painCount = myositisSymptoms.filter(s => getLogSymptomId(s) === 'myositis-muscle-pain').length;
  const weaknessCount = myositisSymptoms.filter(s => getLogSymptomId(s) === 'myositis-weakness').length;
  const fatigueCount = myositisSymptoms.filter(s => getLogSymptomId(s) === 'myositis-fatigue').length;
  const limitedMotionCount = myositisSymptoms.filter(s => getLogSymptomId(s) === 'myositis-limited-motion').length;
  const flareCount = myositisSymptoms.filter(s => getLogSymptomId(s) === 'myositis-flare').length;
  const functionalLossCount = myositisSymptoms.filter(s => getLogSymptomId(s) === 'myositis-functional-loss').length;

  // Calculate average severity
  const painLogs = myositisSymptoms.filter(s =>
      ['myositis-muscle-pain', 'myositis-flare'].includes(getLogSymptomId(s)) && s.severity
  );
  const avgSeverity = painLogs.length > 0
      ? (painLogs.reduce((sum, log) => sum + log.severity, 0) / painLogs.length).toFixed(1)
      : null;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (painCount > 0) evidence.push(`${painCount} muscle pain episodes documented`);
  if (weaknessCount > 0) evidence.push(`${weaknessCount} weakness episodes`);
  if (fatigueCount > 0) evidence.push(`${fatigueCount} fatigue episodes`);
  if (limitedMotionCount > 0) evidence.push(`${limitedMotionCount} limited motion episodes`);
  if (flareCount > 0) evidence.push(`${flareCount} flare-ups documented`);
  if (functionalLossCount > 0) evidence.push(`${functionalLossCount} functional loss episodes`);

  const totalEpisodes = myositisSymptoms.length;

  evidence.push(`${totalEpisodes} total myositis episodes in ${evaluationPeriodDays} days`);

  // Determine rating based on symptom patterns
  if ((flareCount >= 3 && functionalLossCount >= 2) || (flareCount >= 4 && weaknessCount >= 5)) {
    supportedRating = 20;
    ratingRationale.push(
        `${flareCount} flare-ups documented`,
        `${functionalLossCount} episodes with functional loss`,
        'Pattern suggests incapacitating exacerbations'
    );
    gaps.push('Lab values (CK, aldolase) showing muscle inflammation required');
    gaps.push('Document if multiple muscle groups are affected');
  } else if (flareCount >= 2 || totalEpisodes >= 10) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${flareCount} flare-ups documented`,
        `${totalEpisodes} total myositis episodes`,
        'Supports 10-20% rating depending on clinical findings'
    );
    gaps.push('Lab values and/or muscle biopsy needed for rating');
    gaps.push('20% requires incapacitating exacerbations');
  } else if (totalEpisodes >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        `${totalEpisodes} myositis episodes documented`,
        'Supports 10% with documented diagnosis'
    );
  } else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited myositis symptoms documented',
        'Continue logging for stronger documentation'
    );
  }

  // Documentation gaps
  if (painCount === 0) {
    gaps.push('Document muscle pain episodes');
  }
  if (weaknessCount === 0) {
    gaps.push('Document muscle weakness - key symptom');
  }
  if (flareCount === 0) {
    gaps.push('Document flare-ups that limit activities');
  }
  gaps.push('Lab values (CK, aldolase) showing elevated muscle enzymes strengthen claim');
  gaps.push('Muscle biopsy or MRI showing inflammation is strong evidence');
  gaps.push('Document which muscle groups are affected');

  return {
    condition: 'Myositis',
    diagnosticCode: '5021',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: totalEpisodes,
      painDays: painCount,
      avgPain: avgSeverity,
      limitedROM: limitedMotionCount,
      flareUps: flareCount,
    },
    criteria: MYOSITIS_CRITERIA,
    disclaimer: MYOSITIS_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 4B: ANALYSIS FUNCTIONS - OSTEOMYELITIS (DC 5000)
// ============================================

/**
 * Analyzes osteomyelitis symptom logs to determine supported VA rating level
 * Has its own unique rating schedule
 */
export const analyzeOsteomyelitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter osteomyelitis symptom logs
  const osteoSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.OSTEOMYELITIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (osteoSymptoms.length === 0) {
    return {
      condition: 'Osteomyelitis',
      diagnosticCode: '5000',
      hasData: false,
      message: 'No osteomyelitis symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const bonePainCount = osteoSymptoms.filter(s => getLogSymptomId(s) === 'osteo-bone-pain').length;
  const feverCount = osteoSymptoms.filter(s => getLogSymptomId(s) === 'osteo-fever').length;
  const drainageCount = osteoSymptoms.filter(s => getLogSymptomId(s) === 'osteo-drainage').length;
  const constitutionalCount = osteoSymptoms.filter(s => getLogSymptomId(s) === 'osteo-constitutional').length;
  const flareCount = osteoSymptoms.filter(s => getLogSymptomId(s) === 'osteo-flare').length;
  const weightLossCount = osteoSymptoms.filter(s => getLogSymptomId(s) === 'osteo-weight-loss').length;
  const fatigueCount = osteoSymptoms.filter(s => getLogSymptomId(s) === 'osteo-fatigue').length;

  // Calculate average severity
  const painLogs = osteoSymptoms.filter(s =>
      ['osteo-bone-pain', 'osteo-flare'].includes(getLogSymptomId(s)) && s.severity
  );
  const avgSeverity = painLogs.length > 0
      ? (painLogs.reduce((sum, log) => sum + log.severity, 0) / painLogs.length).toFixed(1)
      : null;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (bonePainCount > 0) evidence.push(`${bonePainCount} bone pain episodes documented`);
  if (feverCount > 0) evidence.push(`${feverCount} fever episodes`);
  if (drainageCount > 0) evidence.push(`${drainageCount} draining sinus/wound documented`);
  if (constitutionalCount > 0) evidence.push(`${constitutionalCount} constitutional symptom episodes`);
  if (flareCount > 0) evidence.push(`${flareCount} active infection episodes`);
  if (weightLossCount > 0) evidence.push(`${weightLossCount} weight loss episodes`);
  if (fatigueCount > 0) evidence.push(`${fatigueCount} fatigue episodes`);

  const totalEpisodes = osteoSymptoms.length;

  evidence.push(`${totalEpisodes} total osteomyelitis episodes in ${evaluationPeriodDays} days`);

  // Determine rating based on symptom patterns (DC 5000 specific criteria)
  const hasConstitutionalSymptoms = constitutionalCount > 0 || (feverCount >= 3 && (weightLossCount > 0 || fatigueCount >= 3));
  const hasDrainingSinus = drainageCount > 0;
  const hasFrequentEpisodes = flareCount >= 4;

  if (hasConstitutionalSymptoms && hasFrequentEpisodes) {
    supportedRating = '60-100';
    ratingRationale.push(
        `${flareCount} active infection episodes documented`,
        `${constitutionalCount} constitutional symptom episodes`,
        'Pattern suggests frequent episodes with constitutional symptoms',
        '100% requires pelvis/vertebrae, major joints, or multiple localization'
    );
    gaps.push('Document which bone(s) are affected');
    gaps.push('100% requires pelvis, vertebrae, major joint involvement, or multiple sites');
  } else if (hasDrainingSinus) {
    supportedRating = '20-30';
    ratingRationale.push(
        `${drainageCount} draining sinus/wound episodes documented`,
        '30% requires involucrum or sequestrum on imaging',
        '20% requires active infection evidence within past 5 years'
    );
    gaps.push('Imaging showing involucrum/sequestrum needed for 30%');
  } else if (flareCount >= 2 || (feverCount >= 2 && bonePainCount >= 3)) {
    supportedRating = '10-20';
    ratingRationale.push(
        `${flareCount} active infection episodes`,
        'Supports 10-20% based on infection history',
        '20% requires active infection evidence within past 5 years'
    );
    gaps.push('Document infection episodes and treatment');
    gaps.push('Need evidence of recurrent osteomyelitis (2+ episodes after initial)');
  } else if (totalEpisodes >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        'History of osteomyelitis documented',
        '10% requires inactive disease following repeated episodes'
    );
  } else {
    supportedRating = '0-10';
    ratingRationale.push(
        'Limited osteomyelitis symptoms documented',
        'Continue logging for stronger documentation'
    );
  }

  // Documentation gaps
  if (drainageCount === 0) {
    gaps.push('Document any draining sinuses or wounds');
  }
  if (constitutionalCount === 0 && feverCount === 0) {
    gaps.push('Document constitutional symptoms (fever, fatigue, weight loss)');
  }
  gaps.push('Imaging (X-ray, MRI, bone scan) showing bone involvement is essential');
  gaps.push('Lab values (WBC, ESR, CRP) during active infection strengthen claim');
  gaps.push('Document which specific bone(s) are affected');
  gaps.push('Antibiotic treatment records strengthen claim');

  return {
    condition: 'Osteomyelitis',
    diagnosticCode: '5000',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: totalEpisodes,
      painDays: bonePainCount,
      avgPain: avgSeverity,
      drainingSinus: drainageCount,
      flareUps: flareCount,
    },
    criteria: OSTEOMYELITIS_CRITERIA,
    disclaimer: OSTEOMYELITIS_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 4B: ANALYSIS FUNCTIONS - MULTI-JOINT ARTHRITIS (DC 5002)
// ============================================

/**
 * Analyzes multijoint arthritis symptom logs to determine supported VA rating level
 * Has its own unique rating schedule for active inflammatory process
 */
export const analyzeMultiJointArthritisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter multijoint arthritis symptom logs
  const mjaSymptoms = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.MULTI_JOINT_ARTHRITIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (mjaSymptoms.length === 0) {
    return {
      condition: 'Multi-Joint Arthritis (Active Process)',
      diagnosticCode: '5002',
      hasData: false,
      message: 'No multi-joint arthritis symptoms logged in the evaluation period',
    };
  }

  // Count symptom types
  const jointPainCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-joint-pain').length;
  const jointSwellingCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-joint-swelling').length;
  const morningStiffnessCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-morning-stiffness').length;
  const fatigueCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-fatigue').length;
  const weightLossCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-weight-loss').length;
  const anemiaCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-anemia').length;
  const feverCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-fever').length;
  const flareCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-flare').length;
  const incapacitatingCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-incapacitating').length;
  const functionalLossCount = mjaSymptoms.filter(s => getLogSymptomId(s) === 'mja-functional-loss').length;

  // Calculate average severity
  const painLogs = mjaSymptoms.filter(s =>
      ['mja-joint-pain', 'mja-flare', 'mja-incapacitating'].includes(getLogSymptomId(s)) && s.severity
  );
  const avgSeverity = painLogs.length > 0
      ? (painLogs.reduce((sum, log) => sum + log.severity, 0) / painLogs.length).toFixed(1)
      : null;

  const evidence = [];
  const gaps = [];
  const ratingRationale = [];
  let supportedRating = 0;

  // Build evidence
  if (jointPainCount > 0) evidence.push(`${jointPainCount} joint pain episodes documented`);
  if (jointSwellingCount > 0) evidence.push(`${jointSwellingCount} joint swelling episodes`);
  if (morningStiffnessCount > 0) evidence.push(`${morningStiffnessCount} morning stiffness episodes`);
  if (fatigueCount > 0) evidence.push(`${fatigueCount} fatigue episodes`);
  if (weightLossCount > 0) evidence.push(`${weightLossCount} weight loss documented`);
  if (anemiaCount > 0) evidence.push(`${anemiaCount} anemia symptom episodes`);
  if (feverCount > 0) evidence.push(`${feverCount} fever episodes`);
  if (flareCount > 0) evidence.push(`${flareCount} flare-ups documented`);
  if (incapacitatingCount > 0) evidence.push(`${incapacitatingCount} incapacitating episodes`);
  if (functionalLossCount > 0) evidence.push(`${functionalLossCount} functional loss episodes`);

  const totalEpisodes = mjaSymptoms.length;
  const totalIncapacitating = incapacitatingCount + Math.floor(flareCount * 0.5); // flares partially count

  evidence.push(`${totalEpisodes} total multi-joint arthritis episodes in ${evaluationPeriodDays} days`);

  // Determine rating based on DC 5002 criteria
  const hasConstitutionalSymptoms = weightLossCount > 0 || anemiaCount > 0 || feverCount >= 2;
  const hasWeightLossAndAnemia = weightLossCount > 0 && anemiaCount > 0;

  if (hasConstitutionalSymptoms && incapacitatingCount >= 4 && functionalLossCount >= 4) {
    supportedRating = '60-100';
    ratingRationale.push(
        `${incapacitatingCount} incapacitating episodes documented`,
        'Constitutional symptoms present (weight loss, anemia, fever)',
        '100% requires totally incapacitating disease'
    );
  } else if (hasWeightLossAndAnemia || incapacitatingCount >= 4) {
    supportedRating = 60;
    ratingRationale.push(
        'Weight loss AND anemia documented, OR',
        `${incapacitatingCount} incapacitating exacerbations`,
        'Supports 60% rating'
    );
  } else if (incapacitatingCount >= 3 || (flareCount >= 4 && functionalLossCount >= 3)) {
    supportedRating = 40;
    ratingRationale.push(
        `${incapacitatingCount} incapacitating exacerbations`,
        `${flareCount} flare-ups with ${functionalLossCount} functional loss episodes`,
        'Supports 40% rating'
    );
  } else if (flareCount >= 1 || incapacitatingCount >= 1) {
    supportedRating = 20;
    ratingRationale.push(
        `${flareCount + incapacitatingCount} exacerbations documented`,
        'Supports 20% for 1-2 exacerbations per year'
    );
  } else if (totalEpisodes >= 5) {
    supportedRating = '0-20';
    ratingRationale.push(
        'Multi-joint arthritis symptoms documented',
        '20% requires documented exacerbations'
    );
  } else {
    supportedRating = '0-20';
    ratingRationale.push(
        'Limited multi-joint arthritis symptoms documented',
        'Continue logging for stronger documentation'
    );
  }

  // Documentation gaps
  if (incapacitatingCount === 0) {
    gaps.push('Document incapacitating episodes (unable to work/perform daily activities)');
  }
  if (weightLossCount === 0) {
    gaps.push('Document any weight loss');
  }
  if (anemiaCount === 0) {
    gaps.push('Document anemia symptoms if present (fatigue, pallor)');
  }
  gaps.push('Lab values (ESR, CRP, RF, anti-CCP) showing active inflammation essential');
  gaps.push('Document which joints are affected (need 2+ joints for DC 5002)');
  gaps.push('Rheumatology records confirming diagnosis strengthen claim');
  gaps.push('For chronic residuals after active process resolves, rate under DC 5003');

  return {
    condition: 'Multi-Joint Arthritis (Active Process)',
    diagnosticCode: '5002',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: totalEpisodes,
      painDays: jointPainCount,
      avgPain: avgSeverity,
      incapacitatingEpisodes: incapacitatingCount,
      flareUps: flareCount,
    },
    criteria: MULTI_JOINT_ARTHRITIS_CRITERIA,
    disclaimer: MULTI_JOINT_ARTHRITIS_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 4C: ANALYSIS FUNCTIONS - SPINE EXPANSION
// DC 5235, 5236, 5238, 5240, 5241
// ============================================

/**
 * Helper function to calculate spine rating based on General Rating Formula
 * Used by all spine condition analysis functions
 */
const calculateSpineRating = (symptoms, metrics) => {
  const {
    limitedFlexionCount = 0,
    limitedExtensionCount = 0,
    muscleSpasmsCount = 0,
    functionalLossCount = 0,
    totalLogs = 0,
    avgSeverity = 0,
  } = metrics;

  let supportedRating = 0;
  const ratingRationale = [];

  // Check for severe limitation indicators (40% rating)
  if (avgSeverity >= 8 && functionalLossCount >= 5) {
    supportedRating = 40;
    ratingRationale.push(`Severe symptoms (avg severity ${avgSeverity.toFixed(1)}/10) suggest significant ROM limitation`);
    ratingRationale.push(`${functionalLossCount} functional loss episodes documented`);
    ratingRationale.push('Pattern consistent with forward flexion <=30 - requires clinical ROM measurement to confirm');
  }
  // Check for moderate-severe indicators (20% rating)
  else if (avgSeverity >= 6 || (limitedFlexionCount >= 3 && muscleSpasmsCount >= 2)) {
    supportedRating = 20;
    ratingRationale.push(`Moderate-severe symptoms documented (avg severity ${avgSeverity.toFixed(1)}/10)`);
    if (limitedFlexionCount >= 3) {
      ratingRationale.push(`${limitedFlexionCount} episodes of limited flexion logged`);
    }
    if (muscleSpasmsCount >= 2) {
      ratingRationale.push(`${muscleSpasmsCount} muscle spasm episodes - may indicate abnormal gait/contour`);
    }
    ratingRationale.push('Pattern suggests forward flexion 30-60 or abnormal gait - requires clinical confirmation');
  }
  // Check for mild-moderate indicators (10% rating)
  else if (totalLogs >= 3 || avgSeverity >= 4) {
    supportedRating = 10;
    ratingRationale.push(`${totalLogs} total symptom logs over evaluation period`);
    ratingRationale.push(`Average severity ${avgSeverity.toFixed(1)}/10`);
    ratingRationale.push('Pattern suggests mild-moderate limitation (forward flexion 60-85)');
  }
  // Minimal symptoms
  else if (totalLogs > 0) {
    supportedRating = 0;
    ratingRationale.push('Minimal symptoms documented');
    ratingRationale.push('Continue logging to establish pattern if symptoms persist');
  }

  return { supportedRating, ratingRationale };
};

/**
 * Analyze Vertebral Fracture logs for VA rating
 * DC 5235 - Vertebral Fracture or Dislocation
 */
export const analyzeVertebralFractureLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.VERTEBRAL_FRACTURE.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Vertebral Fracture or Dislocation',
      diagnosticCode: '5235',
      cfrReference: '38 CFR 4.71a',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'No vertebral fracture symptoms logged in evaluation period',
        'Log pain at fracture site and severity',
        'Document any height loss or kyphosis',
        'Track limited motion and functional limitations',
        'Note radiating pain or numbness if present',
      ],
      metrics: { totalLogs: 0 },
      criteria: VERTEBRAL_FRACTURE_CRITERIA,
    };
  }

  // Count symptom types
  const painCount = relevantLogs.filter(l => getLogSymptomId(l) === 'vfx-pain').length;
  const limitedFlexionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'vfx-limited-flexion').length;
  const limitedExtensionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'vfx-limited-extension').length;
  const muscleSpasmsCount = relevantLogs.filter(l => getLogSymptomId(l) === 'vfx-muscle-spasm').length;
  const heightLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'vfx-height-loss').length;
  const kyphosisCount = relevantLogs.filter(l => getLogSymptomId(l) === 'vfx-kyphosis').length;
  const radiculopathyCount = relevantLogs.filter(l => ['vfx-radicular', 'vfx-numbness'].includes(getLogSymptomId(l))).length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'vfx-functional-loss').length;

  // Calculate average severity
  const severities = relevantLogs.filter(l => l.severity).map(l => l.severity);
  const avgSeverity = severities.length > 0 ? severities.reduce((a, b) => a + b, 0) / severities.length : 0;

  const metrics = {
    totalLogs: relevantLogs.length,
    painCount,
    limitedFlexionCount,
    limitedExtensionCount,
    muscleSpasmsCount,
    heightLossCount,
    kyphosisCount,
    radiculopathyCount,
    functionalLossCount,
    avgSeverity,
  };

  // Calculate rating using shared function
  let { supportedRating, ratingRationale } = calculateSpineRating(relevantLogs, metrics);

  // Special consideration for vertebral height loss (10% minimum)
  if (heightLossCount > 0 && supportedRating < 10) {
    supportedRating = 10;
    ratingRationale.push('Vertebral height loss documented - qualifies for minimum 10% if >=50% height loss confirmed on imaging');
  }

  // Add fracture-specific rationale
  if (kyphosisCount > 0) {
    ratingRationale.push(`Kyphosis (hunched posture) documented ${kyphosisCount} times - indicates structural change`);
  }

  // Build evidence array
  const evidence = [];
  evidence.push(`${relevantLogs.length} vertebral fracture symptoms logged`);
  if (painCount > 0) evidence.push(`${painCount} pain episodes at fracture site`);
  if (heightLossCount > 0) evidence.push(`Height loss/compression documented`);
  if (radiculopathyCount > 0) evidence.push(`${radiculopathyCount} neurologic symptoms - may warrant separate rating`);

  // Identify gaps
  const gaps = [];
  if (limitedFlexionCount === 0) gaps.push('Document limited forward bending (flexion) when it occurs');
  if (heightLossCount === 0) gaps.push('If vertebral compression exists, log height loss - qualifies for minimum 10%');
  if (radiculopathyCount === 0 && avgSeverity >= 5) gaps.push('Document any radiating pain or numbness for potential separate neurologic rating');
  gaps.push('Obtain current imaging (X-ray/CT) documenting fracture and any height loss');
  gaps.push('Get ROM measurements from healthcare provider using goniometer');

  return {
    hasData: true,
    condition: 'Vertebral Fracture or Dislocation',
    diagnosticCode: '5235',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics,
    criteria: VERTEBRAL_FRACTURE_CRITERIA,
    disclaimer: VERTEBRAL_FRACTURE_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Sacroiliac Injury logs for VA rating
 * DC 5236 - Sacroiliac Injury and Weakness
 */
export const analyzeSacroiliacInjuryLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.SACROILIAC_INJURY.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Sacroiliac Injury and Weakness',
      diagnosticCode: '5236',
      cfrReference: '38 CFR 4.71a',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'No sacroiliac symptoms logged in evaluation period',
        'Log SI joint pain location and severity',
        'Document referred pain to buttock, hip, groin, or leg',
        'Track difficulty with sitting, standing, or walking',
        'Note morning stiffness duration',
      ],
      metrics: { totalLogs: 0 },
      criteria: SACROILIAC_INJURY_CRITERIA,
    };
  }

  // Count symptom types
  const siPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'si-pain').length;
  const buttockPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'si-buttock-pain').length;
  const referredPainCount = relevantLogs.filter(l => ['si-hip-pain', 'si-groin-pain', 'si-leg-pain'].includes(getLogSymptomId(l))).length;
  const stiffnessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'si-stiffness').length;
  const instabilityCount = relevantLogs.filter(l => getLogSymptomId(l) === 'si-instability').length;
  const functionalDifficultyCount = relevantLogs.filter(l => ['si-difficulty-sitting', 'si-difficulty-standing', 'si-difficulty-walking'].includes(getLogSymptomId(l))).length;
  const limitedFlexionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'si-limited-flexion').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'si-functional-loss').length;

  // Calculate average severity
  const severities = relevantLogs.filter(l => l.severity).map(l => l.severity);
  const avgSeverity = severities.length > 0 ? severities.reduce((a, b) => a + b, 0) / severities.length : 0;

  const metrics = {
    totalLogs: relevantLogs.length,
    siPainCount,
    buttockPainCount,
    referredPainCount,
    stiffnessCount,
    instabilityCount,
    functionalDifficultyCount,
    limitedFlexionCount,
    functionalLossCount,
    avgSeverity,
  };

  // Calculate rating
  const { supportedRating, ratingRationale } = calculateSpineRating(relevantLogs, {
    ...metrics,
    muscleSpasmsCount: instabilityCount, // SI instability similar to spasm in impact
  });

  // Add SI-specific rationale
  if (referredPainCount > 0) {
    ratingRationale.push(`${referredPainCount} referred pain episodes (hip/groin/leg) - characteristic of SI dysfunction`);
  }
  if (functionalDifficultyCount > 0) {
    ratingRationale.push(`${functionalDifficultyCount} episodes of difficulty sitting/standing/walking`);
  }

  // Build evidence
  const evidence = [];
  evidence.push(`${relevantLogs.length} SI joint symptoms logged`);
  if (siPainCount > 0) evidence.push(`${siPainCount} direct SI joint pain episodes`);
  if (buttockPainCount > 0) evidence.push(`${buttockPainCount} buttock pain episodes`);
  if (instabilityCount > 0) evidence.push(`${instabilityCount} joint instability episodes`);

  // Identify gaps
  const gaps = [];
  if (stiffnessCount === 0) gaps.push('Document morning stiffness and duration');
  if (limitedFlexionCount === 0) gaps.push('Log episodes of limited forward bending');
  if (referredPainCount === 0) gaps.push('Document if pain refers to hip, groin, or leg');
  gaps.push('SI joint provocative tests (FABER, Gaenslen) by examiner support diagnosis');
  gaps.push('ROM measurements of thoracolumbar spine needed for rating');

  return {
    hasData: true,
    condition: 'Sacroiliac Injury and Weakness',
    diagnosticCode: '5236',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics,
    criteria: SACROILIAC_INJURY_CRITERIA,
    disclaimer: SACROILIAC_INJURY_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Spinal Stenosis logs for VA rating
 * DC 5238 - Spinal Stenosis
 */
export const analyzeSpinalStenosisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.SPINAL_STENOSIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Spinal Stenosis',
      diagnosticCode: '5238',
      cfrReference: '38 CFR 4.71a',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'No spinal stenosis symptoms logged in evaluation period',
        'Log back pain episodes and severity',
        'Document leg pain with walking (neurogenic claudication)',
        'Track walking distance limitations',
        'Note if sitting or bending forward provides relief',
      ],
      metrics: { totalLogs: 0 },
      criteria: SPINAL_STENOSIS_CRITERIA,
    };
  }

  // Count symptom types
  const backPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-back-pain').length;
  const legPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-leg-pain').length;
  const legWeaknessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-leg-weakness').length;
  const numbnessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-numbness').length;
  const walkingDifficultyCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-walking-difficulty').length;
  const reliefSittingCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-relief-sitting').length;
  const balanceCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-balance-problems').length;
  const limitedFlexionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-limited-flexion').length;
  const limitedExtensionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-limited-extension').length;
  const bladderBowelCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-bladder-bowel').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'ss-functional-loss').length;

  // Calculate average severity
  const severities = relevantLogs.filter(l => l.severity).map(l => l.severity);
  const avgSeverity = severities.length > 0 ? severities.reduce((a, b) => a + b, 0) / severities.length : 0;

  // Neurogenic claudication indicator (leg pain + relief with sitting)
  const neurogenicClaudicationIndicator = legPainCount > 0 && (reliefSittingCount > 0 || walkingDifficultyCount > 0);

  const metrics = {
    totalLogs: relevantLogs.length,
    backPainCount,
    legPainCount,
    legWeaknessCount,
    numbnessCount,
    walkingDifficultyCount,
    reliefSittingCount,
    balanceCount,
    limitedFlexionCount,
    limitedExtensionCount,
    bladderBowelCount,
    functionalLossCount,
    avgSeverity,
    neurogenicClaudicationIndicator,
  };

  // Calculate rating
  const { supportedRating, ratingRationale } = calculateSpineRating(relevantLogs, metrics);

  // Add stenosis-specific rationale
  if (neurogenicClaudicationIndicator) {
    ratingRationale.push('Neurogenic claudication pattern documented (leg symptoms + positional relief)');
  }
  if (walkingDifficultyCount > 0) {
    ratingRationale.push(`${walkingDifficultyCount} episodes of walking difficulty - significant functional impact`);
  }
  if (bladderBowelCount > 0) {
    ratingRationale.push(`Bladder/bowel changes documented - may warrant separate neurologic rating`);
  }

  // Build evidence
  const evidence = [];
  evidence.push(`${relevantLogs.length} spinal stenosis symptoms logged`);
  if (legPainCount > 0) evidence.push(`${legPainCount} neurogenic claudication (leg pain) episodes`);
  if (reliefSittingCount > 0) evidence.push(`Relief with sitting/bending forward documented (classic stenosis sign)`);
  const neurologicCount = legWeaknessCount + numbnessCount + bladderBowelCount;
  if (neurologicCount > 0) evidence.push(`${neurologicCount} neurologic symptoms - consider separate rating`);

  // Identify gaps
  const gaps = [];
  if (reliefSittingCount === 0 && legPainCount > 0) {
    gaps.push('Document if sitting or bending forward relieves leg symptoms (classic stenosis finding)');
  }
  if (walkingDifficultyCount === 0) gaps.push('Track walking distance limitations (e.g., can only walk X blocks)');
  if (bladderBowelCount === 0 && avgSeverity >= 6) {
    gaps.push('Document any bladder/bowel changes - may warrant separate rating');
  }
  gaps.push('MRI showing spinal stenosis is essential for diagnosis');
  gaps.push('ROM measurements needed - stenosis is rated on spine motion limitation');
  gaps.push('Neurologic symptoms (leg weakness, numbness) may warrant separate rating under DC 8520+');

  return {
    hasData: true,
    condition: 'Spinal Stenosis',
    diagnosticCode: '5238',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics,
    criteria: SPINAL_STENOSIS_CRITERIA,
    disclaimer: SPINAL_STENOSIS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Ankylosing Spondylitis logs for VA rating
 * DC 5240 - Ankylosing Spondylitis
 */
export const analyzeAnkylosingSpondylitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.ANKYLOSING_SPONDYLITIS.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Ankylosing Spondylitis',
      diagnosticCode: '5240',
      cfrReference: '38 CFR 4.71a',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'No ankylosing spondylitis symptoms logged in evaluation period',
        'Log inflammatory back pain episodes',
        'Document morning stiffness (especially if >30 minutes)',
        'Track night pain and sleep interruption',
        'Note if exercise improves symptoms (characteristic of AS)',
      ],
      metrics: { totalLogs: 0 },
      criteria: ANKYLOSING_SPONDYLITIS_CRITERIA,
    };
  }

  // Count symptom types
  const backPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-back-pain').length;
  const morningStiffnessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-morning-stiffness').length;
  const nightPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-night-pain').length;
  const limitedFlexionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-limited-flexion').length;
  const limitedExtensionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-limited-extension').length;
  const limitedLateralCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-limited-lateral').length;
  const chestExpansionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-chest-expansion').length;
  const fatigueCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-fatigue').length;
  const peripheralJointCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-peripheral-joint').length;
  const enthesitisCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-enthesitis').length;
  const flareCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-flare').length;
  const fusionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-fusion').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'as-functional-loss').length;

  // Calculate average severity
  const severities = relevantLogs.filter(l => l.severity).map(l => l.severity);
  const avgSeverity = severities.length > 0 ? severities.reduce((a, b) => a + b, 0) / severities.length : 0;

  // Inflammatory back pain indicators (improves with exercise, worse at rest, morning stiffness >30min)
  const inflammatoryIndicators = morningStiffnessCount + nightPainCount;

  const metrics = {
    totalLogs: relevantLogs.length,
    backPainCount,
    morningStiffnessCount,
    nightPainCount,
    limitedFlexionCount,
    limitedExtensionCount,
    limitedLateralCount,
    chestExpansionCount,
    fatigueCount,
    peripheralJointCount,
    enthesitisCount,
    flareCount,
    fusionCount,
    functionalLossCount,
    avgSeverity,
    inflammatoryIndicators,
  };

  // Calculate rating
  let { supportedRating, ratingRationale } = calculateSpineRating(relevantLogs, {
    ...metrics,
    muscleSpasmsCount: flareCount, // Flares indicate active disease
  });

  // Ankylosis/fusion documented - higher ratings
  if (fusionCount > 0) {
    if (supportedRating < 40) {
      supportedRating = 40;
      ratingRationale.push('Spinal fusion symptoms documented - minimum 40% for favorable thoracolumbar ankylosis');
    }
    ratingRationale.push(`${fusionCount} fusion-related symptom logs - confirm ankylosis on imaging`);
  }

  // Add AS-specific rationale
  if (inflammatoryIndicators >= 3) {
    ratingRationale.push(`Inflammatory back pain pattern: ${morningStiffnessCount} morning stiffness, ${nightPainCount} night pain episodes`);
  }
  if (chestExpansionCount > 0) {
    ratingRationale.push('Reduced chest expansion documented - indicates thoracic involvement');
  }
  if (enthesitisCount > 0) {
    ratingRationale.push(`${enthesitisCount} enthesitis episodes - characteristic AS finding`);
  }

  // Build evidence
  const evidence = [];
  evidence.push(`${relevantLogs.length} ankylosing spondylitis symptoms logged`);
  if (morningStiffnessCount > 0) evidence.push(`${morningStiffnessCount} prolonged morning stiffness episodes`);
  if (nightPainCount > 0) evidence.push(`${nightPainCount} night pain episodes (awakening from sleep)`);
  if (flareCount > 0) evidence.push(`${flareCount} disease flares documented`);
  if (fusionCount > 0) evidence.push('Spinal fusion symptoms reported');

  // Identify gaps
  const gaps = [];
  if (morningStiffnessCount === 0) gaps.push('Document morning stiffness and duration (>30 min characteristic of AS)');
  if (nightPainCount === 0) gaps.push('Log night pain/sleep interruption if occurring');
  if (chestExpansionCount === 0) gaps.push('Track chest expansion limitation if present');
  gaps.push('HLA-B27 test and inflammatory markers (ESR, CRP) support diagnosis');
  gaps.push('X-ray/MRI showing sacroiliitis or spinal fusion confirms diagnosis');
  gaps.push('ROM measurements essential - AS typically causes progressive motion loss');

  return {
    hasData: true,
    condition: 'Ankylosing Spondylitis',
    diagnosticCode: '5240',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics,
    criteria: ANKYLOSING_SPONDYLITIS_CRITERIA,
    disclaimer: ANKYLOSING_SPONDYLITIS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Spinal Fusion logs for VA rating
 * DC 5241 - Spinal Fusion
 */
export const analyzeSpinalFusionLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.SPINAL_FUSION.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Spinal Fusion',
      diagnosticCode: '5241',
      cfrReference: '38 CFR 4.71a',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'No spinal fusion symptoms logged in evaluation period',
        'Log pain at fusion site and severity',
        'Document stiffness and mobility limitations',
        'Track adjacent segment pain if present',
        'Note any hardware-related discomfort',
      ],
      metrics: { totalLogs: 0 },
      criteria: SPINAL_FUSION_CRITERIA,
    };
  }

  // Count symptom types
  const fusionPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-pain').length;
  const adjacentPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-adjacent-pain').length;
  const stiffnessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-stiffness').length;
  const limitedFlexionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-limited-flexion').length;
  const limitedExtensionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-limited-extension').length;
  const limitedRotationCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-limited-rotation').length;
  const muscleSpasmsCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-muscle-spasm').length;
  const radiculopathyCount = relevantLogs.filter(l => ['sf-radicular', 'sf-numbness'].includes(getLogSymptomId(l))).length;
  const hardwarePainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-hardware-pain').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'sf-functional-loss').length;

  // Calculate average severity
  const severities = relevantLogs.filter(l => l.severity).map(l => l.severity);
  const avgSeverity = severities.length > 0 ? severities.reduce((a, b) => a + b, 0) / severities.length : 0;

  // Total ROM limitation indicators
  const totalRomLimitation = limitedFlexionCount + limitedExtensionCount + limitedRotationCount;

  const metrics = {
    totalLogs: relevantLogs.length,
    fusionPainCount,
    adjacentPainCount,
    stiffnessCount,
    limitedFlexionCount,
    limitedExtensionCount,
    limitedRotationCount,
    muscleSpasmsCount,
    radiculopathyCount,
    hardwarePainCount,
    functionalLossCount,
    avgSeverity,
    totalRomLimitation,
  };

  // Calculate rating - spinal fusion inherently limits ROM
  let { supportedRating, ratingRationale } = calculateSpineRating(relevantLogs, metrics);

  // Spinal fusion typically warrants at least 10% due to ROM loss
  if (supportedRating < 10 && relevantLogs.length >= 3) {
    supportedRating = 10;
    ratingRationale.push('Spinal fusion inherently limits ROM - minimum 10% typically appropriate');
  }

  // Multi-segment fusion indicators
  if (stiffnessCount >= 5 && totalRomLimitation >= 5) {
    if (supportedRating < 20) {
      supportedRating = 20;
      ratingRationale.push('Significant stiffness and ROM limitation pattern suggests multi-level or extensive fusion');
    }
  }

  // Add fusion-specific rationale
  if (adjacentPainCount > 0) {
    ratingRationale.push(`${adjacentPainCount} adjacent segment pain episodes - common post-fusion complication`);
  }
  if (hardwarePainCount > 0) {
    ratingRationale.push(`${hardwarePainCount} hardware-related pain episodes documented`);
  }

  // Build evidence
  const evidence = [];
  evidence.push(`${relevantLogs.length} post-fusion symptoms logged`);
  if (fusionPainCount > 0) evidence.push(`${fusionPainCount} pain episodes at fusion site`);
  if (stiffnessCount > 0) evidence.push(`${stiffnessCount} stiffness episodes`);
  if (adjacentPainCount > 0) evidence.push(`Adjacent segment disease symptoms present`);
  if (radiculopathyCount > 0) evidence.push(`${radiculopathyCount} neurologic symptoms - may warrant separate rating`);

  // Identify gaps
  const gaps = [];
  if (limitedFlexionCount === 0) gaps.push('Document limited forward bending (most affected by fusion)');
  if (stiffnessCount === 0) gaps.push('Log stiffness episodes - expected with fusion');
  if (adjacentPainCount === 0 && avgSeverity >= 5) {
    gaps.push('Track if pain occurs above/below fusion (adjacent segment disease)');
  }
  gaps.push('Surgical records documenting fusion levels are essential');
  gaps.push('Post-operative imaging showing fusion status');
  gaps.push('ROM measurements by healthcare provider - rating based on remaining motion');

  return {
    hasData: true,
    condition: 'Spinal Fusion',
    diagnosticCode: '5241',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics,
    criteria: SPINAL_FUSION_CRITERIA,
    disclaimer: SPINAL_FUSION_CRITERIA.disclaimer,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - ASTHMA
// ============================================

/**
 * Analyzes asthma logs and measurements to determine supported rating level
 */
export const analyzeAsthmaLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
    profileId = null,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter asthma symptom logs
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && CONDITIONS.ASTHMA.symptomIds.includes(getLogSymptomId(log));
  });

  // Get FEV-1 measurements from the past year for spirometry analysis
  const yearAgo = new Date();
  yearAgo.setDate(yearAgo.getDate() - 365);

  let fev1Measurements = [];
  let fvcMeasurements = [];

  try {
    fev1Measurements = getMeasurements('fev1', profileId).filter(m =>
        new Date(m.timestamp) >= yearAgo
    );
    fvcMeasurements = getMeasurements('fvc', profileId).filter(m =>
        new Date(m.timestamp) >= yearAgo
    );
  } catch (error) {
    // Measurements may not be available
  }

  if (relevantLogs.length === 0 && fev1Measurements.length === 0) {
    return {
      hasData: false,
      message: 'No asthma logs or FEV-1 measurements found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging asthma symptoms and attacks', 'Get spirometry testing (FEV-1) to establish rating'],
    };
  }

  // Calculate FEV-1 metrics
  let latestFev1Percent = null;
  let latestFev1FvcRatio = null;

  if (fev1Measurements.length > 0) {
    // Use most recent FEV-1 measurement
    const latestFev1 = fev1Measurements.reduce((latest, current) =>
        new Date(current.timestamp) > new Date(latest.timestamp) ? current : latest
    );

    if (latestFev1.values.fev1 && latestFev1.values.fev1Predicted) {
      latestFev1Percent = (latestFev1.values.fev1 / latestFev1.values.fev1Predicted) * 100;
    }

    // Calculate FEV-1/FVC ratio if we have matching FVC
    if (fvcMeasurements.length > 0) {
      // Find FVC measurement closest to FEV-1 measurement (within 24 hours)
      const matchingFvc = fvcMeasurements.find(fvc => {
        const timeDiff = Math.abs(new Date(fvc.timestamp) - new Date(latestFev1.timestamp));
        return timeDiff < 24 * 60 * 60 * 1000; // Within 24 hours
      });

      if (matchingFvc && latestFev1.values.fev1) {
        latestFev1FvcRatio = (latestFev1.values.fev1 / matchingFvc.values.fvc) * 100;
      }
    }
  }

  // Analyze symptom patterns
  const monthsInPeriod = evaluationPeriodDays / 30;

  const attackLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'asthma-attack');
  const erVisits = relevantLogs.filter(log => getLogSymptomId(log) === 'asthma-er-visit');
  const mdVisits = relevantLogs.filter(log => getLogSymptomId(log) === 'asthma-md-visit');
  const rescueInhalerUse = relevantLogs.filter(log => getLogSymptomId(log) === 'asthma-rescue-inhaler');

  const attacksPerMonth = attackLogs.length / monthsInPeriod;
  const attacksPerWeek = attackLogs.length / (evaluationPeriodDays / 7);
  const mdVisitsPerMonth = mdVisits.length / monthsInPeriod;

  // Build evidence array
  const evidence = [];

  if (fev1Measurements.length > 0 && latestFev1Percent !== null) {
    evidence.push(`Most recent FEV-1: ${latestFev1Percent.toFixed(0)}% of predicted`);
  }

  if (latestFev1FvcRatio !== null) {
    evidence.push(`FEV-1/FVC ratio: ${latestFev1FvcRatio.toFixed(0)}%`);
  }

  if (attackLogs.length > 0) {
    evidence.push(`${attackLogs.length} asthma attacks logged (${attacksPerMonth.toFixed(1)}/month)`);
  }

  if (erVisits.length > 0) {
    evidence.push(`${erVisits.length} ER visits for asthma`);
  }

  if (mdVisits.length > 0) {
    evidence.push(`${mdVisits.length} physician visits for exacerbations (${mdVisitsPerMonth.toFixed(1)}/month)`);
  }

  if (rescueInhalerUse.length > 0) {
    evidence.push(`${rescueInhalerUse.length} rescue inhaler uses documented`);
  }

  // Determine supported rating
  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // 100% Rating
  if (latestFev1Percent !== null && latestFev1Percent < 40) {
    supportedRating = 100;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (<40% required for 100%)`,
      'Spirometry evidence supports 100% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio < 40) {
    supportedRating = 100;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (<40% required for 100%)`,
      'Spirometry evidence supports 100% rating',
    ];
  } else if (attacksPerWeek > 1) {
    supportedRating = 100;
    ratingRationale = [
      `${attacksPerWeek.toFixed(1)} attacks per week (>1/week required for 100%)`,
      'Attack frequency supports 100% rating if episodes include respiratory failure',
    ];
    gaps.push('Document respiratory failure episodes during attacks (requires medical records)');
  }

  // 60% Rating
  else if (latestFev1Percent !== null && latestFev1Percent >= 40 && latestFev1Percent <= 55) {
    supportedRating = 60;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (40-55% range)`,
      'Spirometry evidence supports 60% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio >= 40 && latestFev1FvcRatio <= 55) {
    supportedRating = 60;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (40-55% range)`,
      'Spirometry evidence supports 60% rating',
    ];
  } else if (mdVisitsPerMonth >= 1) {
    supportedRating = 60;
    ratingRationale = [
      `${mdVisitsPerMonth.toFixed(1)} physician visits per month for exacerbations (>=1/month required)`,
      'Pattern of monthly medical visits supports 60% rating',
    ];
  }

  // 30% Rating
  else if (latestFev1Percent !== null && latestFev1Percent >= 56 && latestFev1Percent <= 70) {
    supportedRating = 30;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (56-70% range)`,
      'Spirometry evidence supports 30% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio >= 56 && latestFev1FvcRatio <= 70) {
    supportedRating = 30;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (56-70% range)`,
      'Spirometry evidence supports 30% rating',
    ];
  } else if (rescueInhalerUse.length > 0 && relevantLogs.length > 0) {
    supportedRating = 30;
    ratingRationale = [
      'Evidence of regular bronchodilator use',
      'Daily or frequent inhaled medication supports 30% rating',
    ];
    gaps.push('Get spirometry (FEV-1) testing to confirm rating level');
  }

  // 10% Rating
  else if (latestFev1Percent !== null && latestFev1Percent >= 71 && latestFev1Percent <= 80) {
    supportedRating = 10;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (71-80% range)`,
      'Spirometry evidence supports 10% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio >= 71 && latestFev1FvcRatio <= 80) {
    supportedRating = 10;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (71-80% range)`,
      'Spirometry evidence supports 10% rating',
    ];
  } else if (attackLogs.length > 0 || rescueInhalerUse.length > 0) {
    supportedRating = 10;
    ratingRationale = [
      'Evidence of intermittent asthma symptoms and inhaler use',
      'Pattern suggests 10% rating',
    ];
    gaps.push('Get spirometry (FEV-1) testing to confirm or increase rating');
  }

  // 0% or Insufficient Data
  else {
    if (latestFev1Percent !== null && latestFev1Percent > 80) {
      supportedRating = 0;
      ratingRationale = [
        `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (>80% is normal)`,
        'Spirometry shows minimal impairment',
      ];
    } else {
      supportedRating = 0;
      ratingRationale = [
        'Insufficient evidence for compensable rating',
      ];
      gaps.push('Get spirometry (FEV-1) testing - this is the primary evidence for asthma ratings');
      gaps.push('Document all asthma attacks and exacerbations');
      gaps.push('Track medication use (rescue inhalers, daily controllers, oral steroids)');
    }
  }

  // Add general gaps if rating could be higher
  if (supportedRating < 100) {
    if (fev1Measurements.length === 0) {
      gaps.push('Get spirometry testing (FEV-1/FVC) - this is the gold standard for VA asthma ratings');
    } else if (fev1Measurements.length < 2) {
      gaps.push('Consider repeat spirometry testing to establish consistent pattern');
    }

    if (mdVisits.length === 0) {
      gaps.push('Document physician visits for asthma exacerbations');
    }
  }

  return {
    hasData: true,
    condition: 'Bronchial Asthma',
    diagnosticCode: '6602',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: ASTHMA_CRITERIA,
    disclaimer: 'This analysis is for documentation guidance only. The VA makes all final rating determinations based on the complete evidence of record, including spirometry testing.',
  };
};

/**
 * Shared helper function for PFT-based respiratory analysis
 * Used by COPD, Chronic Bronchitis, and Emphysema
 */
const analyzeRespiratoryPFT = (logs, options, conditionConfig) => {
  const {
    evaluationPeriodDays = 90,
    profileId = null,
  } = options;

  const { conditionId, conditionName, diagnosticCode, symptomIds, criteria } = conditionConfig;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  // Filter symptom logs for this condition
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  // Get PFT measurements from the past year
  const yearAgo = new Date();
  yearAgo.setDate(yearAgo.getDate() - 365);

  let fev1Measurements = [];
  let fvcMeasurements = [];
  let dlcoMeasurements = [];

  try {
    fev1Measurements = getMeasurements('fev1', profileId).filter(m =>
        new Date(m.timestamp) >= yearAgo
    );
    fvcMeasurements = getMeasurements('fvc', profileId).filter(m =>
        new Date(m.timestamp) >= yearAgo
    );
    dlcoMeasurements = getMeasurements('dlco', profileId).filter(m =>
        new Date(m.timestamp) >= yearAgo
    );
  } catch (error) {
    // Measurements may not be available
  }

  if (relevantLogs.length === 0 && fev1Measurements.length === 0 && dlcoMeasurements.length === 0) {
    return {
      hasData: false,
      message: `No ${conditionName} logs or PFT measurements found`,
      supportedRating: null,
      evidence: [],
      gaps: [
        `Start logging ${conditionName} symptoms`,
        'Get pulmonary function testing (spirometry + DLCO) to establish rating',
      ],
    };
  }

  // Calculate PFT metrics
  let latestFev1Percent = null;
  let latestFev1FvcRatio = null;
  let latestDlcoPercent = null;

  // FEV-1 analysis
  if (fev1Measurements.length > 0) {
    const latestFev1 = fev1Measurements.reduce((latest, current) =>
        new Date(current.timestamp) > new Date(latest.timestamp) ? current : latest
    );

    if (latestFev1.values.fev1 && latestFev1.values.fev1Predicted) {
      latestFev1Percent = (latestFev1.values.fev1 / latestFev1.values.fev1Predicted) * 100;
    }

    // Calculate FEV-1/FVC ratio
    if (fvcMeasurements.length > 0) {
      const matchingFvc = fvcMeasurements.find(fvc => {
        const timeDiff = Math.abs(new Date(fvc.timestamp) - new Date(latestFev1.timestamp));
        return timeDiff < 24 * 60 * 60 * 1000; // Within 24 hours
      });

      if (matchingFvc && latestFev1.values.fev1) {
        latestFev1FvcRatio = (latestFev1.values.fev1 / matchingFvc.values.fvc) * 100;
      }
    }
  }

  // DLCO analysis
  if (dlcoMeasurements.length > 0) {
    const latestDlco = dlcoMeasurements.reduce((latest, current) =>
        new Date(current.timestamp) > new Date(latest.timestamp) ? current : latest
    );

    if (latestDlco.values.dlco && latestDlco.values.dlcoPredicted) {
      latestDlcoPercent = (latestDlco.values.dlco / latestDlco.values.dlcoPredicted) * 100;
    }
  }

  // Analyze symptom patterns
  const oxygenUseLogs = relevantLogs.filter(log => log.symptomId.includes('oxygen-use'));
  const exacerbationLogs = relevantLogs.filter(log => log.symptomId.includes('exacerbation'));
  const erVisitLogs = relevantLogs.filter(log => log.symptomId.includes('er-visit'));
  const hospitalizationLogs = relevantLogs.filter(log => log.symptomId.includes('hospitalization'));

  const hasOxygenUse = oxygenUseLogs.length > 0;

  // Build evidence array
  const evidence = [];

  if (fev1Measurements.length > 0 && latestFev1Percent !== null) {
    evidence.push(`Most recent FEV-1: ${latestFev1Percent.toFixed(0)}% of predicted`);
  }

  if (latestFev1FvcRatio !== null) {
    evidence.push(`FEV-1/FVC ratio: ${latestFev1FvcRatio.toFixed(0)}%`);
  }

  if (dlcoMeasurements.length > 0 && latestDlcoPercent !== null) {
    evidence.push(`Most recent DLCO: ${latestDlcoPercent.toFixed(0)}% of predicted`);
  }

  if (hasOxygenUse) {
    evidence.push(`${oxygenUseLogs.length} supplemental oxygen use entries logged`);
  }

  if (exacerbationLogs.length > 0) {
    evidence.push(`${exacerbationLogs.length} exacerbations logged`);
  }

  if (erVisitLogs.length > 0) {
    evidence.push(`${erVisitLogs.length} ER visits documented`);
  }

  if (hospitalizationLogs.length > 0) {
    evidence.push(`${hospitalizationLogs.length} hospitalizations documented`);
  }

  if (relevantLogs.length > 0) {
    const shortnessLogs = relevantLogs.filter(log => log.symptomId.includes('shortness'));
    const coughLogs = relevantLogs.filter(log => log.symptomId.includes('cough'));
    if (shortnessLogs.length > 0) {
      evidence.push(`${shortnessLogs.length} shortness of breath episodes logged`);
    }
    if (coughLogs.length > 0) {
      evidence.push(`${coughLogs.length} cough episodes logged`);
    }
  }

  // Determine supported rating
  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // Check for 100% rating indicators
  if (hasOxygenUse) {
    supportedRating = 100;
    ratingRationale = [
      'Supplemental oxygen therapy documented',
      'Oxygen therapy requirement supports 100% rating',
    ];
  } else if (latestFev1Percent !== null && latestFev1Percent < 40) {
    supportedRating = 100;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (<40% required for 100%)`,
      'Spirometry evidence supports 100% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio < 40) {
    supportedRating = 100;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (<40% required for 100%)`,
      'Spirometry evidence supports 100% rating',
    ];
  } else if (latestDlcoPercent !== null && latestDlcoPercent < 40) {
    supportedRating = 100;
    ratingRationale = [
      `DLCO at ${latestDlcoPercent.toFixed(0)}% of predicted (<40% required for 100%)`,
      'Diffusion capacity evidence supports 100% rating',
    ];
  }

  // 60% Rating
  else if (latestFev1Percent !== null && latestFev1Percent >= 40 && latestFev1Percent <= 55) {
    supportedRating = 60;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (40-55% range)`,
      'Spirometry evidence supports 60% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio >= 40 && latestFev1FvcRatio <= 55) {
    supportedRating = 60;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (40-55% range)`,
      'Spirometry evidence supports 60% rating',
    ];
  } else if (latestDlcoPercent !== null && latestDlcoPercent >= 40 && latestDlcoPercent <= 55) {
    supportedRating = 60;
    ratingRationale = [
      `DLCO at ${latestDlcoPercent.toFixed(0)}% of predicted (40-55% range)`,
      'Diffusion capacity evidence supports 60% rating',
    ];
  }

  // 30% Rating
  else if (latestFev1Percent !== null && latestFev1Percent >= 56 && latestFev1Percent <= 70) {
    supportedRating = 30;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (56-70% range)`,
      'Spirometry evidence supports 30% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio >= 56 && latestFev1FvcRatio <= 70) {
    supportedRating = 30;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (56-70% range)`,
      'Spirometry evidence supports 30% rating',
    ];
  } else if (latestDlcoPercent !== null && latestDlcoPercent >= 56 && latestDlcoPercent <= 65) {
    supportedRating = 30;
    ratingRationale = [
      `DLCO at ${latestDlcoPercent.toFixed(0)}% of predicted (56-65% range)`,
      'Diffusion capacity evidence supports 30% rating',
    ];
  }

  // 10% Rating
  else if (latestFev1Percent !== null && latestFev1Percent >= 71 && latestFev1Percent <= 80) {
    supportedRating = 10;
    ratingRationale = [
      `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (71-80% range)`,
      'Spirometry evidence supports 10% rating',
    ];
  } else if (latestFev1FvcRatio !== null && latestFev1FvcRatio >= 71 && latestFev1FvcRatio <= 80) {
    supportedRating = 10;
    ratingRationale = [
      `FEV-1/FVC ratio at ${latestFev1FvcRatio.toFixed(0)}% (71-80% range)`,
      'Spirometry evidence supports 10% rating',
    ];
  } else if (latestDlcoPercent !== null && latestDlcoPercent >= 66 && latestDlcoPercent <= 80) {
    supportedRating = 10;
    ratingRationale = [
      `DLCO at ${latestDlcoPercent.toFixed(0)}% of predicted (66-80% range)`,
      'Diffusion capacity evidence supports 10% rating',
    ];
  } else if (relevantLogs.length > 0) {
    // Has symptoms but no PFT data
    supportedRating = '10-30';
    ratingRationale = [
      `${relevantLogs.length} symptom entries logged`,
      'Symptoms documented but PFT testing needed to confirm rating level',
    ];
    gaps.push('Get pulmonary function testing (FEV-1/FVC + DLCO) - required for VA rating');
  }

  // 0% or Insufficient Data
  else {
    if (latestFev1Percent !== null && latestFev1Percent > 80) {
      supportedRating = 0;
      ratingRationale = [
        `FEV-1 at ${latestFev1Percent.toFixed(0)}% of predicted (>80% is normal)`,
        'Spirometry shows minimal impairment',
      ];
    } else {
      supportedRating = 0;
      ratingRationale = [
        'Insufficient evidence for compensable rating',
      ];
      gaps.push('Get pulmonary function testing (FEV-1/FVC + DLCO) - required for VA rating');
      gaps.push(`Document all ${conditionName} symptoms and exacerbations`);
    }
  }

  // Add general gaps if rating could be higher
  if (supportedRating !== 100 && typeof supportedRating === 'number') {
    if (fev1Measurements.length === 0) {
      gaps.push('Get spirometry testing (FEV-1/FVC) - this is required for VA rating');
    }
    if (dlcoMeasurements.length === 0) {
      gaps.push('Get DLCO testing - important for comprehensive pulmonary evaluation');
    }
    if (!hasOxygenUse && exacerbationLogs.length > 0) {
      gaps.push('Document if supplemental oxygen is prescribed');
    }
  }

  return {
    hasData: true,
    condition: conditionName,
    diagnosticCode,
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria,
    disclaimer: criteria.disclaimer,
  };
};

/**
 * Analyze COPD symptom logs against VA rating criteria
 */
export const analyzeCOPDLogs = (logs, options = {}) => {
  return analyzeRespiratoryPFT(logs, options, {
    conditionId: 'copd',
    condition: 'Chronic Obstructive Pulmonary Disease',
    diagnosticCode: '6604',
    symptomIds: [
      'copd-shortness-breath',
      'copd-chronic-cough',
      'copd-sputum',
      'copd-wheezing',
      'copd-exacerbation',
      'copd-oxygen-use',
      'copd-er-visit',
      'copd-hospitalization',
    ],
    criteria: COPD_CRITERIA,
  });
};

/**
 * Analyze Chronic Bronchitis symptom logs against VA rating criteria
 */
export const analyzeChronicBronchitisLogs = (logs, options = {}) => {
  return analyzeRespiratoryPFT(logs, options, {
    conditionId: 'chronic-bronchitis',
    condition: 'Chronic Bronchitis',
    diagnosticCode: '6600',
    symptomIds: [
      'bronchitis-productive-cough',
      'bronchitis-sputum',
      'bronchitis-shortness-breath',
      'bronchitis-chest-discomfort',
      'bronchitis-exacerbation',
      'bronchitis-oxygen-use',
    ],
    criteria: CHRONIC_BRONCHITIS_CRITERIA,
  });
};

/**
 * Analyze Emphysema symptom logs against VA rating criteria
 */
export const analyzeEmphysemaLogs = (logs, options = {}) => {
  return analyzeRespiratoryPFT(logs, options, {
    conditionId: 'emphysema',
    condition: 'Pulmonary Emphysema',
    diagnosticCode: '6603',
    symptomIds: [
      'emphysema-shortness-breath',
      'emphysema-barrel-chest',
      'emphysema-wheezing',
      'emphysema-fatigue',
      'emphysema-oxygen-use',
      'emphysema-exacerbation',
    ],
    criteria: EMPHYSEMA_CRITERIA,
  });
};

// ============================================
// ANALYSIS FUNCTIONS - HEARING LOSS
// ============================================

/**
 * Analyzes hearing loss logs
 * Note: Hearing loss requires audiometry data for accurate rating
 */
export const analyzeHearingLossLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && getLogSymptomId(log) === 'hearing-loss-noticed';
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No hearing loss logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging hearing difficulties', 'Get audiometry testing'],
    };
  }

  // Count bilateral vs unilateral
  const bilateralCount = relevantLogs.filter(log =>
      log.hearingData?.affectedEars === 'both'
  ).length;

  const unilateralCount = relevantLogs.length - bilateralCount;

  const supportedRating = 'Requires Clinical Testing';
  const ratingRationale = [
    'Hearing loss requires pure-tone audiometry for accurate rating',
    `${bilateralCount} logs indicate bilateral hearing difficulties`,
    unilateralCount > 0 ? `${unilateralCount} logs indicate unilateral hearing loss` : null,
  ].filter(Boolean);

  const gaps = [
    'CRITICAL: Get pure-tone audiometry test from audiologist',
    'Test must measure thresholds at 500, 1000, 2000, 3000, 4000 Hz',
    'Request Maryland CNC word recognition test if available',
    'Document situations where hearing loss impacts daily function',
  ];

  return {
    hasData: true,
    condition: 'Hearing Loss',
    diagnosticCode: '6100',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence: {
      totalLogs: relevantLogs.length,
      bilateralIncidents: bilateralCount,
      unilateralIncidents: unilateralCount,
    },
    gaps,
    criteria: HEARING_LOSS_CRITERIA,
    disclaimer: 'Hearing loss ratings require audiometry testing. This analysis is based on symptom logs only.',
  };
};

// ============================================
// ANALYSIS FUNCTIONS - SCARS
// ============================================

export const analyzeScarsLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate &&
        ['scar-pain', 'scar-limitation', 'scar-disfigurement'].includes(log.symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No scar logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Log scar symptoms with location and size'],
    };
  }

  // Extract scar locations
  const scarLocations = [...new Set(
      relevantLogs
      .map(log => log.scarData?.scarLocation)
      .filter(Boolean)
  )];

  const supportedRating = 'Requires Clinical Measurement';
  const ratingRationale = [
    'Scar ratings require measured area in square centimeters',
    `Documented scars at: ${scarLocations.join(', ')}`,
    'Facial/neck scars may warrant higher ratings',
  ];

  const gaps = [
    'CRITICAL: Have provider measure scar area in square centimeters',
    'Document if scars are on exposed areas (head, face, neck, hands)',
    'Note characteristics: raised, keloid, unstable, painful',
    'Photograph scars for documentation',
  ];

  return {
    hasData: true,
    condition: 'Scars (Disfiguring)',
    diagnosticCode: '7800-7805',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence: {
      scarLocations,
      totalLogs: relevantLogs.length,
    },
    gaps,
    criteria: SCARS_CRITERIA,
    disclaimer: 'Scar ratings require clinical measurement of area and assessment of characteristics.',
  };
};

// ============================================
// ANALYSIS FUNCTIONS - PSORIASIS
// ============================================

export const analyzePsoriasisLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && getLogSymptomId(log) === 'psoriasis-flare';
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No psoriasis logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Log psoriasis flare-ups with body coverage percentage'],
    };
  }

  // Get most recent body coverage estimate
  const recentLog = relevantLogs[relevantLogs.length - 1];
  const bodyCoverage = recentLog.psoriasisData?.bodyPercentage;

  let supportedRating = '0%';
  let ratingRationale = [];

  if (bodyCoverage) {
    if (bodyCoverage === '40+') {
      supportedRating = '60%';
      ratingRationale = ['40% or more of body covered (60% criteria)'];
    } else if (bodyCoverage === '20-40') {
      supportedRating = '30%';
      ratingRationale = ['20-40% of body covered (30% criteria)'];
    } else if (['10-20', '5-10'].includes(bodyCoverage)) {
      supportedRating = '10%';
      ratingRationale = ['5-20% of body covered (10% criteria)'];
    } else {
      ratingRationale = ['Less than 5% body coverage'];
    }
  } else {
    supportedRating = 'Insufficient Data';
    ratingRationale = ['Body coverage percentage not documented'];
  }

  const gaps = [
    'Document percentage of body covered during flares',
    'Use "rule of nines" or palm method (palm = 1% body surface)',
    'Note if exposed areas (head, face, neck, hands) are affected',
    'Track frequency and duration of flare-ups',
    'Document treatments used (topical, systemic, phototherapy)',
  ];

  return {
    hasData: true,
    condition: 'Psoriasis',
    diagnosticCode: '7816',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence: {
      totalFlares: relevantLogs.length,
      recentCoverage: bodyCoverage || 'Not documented',
    },
    gaps,
    criteria: PSORIASIS_CRITERIA,
    disclaimer: 'This analysis is for documentation guidance only.',
  };
};

// ============================================
// ANALYSIS FUNCTIONS - ECZEMA
// ============================================

export const analyzeEczemaLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && getLogSymptomId(log) === 'eczema-flare';
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No eczema logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Log eczema flare-ups with affected body percentage'],
    };
  }

  // Get most recent body coverage
  const recentLog = relevantLogs[relevantLogs.length - 1];
  const bodyCoverage = recentLog.eczemaData?.bodyPercentage;

  let supportedRating = '0%';
  let ratingRationale = [];

  if (bodyCoverage) {
    if (bodyCoverage === '40+') {
      supportedRating = '60%';
      ratingRationale = ['40% or more of body affected (60% criteria)'];
    } else if (bodyCoverage === '20-40') {
      supportedRating = '30%';
      ratingRationale = ['20-40% of body affected (30% criteria)'];
    } else if (['10-20', '5-10'].includes(bodyCoverage)) {
      supportedRating = '10%';
      ratingRationale = ['5-20% of body affected (10% criteria)'];
    } else {
      ratingRationale = ['Less than 5% body coverage'];
    }
  } else {
    supportedRating = 'Insufficient Data';
    ratingRationale = ['Body coverage percentage not documented'];
  }

  const gaps = [
    'Document percentage of body affected during flares',
    'Track frequency and duration of flare-ups',
    'Note if exposed areas are affected',
    'Document intense itching and impact on sleep/function',
    'Record treatments used and their effectiveness',
  ];

  return {
    hasData: true,
    condition: 'Eczema/Dermatitis',
    diagnosticCode: '7806',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence: {
      totalFlares: relevantLogs.length,
      recentCoverage: bodyCoverage || 'Not documented',
    },
    gaps,
    criteria: ECZEMA_CRITERIA,
    disclaimer: 'This analysis is for documentation guidance only.',
  };
};

// ============================================
// ANALYSIS FUNCTIONS - TBI RESIDUALS
// ============================================

export const analyzeTBIResidualsLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate &&
        ['tbi-cognitive', 'tbi-emotional'].includes(log.symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No TBI residual symptoms logged',
      supportedRating: null,
      evidence: [],
      gaps: ['Log cognitive and emotional symptoms from TBI'],
    };
  }

  const cognitiveCount = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'tbi-cognitive'
  ).length;

  const emotionalCount = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'tbi-emotional'
  ).length;

  // Frequency analysis
  const monthsInPeriod = evaluationPeriodDays / 30;
  const symptomsPerMonth = relevantLogs.length / monthsInPeriod;

  let supportedRating = 0;
  let ratingRationale = [];

  if (symptomsPerMonth >= 10) {
    supportedRating = '50%';
    ratingRationale = [
      `${symptomsPerMonth.toFixed(1)} residual symptoms per month`,
      'Frequent cognitive and/or emotional difficulties',
      'Pattern suggests occupational and social impairment',
    ];
  } else if (symptomsPerMonth >= 5) {
    supportedRating = '30%';
    ratingRationale = [
      `${symptomsPerMonth.toFixed(1)} residual symptoms per month`,
      'Regular cognitive and/or emotional difficulties',
    ];
  } else {
    ratingRationale = [
      `${symptomsPerMonth.toFixed(1)} residual symptoms per month`,
      'Mild but documented TBI residuals',
    ];
  }

  const gaps = [
    'Consider neuropsychological testing for objective cognitive assessment',
    'Document specific functional impacts (work, relationships, daily tasks)',
    'Track medication use for residual symptoms',
    'Note if symptoms are separate from diagnosed mental health conditions',
  ];

  return {
    hasData: true,
    condition: 'Residuals of TBI',
    diagnosticCode: '8045-1',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence: {
      cognitiveSymptoms: cognitiveCount,
      emotionalSymptoms: emotionalCount,
      totalLogs: relevantLogs.length,
      monthlyRate: symptomsPerMonth.toFixed(1),
    },
    gaps,
    criteria: TBI_RESIDUALS_CRITERIA,
    disclaimer: 'TBI residuals often rated same as main TBI rating. Neuropsych testing may support higher ratings.',
  };
};

// ============================================
// ANALYSIS FUNCTIONS - GERD COMPLICATIONS
// ============================================

export const analyzeGERDComplicationsLogs = (logs, options = {}) => {
  const {
    evaluationPeriodDays = 90,
  } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && getLogSymptomId(log) === 'gerd-complication';
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No GERD complication logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Log GERD complications if diagnosed'],
    };
  }

  // Check for serious complications
  const hasBarretts = relevantLogs.some(log =>
      log.gerdComplicationData?.complicationType === 'barretts'
  );

  const hasStricture = relevantLogs.some(log =>
      log.gerdComplicationData?.complicationType === 'stricture'
  );

  let supportedRating = 0;
  let ratingRationale = [];

  if (hasBarretts) {
    supportedRating = '60%';
    ratingRationale = [
      'Barrett\'s esophagus is serious pre-cancerous complication',
      'Requires regular monitoring and treatment',
    ];
  } else if (hasStricture) {
    supportedRating = '30%';
    ratingRationale = [
      'Esophageal stricture documented',
      'May require periodic dilation procedures',
    ];
  } else {
    supportedRating = '30%';
    ratingRationale = [
      'Documented GERD complications (hiatal hernia, esophagitis)',
      'Persistently recurrent symptoms despite treatment',
    ];
  }

  const gaps = [
    'CRITICAL: Obtain endoscopy reports documenting complications',
    'Document frequency of dilation procedures if applicable',
    'Track daily medication requirements',
    'Note any weight loss or nutritional issues',
    'Request biopsy results if Barrett\'s esophagus suspected',
  ];

  return {
    hasData: true,
    condition: 'GERD with Complications',
    diagnosticCode: '7346',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence: {
      totalLogs: relevantLogs.length,
      hasBarretts,
      hasStricture,
    },
    gaps,
    criteria: GERD_COMPLICATIONS_CRITERIA,
    disclaimer: 'GERD complication ratings require endoscopy documentation and medical records.',
  };
};

/**
 * Analyze Ulcerative Colitis / IBD symptom logs
 */
export const analyzeUlcerativeColitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options; // Use 1 year for hospitalization tracking

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'uc-diarrhea', 'uc-rectal-bleeding', 'uc-abdominal-pain',
    'uc-urgency', 'uc-incontinence', 'uc-fever', 'uc-hospitalization'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No ulcerative colitis/IBD logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging IBD symptoms including diarrhea frequency, bleeding, and flares'],
    };
  }

  // Count symptom types
  const diarrheaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'uc-diarrhea');
  const bleedingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'uc-rectal-bleeding');
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'uc-hospitalization');
  const incontinenceLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'uc-incontinence');
  const feverLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'uc-fever');

  const evidence = [];
  if (diarrheaLogs.length > 0) evidence.push(`${diarrheaLogs.length} diarrhea episodes logged`);
  if (bleedingLogs.length > 0) evidence.push(`${bleedingLogs.length} rectal bleeding episodes logged`);
  if (hospitalizationLogs.length > 0) evidence.push(`${hospitalizationLogs.length} hospitalizations in evaluation period`);
  if (incontinenceLogs.length > 0) evidence.push(`${incontinenceLogs.length} incontinence episodes logged`);
  if (feverLogs.length > 0) evidence.push(`${feverLogs.length} fever/systemic symptom episodes logged`);

  // Determine rating
  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // Calculate daily averages
  const diarrheaPerDay = diarrheaLogs.length / evaluationPeriodDays;

  if (hospitalizationLogs.length >= 1 && (diarrheaPerDay >= 6 || bleedingLogs.length >= 180 || incontinenceLogs.length > 0)) {
    supportedRating = 100;
    ratingRationale = [
      'Hospitalization required in past year',
      'Severe symptoms: frequent diarrhea, bleeding, or incontinence',
      'Pattern consistent with 100% rating criteria',
    ];
  } else if (hospitalizationLogs.length >= 1 || (diarrheaPerDay >= 4 && feverLogs.length > 0)) {
    supportedRating = 60;
    ratingRationale = [
      'Moderate IBD with significant symptom burden',
      'May require immunosuppressant therapy',
    ];
    gaps.push('Document if immunosuppressants or biologics are prescribed');
  } else if (diarrheaLogs.length >= 30 || (relevantLogs.length >= 50 && feverLogs.length > 0)) {
    supportedRating = 30;
    ratingRationale = [
      'Mild-moderate IBD with regular symptoms',
      'Managed with oral/topical agents',
    ];
  } else {
    supportedRating = 10;
    ratingRationale = [
      'Minimal-mild IBD symptoms documented',
    ];
  }

  gaps.push('Document treatment regimen (oral agents, immunosuppressants, or biologics)');
  if (hospitalizationLogs.length === 0) {
    gaps.push('Log any hospitalizations for IBD flares');
  }

  return {
    hasData: true,
    condition: 'Ulcerative Colitis / IBD',
    diagnosticCode: '7323/7326',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: ULCERATIVE_COLITIS_CRITERIA,
    disclaimer: ULCERATIVE_COLITIS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Peptic Ulcer symptom logs
 */
export const analyzePepticUlcerLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'ulcer-abdominal-pain', 'ulcer-nausea', 'ulcer-vomiting',
    'ulcer-hematemesis', 'ulcer-melena', 'ulcer-hospitalization'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No peptic ulcer logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging peptic ulcer symptoms including pain episodes, nausea, and any bleeding'],
    };
  }

  const painLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ulcer-abdominal-pain');
  const nauseaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ulcer-nausea');
  const vomitingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ulcer-vomiting');
  const bleedingLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'ulcer-hematemesis' || getLogSymptomId(log) === 'ulcer-melena'
  );
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ulcer-hospitalization');

  const evidence = [];
  if (painLogs.length > 0) evidence.push(`${painLogs.length} abdominal pain episodes logged`);
  if (nauseaLogs.length > 0) evidence.push(`${nauseaLogs.length} nausea episodes logged`);
  if (vomitingLogs.length > 0) evidence.push(`${vomitingLogs.length} vomiting episodes logged`);
  if (bleedingLogs.length > 0) evidence.push(`${bleedingLogs.length} GI bleeding episodes (hematemesis/melena) logged`);
  if (hospitalizationLogs.length > 0) evidence.push(`${hospitalizationLogs.length} hospitalizations in evaluation period`);

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // Estimate episodes (clusters of 3+ consecutive days)
  const totalSymptomDays = new Set(relevantLogs.map(log =>
      new Date(log.timestamp).toDateString()
  )).size;

  if (hospitalizationLogs.length >= 1 && bleedingLogs.length > 0) {
    supportedRating = 60;
    ratingRationale = [
      'Hospitalization with GI bleeding documented',
      'Consistent with severe peptic ulcer disease',
    ];
  } else if (painLogs.length >= 12 || totalSymptomDays >= 12) {
    supportedRating = 40;
    ratingRationale = [
      'Multiple symptom episodes documented',
      'Pattern suggests 4+ episodes per year lasting 3+ days',
    ];
    gaps.push('Confirm daily medication use for peptic ulcer');
  } else if (painLogs.length >= 3 || totalSymptomDays >= 9) {
    supportedRating = 20;
    ratingRationale = [
      'Symptom episodes documented',
      'Pattern suggests 1-3 episodes per year',
    ];
    gaps.push('Confirm daily medication use for peptic ulcer');
  } else {
    supportedRating = 0;
    ratingRationale = [
      'Symptoms logged but may not meet compensable criteria',
      'Document episode duration (must be 3+ consecutive days)',
    ];
  }

  if (bleedingLogs.length === 0) {
    gaps.push('Document any GI bleeding (vomiting blood or tarry stools)');
  }

  return {
    hasData: true,
    condition: 'Peptic Ulcer Disease',
    diagnosticCode: '7304',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: PEPTIC_ULCER_CRITERIA,
    disclaimer: PEPTIC_ULCER_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Hemorrhoid symptom logs
 */
export const analyzeHemorrhoidLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = ['hemorrhoid-bleeding', 'hemorrhoid-prolapse', 'hemorrhoid-thrombosis', 'hemorrhoid-pain'];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No hemorrhoid logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging hemorrhoid symptoms including bleeding, prolapse, and thrombosis episodes'],
    };
  }

  const bleedingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hemorrhoid-bleeding');
  const prolapseLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hemorrhoid-prolapse');
  const thrombosisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hemorrhoid-thrombosis');

  const evidence = [];
  if (bleedingLogs.length > 0) evidence.push(`${bleedingLogs.length} bleeding episodes logged`);
  if (prolapseLogs.length > 0) evidence.push(`${prolapseLogs.length} prolapse episodes logged`);
  if (thrombosisLogs.length > 0) evidence.push(`${thrombosisLogs.length} thrombosis episodes logged`);

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // Check for 20% criteria: persistent bleeding with anemia OR 3+ thrombosis/year
  if (bleedingLogs.length >= 30 || thrombosisLogs.length >= 3) {
    supportedRating = 20;
    ratingRationale = [];
    if (bleedingLogs.length >= 30) {
      ratingRationale.push('Frequent/persistent bleeding documented');
      gaps.push('Get lab work to document anemia if present');
    }
    if (thrombosisLogs.length >= 3) {
      ratingRationale.push(`${thrombosisLogs.length} thrombosis episodes (3+ required for 20%)`);
    }
  } else if (thrombosisLogs.length >= 1 || prolapseLogs.length >= 1) {
    supportedRating = 10;
    ratingRationale = [
      'Thrombosis or prolapse episodes documented',
      'Pattern supports 10% rating',
    ];
  }

  if (thrombosisLogs.length === 0) {
    gaps.push('Document any thrombosis (blood clot) episodes - these significantly affect rating');
  }

  return {
    hasData: true,
    condition: 'Hemorrhoids',
    diagnosticCode: '7336',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: HEMORRHOID_CRITERIA,
    disclaimer: HEMORRHOID_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Diverticulitis symptom logs
 */
export const analyzeDiverticulitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'divert-abdominal-pain', 'divert-fever', 'divert-flare',
    'divert-hospitalization', 'divert-complication'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No diverticulitis logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging diverticulitis symptoms including flares, hospitalizations, and any complications'],
    };
  }

  const flareLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'divert-flare');
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'divert-hospitalization');
  const complicationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'divert-complication');
  const feverLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'divert-fever');

  const evidence = [];
  if (flareLogs.length > 0) evidence.push(`${flareLogs.length} acute flares logged`);
  if (hospitalizationLogs.length > 0) evidence.push(`${hospitalizationLogs.length} hospitalizations logged`);
  if (complicationLogs.length > 0) evidence.push(`${complicationLogs.length} complications (bleeding/abscess/obstruction) logged`);
  if (feverLogs.length > 0) evidence.push(`${feverLogs.length} fever episodes logged`);

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (hospitalizationLogs.length >= 1 && complicationLogs.length >= 1) {
    supportedRating = 30;
    ratingRationale = [
      'Hospitalization with complications documented',
      'Meets criteria for 30% rating',
    ];
  } else if (hospitalizationLogs.length >= 1) {
    supportedRating = 20;
    ratingRationale = [
      'Hospitalization for diverticulitis documented',
      'Without documented complications (30% requires complications)',
    ];
    gaps.push('Document any complications: hemorrhage, obstruction, abscess, peritonitis, or perforation');
  } else if (flareLogs.length >= 1 || feverLogs.length >= 1) {
    supportedRating = 0;
    ratingRationale = [
      'Symptomatic diverticulitis managed conservatively',
      'Compensable rating requires hospitalization',
    ];
    gaps.push('Document any hospitalizations for acute flares');
  }

  return {
    hasData: true,
    condition: 'Diverticulitis',
    diagnosticCode: '7327',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: DIVERTICULITIS_CRITERIA,
    disclaimer: DIVERTICULITIS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Hypothyroidism symptom logs
 */
export const analyzeHypothyroidismLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'hypo-fatigue', 'hypo-cold-intolerance', 'hypo-weight-gain',
    'hypo-depression', 'hypo-muscle-weakness', 'hypo-constipation', 'hypo-dry-skin'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No hypothyroidism logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging hypothyroidism symptoms including fatigue, cold intolerance, and other symptoms'],
    };
  }

  const fatigueLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hypo-fatigue');
  const coldLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hypo-cold-intolerance');
  const depressionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hypo-depression');
  const weaknessLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hypo-muscle-weakness');

  const evidence = [];
  if (fatigueLogs.length > 0) evidence.push(`${fatigueLogs.length} fatigue episodes logged`);
  if (coldLogs.length > 0) evidence.push(`${coldLogs.length} cold intolerance episodes logged`);
  if (depressionLogs.length > 0) evidence.push(`${depressionLogs.length} depression/mental fog episodes logged`);
  if (weaknessLogs.length > 0) evidence.push(`${weaknessLogs.length} muscle weakness episodes logged`);

  // Check for myxedema criteria (all 4 symptom categories)
  const hasAllMyxedemaSymptoms = coldLogs.length > 0 && weaknessLogs.length > 0 && depressionLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (hasAllMyxedemaSymptoms && relevantLogs.length >= 50) {
    supportedRating = '30-100';
    ratingRationale = [
      'Multiple myxedema symptom categories documented',
      'Severe symptoms may support 100% rating if myxedema diagnosed',
      '30% is standard rating for hypothyroidism without myxedema',
    ];
    gaps.push('Obtain medical documentation if myxedema is present');
  } else {
    supportedRating = 30;
    ratingRationale = [
      'Hypothyroidism symptoms documented',
      '30% is standard rating for hypothyroidism without myxedema',
      'This rating continues for 6 months after diagnosis, then rate residuals',
    ];
  }

  gaps.push('Document cardiovascular effects (low BP, slow heart rate) if present');
  gaps.push('Track lab values (TSH, T4) when available');

  return {
    hasData: true,
    condition: 'Hypothyroidism',
    diagnosticCode: '7903',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: HYPOTHYROIDISM_CRITERIA,
    disclaimer: HYPOTHYROIDISM_CRITERIA.disclaimer,
  };
};

// ============================================
// PHASE 3A: ENDOCRINE ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyze Hyperthyroidism/Graves' Disease symptom logs
 * DC 7900 - 38 CFR 4.119
 */
export const analyzeHyperthyroidismLogs = (logs, options = {}) => {
  const { days = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.HYPERTHYROIDISM.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Hyperthyroidism/Graves\' Disease',
      diagnosticCode: '7900',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging hyperthyroidism symptoms including rapid heartbeat, weight loss, tremor, and heat intolerance'],
      metrics: {},
    };
  }

  // Categorize symptoms
  const cardiacSymptoms = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'hyper-rapid-heartbeat'
  );
  const metabolicSymptoms = relevantLogs.filter(log =>
      ['hyper-weight-loss', 'hyper-heat-intolerance', 'hyper-sweating', 'hyper-appetite-increase'].includes(getLogSymptomId(log))
  );
  const neurologicSymptoms = relevantLogs.filter(log =>
      ['hyper-tremor', 'hyper-anxiety', 'hyper-irritability', 'hyper-sleep-difficulty'].includes(getLogSymptomId(log))
  );
  const muscleSymptoms = relevantLogs.filter(log =>
      ['hyper-fatigue', 'hyper-muscle-weakness'].includes(getLogSymptomId(log))
  );
  const eyeSymptoms = relevantLogs.filter(log =>
      ['graves-eye-bulging', 'graves-eye-irritation', 'graves-double-vision', 'graves-eye-pain', 'graves-light-sensitivity'].includes(getLogSymptomId(log))
  );

  // Calculate average severity
  const severities = relevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  // Determine rating - Hyperthyroidism gets 30% for 6 months, then rate residuals
  let supportedRating = 30;
  const ratingRationale = [];
  const gaps = [];

  ratingRationale.push(`${relevantLogs.length} hyperthyroidism symptoms logged in ${days} days`);
  ratingRationale.push('Initial 30% rating applies for 6 months after diagnosis');

  if (cardiacSymptoms.length > 0) {
    ratingRationale.push(`${cardiacSymptoms.length} cardiac symptoms (rapid/irregular heartbeat) - may warrant separate evaluation under DC 7008`);
  }

  if (eyeSymptoms.length > 0) {
    ratingRationale.push(`${eyeSymptoms.length} Graves\' eye symptoms documented - may warrant separate evaluation under eye DCs`);
    gaps.push('Obtain ophthalmology evaluation for Graves\' eye disease - separately ratable');
  }

  if (metabolicSymptoms.length > 0) {
    ratingRationale.push(`Metabolic symptoms documented: weight loss, heat intolerance, sweating`);
  }

  if (neurologicSymptoms.length > 0) {
    ratingRationale.push(`Neurological symptoms documented: tremor, anxiety, sleep difficulty`);
  }

  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);
  ratingRationale.push('After 6 months, rate residuals under appropriate diagnostic codes');

  // Documentation gaps
  if (cardiacSymptoms.length === 0) {
    gaps.push('Document cardiac symptoms (rapid heartbeat, palpitations) if present - separately ratable');
  }
  if (eyeSymptoms.length === 0) {
    gaps.push('Document eye symptoms (bulging, double vision, irritation) if present - separately ratable');
  }
  gaps.push('Track thyroid lab values (TSH, T3, T4) when available');
  gaps.push('Document any hospitalizations or thyroid storm episodes');

  return {
    hasData: true,
    condition: 'Hyperthyroidism/Graves\' Disease',
    diagnosticCode: '7900',
    cfrReference: '38 CFR 4.119',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      cardiacSymptoms: cardiacSymptoms.length,
      metabolicSymptoms: metabolicSymptoms.length,
      neurologicSymptoms: neurologicSymptoms.length,
      muscleSymptoms: muscleSymptoms.length,
      eyeSymptoms: eyeSymptoms.length,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
      hasGravesEyeDisease: eyeSymptoms.length > 0,
    },
    criteria: HYPERTHYROIDISM_CRITERIA,
  };
};

/**
 * Analyze Thyroiditis symptom logs
 * DC 7906 - 38 CFR 4.119
 */
export const analyzeThyroiditisLogs = (logs, options = {}) => {
  const { days = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.THYROIDITIS.symptomIds;

  // Also check for hyper/hypo symptoms that indicate thyroid dysfunction phase
  const hyperSymptomIds = CONDITIONS.HYPERTHYROIDISM.symptomIds;
  const hypoSymptomIds = CONDITIONS.HYPOTHYROIDISM.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  // Also get hyper/hypo logs to determine phase
  const hyperLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && hyperSymptomIds.includes(symptomId);
  });

  const hypoLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && hypoSymptomIds.includes(symptomId);
  });

  const allRelevantLogs = [...relevantLogs, ...hyperLogs, ...hypoLogs];

  if (relevantLogs.length === 0 && hyperLogs.length === 0 && hypoLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Thyroiditis',
      diagnosticCode: '7906',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging thyroiditis symptoms including neck pain, swelling, and thyroid dysfunction symptoms'],
      metrics: {},
    };
  }

  // Categorize thyroiditis-specific symptoms
  const neckSymptoms = relevantLogs.filter(log =>
      ['thyroiditis-neck-pain', 'thyroiditis-swelling', 'thyroiditis-difficulty-swallowing'].includes(getLogSymptomId(log))
  );
  const hyperPhaseMarkers = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'thyroiditis-hyper-phase'
  );
  const hypoPhaseMarkers = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'thyroiditis-hypo-phase'
  );

  // Calculate average severity
  const severities = allRelevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  // Determine phase and rating
  let supportedRating = 0;
  let currentPhase = 'euthyroid';
  const ratingRationale = [];
  const gaps = [];

  // Determine predominant phase
  if (hyperPhaseMarkers.length > hypoPhaseMarkers.length || hyperLogs.length > hypoLogs.length) {
    currentPhase = 'hyperthyroid';
    supportedRating = 30;
    ratingRationale.push('Thyroiditis manifesting as hyperthyroidism - rated under DC 7900');
    ratingRationale.push('30% rating for hyperthyroid phase');
  } else if (hypoPhaseMarkers.length > hyperPhaseMarkers.length || hypoLogs.length > hyperLogs.length) {
    currentPhase = 'hypothyroid';
    supportedRating = 30;
    ratingRationale.push('Thyroiditis manifesting as hypothyroidism - rated under DC 7903');
    ratingRationale.push('30% rating for hypothyroid phase (without myxedema)');
  } else {
    currentPhase = 'euthyroid';
    supportedRating = 0;
    ratingRationale.push('Thyroiditis with normal thyroid function (euthyroid)');
    ratingRationale.push('0% rating when thyroid function is normal');
  }

  ratingRationale.push(`${allRelevantLogs.length} total symptoms logged in ${days} days`);

  if (neckSymptoms.length > 0) {
    ratingRationale.push(`${neckSymptoms.length} neck/thyroid symptoms (pain, swelling, difficulty swallowing)`);
  }

  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Documentation gaps
  gaps.push('Document current thyroid function status (hyper, hypo, or normal)');
  gaps.push('Track thyroid lab values (TSH, T3, T4) to establish phase');
  if (currentPhase === 'euthyroid') {
    gaps.push('Log hyperthyroid or hypothyroid symptoms if they develop');
  }

  return {
    hasData: true,
    condition: 'Thyroiditis',
    diagnosticCode: '7906',
    cfrReference: '38 CFR 4.119',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: allRelevantLogs.length,
      thyroiditisSpecificLogs: relevantLogs.length,
      hyperLogs: hyperLogs.length,
      hypoLogs: hypoLogs.length,
      neckSymptoms: neckSymptoms.length,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
      currentPhase,
    },
    criteria: THYROIDITIS_CRITERIA,
  };
};

/**
 * Analyze Hyperparathyroidism symptom logs
 * DC 7904 - 38 CFR 4.119
 */
export const analyzeHyperparathyroidismLogs = (logs, options = {}) => {
  const { days = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.HYPERPARATHYROIDISM.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Hyperparathyroidism',
      diagnosticCode: '7904',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging hyperparathyroidism symptoms including fatigue, bone pain, kidney stones, and GI symptoms'],
      metrics: {},
    };
  }

  // Categorize symptoms - "Stones, Bones, Groans, and Moans"
  const kidneySymptoms = relevantLogs.filter(log =>
      ['hpth-kidney-stones', 'hpth-excessive-thirst', 'hpth-frequent-urination'].includes(getLogSymptomId(log))
  );
  const boneSymptoms = relevantLogs.filter(log =>
      ['hpth-bone-pain', 'hpth-fracture', 'hpth-muscle-weakness'].includes(getLogSymptomId(log))
  );
  const giSymptoms = relevantLogs.filter(log =>
      ['hpth-abdominal-pain', 'hpth-nausea', 'hpth-constipation', 'hpth-anorexia'].includes(getLogSymptomId(log))
  );
  const neuroSymptoms = relevantLogs.filter(log =>
      ['hpth-confusion', 'hpth-depression', 'hpth-fatigue'].includes(getLogSymptomId(log))
  );
  const fractureLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'hpth-fracture'
  );

  // Calculate average severity
  const severities = relevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  // Determine rating based on symptoms
  let supportedRating = 0;
  const ratingRationale = [];
  const gaps = [];

  ratingRationale.push(`${relevantLogs.length} hyperparathyroidism symptoms logged in ${days} days`);

  // Check for hypercalcemia indicators (60% criteria)
  const hasHypercalcemiaIndicators = fractureLogs.length > 0 ||
      (kidneySymptoms.length >= 3 && boneSymptoms.length >= 2);

  // Check for persistent symptoms (10% criteria)
  const hasPersistentSymptoms = giSymptoms.length > 0 || neuroSymptoms.length > 0;

  if (hasHypercalcemiaIndicators) {
    supportedRating = 60;
    ratingRationale.push('Symptoms suggest significant hypercalcemia');
    if (fractureLogs.length > 0) {
      ratingRationale.push('Fragility fracture documented - supports 60% rating');
    }
    ratingRationale.push('60% rating requires lab confirmation: Ca >12 mg/dL, creatinine clearance <60, or T-score <-2.5');
  } else if (hasPersistentSymptoms) {
    supportedRating = 10;
    ratingRationale.push('Persistent symptoms (fatigue, anorexia, nausea, constipation) documented');
    ratingRationale.push('10% rating for symptoms despite treatment or requiring continuous medication');
  } else {
    supportedRating = 0;
    ratingRationale.push('Minimal symptoms documented - may be asymptomatic');
    ratingRationale.push('0% rating if asymptomatic and controlled');
  }

  // Add symptom category details
  if (kidneySymptoms.length > 0) {
    ratingRationale.push(`Kidney symptoms: ${kidneySymptoms.length} (stones, thirst, urination)`);
  }
  if (boneSymptoms.length > 0) {
    ratingRationale.push(`Bone symptoms: ${boneSymptoms.length} (pain, weakness, fractures)`);
  }
  if (giSymptoms.length > 0) {
    ratingRationale.push(`GI symptoms: ${giSymptoms.length} (abdominal pain, nausea, constipation)`);
  }
  if (neuroSymptoms.length > 0) {
    ratingRationale.push(`Neuropsychiatric symptoms: ${neuroSymptoms.length} (confusion, depression, fatigue)`);
  }

  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Documentation gaps
  gaps.push('Document calcium levels and other lab values when available');
  gaps.push('Obtain bone density (DEXA) scan results - T-score <-2.5 supports higher rating');
  if (kidneySymptoms.length > 0) {
    gaps.push('Document creatinine clearance if kidney involvement present');
  }
  gaps.push('Note if surgery performed or if continuous medication required');

  return {
    hasData: true,
    condition: 'Hyperparathyroidism',
    diagnosticCode: '7904',
    cfrReference: '38 CFR 4.119',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      kidneySymptoms: kidneySymptoms.length,
      boneSymptoms: boneSymptoms.length,
      giSymptoms: giSymptoms.length,
      neuroSymptoms: neuroSymptoms.length,
      hasFracture: fractureLogs.length > 0,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
    },
    criteria: HYPERPARATHYROIDISM_CRITERIA,
  };
};

/**
 * Analyze Hypoparathyroidism symptom logs
 * DC 7905 - 38 CFR 4.119
 */
export const analyzeHypoparathyroidismLogs = (logs, options = {}) => {
  const { days = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.HYPOPARATHYROIDISM.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Hypoparathyroidism',
      diagnosticCode: '7905',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging hypoparathyroidism symptoms including muscle cramps, tingling, spasms, and fatigue'],
      metrics: {},
    };
  }

  // Categorize symptoms
  const neuromuscularSymptoms = relevantLogs.filter(log =>
      ['hopth-muscle-cramps', 'hopth-tingling', 'hopth-muscle-spasms'].includes(getLogSymptomId(log))
  );
  const neuropsychSymptoms = relevantLogs.filter(log =>
      ['hopth-seizures', 'hopth-depression', 'hopth-anxiety', 'hopth-memory-problems'].includes(getLogSymptomId(log))
  );
  const integumentarySymptoms = relevantLogs.filter(log =>
      ['hopth-dry-skin', 'hopth-brittle-nails', 'hopth-hair-loss'].includes(getLogSymptomId(log))
  );
  const otherSymptoms = relevantLogs.filter(log =>
      ['hopth-fatigue', 'hopth-cataracts'].includes(getLogSymptomId(log))
  );
  const seizureLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'hopth-seizures'
  );
  const cataractLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'hopth-cataracts'
  );

  // Calculate average severity
  const severities = relevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  // Hypoparathyroidism gets 100% for 3 months, then rate residuals
  // Since we can't determine diagnosis date, we note both options
  let supportedRating = 100;
  const ratingRationale = [];
  const gaps = [];

  ratingRationale.push(`${relevantLogs.length} hypoparathyroidism symptoms logged in ${days} days`);
  ratingRationale.push('Initial 100% rating applies for 3 months after diagnosis');
  ratingRationale.push('After 3 months, rate chronic residuals under appropriate codes');

  // Document symptom categories
  if (neuromuscularSymptoms.length > 0) {
    ratingRationale.push(`${neuromuscularSymptoms.length} neuromuscular symptoms (cramps, tingling, spasms/tetany)`);
  }

  if (seizureLogs.length > 0) {
    ratingRationale.push(`${seizureLogs.length} seizure episodes documented - rate separately under DC 8910-8914`);
  }

  if (cataractLogs.length > 0) {
    ratingRationale.push('Cataracts documented - rate separately under eye diagnostic codes');
  }

  if (neuropsychSymptoms.length > 0) {
    ratingRationale.push(`${neuropsychSymptoms.length} neuropsychiatric symptoms (depression, anxiety, memory issues)`);
  }

  if (integumentarySymptoms.length > 0) {
    ratingRationale.push(`${integumentarySymptoms.length} integumentary symptoms (dry skin, brittle nails, hair loss)`);
  }

  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Documentation gaps
  gaps.push('Document diagnosis date to determine if within initial 3-month period');
  gaps.push('Track calcium and PTH lab values when available');
  if (seizureLogs.length > 0) {
    gaps.push('Seizures from hypocalcemia may be separately rated - document all episodes');
  }
  if (cataractLogs.length > 0) {
    gaps.push('Obtain ophthalmology evaluation for cataracts - separately ratable');
  }
  gaps.push('Document any kidney complications (nephrolithiasis)');
  gaps.push('Note if cardiac involvement present (CHF) - separately ratable');

  return {
    hasData: true,
    condition: 'Hypoparathyroidism',
    diagnosticCode: '7905',
    cfrReference: '38 CFR 4.119',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      neuromuscularSymptoms: neuromuscularSymptoms.length,
      neuropsychSymptoms: neuropsychSymptoms.length,
      integumentarySymptoms: integumentarySymptoms.length,
      hasSeizures: seizureLogs.length > 0,
      hasCataracts: cataractLogs.length > 0,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
    },
    criteria: HYPOPARATHYROIDISM_CRITERIA,
  };
};

// ============================================
// PHASE 3B: ADRENAL & PITUITARY ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyze Addison's Disease symptom logs
 * DC 7911 - 38 CFR 4.119
 */
export const analyzeAddisonsDiseaseLog = (logs, options = {}) => {
  const { days = 365 } = options; // Use 365 days for crisis/episode counting

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.ADDISONS_DISEASE.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: "Addison's Disease",
      diagnosticCode: '7911',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging Addison\'s disease symptoms including crises, episodes, fatigue, and other symptoms'],
      metrics: {},
    };
  }

  // Count crises and episodes (most critical for rating)
  const crisisLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'addisons-crisis'
  );
  const episodeLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'addisons-episode'
  );

  // Other symptom categories
  const fatigueWeaknessLogs = relevantLogs.filter(log =>
      ['addisons-fatigue', 'addisons-muscle-weakness'].includes(getLogSymptomId(log))
  );
  const giSymptomLogs = relevantLogs.filter(log =>
      ['addisons-nausea', 'addisons-abdominal-pain'].includes(getLogSymptomId(log))
  );
  const cardiovascularLogs = relevantLogs.filter(log =>
      ['addisons-hypotension', 'addisons-dizziness'].includes(getLogSymptomId(log))
  );
  const skinLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'addisons-hyperpigmentation'
  );

  // Calculate average severity
  const severities = relevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  const crisisCount = crisisLogs.length;
  const episodeCount = episodeLogs.length;

  // Determine rating based on crisis/episode frequency
  let supportedRating = 0;
  const ratingRationale = [];
  const gaps = [];

  if (crisisCount >= 4) {
    supportedRating = 60;
    ratingRationale.push(`${crisisCount} adrenal crises documented in past year`);
    ratingRationale.push('4+ crises per year supports 60% rating');
  } else if (crisisCount >= 3 || episodeCount >= 5) {
    supportedRating = 40;
    if (crisisCount >= 3) {
      ratingRationale.push(`${crisisCount} adrenal crises documented in past year`);
    }
    if (episodeCount >= 5) {
      ratingRationale.push(`${episodeCount} adrenal episodes documented in past year`);
    }
    ratingRationale.push('3 crises OR 5+ episodes supports 40% rating');
  } else if (crisisCount >= 1 || episodeCount >= 2 || fatigueWeaknessLogs.length > 0) {
    supportedRating = 20;
    if (crisisCount >= 1) {
      ratingRationale.push(`${crisisCount} adrenal crisis documented in past year`);
    }
    if (episodeCount >= 2) {
      ratingRationale.push(`${episodeCount} adrenal episodes documented in past year`);
    }
    if (fatigueWeaknessLogs.length > 0) {
      ratingRationale.push(`Weakness and fatigability documented (${fatigueWeaknessLogs.length} logs)`);
    }
    ratingRationale.push('1-2 crises OR 2-4 episodes OR weakness/fatigue supports 20% rating');
  } else {
    supportedRating = 20;
    ratingRationale.push('Symptoms documented - minimum 20% if on corticosteroid therapy');
  }

  ratingRationale.push(`${relevantLogs.length} total symptoms logged in past ${days} days`);
  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Add symptom category details
  if (cardiovascularLogs.length > 0) {
    ratingRationale.push(`Cardiovascular symptoms: ${cardiovascularLogs.length} (hypotension, dizziness)`);
  }
  if (giSymptomLogs.length > 0) {
    ratingRationale.push(`GI symptoms: ${giSymptomLogs.length} (nausea, abdominal pain)`);
  }
  if (skinLogs.length > 0) {
    ratingRationale.push('Hyperpigmentation documented');
  }

  // Documentation gaps
  if (crisisCount === 0 && episodeCount === 0) {
    gaps.push('Document any adrenal crises or episodes with detailed descriptions');
  }
  gaps.push('Note if currently on corticosteroid replacement therapy');
  gaps.push('Document any emergency room visits or hospitalizations for adrenal insufficiency');
  if (crisisCount > 0) {
    gaps.push('For crises: document vital signs, treatments required, and recovery time');
  }

  return {
    hasData: true,
    condition: "Addison's Disease",
    diagnosticCode: '7911',
    cfrReference: '38 CFR 4.119',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      crisisCount,
      episodeCount,
      fatigueWeaknessLogs: fatigueWeaknessLogs.length,
      giSymptomLogs: giSymptomLogs.length,
      cardiovascularLogs: cardiovascularLogs.length,
      hasHyperpigmentation: skinLogs.length > 0,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
      evaluationPeriodDays: days,
    },
    criteria: ADDISONS_DISEASE_CRITERIA,
  };
};

/**
 * Analyze Cushing's Syndrome symptom logs
 * DC 7907 - 38 CFR 4.119
 */
export const analyzeCushingsSyndromeLogs = (logs, options = {}) => {
  const { days = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.CUSHINGS_SYNDROME.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: "Cushing's Syndrome",
      diagnosticCode: '7907',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging Cushing\'s syndrome symptoms including weight changes, skin changes, and muscle weakness'],
      metrics: {},
    };
  }

  // Key symptom categories for rating determination
  const cushingoidFeatures = relevantLogs.filter(log =>
      ['cushings-moon-face', 'cushings-buffalo-hump', 'cushings-striae',
        'cushings-weight-gain', 'cushings-thin-skin', 'cushings-bruising'].includes(getLogSymptomId(log))
  );

  const muscleWastingLogs = relevantLogs.filter(log =>
      ['cushings-muscle-weakness', 'cushings-muscle-wasting'].includes(getLogSymptomId(log))
  );

  const metabolicLogs = relevantLogs.filter(log =>
      ['cushings-hypertension', 'cushings-glucose', 'cushings-osteoporosis'].includes(getLogSymptomId(log))
  );

  const otherLogs = relevantLogs.filter(log =>
      ['cushings-fatigue', 'cushings-mood', 'cushings-insomnia',
        'cushings-infections', 'cushings-acne', 'cushings-hirsutism',
        'cushings-menstrual', 'cushings-erectile'].includes(getLogSymptomId(log))
  );

  // Check for specific 100% criteria components
  const hasOsteoporosis = relevantLogs.some(log => getLogSymptomId(log) === 'cushings-osteoporosis');
  const hasHypertension = relevantLogs.some(log => getLogSymptomId(log) === 'cushings-hypertension');
  const hasSevereMuscleWasting = muscleWastingLogs.length >= 3 ||
      muscleWastingLogs.some(log => (log.severity || 5) >= 8);

  // Check for 30% criteria components
  const hasStriae = relevantLogs.some(log => getLogSymptomId(log) === 'cushings-striae');
  const hasMoonFace = relevantLogs.some(log => getLogSymptomId(log) === 'cushings-moon-face');
  const hasWeightGain = relevantLogs.some(log => getLogSymptomId(log) === 'cushings-weight-gain');
  const hasGlucoseIntolerance = relevantLogs.some(log => getLogSymptomId(log) === 'cushings-glucose');
  const hasVascularFragility = relevantLogs.some(log =>
      ['cushings-thin-skin', 'cushings-bruising'].includes(getLogSymptomId(log))
  );

  // Calculate average severity
  const severities = relevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  // Determine rating
  let supportedRating = 0;
  const ratingRationale = [];
  const gaps = [];

  // Check for 100% rating (most severe)
  if (hasOsteoporosis && hasHypertension && hasSevereMuscleWasting) {
    supportedRating = 100;
    ratingRationale.push('Active progressive disease documented with:');
    ratingRationale.push('- Osteoporosis/bone involvement');
    ratingRationale.push('- Hypertension');
    ratingRationale.push('- Severe proximal muscle wasting');
    ratingRationale.push('100% rating for active progressive disease with all three findings');
  }
  // Check for 60% rating
  else if (hasSevereMuscleWasting) {
    supportedRating = 60;
    ratingRationale.push('Proximal muscle wasting documented');
    ratingRationale.push(`${muscleWastingLogs.length} muscle weakness/wasting symptoms logged`);
    ratingRationale.push('60% rating for muscle wasting causing functional limitations');
  }
  // Check for 30% rating (classic Cushingoid features)
  else if (cushingoidFeatures.length >= 2) {
    supportedRating = 30;
    ratingRationale.push('Classic Cushingoid features documented:');
    if (hasStriae) ratingRationale.push('- Striae (stretch marks)');
    if (hasWeightGain) ratingRationale.push('- Central obesity');
    if (hasMoonFace) ratingRationale.push('- Moon face');
    if (hasGlucoseIntolerance) ratingRationale.push('- Glucose intolerance');
    if (hasVascularFragility) ratingRationale.push('- Vascular fragility/easy bruising');
    ratingRationale.push('30% rating for typical Cushingoid presentation');
  } else {
    supportedRating = 30;
    ratingRationale.push('Cushing\'s syndrome symptoms documented');
    ratingRationale.push('Minimum 30% rating applies for 6 months after diagnosis');
  }

  ratingRationale.push(`${relevantLogs.length} total symptoms logged in ${days} days`);
  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);
  ratingRationale.push('Note: Ratings continue for 6 months after diagnosis, then rate residuals');

  // Documentation gaps
  if (!hasSevereMuscleWasting) {
    gaps.push('Document any difficulty rising from chair, climbing stairs, or raising arms');
  }
  if (!hasOsteoporosis) {
    gaps.push('Document any bone density issues or fractures');
  }
  if (!hasHypertension) {
    gaps.push('Track and document blood pressure readings');
  }
  if (!hasGlucoseIntolerance) {
    gaps.push('Document any blood sugar abnormalities');
  }
  gaps.push('Note diagnosis date to determine if within initial 6-month period');

  return {
    hasData: true,
    condition: "Cushing's Syndrome",
    diagnosticCode: '7907',
    cfrReference: '38 CFR 4.119',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      cushingoidFeatures: cushingoidFeatures.length,
      muscleWastingLogs: muscleWastingLogs.length,
      metabolicLogs: metabolicLogs.length,
      hasOsteoporosis,
      hasHypertension,
      hasSevereMuscleWasting,
      hasStriae,
      hasMoonFace,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
    },
    criteria: CUSHINGS_SYNDROME_CRITERIA,
  };
};

/**
 * Analyze Diabetes Insipidus symptom logs
 * DC 7909 - 38 CFR 4.119
 */
export const analyzeDiabetesInsipidusLogs = (logs, options = {}) => {
  const { days = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.DIABETES_INSIPIDUS.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Diabetes Insipidus',
      diagnosticCode: '7909',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging diabetes insipidus symptoms including excessive urination and thirst'],
      metrics: {},
    };
  }

  // Key symptom categories
  const polyuriaLogs = relevantLogs.filter(log =>
      ['di-polyuria', 'di-nocturia'].includes(getLogSymptomId(log))
  );
  const polydipsiaLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'di-polydipsia'
  );
  const dehydrationLogs = relevantLogs.filter(log =>
      ['di-dehydration', 'di-dizziness', 'di-headache'].includes(getLogSymptomId(log))
  );
  const otherLogs = relevantLogs.filter(log =>
      ['di-fatigue', 'di-muscle-cramps', 'di-constipation', 'di-weight-loss'].includes(getLogSymptomId(log))
  );

  // Calculate average severity
  const severities = relevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  // Check for persistent polyuria (key criterion for 10% after initial period)
  const hasPersistentPolyuria = polyuriaLogs.length >= 5; // Multiple logs suggest persistence

  // Determine rating
  let supportedRating = 30;
  const ratingRationale = [];
  const gaps = [];

  ratingRationale.push(`${relevantLogs.length} diabetes insipidus symptoms logged in ${days} days`);
  ratingRationale.push('Initial 30% rating applies for 3 months after diagnosis');

  if (hasPersistentPolyuria) {
    ratingRationale.push(`Persistent polyuria documented (${polyuriaLogs.length} polyuria/nocturia logs)`);
    ratingRationale.push('After initial 3 months: 10% for persistent polyuria or continuous therapy');
    supportedRating = '30/10'; // Indicate both possible ratings
  } else {
    ratingRationale.push('After 3 months, if condition subsides, rate residuals under appropriate codes');
  }

  if (polydipsiaLogs.length > 0) {
    ratingRationale.push(`Polydipsia (excessive thirst) documented: ${polydipsiaLogs.length} logs`);
  }

  if (dehydrationLogs.length > 0) {
    ratingRationale.push(`Dehydration-related symptoms: ${dehydrationLogs.length} logs`);
  }

  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Documentation gaps
  gaps.push('Document diagnosis date to determine rating period');
  gaps.push('Note if on continuous hormonal therapy (desmopressin/DDAVP)');
  if (polyuriaLogs.length < 3) {
    gaps.push('Document frequency and volume of urination');
  }
  gaps.push('Track fluid intake and urine output if possible');

  return {
    hasData: true,
    condition: 'Diabetes Insipidus',
    diagnosticCode: '7909',
    cfrReference: '38 CFR 4.119',
    supportedRating: 30, // Default to initial rating
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      polyuriaLogs: polyuriaLogs.length,
      polydipsiaLogs: polydipsiaLogs.length,
      dehydrationLogs: dehydrationLogs.length,
      hasPersistentPolyuria,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
    },
    criteria: DIABETES_INSIPIDUS_CRITERIA,
  };
};

/**
 * Analyze Hyperaldosteronism symptom logs
 * DC 7917 - 38 CFR 4.119
 */
export const analyzeHyperaldosteronismLogs = (logs, options = {}) => {
  const { days = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.HYPERALDOSTERONISM.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date || log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Hyperaldosteronism',
      diagnosticCode: '7917',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging hyperaldosteronism symptoms including hypertension, muscle weakness, and fatigue'],
      metrics: {},
    };
  }

  // Key symptom categories
  const hypertensionLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'haldo-hypertension'
  );
  const hypokalemiaLogs = relevantLogs.filter(log =>
      ['haldo-muscle-weakness', 'haldo-muscle-cramps', 'haldo-numbness',
        'haldo-palpitations', 'haldo-constipation'].includes(getLogSymptomId(log))
  );
  const otherLogs = relevantLogs.filter(log =>
      ['haldo-fatigue', 'haldo-headaches', 'haldo-polyuria',
        'haldo-polydipsia', 'haldo-mood'].includes(getLogSymptomId(log))
  );

  // Calculate average severity
  const severities = relevantLogs.map(log => log.severity || 5).filter(s => s > 0);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  // Hyperaldosteronism is rated as neoplasm or by residuals
  // Most common residual is hypertension - guide to rate under DC 7101
  const ratingRationale = [];
  const gaps = [];

  ratingRationale.push(`${relevantLogs.length} hyperaldosteronism symptoms logged in ${days} days`);
  ratingRationale.push('Per VA: Evaluate as benign or malignant neoplasm as appropriate');
  ratingRationale.push('For benign cases, rate residuals under appropriate diagnostic codes');

  if (hypertensionLogs.length > 0) {
    ratingRationale.push(`Hypertension documented (${hypertensionLogs.length} logs) - rate under DC 7101`);
  }

  if (hypokalemiaLogs.length > 0) {
    ratingRationale.push(`Hypokalemia symptoms: ${hypokalemiaLogs.length} (weakness, cramps, numbness, palpitations)`);
  }

  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);
  ratingRationale.push('Primary residual (hypertension) rated separately under cardiovascular codes');

  // Documentation gaps
  gaps.push('Document blood pressure readings for hypertension rating');
  gaps.push('Note potassium levels when available');
  gaps.push('Document if benign adenoma (Conn\'s syndrome) or other cause');
  if (hypertensionLogs.length === 0) {
    gaps.push('Track and log blood pressure - primary manifestation for rating');
  }

  return {
    hasData: true,
    condition: 'Hyperaldosteronism',
    diagnosticCode: '7917',
    cfrReference: '38 CFR 4.119',
    supportedRating: 0, // Rated via residuals
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      hypertensionLogs: hypertensionLogs.length,
      hypokalemiaLogs: hypokalemiaLogs.length,
      otherLogs: otherLogs.length,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
    },
    criteria: HYPERALDOSTERONISM_CRITERIA,
  };
};

/**
 * Analyze Raynaud's symptom logs
 */
export const analyzeRaynaudsLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'raynauds-attack', 'raynauds-numbness', 'raynauds-pain',
    'raynauds-ulcer', 'raynauds-cold-trigger'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: "No Raynaud's logs found",
      supportedRating: null,
      evidence: [],
      gaps: ["Start logging Raynaud's attacks including color changes, triggers, and any ulcers"],
    };
  }

  const attackLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'raynauds-attack' || getLogSymptomId(log) === 'raynauds-cold-trigger'
  );
  const ulcerLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'raynauds-ulcer');

  const weeksInPeriod = evaluationPeriodDays / 7;
  const attacksPerWeek = attackLogs.length / weeksInPeriod;

  const evidence = [];
  evidence.push(`${attackLogs.length} characteristic attacks logged (${attacksPerWeek.toFixed(1)}/week)`);
  if (ulcerLogs.length > 0) evidence.push(`${ulcerLogs.length} digital ulcer episodes logged`);

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (ulcerLogs.length >= 2) {
    supportedRating = 60;
    ratingRationale = [
      '2+ digital ulcers documented',
      'With history of characteristic attacks',
      'Supports 60% rating (100% requires auto-amputation)',
    ];
  } else if (attacksPerWeek >= 7) {
    supportedRating = 40;
    ratingRationale = [
      `Attacks occurring ${attacksPerWeek.toFixed(1)} times per week (daily or more)`,
      'Daily attacks support 40% rating',
    ];
  } else if (attacksPerWeek >= 4) {
    supportedRating = 20;
    ratingRationale = [
      `Attacks occurring ${attacksPerWeek.toFixed(1)} times per week`,
      '4-6 attacks per week supports 20% rating',
    ];
  } else if (attacksPerWeek >= 1) {
    supportedRating = 10;
    ratingRationale = [
      `Attacks occurring ${attacksPerWeek.toFixed(1)} times per week`,
      '1-3 attacks per week supports 10% rating',
    ];
  }

  if (ulcerLogs.length === 0) {
    gaps.push('Document any digital ulcers - these significantly increase rating');
  }
  gaps.push('Log each attack with date, duration, and affected digits');
  gaps.push('Note triggers (cold exposure, stress) for each attack');

  return {
    hasData: true,
    condition: "Raynaud's Syndrome",
    diagnosticCode: '7117',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: RAYNAUDS_CRITERIA,
    disclaimer: RAYNAUDS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Varicose Veins symptom logs
 */
export const analyzeVaricoseVeinsLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'varicose-aching', 'varicose-edema', 'varicose-pigmentation',
    'varicose-ulcer', 'varicose-pain'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No varicose vein logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging varicose vein symptoms including swelling, pain, and any skin changes'],
    };
  }

  const edemaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'varicose-edema');
  const pigmentationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'varicose-pigmentation');
  const ulcerLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'varicose-ulcer');
  const painLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'varicose-pain');
  const achingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'varicose-aching');

  const evidence = [];
  if (edemaLogs.length > 0) evidence.push(`${edemaLogs.length} swelling/edema episodes logged`);
  if (pigmentationLogs.length > 0) evidence.push(`${pigmentationLogs.length} skin discoloration entries logged`);
  if (ulcerLogs.length > 0) evidence.push(`${ulcerLogs.length} skin ulcer entries logged`);
  if (painLogs.length > 0) evidence.push(`${painLogs.length} pain at rest episodes logged`);
  if (achingLogs.length > 0) evidence.push(`${achingLogs.length} aching/fatigue episodes logged`);

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // Check for severe symptoms
  if (painLogs.length >= 30 && edemaLogs.length >= 30) {
    supportedRating = 100;
    ratingRationale = [
      'Constant pain at rest with persistent edema documented',
      'Pattern consistent with 100% rating',
    ];
  } else if (ulcerLogs.length >= 5 && edemaLogs.length >= 10 && pigmentationLogs.length > 0) {
    supportedRating = 60;
    ratingRationale = [
      'Persistent edema, skin changes, and ulceration documented',
      'Pattern supports 60% rating',
    ];
  } else if (edemaLogs.length >= 10 && pigmentationLogs.length > 0) {
    supportedRating = 40;
    ratingRationale = [
      'Persistent edema with skin pigmentation changes',
      'Pattern supports 40% rating',
    ];
  } else if (edemaLogs.length >= 5) {
    supportedRating = 20;
    ratingRationale = [
      'Persistent edema documented',
      'Pattern supports 20% rating',
    ];
  } else if (achingLogs.length > 0 || edemaLogs.length > 0) {
    supportedRating = 10;
    ratingRationale = [
      'Intermittent symptoms documented',
      'Relieved by elevation or compression hosiery supports 10% rating',
    ];
  }

  gaps.push('Track symptoms separately for each leg if bilateral');
  gaps.push('Document response to elevation and compression hosiery');
  if (ulcerLogs.length === 0) {
    gaps.push('Document any skin ulcers - these significantly affect rating');
  }

  return {
    hasData: true,
    condition: 'Varicose Veins',
    diagnosticCode: '7120/7121',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: VARICOSE_VEINS_CRITERIA,
    disclaimer: VARICOSE_VEINS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Chronic Urticaria symptom logs
 */
export const analyzeChronicUrticariaLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'urticaria-outbreak', 'urticaria-itching', 'urticaria-swelling', 'urticaria-medication'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      message: 'No chronic urticaria logs found',
      supportedRating: null,
      evidence: [],
      gaps: ['Start logging urticaria outbreaks and medication use'],
    };
  }

  const outbreakLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'urticaria-outbreak');
  const medicationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'urticaria-medication');

  const weeksInPeriod = evaluationPeriodDays / 7;
  const outbreaksPerWeek = outbreakLogs.length / weeksInPeriod;

  const evidence = [];
  evidence.push(`${outbreakLogs.length} hives outbreaks logged (${outbreaksPerWeek.toFixed(1)}/week)`);
  if (medicationLogs.length > 0) evidence.push(`${medicationLogs.length} medication use entries logged`);

  // Chronic urticaria = 2+ outbreaks per week for 6+ weeks
  const isChronicPattern = outbreaksPerWeek >= 2 && evaluationPeriodDays >= 42;

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (isChronicPattern) {
    supportedRating = 10;
    ratingRationale = [
      'Chronic urticaria pattern documented (2+/week for 6+ weeks)',
      'Rating based on treatment level required',
    ];
    gaps.push('Document treatment level: first-line (antihistamines), second-line (steroids), or third-line (immunosuppressives)');
    gaps.push('If antihistamines alone are insufficient, document escalation to higher treatment');
  } else {
    supportedRating = '0-10';
    ratingRationale = [
      'Urticaria documented but chronic pattern not yet established',
      'Chronic = 2+ outbreaks per week for 6+ weeks',
    ];
    gaps.push('Continue logging to establish chronic pattern');
  }

  return {
    hasData: true,
    condition: 'Chronic Urticaria',
    diagnosticCode: '7825',
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    criteria: CHRONIC_URTICARIA_CRITERIA,
    disclaimer: CHRONIC_URTICARIA_CRITERIA.disclaimer,
  };
};

// ============================================
// EPILEPSY ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyze epilepsy - major seizures (DC 8910)
 * Counts major seizure frequency over various time periods
 */
export function analyzeEpilepsyMajorLogs(logs, evaluationDays = 90) {
  // Filter for major seizure symptoms
  const seizureSymptomIds = [
    'seizure-major',
    'seizure-partial',  // Can be rated as major if with LOC
    'seizure-psychomotor', // Can be rated as major if with convulsion/LOC
  ];

  const seizureLogs = logs.filter(log =>
      seizureSymptomIds.includes(log.symptomId)
  );

  if (seizureLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Epilepsy, Grand Mal (Major Seizures)',
      diagnosticCode: '8910',
    };
  }

  const now = new Date();
  const msPerDay = 24 * 60 * 60 * 1000;

  // Count seizures in different time periods
  const last30Days = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 30;
  }).length;

  const last3Months = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 90;
  }).length;

  const last6Months = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 180;
  }).length;

  const lastYear = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 365;
  }).length;

  const last2Years = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 730;
  }).length;

  // Calculate average per month over last year
  const averagePerMonth = lastYear > 0 ? lastYear / 12 : 0;

  // Determine rating based on VA criteria
  let supportedRating = 0;
  let ratingRationale = [];

  if (averagePerMonth >= 1) {
    supportedRating = '100%';
    ratingRationale.push(`Averaging ${lastYear} major seizures over last year (${averagePerMonth.toFixed(1)} per month)`);
    ratingRationale.push('Meets 100% criteria: >=1 major seizure per month average');
  } else if (lastYear >= 4) {
    supportedRating = '80%';
    ratingRationale.push(`${lastYear} major seizures in last year (average 1 per 3 months)`);
    ratingRationale.push('Meets 80% criteria: >=1 major seizure per 3 months');
  } else if (lastYear >= 3) {
    supportedRating = '60%';
    ratingRationale.push(`${lastYear} major seizures in last year (average 1 per 4 months)`);
    ratingRationale.push('Meets 60% criteria: >=1 major seizure per 4 months');
  } else if (last6Months >= 1 || lastYear >= 2) {
    supportedRating = '40%';
    if (last6Months >= 1) {
      ratingRationale.push(`${last6Months} major seizure(s) in last 6 months`);
    }
    if (lastYear >= 2) {
      ratingRationale.push(`${lastYear} major seizures in last year`);
    }
    ratingRationale.push('Meets 40% criteria: >=1 seizure in last 6 months OR >=2 in last year');
  } else if (last2Years >= 1) {
    supportedRating = '20%';
    ratingRationale.push(`${last2Years} major seizure(s) in last 2 years`);
    ratingRationale.push('Meets 20% criteria: >=1 major seizure in last 2 years');
  } else {
    supportedRating = '10%';
    ratingRationale.push('Documented seizure history with symptom logs');
    ratingRationale.push('If on continuous medication, qualifies for minimum 10% rating');
  }

  // Build evidence list
  const evidence = [];
  evidence.push(`${seizureLogs.length} major seizure episodes logged`);
  if (lastYear > 0) {
    evidence.push(`${lastYear} seizures in last 12 months`);
  }
  if (last6Months > 0) {
    evidence.push(`${last6Months} seizures in last 6 months`);
  }

  // Count witnessed seizures
  const witnessedCount = seizureLogs.filter(log =>
      log.seizureData?.witnessPresent === true
  ).length;
  if (witnessedCount > 0) {
    evidence.push(`${witnessedCount} seizure(s) with witness present`);
  }

  // Count seizures with LOC
  const locCount = seizureLogs.filter(log =>
      log.seizureData?.lossOfConsciousness === 'yes'
  ).length;
  if (locCount > 0) {
    evidence.push(`${locCount} seizure(s) with loss of consciousness`);
  }

  // Build gaps list
  const gaps = [];
  if (witnessedCount === 0) {
    gaps.push('Log witness statements for documented seizures');
  }
  if (seizureLogs.length < 3) {
    gaps.push('Continue logging seizures to establish frequency pattern');
  }
  gaps.push('Obtain physician verification of epilepsy diagnosis');
  gaps.push('Document current anti-epileptic medications if prescribed');
  gaps.push('Request EEG results if available');

  return {
    hasData: true,
    condition: 'Epilepsy, Grand Mal (Major Seizures)',
    diagnosticCode: '8910',
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: EPILEPSY_MAJOR_CRITERIA,
    disclaimer: 'This analysis is for documentation purposes only. The VA makes all final rating determinations based on medical evidence and C&P examinations.',
    seizureType: 'major',
    frequencyAnalysis: {
      last30Days,
      last6Months,
      lastYear,
      last2Years,
      averagePerMonth,
    },
  };
}

/**
 * Analyze epilepsy - minor seizures (DC 8911)
 * Counts minor seizure frequency
 */
export function analyzeEpilepsyMinorLogs(logs, evaluationDays = 90) {
  const seizureSymptomIds = ['seizure-minor'];

  const seizureLogs = logs.filter(log =>
      seizureSymptomIds.includes(log.symptomId)
  );

  if (seizureLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Epilepsy, Petit Mal (Minor Seizures)',
      diagnosticCode: '8911',
    };
  }

  const now = new Date();
  const msPerDay = 24 * 60 * 60 * 1000;

  // Count seizures in different time periods
  const last7Days = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 7;
  }).length;

  const last30Days = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 30;
  }).length;

  const last6Months = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 180;
  }).length;

  const lastYear = seizureLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const daysDiff = (now - logDate) / msPerDay;
    return daysDiff <= 365;
  }).length;

  // Calculate weekly average
  const weeksTracked = 4; // Last 30 days
  const averagePerWeek = last7Days > 0 ? last7Days : (last30Days / weeksTracked);

  // Determine rating based on weekly frequency
  let supportedRating = 0;
  let ratingRationale = [];

  if (averagePerWeek > 10) {
    supportedRating = '80%';
    ratingRationale.push(`Averaging ${averagePerWeek.toFixed(1)} minor seizures per week`);
    ratingRationale.push('Meets 80% criteria: >10 minor seizures weekly');
  } else if (averagePerWeek >= 9) {
    supportedRating = '60%';
    ratingRationale.push(`Averaging ${averagePerWeek.toFixed(1)} minor seizures per week`);
    ratingRationale.push('Meets 60% criteria: 9-10 minor seizures per week');
  } else if (averagePerWeek >= 5) {
    supportedRating = '40%';
    ratingRationale.push(`Averaging ${averagePerWeek.toFixed(1)} minor seizures per week`);
    ratingRationale.push('Meets 40% criteria: 5-8 minor seizures weekly');
  } else if (last6Months >= 2) {
    supportedRating = '20%';
    ratingRationale.push(`${last6Months} minor seizures in last 6 months`);
    ratingRationale.push('Meets 20% criteria: >=2 minor seizures in last 6 months');
  } else {
    supportedRating = '10%';
    ratingRationale.push('Documented minor seizure history');
    ratingRationale.push('If on continuous medication, qualifies for minimum 10% rating');
  }

  // Build evidence list
  const evidence = [];
  evidence.push(`${seizureLogs.length} minor seizure episodes logged`);
  if (last7Days > 0) {
    evidence.push(`${last7Days} seizures in last 7 days (${averagePerWeek.toFixed(1)} per week)`);
  }
  if (last30Days > 0) {
    evidence.push(`${last30Days} seizures in last 30 days`);
  }

  const gaps = [];
  if (seizureLogs.length < 5) {
    gaps.push('Continue logging to establish weekly frequency pattern');
  }
  gaps.push('Obtain physician diagnosis of petit mal epilepsy');
  gaps.push('Request EEG showing absence seizure pattern');
  gaps.push('Document anti-epileptic medications');

  return {
    hasData: true,
    condition: 'Epilepsy, Petit Mal (Minor Seizures)',
    diagnosticCode: '8911',
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: EPILEPSY_MINOR_CRITERIA,
    disclaimer: 'This analysis is for documentation purposes only. The VA makes all final rating determinations based on medical evidence and C&P examinations.',
    seizureType: 'minor',
    frequencyAnalysis: {
      last7Days,
      last30Days,
      last6Months,
      lastYear,
      averagePerWeek,
    },
  };
}

// ============================================
// PHASE 1D: EPILEPSY EXPANSION ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyze Jacksonian/Focal Epilepsy (DC 8912)
 * Rates as minor seizures unless major (secondary generalization) predominates
 */
export function analyzeJacksonianEpilepsyLogs(logs, options = {}) {
  const { days = 365 } = options;

  // Jacksonian-specific symptom IDs
  const jacksonianSymptomIds = [
    'jack-focal-motor', 'jack-focal-sensory', 'jack-march',
    'jack-unilateral-jerking', 'jack-tingling-numbness', 'jack-visual-disturbance',
    'jack-secondary-generalization', 'jack-preserved-awareness', 'jack-impaired-awareness',
    'seizure-partial', // Also include generic partial seizure
  ];

  const jacksonianLogs = logs.filter(log =>
      jacksonianSymptomIds.includes(log.symptomId) ||
      log.symptomId?.startsWith('jack-')
  );

  if (jacksonianLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Epilepsy, Jacksonian/Focal',
      diagnosticCodes: '8912',
    };
  }

  const now = new Date();
  const msPerDay = 24 * 60 * 60 * 1000;

  // Count seizures with secondary generalization (these count as major)
  const majorSeizures = jacksonianLogs.filter(log =>
      log.symptomId === 'jack-secondary-generalization' ||
      log.seizureData?.lossOfConsciousness === 'yes' ||
      log.seizureData?.episodeType === 'generalized'
  );

  // Minor seizures (focal without generalization)
  const minorSeizures = jacksonianLogs.filter(log =>
      !majorSeizures.includes(log)
  );

  // Time-based analysis
  const lastYear = jacksonianLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 365;
  });

  const last6Months = jacksonianLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 180;
  });

  const last2Years = jacksonianLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 730;
  });

  // Calculate weekly frequency for minor seizures (last 4 weeks)
  const last4Weeks = minorSeizures.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 28;
  });
  const weeklyMinorAverage = last4Weeks.length / 4;

  // Determine if major or minor predominates
  const majorPredominates = majorSeizures.length > minorSeizures.length;

  // Calculate rating based on VA criteria
  let supportedRating = 0;
  let ratingRationale = [];

  if (majorPredominates) {
    // Rate as major seizures
    const majorInYear = majorSeizures.filter(log => {
      const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
      return daysDiff <= 365;
    }).length;
    const avgPerMonth = majorInYear / 12;

    if (avgPerMonth >= 1) {
      supportedRating = 100;
      ratingRationale.push(`Major seizures predominate with ${majorInYear} in last year (${avgPerMonth.toFixed(1)}/month)`);
    } else if (majorInYear >= 4) {
      supportedRating = 80;
      ratingRationale.push(`Major seizures predominate: ${majorInYear} in last year (avg 1 per 3 months)`);
    } else if (majorInYear >= 3) {
      supportedRating = 60;
      ratingRationale.push(`Major seizures predominate: ${majorInYear} in last year (avg 1 per 4 months)`);
    } else if (last6Months.filter(l => majorSeizures.includes(l)).length >= 1 || majorInYear >= 2) {
      supportedRating = 40;
      ratingRationale.push('Major seizures predominate: meets 40% criteria');
    } else {
      supportedRating = 20;
      ratingRationale.push('Major seizures predominate with documented history');
    }
  } else {
    // Rate as minor seizures
    if (weeklyMinorAverage > 10) {
      supportedRating = 80;
      ratingRationale.push(`More than 10 focal seizures weekly (avg ${weeklyMinorAverage.toFixed(1)}/week)`);
    } else if (weeklyMinorAverage >= 9) {
      supportedRating = 60;
      ratingRationale.push(`9-10 focal seizures per week (avg ${weeklyMinorAverage.toFixed(1)}/week)`);
    } else if (weeklyMinorAverage >= 5) {
      supportedRating = 40;
      ratingRationale.push(`5-8 focal seizures per week (avg ${weeklyMinorAverage.toFixed(1)}/week)`);
    } else if (last6Months.length >= 2) {
      supportedRating = 20;
      ratingRationale.push(`${last6Months.length} focal seizures in last 6 months`);
    } else {
      supportedRating = 10;
      ratingRationale.push('Confirmed diagnosis with documented focal seizure history');
    }
  }

  // Evidence gaps
  const gaps = [];
  if (majorSeizures.length === 0 && minorSeizures.length > 0) {
    gaps.push('Document if any focal seizures secondarily generalize to tonic-clonic');
  }
  gaps.push('Obtain EEG showing focal epileptiform activity if available');
  gaps.push('Document anti-epileptic medication regimen');
  gaps.push('Record specific body areas affected during focal seizures');

  return {
    hasData: true,
    condition: 'Epilepsy, Jacksonian/Focal',
    diagnosticCodes: '8912',
    cfrReference: '38 CFR 4.124a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: jacksonianLogs.length,
      majorSeizures: majorSeizures.length,
      minorSeizures: minorSeizures.length,
      majorPredominates,
      weeklyMinorAverage,
      lastYearCount: lastYear.length,
    },
    criteria: EPILEPSY_JACKSONIAN_CRITERIA,
  };
}

/**
 * Analyze Diencephalic Epilepsy (DC 8913)
 * Rates as minor seizures (autonomic symptoms)
 */
export function analyzeDiencephalicEpilepsyLogs(logs, options = {}) {
  const { days = 365 } = options;

  const diencephalicSymptomIds = [
    'dien-autonomic-seizure', 'dien-flushing', 'dien-sweating',
    'dien-blood-pressure', 'dien-heart-rate', 'dien-pupil-changes',
    'dien-temperature', 'dien-lacrimation', 'dien-gi-symptoms', 'dien-hypothalamic',
  ];

  const diencephalicLogs = logs.filter(log =>
      diencephalicSymptomIds.includes(log.symptomId) ||
      log.symptomId?.startsWith('dien-')
  );

  if (diencephalicLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Epilepsy, Diencephalic',
      diagnosticCodes: '8913',
    };
  }

  const now = new Date();
  const msPerDay = 24 * 60 * 60 * 1000;

  // Time-based analysis
  const last6Months = diencephalicLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 180;
  });

  // Calculate weekly frequency (last 4 weeks)
  const last4Weeks = diencephalicLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 28;
  });
  const weeklyAverage = last4Weeks.length / 4;

  // Rate as minor seizures per 38 CFR
  let supportedRating = 0;
  let ratingRationale = [];

  if (weeklyAverage > 10) {
    supportedRating = 80;
    ratingRationale.push(`More than 10 autonomic seizures weekly (avg ${weeklyAverage.toFixed(1)}/week)`);
  } else if (weeklyAverage >= 9) {
    supportedRating = 60;
    ratingRationale.push(`9-10 autonomic seizures per week (avg ${weeklyAverage.toFixed(1)}/week)`);
  } else if (weeklyAverage >= 5) {
    supportedRating = 40;
    ratingRationale.push(`5-8 autonomic seizures per week (avg ${weeklyAverage.toFixed(1)}/week)`);
  } else if (last6Months.length >= 2) {
    supportedRating = 20;
    ratingRationale.push(`${last6Months.length} autonomic seizures in last 6 months`);
  } else {
    supportedRating = 10;
    ratingRationale.push('Confirmed diagnosis with documented autonomic seizure history');
  }

  ratingRationale.push('Diencephalic epilepsy rates as minor seizures per 38 CFR 4.124a');

  // Common autonomic symptoms logged
  const symptomCounts = {};
  diencephalicLogs.forEach(log => {
    const symptom = log.symptomId;
    symptomCounts[symptom] = (symptomCounts[symptom] || 0) + 1;
  });

  const gaps = [];
  gaps.push('Document autonomic symptoms during each episode');
  gaps.push('Obtain neurologist evaluation confirming diencephalic origin');
  gaps.push('Record episode duration and recovery time');
  gaps.push('Document anti-epileptic medication effectiveness');

  return {
    hasData: true,
    condition: 'Epilepsy, Diencephalic',
    diagnosticCodes: '8913',
    cfrReference: '38 CFR 4.124a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: diencephalicLogs.length,
      weeklyAverage,
      last6MonthsCount: last6Months.length,
      symptomCounts,
    },
    criteria: EPILEPSY_DIENCEPHALIC_CRITERIA,
  };
}

/**
 * Analyze Psychomotor Epilepsy (DC 8914)
 * Can be major OR minor depending on episode characteristics
 */
export function analyzePsychomotorEpilepsyLogs(logs, options = {}) {
  const { days = 365 } = options;

  // Major psychomotor symptoms (automatic states, convulsions with LOC)
  const majorPsychomotorIds = [
    'psych-automatic-state', 'psych-convulsion-loc', 'psych-prolonged-confusion',
    'psych-wandering', 'psych-complex-behavior',
    'seizure-psychomotor', // Existing generic - check seizureData for type
  ];

  // Minor psychomotor symptoms (brief transient episodes)
  const minorPsychomotorIds = [
    'psych-random-motor', 'psych-hallucination', 'psych-perceptual-illusion',
    'psych-deja-vu', 'psych-thinking-abnormality', 'psych-memory-disturbance',
    'psych-mood-change', 'psych-autonomic', 'psych-lip-smacking', 'psych-hand-movements',
  ];

  const allPsychomotorIds = [...majorPsychomotorIds, ...minorPsychomotorIds];

  const psychomotorLogs = logs.filter(log =>
      allPsychomotorIds.includes(log.symptomId) ||
      log.symptomId?.startsWith('psych-')
  );

  if (psychomotorLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Epilepsy, Psychomotor',
      diagnosticCodes: '8914',
    };
  }

  const now = new Date();
  const msPerDay = 24 * 60 * 60 * 1000;

  // Classify each log as major or minor
  const majorSeizures = psychomotorLogs.filter(log => {
    // Check if symptom ID indicates major type
    if (majorPsychomotorIds.includes(log.symptomId)) {
      // If it's the generic 'seizure-psychomotor', check seizureData
      if (log.symptomId === 'seizure-psychomotor') {
        return log.seizureData?.lossOfConsciousness === 'yes' ||
            log.seizureData?.episodeType === 'automatic-state' ||
            log.seizureData?.episodeType === 'convulsion';
      }
      return true;
    }
    // Also check seizureData for LOC
    return log.seizureData?.lossOfConsciousness === 'yes';
  });

  const minorSeizures = psychomotorLogs.filter(log => !majorSeizures.includes(log));

  // Time-based analysis
  const lastYear = psychomotorLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 365;
  });

  const last6Months = psychomotorLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 180;
  });

  const last2Years = psychomotorLogs.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 730;
  });

  // Weekly frequency for minor seizures
  const last4Weeks = minorSeizures.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 28;
  });
  const weeklyMinorAverage = last4Weeks.length / 4;

  // Major seizure analysis
  const majorInYear = majorSeizures.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 365;
  });
  const majorIn6Months = majorSeizures.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 180;
  });
  const majorIn2Years = majorSeizures.filter(log => {
    const daysDiff = (now - new Date(log.timestamp)) / msPerDay;
    return daysDiff <= 730;
  });

  // Determine rating
  let supportedRating = 0;
  let ratingRationale = [];
  let seizureClassification = 'minor';

  // Check major seizure criteria first
  const avgMajorPerMonth = majorInYear.length / 12;

  if (avgMajorPerMonth >= 1) {
    supportedRating = 100;
    seizureClassification = 'major';
    ratingRationale.push(`Major psychomotor seizures: ${majorInYear.length} in last year (${avgMajorPerMonth.toFixed(1)}/month)`);
    ratingRationale.push('Episodes with automatic states/convulsions with LOC');
  } else if (majorInYear.length >= 4) {
    supportedRating = 80;
    seizureClassification = 'major';
    ratingRationale.push(`Major psychomotor seizures: ${majorInYear.length} in last year (avg 1 per 3 months)`);
  } else if (majorInYear.length >= 3) {
    supportedRating = 60;
    seizureClassification = 'major';
    ratingRationale.push(`Major psychomotor seizures: ${majorInYear.length} in last year (avg 1 per 4 months)`);
  } else if (majorIn6Months.length >= 1 || majorInYear.length >= 2) {
    supportedRating = 40;
    seizureClassification = 'major';
    ratingRationale.push(`Major psychomotor seizures: ${majorIn6Months.length} in 6 months, ${majorInYear.length} in year`);
  } else if (majorIn2Years.length >= 1) {
    // 20% for major, but check if minor gives higher
    if (weeklyMinorAverage > 10) {
      supportedRating = 80;
      seizureClassification = 'minor';
      ratingRationale.push(`Minor psychomotor seizures: ${weeklyMinorAverage.toFixed(1)}/week (>10)`);
    } else if (weeklyMinorAverage >= 9) {
      supportedRating = 60;
      seizureClassification = 'minor';
      ratingRationale.push(`Minor psychomotor seizures: ${weeklyMinorAverage.toFixed(1)}/week (9-10)`);
    } else if (weeklyMinorAverage >= 5) {
      supportedRating = 40;
      seizureClassification = 'minor';
      ratingRationale.push(`Minor psychomotor seizures: ${weeklyMinorAverage.toFixed(1)}/week (5-8)`);
    } else {
      supportedRating = 20;
      seizureClassification = 'major';
      ratingRationale.push(`Major psychomotor seizure within last 2 years`);
    }
  } else {
    // No major seizures in 2 years, rate on minor
    if (weeklyMinorAverage > 10) {
      supportedRating = 80;
      ratingRationale.push(`Minor psychomotor seizures: ${weeklyMinorAverage.toFixed(1)}/week (>10)`);
    } else if (weeklyMinorAverage >= 9) {
      supportedRating = 60;
      ratingRationale.push(`Minor psychomotor seizures: ${weeklyMinorAverage.toFixed(1)}/week (9-10)`);
    } else if (weeklyMinorAverage >= 5) {
      supportedRating = 40;
      ratingRationale.push(`Minor psychomotor seizures: ${weeklyMinorAverage.toFixed(1)}/week (5-8)`);
    } else if (last6Months.length >= 2) {
      supportedRating = 20;
      ratingRationale.push(`${last6Months.length} psychomotor episodes in last 6 months`);
    } else {
      supportedRating = 10;
      ratingRationale.push('Confirmed diagnosis with documented psychomotor seizure history');
    }
  }

  const gaps = [];
  gaps.push('Document specific characteristics of each episode (automatic state vs brief transient)');
  gaps.push('Record loss of consciousness status for each seizure');
  gaps.push('Note presence of hallucinations, perceptual illusions, or automatisms');
  gaps.push('Obtain neurologist confirmation of temporal lobe epilepsy');
  gaps.push('Document anti-epileptic medication regimen and effectiveness');

  return {
    hasData: true,
    condition: 'Epilepsy, Psychomotor',
    diagnosticCodes: '8914',
    cfrReference: '38 CFR 4.124a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: psychomotorLogs.length,
      majorSeizures: majorSeizures.length,
      minorSeizures: minorSeizures.length,
      seizureClassification,
      weeklyMinorAverage,
      majorInYear: majorInYear.length,
      avgMajorPerMonth,
    },
    criteria: EPILEPSY_PSYCHOMOTOR_CRITERIA,
  };
}

// ============================================
// PHASE 2: VISION LOSS ANALYSIS FUNCTION
// ============================================

export const analyzeVisionLogs = (logs) => {
  const visionLogs = logs.filter(log =>
      log.eyeData ||
      log.symptomId?.includes('vision') ||
      log.symptomId?.includes('eye') ||
      log.symptomId?.includes('glaucoma') ||
      log.symptomId?.includes('retinopathy') ||
      log.symptomId?.includes('macular')
  );

  if (visionLogs.length === 0) {
    return {
      hasData: false,
      message: 'No vision-related symptoms logged'
    };
  }

  // Analyze visual acuity trends
  const acuityTrends = {
    left: [],
    right: [],
    worstLeft: null,
    worstRight: null,
    betterEye: null
  };

  visionLogs.forEach(log => {
    if (log.eyeData?.leftEyeAcuity) {
      acuityTrends.left.push({
        date: log.timestamp,
        acuity: log.eyeData.leftEyeAcuity
      });
    }
    if (log.eyeData?.rightEyeAcuity) {
      acuityTrends.right.push({
        date: log.timestamp,
        acuity: log.eyeData.rightEyeAcuity
      });
    }
  });

  // Determine the worst visual acuity (for rating purposes)
  const acuityRanking = {
    '20/20': 1, '20/25': 2, '20/30': 3, '20/40': 4, '20/50': 5,
    '20/70': 6, '20/100': 7, '20/200': 8, 'CF': 9, 'HM': 10, 'LP': 11, 'NLP': 12
  };

  if (acuityTrends.left.length > 0) {
    acuityTrends.worstLeft = acuityTrends.left.reduce((worst, current) => {
      const currentRank = acuityRanking[current.acuity] || 0;
      const worstRank = acuityRanking[worst.acuity] || 0;
      return currentRank > worstRank ? current : worst;
    });
  }

  if (acuityTrends.right.length > 0) {
    acuityTrends.worstRight = acuityTrends.right.reduce((worst, current) => {
      const currentRank = acuityRanking[current.acuity] || 0;
      const worstRank = acuityRanking[worst.acuity] || 0;
      return currentRank > worstRank ? current : worst;
    });
  }

  // Determine "better eye" for VA rating
  if (acuityTrends.worstLeft && acuityTrends.worstRight) {
    const leftRank = acuityRanking[acuityTrends.worstLeft.acuity] || 0;
    const rightRank = acuityRanking[acuityTrends.worstRight.acuity] || 0;
    acuityTrends.betterEye = leftRank < rightRank ? 'left' : 'right';
  } else if (acuityTrends.worstLeft) {
    acuityTrends.betterEye = 'left';
  } else if (acuityTrends.worstRight) {
    acuityTrends.betterEye = 'right';
  }

  // Frequency analysis
  const last30Days = visionLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    return logDate >= thirtyDaysAgo;
  });

  // Impact on activities
  const activityImpacts = {};
  visionLogs.forEach(log => {
    if (log.eyeData?.affectedActivities) {
      log.eyeData.affectedActivities.forEach(activity => {
        activityImpacts[activity] = (activityImpacts[activity] || 0) + 1;
      });
    }
  });

  // Field of vision defects
  const fieldDefects = {};
  visionLogs.forEach(log => {
    if (log.eyeData?.fieldOfVision) {
      log.eyeData.fieldOfVision.forEach(field => {
        fieldDefects[field] = (fieldDefects[field] || 0) + 1;
      });
    }
  });

  // Evidence gaps
  const gaps = [];
  const hasAcuityMeasurements = acuityTrends.left.length > 0 || acuityTrends.right.length > 0;
  const hasFieldDefectDocs = Object.keys(fieldDefects).length > 0;

  if (!hasAcuityMeasurements) {
    gaps.push('Need formal visual acuity measurements from eye exam');
  }
  if (fieldDefects['peripheral'] || fieldDefects['blind-spots']) {
    gaps.push('Field defects noted - need formal visual field testing (perimetry)');
  }
  gaps.push('Need ophthalmology examination records');
  gaps.push('Need diagnosis documentation');

  // Rating guidance
  let ratingGuidance = 'Vision loss is rated based on visual acuity in the better eye. ';
  if (acuityTrends.betterEye && (acuityTrends.worstLeft || acuityTrends.worstRight)) {
    const betterEyeAcuity = acuityTrends.betterEye === 'left'
        ? acuityTrends.worstLeft.acuity
        : acuityTrends.worstRight.acuity;

    ratingGuidance += `Your logged better eye acuity is ${betterEyeAcuity}. `;

    // Provide rating estimate
    if (betterEyeAcuity === '20/40') {
      ratingGuidance += 'This may support a 10% rating.';
    } else if (betterEyeAcuity === '20/70') {
      ratingGuidance += 'This may support a 30% rating.';
    } else if (betterEyeAcuity === '20/100') {
      ratingGuidance += 'This may support a 40% rating.';
    } else if (betterEyeAcuity === '20/200') {
      ratingGuidance += 'This may support a 50% rating.';
    } else if (['CF', 'HM', 'LP', 'NLP'].includes(betterEyeAcuity)) {
      ratingGuidance += 'This indicates severe vision loss - may support 60-100% rating depending on exact measurements.';
    }
  } else {
    ratingGuidance += 'Log visual acuity measurements from eye exams to determine potential rating.';
  }

  // Determine supported rating based on better eye acuity
  let supportedRating = 0;
  if (acuityTrends.betterEye && (acuityTrends.worstLeft || acuityTrends.worstRight)) {
    const betterEyeAcuity = acuityTrends.betterEye === 'left'
        ? acuityTrends.worstLeft.acuity
        : acuityTrends.worstRight.acuity;

    if (betterEyeAcuity === '20/40') supportedRating = 10;
    else if (betterEyeAcuity === '20/70') supportedRating = 30;
    else if (betterEyeAcuity === '20/100') supportedRating = 40;
    else if (betterEyeAcuity === '20/200') supportedRating = 50;
    else if (betterEyeAcuity === '15/200') supportedRating = 60;
    else if (betterEyeAcuity === '10/200') supportedRating = 70;
    else if (betterEyeAcuity === '5/200') supportedRating = 90;
    else if (betterEyeAcuity === 'CF' || betterEyeAcuity === 'HM' || betterEyeAcuity === 'LP' || betterEyeAcuity === 'NLP') supportedRating = 100;
  }

  return {
    hasData: true,
    condition: 'Eye & Vision Conditions',
    diagnosticCode: 'DC 6061-6079',
    supportedRating: supportedRating.toString(),
    totalLogs: visionLogs.length,
    last30Days: last30Days.length,
    acuityTrends,
    mostAffectedActivities: Object.entries(activityImpacts)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 5)
    .map(([activity, count]) => ({ activity, count })),
    fieldDefects: Object.entries(fieldDefects)
    .map(([field, count]) => ({ field, count })),
    gaps: gaps,
    ratingGuidance,
    criteria: VISION_LOSS_CRITERIA
  };
};
// ============================================
// ANALYSIS FUNCTIONS - GENITOURINARY
// ============================================

// Analyze Kidney Stones logs (DC 7508)
export const analyzeKidneyStonesLogs = (logs) => {
  const stoneLogs = logs.filter(log =>
      log.genitourinaryData?.affectedSystem === 'kidney' ||
      log.symptomId?.includes('kidney-stone') ||
      log.symptomId?.includes('kidney-pain')
  );

  if (stoneLogs.length === 0) {
    return {
      hasData: false,
      message: 'No kidney stone symptoms logged'
    };
  }

  // Count procedures
  const procedureCounts = {};
  const stoneEpisodes = stoneLogs.filter(log => log.genitourinaryData?.stoneEpisode).length;
  const stonesPassed = stoneLogs.filter(log => log.genitourinaryData?.stonePassedToday).length;

  stoneLogs.forEach(log => {
    const procedure = log.genitourinaryData?.procedureRecent;
    if (procedure && procedure !== '' && procedure !== 'none') {
      procedureCounts[procedure] = (procedureCounts[procedure] || 0) + 1;
    }
  });

  // Calculate procedures in last year
  const oneYearAgo = new Date();
  oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);

  const proceduresLastYear = stoneLogs.filter(log => {
    const logDate = new Date(log.timestamp);
    const procedure = log.genitourinaryData?.procedureRecent;
    return logDate >= oneYearAgo && procedure && procedure !== '' && procedure !== 'none';
  }).length;

  // Determine rating
  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (proceduresLastYear > 2) {
    supportedRating = 30;
    rationale.push(`${proceduresLastYear} procedures documented in past year (>2 required for 30%)`);
  } else if (proceduresLastYear >= 1) {
    supportedRating = 10;
    rationale.push(`${proceduresLastYear} procedure(s) in past year (1-2 required for 10%)`);
  } else {
    supportedRating = 0;
    rationale.push('No procedures documented in past year');
    evidenceGaps.push('Document any lithotripsy, ureteroscopy, or stent procedures');
  }

  if (stoneEpisodes > 0) {
    rationale.push(`${stoneEpisodes} stone episodes logged`);
  }

  if (stonesPassed > 0) {
    rationale.push(`${stonesPassed} stones documented as passed`);
  }

  // Evidence gaps
  if (!Object.keys(procedureCounts).length) {
    evidenceGaps.push('No procedure records logged - document all stone-related procedures');
  }

  evidenceGaps.push('Obtain imaging reports (CT scans, ultrasounds) showing stone formation');
  evidenceGaps.push('Get urology treatment records documenting recurrent stones');

  return {
      condition: 'Kidney Stones (Nephrolithiasis)',
      diagnosticCode: '7508',

    hasData: true,
    totalLogs: stoneLogs.length,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      stoneEpisodes,
      stonesPassed,
      proceduresLastYear,
      procedureTypes: Object.keys(procedureCounts),
    },
    criteriaReference: KIDNEY_STONES_CRITERIA,
  };
};

// Analyze Chronic Renal Disease logs (DC 7530)
export const analyzeChronicRenalDiseaseLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options; // 1 year default for kidney function

  const renalLogs = logs.filter(log =>
      log.genitourinaryData?.affectedSystem === 'kidney' ||
      log.symptomId?.includes('renal') ||
      log.symptomId?.includes('kidney')
  );

  // Get eGFR measurements from storage
  const egfrMeasurements = getMeasurements({
    type: 'egfr',
    days: evaluationPeriodDays
  });

  const creatinineMeasurements = getMeasurements({
    type: 'creatinine',
    days: evaluationPeriodDays
  });

  if (renalLogs.length === 0 && egfrMeasurements.length === 0) {
    return {
      hasData: false,
      message: 'No chronic kidney disease symptoms or lab values logged'
    };
  }

  // Count dialysis
  const dialysisLogs = renalLogs.filter(log => log.genitourinaryData?.dialysis);
  const onDialysis = dialysisLogs.length > 0;

  // Analyze eGFR values
  let lowestEGFR = null;
  let averageEGFR = null;

  if (egfrMeasurements.length > 0) {
    const egfrValues = egfrMeasurements.map(m => m.values.egfr);
    lowestEGFR = Math.min(...egfrValues);
    averageEGFR = (egfrValues.reduce((a, b) => a + b, 0) / egfrValues.length).toFixed(1);
  }

  // Determine rating based on eGFR
  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (onDialysis) {
    supportedRating = 100;
    rationale.push(`Regular dialysis documented (${dialysisLogs.length} dialysis sessions logged)`);
  } else if (lowestEGFR !== null) {
    if (lowestEGFR >= 15 && lowestEGFR <= 20) {
      supportedRating = 80;
      rationale.push(`Lowest eGFR: ${lowestEGFR} mL/min/1.73m (15-20 range = 80%)`);
    } else if (lowestEGFR >= 20 && lowestEGFR < 30) {
      supportedRating = 60;
      rationale.push(`Lowest eGFR: ${lowestEGFR} mL/min/1.73m (20-30 range = 60%)`);
    } else if (lowestEGFR >= 30 && lowestEGFR < 40) {
      supportedRating = 40;
      rationale.push(`Lowest eGFR: ${lowestEGFR} mL/min/1.73m (30-40 range = 40%)`);
    } else if (lowestEGFR >= 40 && lowestEGFR < 60) {
      supportedRating = 20;
      rationale.push(`Lowest eGFR: ${lowestEGFR} mL/min/1.73m (40-60 range = 20%)`);
    } else if (lowestEGFR >= 60) {
      supportedRating = 0;
      rationale.push(`Lowest eGFR: ${lowestEGFR} mL/min/1.73m (>60 = minimal impairment)`);
    } else {
      supportedRating = 100;
      rationale.push(`Lowest eGFR: ${lowestEGFR} mL/min/1.73m (<15 = kidney failure)`);
    }

    if (averageEGFR) {
      rationale.push(`Average eGFR: ${averageEGFR} mL/min/1.73m (${egfrMeasurements.length} measurements)`);
    }
  }

  // Evidence gaps
  if (egfrMeasurements.length < 3) {
    evidenceGaps.push('Track more eGFR measurements - ratings require sustained kidney function decline');
  }

  if (creatinineMeasurements.length === 0) {
    evidenceGaps.push('Log serum creatinine values from lab reports');
  }

  evidenceGaps.push('Obtain nephrology consultation records');
  evidenceGaps.push('Document any complications (anemia, bone disease, metabolic issues)');

  return {
      condition: 'Chronic Kidney Disease',
      diagnosticCode: '7530',

    hasData: true,
    totalLogs: renalLogs.length,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      egfrMeasurements: egfrMeasurements.length,
      lowestEGFR,
      averageEGFR,
      onDialysis,
      dialysisSessions: dialysisLogs.length,
    },
    criteriaReference: CHRONIC_RENAL_DISEASE_CRITERIA,
  };
};

// Analyze Voiding Dysfunction logs (DC 7512, 7527, 7542, 7518)
export const analyzeVoidingDysfunctionLogs = (logs) => {
  const voidingLogs = logs.filter(log =>
      log.genitourinaryData?.affectedSystem === 'bladder' ||
      log.genitourinaryData?.affectedSystem === 'prostate' ||
      log.symptomId?.includes('urinary') ||
      log.symptomId?.includes('bladder') ||
      log.symptomId?.includes('prostate')
  );

  if (voidingLogs.length === 0) {
    return {
      hasData: false,
      message: 'No voiding dysfunction symptoms logged'
    };
  }

  // Analyze incontinence
  const incontinenceLogs = voidingLogs.filter(log => log.genitourinaryData?.incontinenceEpisode);
  const padChangeCounts = voidingLogs
      .map(log => parseInt(log.genitourinaryData?.padChangesRequired) || 0)
      .filter(count => count > 0);
  const avgPadChanges = padChangeCounts.length > 0
      ? (padChangeCounts.reduce((a, b) => a + b, 0) / padChangeCounts.length).toFixed(1)
      : 0;
  const maxPadChanges = padChangeCounts.length > 0 ? Math.max(...padChangeCounts) : 0;

  // Analyze frequency
  const frequencyCounts = voidingLogs
      .map(log => parseInt(log.genitourinaryData?.urinaryFrequency24h) || 0)
      .filter(count => count > 0);
  const avgFrequency = frequencyCounts.length > 0
      ? (frequencyCounts.reduce((a, b) => a + b, 0) / frequencyCounts.length).toFixed(1)
      : 0;

  const nocturnalCounts = voidingLogs
      .map(log => parseInt(log.genitourinaryData?.nocturiaCount) || 0)
      .filter(count => count > 0);
  const avgNocturia = nocturnalCounts.length > 0
      ? (nocturnalCounts.reduce((a, b) => a + b, 0) / nocturnalCounts.length).toFixed(1)
      : 0;
  const maxNocturia = nocturnalCounts.length > 0 ? Math.max(...nocturnalCounts) : 0;

  // Analyze obstruction
  const catheterLogs = voidingLogs.filter(log => log.genitourinaryData?.catheterUse);
  const catheterType = catheterLogs.length > 0 ? catheterLogs[catheterLogs.length - 1].genitourinaryData?.catheterType : null;

  // Determine rating (highest of incontinence, frequency, or obstruction)
  let incontinenceRating = 0;
  let frequencyRating = 0;
  let obstructionRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  // Incontinence rating
  if (maxPadChanges > 4 || avgPadChanges > 4) {
    incontinenceRating = 60;
    rationale.push(`Incontinence: ${avgPadChanges} avg pad changes/day (>4 = 60%)`);
  } else if (maxPadChanges >= 2 || avgPadChanges >= 2) {
    incontinenceRating = 40;
    rationale.push(`Incontinence: ${avgPadChanges} avg pad changes/day (2-4 = 40%)`);
  } else if (incontinenceLogs.length > 0) {
    incontinenceRating = 20;
    rationale.push(`Incontinence: ${avgPadChanges || '<2'} pad changes/day (<2 = 20%)`);
  }

  // Frequency rating
  const hourlyInterval = avgFrequency > 0 ? (24 / avgFrequency).toFixed(1) : 'N/A';
  if (avgFrequency >= 24 || maxNocturia >= 5) {
    frequencyRating = 40;
    rationale.push(`Frequency: ${avgFrequency} times/day (~every ${hourlyInterval}h), or ${maxNocturia} times/night = 40%`);
  } else if ((avgFrequency >= 12 && avgFrequency < 24) || maxNocturia >= 3) {
    frequencyRating = 20;
    rationale.push(`Frequency: ${avgFrequency} times/day, ${avgNocturia} avg nocturia = 20%`);
  } else if ((avgFrequency >= 8 && avgFrequency < 12) || maxNocturia >= 2) {
    frequencyRating = 10;
    rationale.push(`Frequency: ${avgFrequency} times/day, ${avgNocturia} avg nocturia = 10%`);
  }

  // Obstruction rating
  if (catheterLogs.length > 0) {
    obstructionRating = 30;
    rationale.push(`Obstruction: Catheterization required (${catheterType || 'type not specified'}) = 30%`);
  }

  const supportedRating = Math.max(incontinenceRating, frequencyRating, obstructionRating);

  // Evidence gaps
  if (!avgFrequency) {
    evidenceGaps.push('Log urinary frequency (times per day) consistently');
  }
  if (!avgNocturia) {
    evidenceGaps.push('Track nocturia (nighttime awakenings to void)');
  }
  if (incontinenceLogs.length > 0 && !avgPadChanges) {
    evidenceGaps.push('Document pad/diaper changes per day');
  }

  evidenceGaps.push('Obtain voiding diary from healthcare provider');
  evidenceGaps.push('Get post-void residual measurements if available');
  evidenceGaps.push('Document any urodynamic testing results');

  return {
      condition: 'Voiding Dysfunction',
      diagnosticCode: '7542',

    hasData: true,
    totalLogs: voidingLogs.length,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      incontinenceEpisodes: incontinenceLogs.length,
      avgPadChanges,
      maxPadChanges,
      avgFrequency,
      avgNocturia,
      maxNocturia,
      catheterUse: catheterLogs.length,
      catheterType,
    },
    criteriaReference: VOIDING_DYSFUNCTION_CRITERIA,
  };
};

// Analyze Sphincter Impairment logs (DC 7332)
export const analyzeSphincterImpairmentLogs = (logs) => {
  const sphincterLogs = logs.filter(log =>
      log.genitourinaryData?.affectedSystem === 'sphincter' ||
      log.symptomId?.includes('fecal-incontinence')
  );

  if (sphincterLogs.length === 0) {
    return {
      hasData: false,
      message: 'No fecal incontinence symptoms logged'
    };
  }

  const episodes = sphincterLogs.filter(log => log.genitourinaryData?.fecalIncontinenceEpisode).length;
  const totalDaysLogged = sphincterLogs.length;
  const episodeRate = (episodes / totalDaysLogged * 100).toFixed(1);

  // Get frequency descriptions
  const frequencyDescriptions = {};
  sphincterLogs.forEach(log => {
    const freq = log.genitourinaryData?.fecalIncontinenceFrequency;
    if (freq) {
      frequencyDescriptions[freq] = (frequencyDescriptions[freq] || 0) + 1;
    }
  });

  const mostCommonFrequency = Object.keys(frequencyDescriptions).reduce((a, b) =>
      frequencyDescriptions[a] > frequencyDescriptions[b] ? a : b, null
  );

  // Determine rating
  let supportedRating = 0;
  let rationale = [];

  if (mostCommonFrequency === 'daily' || episodeRate > 50) {
    supportedRating = 60;
    rationale.push(`Daily or frequent episodes documented (${episodes} episodes in ${totalDaysLogged} days = ${episodeRate}%)`);
  } else if (mostCommonFrequency === 'weekly' || episodeRate > 10) {
    supportedRating = 30;
    rationale.push(`Weekly episodes documented (${episodes} episodes over ${totalDaysLogged} days)`);
  } else if (mostCommonFrequency === 'monthly' || episodes > 0) {
    supportedRating = 10;
    rationale.push(`Occasional episodes documented (${episodes} episodes)`);
  }

  const evidenceGaps = [
    'Obtain gastroenterology or colorectal surgery evaluation',
    'Document anorectal manometry results if performed',
    'Get treatment records (medications, biofeedback, surgery)',
  ];

  return {
      condition: 'Sphincter Control Impairment',
      diagnosticCode: '7332',

    hasData: true,
    totalLogs: sphincterLogs.length,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      episodes,
      totalDaysLogged,
      episodeRate: `${episodeRate}%`,
      mostCommonFrequency,
    },
    criteriaReference: SPHINCTER_IMPAIRMENT_CRITERIA,
  };
};

// Analyze Erectile Dysfunction logs (DC 7522)
export const analyzeErectileDysfunctionLogs = (logs) => {
  const edLogs = logs.filter(log =>
      log.genitourinaryData?.affectedSystem === 'reproductive' ||
      log.symptomId?.includes('erectile-dysfunction')
  );

  if (edLogs.length === 0) {
    return {
      hasData: false,
      message: 'No erectile dysfunction symptoms logged'
    };
  }

  const severityCounts = {};
  edLogs.forEach(log => {
    const severity = log.genitourinaryData?.edSeverity;
    if (severity) {
      severityCounts[severity] = (severityCounts[severity] || 0) + 1;
    }
  });

  const mostCommonSeverity = Object.keys(severityCounts).reduce((a, b) =>
      severityCounts[a] > severityCounts[b] ? a : b, null
  );

  return {
    condition: 'Erectile Dysfunction',
    diagnosticCode: '7522',
    hasData: true,
    totalLogs: edLogs.length,
    supportedRating: 0,
    ratingRationale: [
      'DC 7522 is rated at 0% only',
      `Severity documented: ${mostCommonSeverity || 'not specified'}`,
      'Service connection establishes potential for SMC in specific circumstances',
    ],
    gaps: [
      'Obtain urology evaluation documenting ED',
      'Document any secondary conditions (diabetes, PTSD, medications)',
      'Get treatment records (medications, devices, procedures attempted)',
    ],
    metrics: {
      mostCommonSeverity,
      severityCounts,
    },
    criteriaReference: ERECTILE_DYSFUNCTION_CRITERIA,
  };
};

export const analyzeIronDeficiencyAnemiaLogs = (logs, options = {}) => {
  if (!logs || logs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: [],
      gaps: ['No symptom logs found for iron deficiency anemia'],
      metrics: {},
      criteriaReference: IRON_DEFICIENCY_ANEMIA_CRITERIA
    };
  }

  const anemiaLogs = logs.filter(log =>
      log.anemiaData?.type === 'iron-deficiency' ||
      ['fatigue-blood', 'weakness-blood', 'dizziness-anemia', 'pale-skin'].includes(log.symptomId)
  );

  if (anemiaLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No iron deficiency anemia symptom logs found'],
      gaps: ['Log symptoms related to iron deficiency anemia'],
      metrics: {},
      criteriaReference: IRON_DEFICIENCY_ANEMIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const evidenceGaps = [];
  const metrics = {
    totalLogs: anemiaLogs.length,
    dateRange: `${new Date(anemiaLogs[0].timestamp).toLocaleDateString()} to ${new Date(anemiaLogs[anemiaLogs.length - 1].timestamp).toLocaleDateString()}`,
    treatmentTypes: new Set(),
    ivInfusionCount: 0,
    continuousOralSupplementation: false
  };

  anemiaLogs.forEach(log => {
    if (log.anemiaData?.treatment) {
      log.anemiaData.treatment.forEach(t => {
        metrics.treatmentTypes.add(t);
        if (t === 'iv-iron') metrics.ivInfusionCount++;
        if (t === 'oral-iron') metrics.continuousOralSupplementation = true;
      });
    }
  });

  if (metrics.ivInfusionCount >= 4) {
    supportedRating = 30;
    rationale.push(`Documented ${metrics.ivInfusionCount} IV iron infusion episodes (qualifies for 30% when 4+ per year)`);
    rationale.push('Treatment frequency indicates severe iron deficiency requiring aggressive intervention');
  } else if (metrics.ivInfusionCount >= 1 || metrics.continuousOralSupplementation) {
    supportedRating = 10;
    if (metrics.ivInfusionCount > 0) {
      rationale.push(`Documented ${metrics.ivInfusionCount} IV iron infusion episodes (requires 1-3 per year for 10%)`);
    }
    if (metrics.continuousOralSupplementation) {
      rationale.push('Requiring continuous oral iron supplementation');
    }
  } else {
    supportedRating = 0;
    rationale.push('Symptoms managed with dietary modification only or asymptomatic');
  }

  evidenceGaps.push('Upload medical records documenting IV iron infusion dates');
  evidenceGaps.push('Upload lab results (CBC, iron panel, ferritin levels)');
  evidenceGaps.push('Upload prescription records for iron supplementation');
  evidenceGaps.push('Obtain provider statement regarding treatment frequency and necessity');

  return {
      condition: 'Iron Deficiency Anemia',
      diagnosticCode: '7720',

    hasData: true,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics,
    criteriaReference: IRON_DEFICIENCY_ANEMIA_CRITERIA
  };
};

export const analyzeFolateDeficiencyAnemiaLogs = (logs, options = {}) => {
  const anemiaLogs = logs.filter(log => log.anemiaData?.type === 'folate-deficiency');

  if (anemiaLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No folate deficiency anemia logs found'],
      gaps: ['Log folate deficiency anemia symptoms and treatment'],
      metrics: {},
      criteriaReference: FOLATE_DEFICIENCY_ANEMIA_CRITERIA
    };
  }

  let ivCount = 0;
  let continuousOral = false;

  anemiaLogs.forEach(log => {
    if (log.anemiaData?.treatment?.includes('iv-folate')) ivCount++;
    if (log.anemiaData?.treatment?.includes('oral-folate')) continuousOral = true;
  });

  let supportedRating = 0;
  const rationale = [];

  if (ivCount >= 4) {
    supportedRating = 30;
    rationale.push(`${ivCount} IV folate infusions documented (30% when 4+ per year)`);
  } else if (ivCount >= 1 || continuousOral) {
    supportedRating = 10;
    if (ivCount > 0) rationale.push(`${ivCount} IV folate infusions (10% for 1-3 per year)`);
    if (continuousOral) rationale.push('Continuous oral folate supplementation required');
  }

  return {
      condition: 'Folic Acid Deficiency Anemia',
      diagnosticCode: '7721',

    hasData: true,
    supportedRating,
    rationale,
    gaps: ['Upload medical records and lab results documenting folate levels'],
    metrics: { totalLogs: anemiaLogs.length, ivCount, continuousOral },
    criteriaReference: FOLATE_DEFICIENCY_ANEMIA_CRITERIA
  };
};

export const analyzePerniciousAnemiaLogs = (logs, options = {}) => {
  const b12Logs = logs.filter(log =>
      log.anemiaData?.type === 'b12-deficiency' ||
      log.b12DeficiencyData?.deficiency_cause === 'pernicious-anemia' ||
      ['numbness-tingling-b12', 'difficulty-walking', 'memory-problems-b12'].includes(log.symptomId)
  );

  if (b12Logs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      rationale: ['No B12 deficiency/pernicious anemia logs found'],
      gaps: ['Log B12 deficiency symptoms and treatment'],
      metrics: {},
      criteriaReference: PERNICIOUS_ANEMIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: b12Logs.length,
    injectionCount: 0,
    continuousOral: false,
    neurologicalSymptoms: new Set(),
    hasCNSInvolvement: false
  };

  b12Logs.forEach(log => {
    if (log.anemiaData?.treatment?.includes('b12-injections')) metrics.injectionCount++;
    if (log.b12DeficiencyData?.treatment?.includes('injections-weekly') ||
        log.b12DeficiencyData?.treatment?.includes('injections-monthly')) {
      metrics.injectionCount++;
    }
    if (log.b12DeficiencyData?.treatment?.includes('high-dose-oral') ||
        log.b12DeficiencyData?.treatment?.includes('sublingual')) {
      metrics.continuousOral = true;
    }
    if (log.b12DeficiencyData?.neurological_symptoms) {
      log.b12DeficiencyData.neurological_symptoms.forEach(s => metrics.neurologicalSymptoms.add(s));
    }
  });

  // Check for CNS involvement
  const severeNeuroSymptoms = ['balance-problems', 'difficulty-walking', 'weakness', 'confusion'];
  metrics.hasCNSInvolvement = severeNeuroSymptoms.some(s => metrics.neurologicalSymptoms.has(s));

  if (metrics.hasCNSInvolvement && metrics.neurologicalSymptoms.size >= 3) {
    supportedRating = 100;
    rationale.push('Central nervous system involvement documented with neurological symptoms:');
    rationale.push(`- ${Array.from(metrics.neurologicalSymptoms).join(', ')}`);
    rationale.push('CRITICAL: Requires neurology evaluation and documentation of CNS damage for 100% rating');
  } else if (metrics.injectionCount >= 4) {
    supportedRating = 30;
    rationale.push(`${metrics.injectionCount} B12 injection episodes documented (30% when 4+ per year)`);
  } else if (metrics.injectionCount >= 1 || metrics.continuousOral) {
    supportedRating = 10;
    if (metrics.injectionCount > 0) rationale.push(`${metrics.injectionCount} B12 injections (10% for 1-3 per year)`);
    if (metrics.continuousOral) rationale.push('Continuous oral/sublingual B12 supplementation required');
  }

  const evidenceGaps = [
    'Upload lab results (B12 level, methylmalonic acid, homocysteine)',
    'Upload treatment records showing injection frequency',
  ];

  if (metrics.hasCNSInvolvement) {
    evidenceGaps.push('CRITICAL: Obtain neurology evaluation documenting CNS involvement');
    evidenceGaps.push('CRITICAL: Upload MRI or EMG/NCV studies showing nerve or spinal cord damage');
  }

  return {
    condition: 'Pernicious Anemia (B12 Deficiency)',
    diagnosticCode: '7722',
    hasData: true,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics,
    criteriaReference: PERNICIOUS_ANEMIA_CRITERIA
  };
};

export const analyzeHemolyticAnemiaLogs = (logs, options = {}) => {
  const hemolyticLogs = logs.filter(log => log.anemiaData?.type === 'hemolytic');

  if (hemolyticLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No hemolytic anemia logs found'],
      gaps: ['Log hemolytic anemia symptoms and treatment'],
      metrics: {},
      criteriaReference: HEMOLYTIC_ANEMIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: hemolyticLogs.length,
    transfusionCount: 0,
    hasImmunosuppression: false,
    hasBoneMarrowTransplant: false
  };

  hemolyticLogs.forEach(log => {
    if (log.anemiaData?.treatment?.includes('transfusions')) metrics.transfusionCount++;
    if (log.anemiaData?.treatment?.includes('immunosuppressants')) metrics.hasImmunosuppression = true;
    if (log.anemiaData?.treatment?.includes('bone-marrow-transplant')) metrics.hasBoneMarrowTransplant = true;
  });

  if (metrics.hasBoneMarrowTransplant) {
    supportedRating = 100;
    rationale.push('Bone marrow/stem cell transplant performed (100% rating)');
  } else if (metrics.transfusionCount >= 8) {
    supportedRating = 70;
    rationale.push(`${metrics.transfusionCount} transfusions documented (70% when every 6 weeks = 8-9+ per year)`);
  } else if (metrics.transfusionCount >= 4 && metrics.hasImmunosuppression) {
    supportedRating = 50;
    rationale.push(`${metrics.transfusionCount} transfusions + continuous immunosuppressive therapy (50%)`);
  } else if (metrics.hasImmunosuppression || metrics.transfusionCount >= 1) {
    supportedRating = 30;
    if (metrics.hasImmunosuppression) rationale.push('Continuous immunosuppressive therapy required');
    if (metrics.transfusionCount > 0) rationale.push(`${metrics.transfusionCount} transfusions per year`);
  } else if (metrics.hasImmunosuppression) {
    supportedRating = 10;
    rationale.push('Continuous oral medication required');
  }

  return {
      condition: 'Acquired Hemolytic Anemia',
      diagnosticCode: '7723',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload transfusion records showing dates and frequency',
      'Upload lab results (CBC, reticulocyte count, LDH, haptoglobin, direct Coombs test)',
      'Upload prescription records for immunosuppressive medications'
    ],
    metrics,
    criteriaReference: HEMOLYTIC_ANEMIA_CRITERIA
  };
};

export const analyzeSickleCellAnemiaLogs = (logs, options = {}) => {
  const sickleLogs = logs.filter(log =>
      log.anemiaData?.type === 'sickle-cell' ||
      log.sickleCellData ||
      getLogSymptomId(log) === 'sickle-cell-crisis'
  );

  if (sickleLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No sickle cell disease logs found'],
      gaps: ['Log sickle cell crises and symptoms'],
      metrics: {},
      criteriaReference: SICKLE_CELL_ANEMIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: sickleLogs.length,
    hospitalizationCount: 0,
    erVisitCount: 0,
    homeManagedCount: 0,
    organDamage: false
  };

  sickleLogs.forEach(log => {
    if (log.sickleCellData?.treatment_received?.includes('hospitalized')) {
      metrics.hospitalizationCount++;
    } else if (log.sickleCellData?.treatment_received?.includes('er-visit')) {
      metrics.erVisitCount++;
    } else if (log.sickleCellData?.treatment_received?.includes('home-management')) {
      metrics.homeManagedCount++;
    }
  });

  const totalMedicalCrises = metrics.hospitalizationCount + metrics.erVisitCount;

  if (totalMedicalCrises >= 4) {
    supportedRating = 100;
    rationale.push(`${totalMedicalCrises} painful crises requiring medical intervention (4+ per year = 100%)`);
    rationale.push(`Breakdown: ${metrics.hospitalizationCount} hospitalizations, ${metrics.erVisitCount} ER visits`);
  } else if (totalMedicalCrises === 3) {
    supportedRating = 60;
    rationale.push(`3 painful crises requiring medical intervention (60% rating)`);
  } else if (totalMedicalCrises >= 1) {
    supportedRating = 30;
    rationale.push(`${totalMedicalCrises} painful crisis(es) requiring medical intervention (30% for 1-2 per year)`);
  } else if (sickleLogs.length > 0) {
    supportedRating = 10;
    rationale.push('Documented sickle cell disease with history of symptoms');
    rationale.push('NOTE: Home-managed crises do not count toward higher ratings');
  }

  const evidenceGaps = [
    'Upload medical records of all ER visits and hospitalizations for sickle cell crises',
    'Upload documentation showing IV pain medication administration',
    'Upload hemoglobin electrophoresis results',
    'Upload imaging studies if organ damage present'
  ];

  if (metrics.homeManagedCount > 0) {
    evidenceGaps.push(`IMPORTANT: ${metrics.homeManagedCount} home-managed crises logged but these do not count for rating - only crises requiring parenteral opioids or hospitalization qualify`);
  }

  return {
      condition: 'Sickle Cell Anemia',
      diagnosticCode: '7714',

    hasData: true,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics,
    criteriaReference: SICKLE_CELL_ANEMIA_CRITERIA
  };
};

export const analyzeAplasticAnemiaLogs = (logs, options = {}) => {
  const aplasticLogs = logs.filter(log => log.anemiaData?.type === 'aplastic');

  if (aplasticLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No aplastic anemia logs found'],
      gaps: ['Log aplastic anemia symptoms and treatment'],
      metrics: {},
      criteriaReference: APLASTIC_ANEMIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: aplasticLogs.length,
    transfusionCount: 0,
    hasImmunosuppression: false,
    hasGrowthFactors: false,
    hasBoneMarrowTransplant: false,
    frequentInfections: 0
  };

  aplasticLogs.forEach(log => {
    if (log.anemiaData?.treatment?.includes('transfusions')) metrics.transfusionCount++;
    if (log.anemiaData?.treatment?.includes('immunosuppressants')) metrics.hasImmunosuppression = true;
    if (log.anemiaData?.treatment?.includes('growth-factors')) metrics.hasGrowthFactors = true;
    if (log.anemiaData?.treatment?.includes('bone-marrow-transplant')) metrics.hasBoneMarrowTransplant = true;
  });

  if (metrics.hasBoneMarrowTransplant) {
    supportedRating = 100;
    rationale.push('Bone marrow/stem cell transplant performed (100% rating)');
  } else if (metrics.transfusionCount >= 8 && metrics.frequentInfections >= 8) {
    supportedRating = 100;
    rationale.push('Transfusions every 6 weeks (8-9+ per year) AND recurring infections despite prophylactic antibiotics');
  } else if (metrics.transfusionCount >= 4 && metrics.hasImmunosuppression) {
    supportedRating = 70;
    rationale.push(`Transfusions every 3 months (4+ per year) AND continuous immunosuppressive therapy`);
  } else if (metrics.hasImmunosuppression && metrics.hasGrowthFactors) {
    supportedRating = 50;
    rationale.push('Continuous immunosuppressive therapy AND myeloid growth factors');
  } else if (metrics.hasImmunosuppression) {
    supportedRating = 30;
    rationale.push('Continuous immunosuppressive therapy required');
  } else if (metrics.hasGrowthFactors) {
    supportedRating = 10;
    rationale.push('Continuous myeloid growth factor treatment required');
  }

  return {
      condition: 'Aplastic Anemia',
      diagnosticCode: '7716',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload bone marrow biopsy report confirming diagnosis',
      'Upload transfusion records showing frequency',
      'Upload prescription records for immunosuppressive medications',
      'Upload prescription/treatment records for growth factors (G-CSF, EPO)',
      'Upload infection records if frequent infections present'
    ],
    metrics,
    criteriaReference: APLASTIC_ANEMIA_CRITERIA
  };
};

export const analyzePolycythemiaVeraLogs = (logs, options = {}) => {
  const polyLogs = logs.filter(log =>
      log.polycythemiaData?.diagnosis === 'polycythemia-vera' ||
      ['itching-after-bathing', 'burning-hands-feet', 'redness-skin'].includes(log.symptomId)
  );

  if (polyLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No polycythemia vera logs found'],
      gaps: ['Log polycythemia vera symptoms and treatment'],
      metrics: {},
      criteriaReference: POLYCYTHEMIA_VERA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: polyLogs.length,
    phlebotomyCount: 0,
    hasMyelosuppression: false,
    hasAspirinOnly: false,
    hasBoneMarrowTransplant: false
  };

  polyLogs.forEach(log => {
    if (log.polycythemiaData?.treatment?.includes('phlebotomy')) metrics.phlebotomyCount++;
    if (log.polycythemiaData?.medications?.some(m =>
        ['hydroxyurea-continuous', 'interferon-continuous', 'jakafi-continuous'].includes(m)
    )) {
      metrics.hasMyelosuppression = true;
    }
    if (log.polycythemiaData?.treatment?.includes('aspirin')) metrics.hasAspirinOnly = true;
  });

  if (metrics.hasBoneMarrowTransplant) {
    supportedRating = 100;
    rationale.push('Bone marrow/stem cell transplant performed');
  } else if (metrics.phlebotomyCount >= 6 && metrics.hasMyelosuppression) {
    supportedRating = 75;
    rationale.push(`${metrics.phlebotomyCount} phlebotomies per year AND continuous myelosuppressive treatment`);
  } else if (metrics.phlebotomyCount >= 4 && metrics.hasMyelosuppression) {
    supportedRating = 60;
    rationale.push(`${metrics.phlebotomyCount} phlebotomies per year AND continuous myelosuppressive treatment`);
  } else if (metrics.phlebotomyCount >= 4 || metrics.hasMyelosuppression) {
    supportedRating = 50;
    if (metrics.phlebotomyCount >= 4) rationale.push(`${metrics.phlebotomyCount} phlebotomies per year`);
    if (metrics.hasMyelosuppression) rationale.push('Continuous myelosuppressive medication');
  } else if (metrics.phlebotomyCount === 3 || metrics.hasMyelosuppression) {
    supportedRating = 40;
    rationale.push(metrics.phlebotomyCount === 3 ? '3 phlebotomies per year' : 'Continuous myelosuppressive medication');
  } else if (metrics.phlebotomyCount >= 1) {
    supportedRating = 20;
    rationale.push(`${metrics.phlebotomyCount} phlebotomies per year`);
  } else if (metrics.hasAspirinOnly) {
    supportedRating = 10;
    rationale.push('Managed with low-dose aspirin only');
  }

  return {
      condition: 'Polycythemia Vera',
      diagnosticCode: '7704',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload phlebotomy records showing dates and frequency',
      'Upload prescription records for myelosuppressive medications',
      'Upload lab results (CBC, JAK2 mutation testing)',
      'Upload hematology consultation reports'
    ],
    metrics,
    criteriaReference: POLYCYTHEMIA_VERA_CRITERIA
  };
};

export const analyzeImmuneThrombocytopeniaLogs = (logs, options = {}) => {
  const itpLogs = logs.filter(log =>
      log.bleedingDisorderData?.disorder_type === 'thrombocytopenia' ||
      ['easy-bruising', 'prolonged-bleeding', 'petechiae'].includes(log.symptomId)
  );

  if (itpLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No immune thrombocytopenia logs found'],
      gaps: ['Log ITP symptoms and treatment'],
      metrics: {},
      criteriaReference: IMMUNE_THROMBOCYTOPENIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: itpLogs.length,
    lowestPlateletCount: null,
    hasImmunosuppression: false,
    hasBleedingEpisodes: false,
    hasBoneMarrowTransplant: false
  };

  itpLogs.forEach(log => {
    if (log.bleedingDisorderData?.platelet_count) {
      const count = parseInt(log.bleedingDisorderData.platelet_count);
      if (!metrics.lowestPlateletCount || count < metrics.lowestPlateletCount) {
        metrics.lowestPlateletCount = count;
      }
    }
    if (log.bleedingDisorderData?.treatment?.some(t =>
        ['steroids', 'immunoglobulins', 'immunosuppressants', 'tpo-agonists'].includes(t)
    )) {
      metrics.hasImmunosuppression = true;
    }
    if (log.bleedingDisorderData?.bleeding_site?.length > 0) {
      metrics.hasBleedingEpisodes = true;
    }
  });

  if (metrics.hasBoneMarrowTransplant) {
    supportedRating = 100;
    rationale.push('Bone marrow/stem cell transplant performed');
  } else if (metrics.lowestPlateletCount && metrics.lowestPlateletCount < 20000 &&
      metrics.hasImmunosuppression && metrics.hasBleedingEpisodes) {
    supportedRating = 100;
    rationale.push(`Platelet count <20,000 (lowest: ${metrics.lowestPlateletCount.toLocaleString()}) with continuous immunosuppressive treatment and bleeding episodes`);
  } else if (metrics.lowestPlateletCount && metrics.lowestPlateletCount >= 20000 &&
      metrics.lowestPlateletCount <= 30000 && metrics.hasImmunosuppression && metrics.hasBleedingEpisodes) {
    supportedRating = 70;
    rationale.push(`Platelet count 20,000-30,000 (${metrics.lowestPlateletCount.toLocaleString()}) with immunosuppressive treatment and bleeding`);
  } else if (metrics.lowestPlateletCount && metrics.lowestPlateletCount >= 30000 &&
      metrics.lowestPlateletCount <= 50000 && metrics.hasImmunosuppression) {
    supportedRating = 50;
    rationale.push(`Platelet count 30,000-50,000 (${metrics.lowestPlateletCount.toLocaleString()}) requiring continuous immunosuppressive treatment`);
  } else if (metrics.lowestPlateletCount && metrics.lowestPlateletCount >= 50000 &&
      metrics.lowestPlateletCount <= 70000 && metrics.hasImmunosuppression) {
    supportedRating = 30;
    rationale.push(`Platelet count 50,000-70,000 (${metrics.lowestPlateletCount.toLocaleString()}) requiring continuous immunosuppressive treatment`);
  } else if (metrics.lowestPlateletCount && metrics.lowestPlateletCount >= 70000 &&
      metrics.lowestPlateletCount <= 100000) {
    supportedRating = 10;
    rationale.push(`Platelet count 70,000-100,000 (${metrics.lowestPlateletCount.toLocaleString()})`);
  } else {
    supportedRating = 0;
    rationale.push('Platelet count >100,000 or asymptomatic');
  }

  return {
      condition: 'Immune Thrombocytopenia (ITP)',
      diagnosticCode: '7705',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload multiple CBC lab results showing platelet counts',
      'Upload prescription records for immunosuppressive medications',
      'Upload documentation of bleeding episodes',
      'Upload hematology consultation reports'
    ],
    metrics,
    criteriaReference: IMMUNE_THROMBOCYTOPENIA_CRITERIA
  };
};


export const analyzeLeukemiaLogs = (logs, options = {}) => {
  const leukemiaLogs = logs.filter(log =>
      ['cll', 'cml', 'all', 'aml'].includes(log.lymphomaLeukemiaData?.diagnosis) ||
      ['bone-pain-leukemia', 'night-sweats-blood', 'frequent-infections'].includes(log.symptomId)
  );

  if (leukemiaLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      rationale: ['No leukemia logs found'],
      gaps: ['Log leukemia symptoms and treatment'],
      metrics: {},
      criteriaReference: LEUKEMIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: leukemiaLogs.length,
    activeTreatment: false,
    inRemission: false,
    hasResidualSymptoms: false,
    treatmentTypes: new Set(),
    sideEffects: new Set()
  };

  leukemiaLogs.forEach(log => {
    if (log.lymphomaLeukemiaData?.treatment_status === 'active-treatment') {
      metrics.activeTreatment = true;
    }
    if (log.lymphomaLeukemiaData?.treatment_status === 'remission') {
      metrics.inRemission = true;
    }
    if (log.lymphomaLeukemiaData?.side_effects?.length > 0) {
      metrics.hasResidualSymptoms = true;
      log.lymphomaLeukemiaData.side_effects.forEach(e => metrics.sideEffects.add(e));
    }
    if (log.lymphomaLeukemiaData?.treatment_type) {
      log.lymphomaLeukemiaData.treatment_type.forEach(t => metrics.treatmentTypes.add(t));
    }
  });

  if (metrics.activeTreatment) {
    supportedRating = 100;
    rationale.push('Currently receiving active treatment for leukemia (100% rating during treatment)');
    if (metrics.treatmentTypes.size > 0) {
      rationale.push(`Treatment types: ${Array.from(metrics.treatmentTypes).join(', ')}`);
    }
  } else if (metrics.inRemission && metrics.hasResidualSymptoms) {
    supportedRating = 60;
    rationale.push('Post-treatment with residual symptoms');
    rationale.push(`Ongoing symptoms: ${Array.from(metrics.sideEffects).join(', ')}`);
  } else if (metrics.inRemission) {
    supportedRating = 30;
    rationale.push('In complete remission with surveillance only');
  } else {
    supportedRating = 100;
    rationale.push('Active leukemia - assume 100% rating until remission documented');
  }

  return {
    condition: 'Leukemia',
    diagnosticCode: '7703',
    hasData: true,
    supportedRating,
    ratingRationale: rationale,
    gaps: [
      'Upload oncology consultation reports',
      'Upload bone marrow biopsy results',
      'Upload treatment records and protocols',
      'Upload lab results (CBC, flow cytometry, molecular studies)',
      'Upload documentation of treatment status (active vs. remission)'
    ],
    metrics,
    criteriaReference: LEUKEMIA_CRITERIA
  };
};


export const analyzeHodgkinsLymphomaLogs = (logs, options = {}) => {
  const hodgkinsLogs = logs.filter(log =>
      log.lymphomaLeukemiaData?.diagnosis === 'hodgkin' ||
      ['swollen-lymph-nodes', 'night-sweats-blood'].includes(log.symptomId)
  );

  if (hodgkinsLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ["No Hodgkin's lymphoma logs found"],
      gaps: ["Log Hodgkin's lymphoma symptoms and treatment"],
      metrics: {},
      criteriaReference: HODGKINS_LYMPHOMA_CRITERIA
    };
  }

  let activeTreatment = false;
  let inRemission = false;
  let hasResidualSymptoms = false;

  hodgkinsLogs.forEach(log => {
    if (log.lymphomaLeukemiaData?.treatment_status === 'active-treatment') activeTreatment = true;
    if (log.lymphomaLeukemiaData?.treatment_status === 'remission') inRemission = true;
    if (log.lymphomaLeukemiaData?.side_effects?.length > 0) hasResidualSymptoms = true;
  });

  let supportedRating = 0;
  const rationale = [];

  if (activeTreatment) {
    supportedRating = 100;
    rationale.push("Active treatment for Hodgkin's lymphoma (100% during treatment)");
  } else if (inRemission && hasResidualSymptoms) {
    supportedRating = 60;
    rationale.push('Post-treatment with residual symptoms');
  } else if (inRemission) {
    supportedRating = 30;
    rationale.push('Complete remission with surveillance');
  } else {
    supportedRating = 100;
    rationale.push("Active Hodgkin's lymphoma - 100% until remission");
  }

  return {
      condition: 'Hodgkin\'s Lymphoma',
      diagnosticCode: '7709',
      hasData: true,
      supportedRating,
      rationale,
      gaps: [
        'Upload oncology consultation reports',
        'Upload pathology report confirming diagnosis',
        'Upload PET/CT scan results',
        'Upload treatment records'
      ],
      metrics: { totalLogs: hodgkinsLogs.length },
      criteriaReference: HODGKINS_LYMPHOMA_CRITERIA
  };
};


export const analyzeMultipleMyelomaLogs = (logs, options = {}) => {
  const myelomaLogs = logs.filter(log =>
      log.lymphomaLeukemiaData?.diagnosis === 'multiple-myeloma' ||
      getLogSymptomId(log) === 'bone-pain-leukemia'
  );

  if (myelomaLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      rationale: ['No multiple myeloma logs found'],
      gaps: ['Log multiple myeloma symptoms and treatment'],
      metrics: {},
      criteriaReference: MULTIPLE_MYELOMA_CRITERIA
    };
  }

  let activeTreatment = false;
  let inRemission = false;
  let hasResidualSymptoms = false;

  myelomaLogs.forEach(log => {
    if (log.lymphomaLeukemiaData?.treatment_status === 'active-treatment') activeTreatment = true;
    if (log.lymphomaLeukemiaData?.treatment_status === 'remission') inRemission = true;
    if (log.lymphomaLeukemiaData?.side_effects?.length > 0) hasResidualSymptoms = true;
  });

  let supportedRating = 0;
  const rationale = [];

  if (activeTreatment) {
    supportedRating = 100;
    rationale.push('Active treatment for multiple myeloma (100% during treatment)');
  } else if (inRemission && hasResidualSymptoms) {
    supportedRating = 60;
    rationale.push('Post-treatment with residual symptoms');
  } else if (inRemission) {
    supportedRating = 30;
    rationale.push('In remission with surveillance');
  } else {
    supportedRating = 100;
    rationale.push('Active multiple myeloma - 100% until remission');
  }

  return {
    condition: 'Multiple Myeloma',
    diagnosticCode: '7712',
    hasData: true,
    supportedRating,
    ratingRationale: rationale,
    gaps: [
      'Upload oncology consultation reports',
      'Upload bone marrow biopsy results',
      'Upload lab results (SPEP, free light chains, complete metabolic panel)',
      'Upload skeletal survey or PET/CT showing bone lesions',
      'Upload treatment records'
    ],
    metrics: { totalLogs: myelomaLogs.length },
    criteriaReference: MULTIPLE_MYELOMA_CRITERIA
  };
};


export const analyzeNonHodgkinsLymphomaLogs = (logs, options = {}) => {
  const nhlLogs = logs.filter(log => log.lymphomaLeukemiaData?.diagnosis === 'non-hodgkin');

  if (nhlLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ["No Non-Hodgkin's lymphoma logs found"],
      gaps: ["Log Non-Hodgkin's lymphoma symptoms and treatment"],
      metrics: {},
      criteriaReference: NON_HODGKINS_LYMPHOMA_CRITERIA
    };
  }

  let activeTreatment = false;
  let inRemission = false;
  let hasResidualSymptoms = false;

  nhlLogs.forEach(log => {
    if (log.lymphomaLeukemiaData?.treatment_status === 'active-treatment') activeTreatment = true;
    if (log.lymphomaLeukemiaData?.treatment_status === 'remission') inRemission = true;
    if (log.lymphomaLeukemiaData?.side_effects?.length > 0) hasResidualSymptoms = true;
  });

  let supportedRating = 0;
  const rationale = [];

  if (activeTreatment) {
    supportedRating = 100;
    rationale.push("Active treatment for Non-Hodgkin's lymphoma (100% during treatment)");
  } else if (inRemission && hasResidualSymptoms) {
    supportedRating = 60;
    rationale.push('Post-treatment with residual symptoms');
  } else if (inRemission) {
    supportedRating = 30;
    rationale.push('Complete remission with surveillance');
  } else {
    supportedRating = 100;
    rationale.push("Active Non-Hodgkin's lymphoma - 100% until remission");
  }

  return {
      condition: 'Non-Hodgkin\'s Lymphoma',
      diagnosticCode: '7715',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload oncology consultation reports',
      'Upload pathology report with lymphoma subtype',
      'Upload PET/CT scan results',
      'Upload treatment records'
    ],
    metrics: { totalLogs: nhlLogs.length },
    criteriaReference: NON_HODGKINS_LYMPHOMA_CRITERIA
  };
};

export const analyzeMyeloproliferative7718Logs = (logs, options = {}) => {
  const mpnLogs = logs.filter(log =>
      ['essential-thrombocythemia', 'primary-myelofibrosis'].includes(log.polycythemiaData?.diagnosis)
  );

  if (mpnLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No essential thrombocythemia or myelofibrosis logs found'],
      gaps: ['Log symptoms and treatment for ET or PMF'],
      metrics: {},
      criteriaReference: MYELOPROLIFERATIVE_7718_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: mpnLogs.length,
    hasJAKInhibitor: false,
    hasMyelosuppression: false,
    hasSplenomegaly: false,
    hasBoneMarrowTransplant: false
  };

  mpnLogs.forEach(log => {
    if (log.polycythemiaData?.medications?.includes('jakafi-continuous')) metrics.hasJAKInhibitor = true;
    if (log.polycythemiaData?.medications?.some(m =>
        ['hydroxyurea-continuous', 'interferon-continuous'].includes(m)
    )) {
      metrics.hasMyelosuppression = true;
    }
    if (log.polycythemiaData?.complications?.includes('enlarged-spleen')) metrics.hasSplenomegaly = true;
  });

  if (metrics.hasBoneMarrowTransplant) {
    supportedRating = 100;
    rationale.push('Bone marrow/stem cell transplant performed');
  } else if (metrics.hasSplenomegaly) {
    supportedRating = 100;
    rationale.push('Symptomatic splenomegaly with complications');
  } else if (metrics.hasJAKInhibitor || metrics.hasSplenomegaly) {
    supportedRating = 60;
    if (metrics.hasJAKInhibitor) rationale.push('Requiring continuous JAK inhibitor therapy');
    if (metrics.hasSplenomegaly) rationale.push('Symptomatic splenomegaly documented');
  } else if (metrics.hasMyelosuppression) {
    supportedRating = 40;
    rationale.push('Requiring continuous myelosuppressive treatment');
  } else {
    supportedRating = 10;
    rationale.push('Managed with aspirin or antiplatelet therapy');
  }

  return {
      condition: 'Essential Thrombocythemia',
      diagnosticCode: '7718',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload bone marrow biopsy results',
      'Upload JAK2 mutation testing',
      'Upload imaging showing spleen size (ultrasound or CT)',
      'Upload prescription records for medications',
      'Upload lab results (CBC with differential, LDH)'
    ],
    metrics,
    criteriaReference: MYELOPROLIFERATIVE_7718_CRITERIA
  };
};

export const analyzeChronicMyelogenousLeukemiaLogs = (logs, options = {}) => {
  const cmlLogs = logs.filter(log => log.lymphomaLeukemiaData?.diagnosis === 'cml');

  if (cmlLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No CML logs found'],
      gaps: ['Log CML symptoms and treatment'],
      metrics: {},
      criteriaReference: CHRONIC_MYELOGENOUS_LEUKEMIA_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: cmlLogs.length,
    onTKI: false,
    inRemission: false,
    activeTreatment: false
  };

  cmlLogs.forEach(log => {
    if (log.lymphomaLeukemiaData?.treatment_type?.includes('targeted-therapy')) metrics.onTKI = true;
    if (log.lymphomaLeukemiaData?.treatment_status === 'remission') metrics.inRemission = true;
    if (log.lymphomaLeukemiaData?.treatment_status === 'active-treatment') metrics.activeTreatment = true;
  });

  if (metrics.activeTreatment && !metrics.inRemission) {
    supportedRating = 100;
    rationale.push('Chronic or accelerated phase CML (100% rating)');
  } else if (metrics.onTKI && !metrics.inRemission) {
    supportedRating = 60;
    rationale.push('Partial molecular/cytogenetic response on TKI therapy');
  } else if (metrics.inRemission && metrics.onTKI) {
    supportedRating = 10;
    rationale.push('Complete molecular response on TKI therapy');
  } else {
    supportedRating = 100;
    rationale.push('Active CML - 100% until molecular response documented');
  }

  return {
      condition: 'Chronic Myelogenous Leukemia',
      diagnosticCode: '7703',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload bone marrow biopsy results',
      'Upload BCR-ABL PCR molecular testing results',
      'Upload prescription records for TKI medications',
      'Upload hematology/oncology consultation reports',
      'Upload cytogenetic testing (Philadelphia chromosome)'
    ],
    metrics,
    criteriaReference: CHRONIC_MYELOGENOUS_LEUKEMIA_CRITERIA
  };
};

export const analyzeSolitaryPlasmacytomaLogs = (logs, options = {}) => {
  const plasmacytomaLogs = logs.filter(log =>
      log.lymphomaLeukemiaData?.diagnosis === 'plasmacytoma'
  );

  if (plasmacytomaLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No solitary plasmacytoma logs found'],
      gaps: ['Log plasmacytoma symptoms and treatment'],
      metrics: {},
      criteriaReference: SOLITARY_PLASMACYTOMA_CRITERIA
    };
  }

  let activeTreatment = false;

  plasmacytomaLogs.forEach(log => {
    if (log.lymphomaLeukemiaData?.treatment_status === 'active-treatment') activeTreatment = true;
  });

  let supportedRating = 0;
  const rationale = [];

  if (activeTreatment) {
    supportedRating = 100;
    rationale.push('Active treatment for solitary plasmacytoma (100% during treatment)');
  } else {
    supportedRating = 30;
    rationale.push('Post-treatment surveillance for plasmacytoma');
  }

  return {
      condition: 'Solitary Plasmacytoma',
      diagnosticCode: '7712',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload pathology report confirming diagnosis',
      'Upload imaging (MRI, PET/CT) showing tumor location and size',
      'Upload treatment records (radiation, surgery, etc.)',
      'Upload follow-up lab results (SPEP, free light chains)',
      'Upload bone marrow biopsy ruling out multiple myeloma'
    ],
    metrics: { totalLogs: plasmacytomaLogs.length },
    criteriaReference: SOLITARY_PLASMACYTOMA_CRITERIA
  };
};

export const analyzeMyelodysplasticSyndromesLogs = (logs, options = {}) => {
  const mdsLogs = logs.filter(log => log.lymphomaLeukemiaData?.diagnosis === 'mds');

  if (mdsLogs.length === 0) {
    return {
      hasData: false,
      supportedRating: 0,
      ratingRationale: ['No myelodysplastic syndrome logs found'],
      gaps: ['Log MDS symptoms and treatment'],
      metrics: {},
      criteriaReference: MYELODYSPLASTIC_SYNDROMES_CRITERIA
    };
  }

  let supportedRating = 0;
  const rationale = [];
  const metrics = {
    totalLogs: mdsLogs.length,
    transfusionCount: 0,
    hasImmunosuppression: false,
    hasGrowthFactors: false,
    hasBoneMarrowTransplant: false
  };

  mdsLogs.forEach(log => {
    // Count treatment occurrences
    if (log.anemiaData?.treatment?.includes('transfusions')) metrics.transfusionCount++;
    if (log.anemiaData?.treatment?.includes('immunosuppressants')) metrics.hasImmunosuppression = true;
    if (log.anemiaData?.treatment?.includes('growth-factors')) metrics.hasGrowthFactors = true;
  });

  if (metrics.hasBoneMarrowTransplant) {
    supportedRating = 100;
    rationale.push('Bone marrow/stem cell transplant performed');
  } else if (metrics.transfusionCount >= 8) {
    supportedRating = 100;
    rationale.push('Transfusions every 6 weeks (8-9+ per year) with frequent infections');
  } else if (metrics.transfusionCount >= 4 && metrics.hasImmunosuppression) {
    supportedRating = 70;
    rationale.push('Transfusions every 3 months AND continuous immunosuppressive therapy');
  } else if (metrics.hasImmunosuppression && metrics.hasGrowthFactors) {
    supportedRating = 50;
    rationale.push('Continuous immunosuppressive therapy AND growth factors');
  } else if (metrics.hasImmunosuppression) {
    supportedRating = 30;
    rationale.push('Continuous immunosuppressive therapy or erythropoietin');
  } else if (metrics.hasGrowthFactors) {
    supportedRating = 10;
    rationale.push('Continuous myeloid growth factor treatment');
  }

  return {
      condition: 'Myelodysplastic Syndromes',
      diagnosticCode: '7703',

    hasData: true,
    supportedRating,
    rationale,
    gaps: [
      'Upload bone marrow biopsy with cytogenetic analysis',
      'Upload transfusion records showing frequency',
      'Upload prescription records for immunosuppressants or growth factors',
      'Upload lab results (CBC with differential)',
      'Upload MDS risk stratification (IPSS or IPSS-R score)'
    ],
    metrics,
    criteriaReference: MYELODYSPLASTIC_SYNDROMES_CRITERIA
  };
};


// ============================================
// PHASE 4: GYNECOLOGICAL ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyzes Endometriosis logs (DC 7629)
 */
export const analyzeEndometriosisLogs = (logs) => {
  const endoLogs = logs.filter(log =>
      log.gynecologicalData?.endometriosisDiagnosed ||
      log.symptomId?.includes('endometriosis')
  );

  if (endoLogs.length === 0) {
    return {
      hasData: false,
      message: 'No endometriosis symptoms logged'
    };
  }

  // Check laparoscopy confirmation
  const laparoscopyConfirmed = endoLogs.some(log => log.gynecologicalData?.laparoscopyConfirmed);

  // Check bowel/bladder involvement
  const hasBowelBladderLesions = endoLogs.some(log =>
      log.gynecologicalData?.lesionLocations?.includes('Bowel') ||
      log.gynecologicalData?.lesionLocations?.includes('Bladder')
  );

  const hasBowelSymptoms = endoLogs.some(log => log.gynecologicalData?.bowelSymptoms);
  const hasBladderSymptoms = endoLogs.some(log => log.gynecologicalData?.bladderSymptoms);

  // Check treatment effectiveness
  const treatmentEffectiveness = {};
  endoLogs.forEach(log => {
    const effect = log.gynecologicalData?.treatmentEffectiveness;
    if (effect) {
      treatmentEffectiveness[effect] = (treatmentEffectiveness[effect] || 0) + 1;
    }
  });

  const mostCommonEffectiveness = Object.keys(treatmentEffectiveness).reduce((a, b) =>
      treatmentEffectiveness[a] > treatmentEffectiveness[b] ? a : b, null
  );

  // Determine rating
  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (!laparoscopyConfirmed) {
    evidenceGaps.push('CRITICAL: Laparoscopy confirmation required for VA endometriosis diagnosis');
    rationale.push('Endometriosis must be confirmed by laparoscopy for VA rating');
  }

  if (laparoscopyConfirmed && hasBowelBladderLesions &&
      (mostCommonEffectiveness === 'not-controlled' || mostCommonEffectiveness === 'partially-controlled') &&
      (hasBowelSymptoms || hasBladderSymptoms)) {
    supportedRating = 50;
    rationale.push('Lesions involving bowel or bladder confirmed by laparoscopy');
    rationale.push('Pelvic pain or bleeding not controlled by treatment');
    rationale.push('Bowel or bladder symptoms documented');
  } else if (laparoscopyConfirmed &&
      (mostCommonEffectiveness === 'not-controlled' || mostCommonEffectiveness === 'partially-controlled')) {
    supportedRating = 30;
    rationale.push('Pelvic pain or heavy/irregular bleeding present');
    rationale.push('Symptoms not controlled by treatment');
  } else if (laparoscopyConfirmed) {
    supportedRating = 10;
    rationale.push('Pelvic pain or heavy/irregular bleeding present');
    rationale.push('Symptoms require continuous treatment for control');
  }

  // Evidence gaps
  if (!hasBowelBladderLesions && supportedRating < 50) {
    evidenceGaps.push('For 50% rating: Document bowel or bladder lesions on laparoscopy report');
  }
  if (!hasBowelSymptoms && !hasBladderSymptoms && hasBowelBladderLesions) {
    evidenceGaps.push('For 50% rating: Document bowel/bladder symptoms in medical records');
  }
  if (mostCommonEffectiveness === 'controlled' || !mostCommonEffectiveness) {
    evidenceGaps.push('Document treatment effectiveness - symptoms must not be controlled for higher ratings');
  }

  evidenceGaps.push('Maintain gynecology records showing treatment attempts and symptom persistence');
  evidenceGaps.push('Document pain severity and interference with daily activities');

  return {
      condition: 'Endometriosis',
      diagnosticCode: '7629',

    hasData: true,
    totalLogs: endoLogs.length,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      laparoscopyConfirmed,
      hasBowelBladderLesions,
      hasBowelSymptoms,
      hasBladderSymptoms,
      treatmentEffectiveness,
      mostCommonEffectiveness,
    },
    criteriaReference: ENDOMETRIOSIS_CRITERIA,
  };
};

/**
 * Analyzes Female Reproductive Organs logs (DC 7610-7615)
 * Covers vulva, vagina, cervix, uterus, fallopian tube/PID, ovary/PCOS
 */
export const analyzeFemaleReproductiveOrgansLogs = (logs) => {
  const gyneLogs = logs.filter(log =>
      log.gynecologicalData &&
      (log.gynecologicalData.pcosDiagnosed ||
          log.gynecologicalData.pidDiagnosed ||
          log.symptomId?.includes('menstrual') ||
          log.symptomId?.includes('pelvic-pain') ||
          log.symptomId?.includes('dysmenorrhea') ||
          log.symptomId?.includes('pid') ||
          log.symptomId?.includes('ovarian') ||
          log.symptomId?.includes('pcos'))
  );

  if (gyneLogs.length === 0) {
    return {
      hasData: false,
      message: 'No female reproductive organ symptoms logged'
    };
  }

  // Check for continuous treatment requirement
  const requiresContinuousTreatment = gyneLogs.some(log =>
      log.gynecologicalData?.continuousTreatmentRequired
  );

  // Check symptom control
  const hasUncontrolledSymptoms = gyneLogs.some(log =>
      log.severity >= 7 ||
      log.gynecologicalData?.interferesDailyActivities ||
      log.gynecologicalData?.workMissed
  );

  // Specific conditions
  const hasPCOS = gyneLogs.some(log => log.gynecologicalData?.pcosDiagnosed);
  const hasPID = gyneLogs.some(log => log.gynecologicalData?.pidDiagnosed);
  const hasRecurrentPID = gyneLogs.some(log => log.gynecologicalData?.recurrentInfections);

  // Menstrual dysfunction
  const hasIrregularCycles = gyneLogs.some(log =>
      log.gynecologicalData?.cycleRegularity === 'irregular' ||
      log.gynecologicalData?.cycleRegularity === 'absent'
  );
  const hasHeavyBleeding = gyneLogs.some(log =>
      log.gynecologicalData?.flowHeaviness === 'heavy' ||
      log.gynecologicalData?.flowHeaviness === 'very-heavy'
  );
  const hasSevereDysmenorrhea = gyneLogs.some(log =>
      log.gynecologicalData?.dysmenorrheaSeverity === 'severe'
  );

  // Determine rating
  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (hasUncontrolledSymptoms && requiresContinuousTreatment) {
    supportedRating = 30;
    rationale.push('Symptoms not controlled by continuous treatment');
    rationale.push('Documented interference with daily activities or work');
  } else if (requiresContinuousTreatment) {
    supportedRating = 10;
    rationale.push('Symptoms require continuous treatment');
    rationale.push('Treatment provides adequate symptom control');
  } else {
    supportedRating = 0;
    rationale.push('Symptoms do not require continuous treatment');
  }

  // Condition-specific notes
  if (hasPCOS) {
    rationale.push('PCOS diagnosed (rated under DC 7615 - Ovary Disease)');
  }
  if (hasPID) {
    rationale.push('PID diagnosed (rated under DC 7614 - Fallopian Tube)');
    if (hasRecurrentPID) {
      rationale.push('Recurrent PID documented');
    }
  }
  if (hasIrregularCycles) {
    rationale.push('Irregular menstrual cycles documented');
  }
  if (hasHeavyBleeding) {
    rationale.push('Heavy menstrual bleeding (menorrhagia) documented');
  }
  if (hasSevereDysmenorrhea) {
    rationale.push('Severe dysmenorrhea (painful periods) documented');
  }

  // Evidence gaps
  evidenceGaps.push('Obtain gynecology examination and diagnosis');
  evidenceGaps.push('Document specific organ affected (vulva/vagina/cervix/uterus/fallopian tube/ovary)');
  evidenceGaps.push('Document treatment regimen (hormonal therapy, pain management, etc.)');
  evidenceGaps.push('Document symptom control with treatment');
  evidenceGaps.push('For higher rating: Document failed treatment attempts or persistent symptoms despite treatment');

  if (hasPCOS) {
    evidenceGaps.push('PCOS: Document Rotterdam criteria (2 of 3: irregular periods, hyperandrogenism, polycystic ovaries)');
  }
  if (hasPID) {
    evidenceGaps.push('PID: Document acute episodes, treatment, and any chronic sequelae');
  }

  return {
      condition: 'Diseases of Female Reproductive Organs',
      diagnosticCode: '7610-7629',

    hasData: true,
    totalLogs: gyneLogs.length,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      requiresContinuousTreatment,
      hasUncontrolledSymptoms,
      hasPCOS,
      hasPID,
      hasRecurrentPID,
      hasIrregularCycles,
      hasHeavyBleeding,
      hasSevereDysmenorrhea,
    },
    criteriaReference: FEMALE_REPRODUCTIVE_ORGANS_CRITERIA,
  };
};

/**
 * Analyzes Pelvic Organ Prolapse logs (DC 7621)
 */
export const analyzePelvicProlapseLogs = (logs) => {
  const prolapseLogs = logs.filter(log =>
      log.gynecologicalData?.prolapseDiagnosed ||
      log.symptomId?.includes('prolapse')
  );

  if (prolapseLogs.length === 0) {
    return {
      hasData: false,
      message: 'No pelvic organ prolapse symptoms logged'
    };
  }

  // Get prolapse types
  const prolapseTypes = {};
  prolapseLogs.forEach(log => {
    const type = log.gynecologicalData?.prolapseType;
    if (type) {
      prolapseTypes[type] = (prolapseTypes[type] || 0) + 1;
    }
  });

  // Get POP-Q stages
  const popStages = {};
  prolapseLogs.forEach(log => {
    const stage = log.gynecologicalData?.popStage;
    if (stage) {
      popStages[stage] = (popStages[stage] || 0) + 1;
    }
  });

  const mostCommonType = Object.keys(prolapseTypes).reduce((a, b) =>
      prolapseTypes[a] > prolapseTypes[b] ? a : b, null
  );

  const mostCommonStage = Object.keys(popStages).reduce((a, b) =>
      popStages[a] > popStages[b] ? a : b, null
  );

  // DC 7621 is flat 10%
  const supportedRating = 10;
  const rationale = [
    'DC 7621 provides flat 10% rating for pelvic organ prolapse',
    `Type of prolapse: ${mostCommonType || 'not specified'}`,
    `POP-Q Stage: ${mostCommonStage || 'not specified'}`,
    'Rating is same regardless of severity or stage',
  ];

  const evidenceGaps = [
    'Obtain gynecology or urogynecology examination',
    'Get POP-Q staging documentation',
    'Document type of prolapse (cystocele, rectocele, uterine, etc.)',
    'Document symptoms (pelvic pressure, bulge, urinary/bowel issues)',
    'Document treatment (pessary, pelvic floor PT, surgery)',
    'Note: Secondary conditions (urinary incontinence, bowel dysfunction) may be separately ratable',
  ];

  return {
      condition: 'Pelvic Organ Prolapse',
      diagnosticCode: '7628',

    hasData: true,
    totalLogs: prolapseLogs.length,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      prolapseTypes,
      popStages,
      mostCommonType,
      mostCommonStage,
    },
    criteriaReference: PELVIC_PROLAPSE_CRITERIA,
  };
};

/**
 * Analyzes Female Sexual Arousal Disorder logs (DC 7632)
 */
export const analyzeFemaleArousalDisorderLogs = (logs) => {
  const fsadLogs = logs.filter(log =>
      log.gynecologicalData?.sexualDysfunction ||
      log.gynecologicalData?.arousalDifficulty ||
      log.gynecologicalData?.libidoDecreased ||
      log.symptomId?.includes('sexual-dysfunction') ||
      log.symptomId?.includes('arousal') ||
      log.symptomId?.includes('libido')
  );

  if (fsadLogs.length === 0) {
    return {
      hasData: false,
      message: 'No female sexual arousal disorder symptoms logged'
    };
  }

  const hasArousalDifficulty = fsadLogs.some(log => log.gynecologicalData?.arousalDifficulty);
  const hasDecreasedLibido = fsadLogs.some(log => log.gynecologicalData?.libidoDecreased);

  return {
      condition: 'Female Sexual Arousal Disorder (FSAD)',
      diagnosticCode: '7632',

    hasData: true,
    totalLogs: fsadLogs.length,
    supportedRating: 0,
    ratingRationale: [
      'DC 7632 is rated at 0% only',
      'Service connection establishes potential for SMC review',
      hasArousalDifficulty ? 'Arousal difficulty documented' : '',
      hasDecreasedLibido ? 'Decreased libido documented' : '',
    ].filter(Boolean),
    gaps: [
      'Obtain gynecology or sexual health specialist evaluation',
      'Document FSAD diagnosis and symptoms',
      'Document any secondary conditions (PTSD, depression, medications, endometriosis, dyspareunia)',
      'Get treatment records if any (therapy, medications, etc.)',
      'Service connection establishes review for SMC under  3.350',
    ],
    metrics: {
      hasArousalDifficulty,
      hasDecreasedLibido,
    },
    criteriaReference: FEMALE_SEXUAL_AROUSAL_DISORDER_CRITERIA,
  };
};


// Helper function to check if timestamp is within evaluation period
const isWithinEvaluationPeriod = (timestamp, days) => {
  const logDate = new Date(timestamp);
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);
  return logDate >= cutoffDate;
};

/**
 * Analyzes Tinnitus logs
 */
export const analyzeTinnitusLogs = (logs, options = {}) => {
  const conditionCriteria = TINNITUS_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.TINNITUS.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No tinnitus symptoms logged in evaluation period',
    };
  }

  const totalSymptoms = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 0), 0) / totalSymptoms;
  const daysLogged = [...new Set(relevantLogs.map(log => new Date(log.timestamp).toDateString()))].length;

  const evidence = [
    `${totalSymptoms} tinnitus symptoms logged over ${(evaluationPeriodDays / 30).toFixed(1)} months`,
    `Logged on ${daysLogged} different days`,
    `Average severity: ${avgSeverity.toFixed(1)}/5`,
    'Pattern establishes recurrent tinnitus',
  ];

  let supportedRating = 0;
  const ratingRationale = [
    'Tinnitus has a flat 10% rating for all recurrent cases',
    'Your symptom logs document recurrent tinnitus',
    'No higher rating available regardless of severity',
  ];

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    assessmentLevel: 'Well-Documented',
    evidence,
    gaps: [
      'Get formal tinnitus diagnosis from healthcare provider',
      'Audiological examination (hearing test) typically performed',
      'Document characteristics: type of sound (ringing, buzzing, hissing, etc.)',
      'Document which ear(s) affected or if sound is "in head"',
      'Note: Severity does not affect rating - all recurrent tinnitus is 10%',
      'Note: Only ONE 10% rating awarded even if tinnitus in both ears',
    ],
    criteria: conditionCriteria,
    disclaimer: 'Tinnitus receives a flat 10% rating for all recurrent cases - severity does not change the rating. This is a straightforward condition to document. Your symptom logs establish the recurrent nature of the tinnitus.',
  };
};

/**
 * Analyzes Fibromyalgia logs
 */
export const analyzeFibromyalgiaLogs = (logs, options = {}) => {
  const conditionCriteria = FIBROMYALGIA_CRITERIA;
  const evaluationPeriodDays = options.days || 180; // Longer period for fibro
  const symptomIds = CONDITIONS.FIBROMYALGIA.symptomIds;

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No fibromyalgia symptoms logged in evaluation period',
    };
  }

  const totalSymptoms = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 0), 0) / totalSymptoms;
  const severeSymptoms = relevantLogs.filter(log => (log.severity || 0) >= 4).length;
  const symptomTypesPresent = [...new Set(relevantLogs.map(log => getLogSymptomId(log)))].length;
  const daysLogged = [...new Set(relevantLogs.map(log => new Date(log.timestamp).toDateString()))].length;

  const hasWidespreadPain = relevantLogs.some(log => getLogSymptomId(log) === 'fibro-widespread-pain');
  const hasTenderPoints = relevantLogs.some(log => getLogSymptomId(log) === 'fibro-tender-points');
  const hasFatigue = relevantLogs.some(log => getLogSymptomId(log) === 'fibro-fatigue');
  const hasSleepIssues = relevantLogs.some(log => getLogSymptomId(log) === 'fibro-sleep');
  const hasStiffness = relevantLogs.some(log => getLogSymptomId(log) === 'fibro-stiffness');
  const hasCognitive = relevantLogs.some(log => getLogSymptomId(log) === 'fibro-cognitive');

  const monthsInPeriod = evaluationPeriodDays / 30;
  const symptomsPerMonth = totalSymptoms / monthsInPeriod;

  const evidence = [
    `${totalSymptoms} fibromyalgia symptoms logged over ${monthsInPeriod.toFixed(1)} months`,
    `Logged on ${daysLogged} different days (${(daysLogged / monthsInPeriod).toFixed(1)} days/month)`,
    `${symptomTypesPresent} different symptom types documented`,
    `Average severity: ${avgSeverity.toFixed(1)}/5`,
    `${severeSymptoms} severe symptoms (4-5 severity)`,
  ];

  if (hasWidespreadPain) evidence.push('Widespread pain documented');
  if (hasTenderPoints) evidence.push('Tender point pain documented');
  if (hasFatigue) evidence.push('Fibromyalgia-specific fatigue documented');
  if (hasSleepIssues) evidence.push('Sleep disturbances documented');
  if (hasStiffness) evidence.push('Morning stiffness documented');
  if (hasCognitive) evidence.push('Cognitive issues (fibro fog) documented');

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // Assess pattern
  const isConstant = symptomsPerMonth >= 20; // ~5 per week = nearly constant
  const isFrequent = symptomsPerMonth >= 10; // ~2-3 per week = more than 1/3 time
  const severityHigh = avgSeverity >= 3.5;

  if (isConstant && severityHigh && severeSymptoms >= totalSymptoms * 0.4) {
    supportedRating = '40';
    ratingRationale = [
      'Symptoms appear constant or nearly constant',
      `Logged ${symptomsPerMonth.toFixed(1)} times per month on average`,
      `High severity (${avgSeverity.toFixed(1)}/5 average)`,
      `${symptomTypesPresent} different symptom types showing widespread impact`,
    ];
    gaps = [
      'Get formal fibromyalgia diagnosis from rheumatologist',
      'Document that widespread pain meets VA criteria (both sides, above+below waist, axial skeleton+extremities)',
      'Get tender point examination (11+ of 18 points for traditional diagnosis)',
      'Document all treatments tried and their effectiveness',
      'Show that symptoms persist despite treatment (refractory to therapy)',
      'Document functional impact on work and daily activities',
    ];
  } else if (isFrequent || (symptomTypesPresent >= 3 && severeSymptoms > 0)) {
    supportedRating = '20';
    ratingRationale = [
      'Symptoms present more than one-third of the time',
      `Logged ${symptomsPerMonth.toFixed(1)} times per month`,
      'Episodic pattern with exacerbations',
      `${symptomTypesPresent} symptom types documented`,
    ];
    gaps = [
      'Get formal fibromyalgia diagnosis',
      'Document widespread pain pattern',
      'Tender point examination results',
      'Track triggers for exacerbations (stress, overexertion, weather)',
      'Document frequency and duration of flare-ups',
      'Show pattern of episodic symptoms',
    ];
  } else {
    supportedRating = '10';
    ratingRationale = [
      `Symptoms documented but pattern suggests controlled status`,
      `${totalSymptoms} symptoms over ${monthsInPeriod.toFixed(1)} months`,
      'May indicate medication-controlled fibromyalgia',
    ];
    gaps = [
      'Get formal fibromyalgia diagnosis',
      'Document continuous medication requirement',
      'Prescription records for fibromyalgia medications',
      'Document widespread pain and tender points',
      'If symptoms are more frequent than logged, increase documentation frequency',
    ];
  }

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    assessmentLevel: 'Good Documentation',
    evidence,
    gaps,
    criteria: conditionCriteria,
    disclaimer: 'Fibromyalgia ratings are based on symptom pattern (constant vs episodic vs medication-controlled) and response to treatment. Your documentation establishes symptom frequency and types. Formal diagnosis and documentation of widespread pain pattern are essential.',
  };
};

/**
 * Analyze Tooth Loss logs for VA rating
 * DC 9913 - Loss of Teeth Due to Bone Loss
 */
export const analyzeToothLossLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const toothLossSymptoms = logs.filter(log =>
      CONDITIONS.TOOTH_LOSS.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (toothLossSymptoms.length === 0) {
    return {
      condition: 'Loss of Teeth Due to Bone Loss',
      diagnosticCode: '9913',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No tooth loss symptoms logged',
        'Document number of missing teeth',
        'Specify if tooth loss is from bone loss (trauma, osteomyelitis, disease)',
        'Note: Tooth loss from periodontal disease alone is NOT ratable',
        'Track prosthesis type and whether it restores chewing function',
      ],
      criteria: TOOTH_LOSS_CRITERIA,
      disclaimer: TOOTH_LOSS_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Check for dentalData with tooth count
  const logsWithToothCount = toothLossSymptoms.filter(log => log.dentalData?.toothCount);
  const logsWithProsthesis = toothLossSymptoms.filter(log => log.dentalData?.prosthesisType);
  const logsWithCause = toothLossSymptoms.filter(log => log.dentalData?.toothLossCause);

  // Get maximum tooth count from logs
  let maxToothCount = 0;
  let prosthesisRestores = null;
  let causedByBoneLoss = false;

  logsWithToothCount.forEach(log => {
    const count = parseInt(log.dentalData.toothCount);
    if (!isNaN(count) && count > maxToothCount) {
      maxToothCount = count;
    }
  });

  // Check prosthesis function
  if (logsWithProsthesis.length > 0) {
    const lastProsthesisLog = logsWithProsthesis[logsWithProsthesis.length - 1];
    prosthesisRestores = lastProsthesisLog.dentalData.prosthesisFunction === 'restores';
  }

  // Check if caused by bone loss
  if (logsWithCause.length > 0) {
    const causes = logsWithCause.map(log => log.dentalData.toothLossCause);
    causedByBoneLoss = causes.some(cause =>
        ['bone-loss-trauma', 'bone-loss-osteomyelitis', 'bone-loss-disease'].includes(cause)
    );
  }

  evidence.push(`${toothLossSymptoms.length} tooth loss symptoms logged over ${evaluationPeriodDays} days`);

  if (maxToothCount > 0) {
    evidence.push(`Maximum ${maxToothCount} missing teeth documented`);
  }

  if (causedByBoneLoss) {
    evidence.push('Tooth loss attributed to bone loss (trauma/osteomyelitis/disease)');
  }

  if (prosthesisRestores !== null) {
    evidence.push(prosthesisRestores ?
        'Prosthesis DOES restore chewing function (0% rating)' :
        'Prosthesis does NOT restore chewing function (higher rating)'
    );
  }

  // Determine rating based on tooth count and prosthesis function
  if (!causedByBoneLoss) {
    supportedRating = 'Not Ratable';
    ratingRationale.push(
        'CRITICAL: Tooth loss must be due to bone loss from trauma, osteomyelitis, or disease',
        'Tooth loss from periodontal disease alone is NOT compensable by the VA',
        'Document the underlying bone/jaw condition causing tooth loss'
    );
  } else if (prosthesisRestores === true) {
    supportedRating = '0';
    ratingRationale.push(
        `${maxToothCount} teeth lost due to bone loss`,
        'Prosthesis DOES restore masticatory function',
        'Compensable at 0% (documented but not disabling)'
    );
  } else if (maxToothCount === 32) {
    supportedRating = prosthesisRestores === false ? '40' : '30-40';
    ratingRationale.push(
        'Complete loss of all teeth',
        prosthesisRestores === false ?
            'Prosthesis does NOT restore function = 40%' :
            'Need to document if prosthesis restores function'
    );
  } else if (maxToothCount >= 16) {
    supportedRating = prosthesisRestores === false ? '30' : '20-30';
    ratingRationale.push(
        `Loss of ${maxToothCount} teeth (all upper OR all lower)`,
        prosthesisRestores === false ?
            'Prosthesis does NOT restore function = 30%' :
            'Need to document if prosthesis restores function'
    );
  } else if (maxToothCount >= 8) {
    supportedRating = prosthesisRestores === false ? '20' : '10-20';
    ratingRationale.push(
        `Loss of ${maxToothCount} teeth`,
        'Likely qualifies for 10-20% depending on location and prosthesis function'
    );
  } else if (maxToothCount > 0) {
    supportedRating = prosthesisRestores === false ? '10' : '0-10';
    ratingRationale.push(
        `Loss of ${maxToothCount} teeth`,
        'May qualify for 10% if prosthesis does not restore function'
    );
  }

  // Documentation gaps
  if (maxToothCount === 0) {
    gaps.push('Document the exact number of missing teeth');
  }

  if (!causedByBoneLoss) {
    gaps.push(' CRITICAL: Confirm tooth loss is due to bone loss (NOT periodontal disease)');
    gaps.push('Document underlying bone/jaw condition (trauma, osteomyelitis, radiation, tumor)');
  }

  if (prosthesisRestores === null) {
    gaps.push('Document whether prosthesis/denture restores chewing ability');
  }

  gaps.push('Specify tooth locations: anterior (front) vs. posterior (back)');
  gaps.push('Track dietary restrictions caused by tooth loss');
  gaps.push('Dental examination records are essential evidence');

  return {
    condition: 'Loss of Teeth Due to Bone Loss',
    diagnosticCode: '9913',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: TOOTH_LOSS_CRITERIA,
    disclaimer: TOOTH_LOSS_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Mandible Nonunion/Malunion logs for VA rating
 * DC 9903-9904 - Mandible Fracture Complications
 */
export const analyzeMandibleNonunionLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const mandibleSymptoms = logs.filter(log =>
      CONDITIONS.MANDIBLE_NONUNION.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (mandibleSymptoms.length === 0) {
    return {
      condition: 'Mandible Nonunion or Malunion',
      diagnosticCode: '9903-9904',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No mandible fracture symptoms logged',
        'Document jaw instability or deformity',
        'Track bite problems and chewing difficulty',
        'X-rays or CT scans showing nonunion/malunion are critical',
        'Surgical records from fracture repair',
      ],
      criteria: MANDIBLE_NONUNION_CRITERIA,
      disclaimer: MANDIBLE_NONUNION_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptom types
  const jawPainCount = mandibleSymptoms.filter(s => getLogSymptomId(s) === 'jaw-pain').length;
  const jawInstabilityCount = mandibleSymptoms.filter(s => getLogSymptomId(s) === 'jaw-instability').length;
  const chewingDifficultyCount = mandibleSymptoms.filter(s => getLogSymptomId(s) === 'chewing-difficulty').length;
  const facialAsymmetryCount = mandibleSymptoms.filter(s => getLogSymptomId(s) === 'facial-asymmetry').length;

  evidence.push(`${mandibleSymptoms.length} mandible symptoms logged over ${evaluationPeriodDays} days`);

  if (jawPainCount > 0) evidence.push(`${jawPainCount} jaw pain episodes`);
  if (jawInstabilityCount > 0) evidence.push(`${jawInstabilityCount} jaw instability episodes`);
  if (chewingDifficultyCount > 0) evidence.push(`${chewingDifficultyCount} chewing difficulty episodes`);
  if (facialAsymmetryCount > 0) evidence.push(`${facialAsymmetryCount} facial asymmetry episodes`);

  // Determine rating
  if (jawInstabilityCount >= 5 && chewingDifficultyCount >= 5) {
    supportedRating = '30';
    ratingRationale.push(
        `${jawInstabilityCount} jaw instability episodes indicate nonunion or severe malunion`,
        `${chewingDifficultyCount} episodes of chewing difficulty`,
        'Symptoms suggest marked functional impairment = 30%'
    );
  } else if (mandibleSymptoms.length >= 8 && (jawPainCount >= 5 || chewingDifficultyCount >= 3)) {
    supportedRating = '10';
    ratingRationale.push(
        `${mandibleSymptoms.length} documented symptoms`,
        'Moderate malunion with some functional impairment = 10%'
    );
  } else {
    supportedRating = '10';
    ratingRationale.push(
        'Mandible fracture complications documented',
        'Supports 10% rating for moderate malunion'
    );
  }

  // Documentation gaps
  gaps.push(' CRITICAL: X-rays or CT scans showing nonunion/malunion are required');
  gaps.push('Document jaw opening limitation if present');
  gaps.push('Track facial deformity and bite problems (malocclusion)');
  gaps.push('Surgical records from fracture treatment');

  if (jawInstabilityCount === 0) {
    gaps.push('Document jaw instability episodes if present');
  }

  if (chewingDifficultyCount < 5) {
    gaps.push('Log more chewing difficulty episodes to support higher rating');
  }

  return {
    condition: 'Mandible Nonunion or Malunion',
    diagnosticCode: '9903-9904',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: MANDIBLE_NONUNION_CRITERIA,
    disclaimer: MANDIBLE_NONUNION_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Malignant Oral Neoplasm logs for VA rating
 * DC 9918 - Malignant Oral Cancer
 */
export const analyzeMalignantOralNeoplasmLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const neoplasmSymptoms = logs.filter(log =>
      CONDITIONS.MALIGNANT_ORAL_NEOPLASM.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (neoplasmSymptoms.length === 0) {
    return {
      condition: 'Malignant Neoplasm of Oral Cavity',
      diagnosticCode: '9918',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No oral neoplasm symptoms logged',
        'Document oral masses, growths, or tissue changes',
        'Biopsy results confirming malignancy',
        'All treatment dates (surgery, chemo, radiation)',
        'Track side effects and residual impairments',
      ],
      criteria: MALIGNANT_ORAL_NEOPLASM_CRITERIA,
      disclaimer: MALIGNANT_ORAL_NEOPLASM_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Check for treatment status in dentalData
  let activeTreatment = false;
  let malignant = false;

  const logsWithMassData = neoplasmSymptoms.filter(log => log.dentalData?.oralMass);
  if (logsWithMassData.length > 0) {
    const latestLog = logsWithMassData[logsWithMassData.length - 1];
    malignant = latestLog.dentalData.massBiopsy === 'malignant';
    activeTreatment = ['active-treatment', 'post-surgical'].includes(latestLog.dentalData.treatmentStatus);
  }

  evidence.push(`${neoplasmSymptoms.length} oral neoplasm symptoms logged over ${evaluationPeriodDays} days`);

  if (malignant) {
    evidence.push('Biopsy confirmed malignant (cancerous)');
  }

  if (activeTreatment) {
    evidence.push('Currently in active treatment or recently post-surgical');
  }

  // Determine rating
  if (malignant && activeTreatment) {
    supportedRating = '100';
    ratingRationale.push(
        ' Malignant oral cancer = AUTOMATIC 100% rating',
        '100% during active treatment AND for 6 months after completion',
        'Document all treatment dates carefully',
        'After 6-month period, rate based on residual effects'
    );
  } else if (malignant) {
    supportedRating = 'Varies';
    ratingRationale.push(
        'Malignant oral cancer confirmed',
        'If in active treatment or within 6 months post-treatment: 100%',
        'If >6 months post-treatment: rate based on residuals',
        'Residuals include: tissue loss, scarring, difficulty swallowing/speaking, TMJ dysfunction'
    );
  } else {
    supportedRating = 'Requires Evaluation';
    ratingRationale.push(
        'Oral mass documented',
        'Biopsy results needed to determine malignancy',
        'Rating depends on whether mass is malignant or benign'
    );
  }

  // Documentation gaps
  if (!malignant) {
    gaps.push(' CRITICAL: Biopsy results needed to confirm malignancy');
  }

  gaps.push('Document all treatment dates: surgery, chemotherapy, radiation');
  gaps.push('Track side effects: pain, difficulty eating/speaking, weight loss');
  gaps.push('After treatment, document residual effects (tissue loss, scarring, function)');
  gaps.push('Oncology records and treatment summaries are essential');

  if (malignant) {
    gaps.push('If recurrence occurs, this restarts the 100% rating period');
  }

  return {
    condition: 'Malignant Neoplasm of Oral Cavity',
    diagnosticCode: '9918',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: MALIGNANT_ORAL_NEOPLASM_CRITERIA,
    disclaimer: MALIGNANT_ORAL_NEOPLASM_CRITERIA.disclaimer,
  };
};

/**
 * Analyze Benign Oral Neoplasm logs for VA rating
 * DC 9917 - Benign (Non-cancerous) Oral Tumors
 */
export const analyzeBenignOralNeoplasmLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const neoplasmSymptoms = logs.filter(log =>
      CONDITIONS.BENIGN_ORAL_NEOPLASM.symptomIds.includes(getLogSymptomId(log)) &&
      isWithinEvaluationPeriod(log.timestamp, evaluationPeriodDays)
  );

  if (neoplasmSymptoms.length === 0) {
    return {
      condition: 'Benign Neoplasm of Oral Cavity',
      diagnosticCode: '9917',
      hasData: false,
      supportedRating: null,
      ratingRationale: [],
      evidence: [],
      gaps: [
        'No oral neoplasm symptoms logged',
        'Document oral masses, growths, or tissue changes',
        'Biopsy results confirming benign status',
        'Track impact on chewing, swallowing, speaking',
        'Document size and location of mass',
      ],
      criteria: BENIGN_ORAL_NEOPLASM_CRITERIA,
      disclaimer: BENIGN_ORAL_NEOPLASM_CRITERIA.disclaimer,
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Check for mass data
  let benign = false;
  let massLocation = '';

  const logsWithMassData = neoplasmSymptoms.filter(log => log.dentalData?.oralMass);
  if (logsWithMassData.length > 0) {
    const latestLog = logsWithMassData[logsWithMassData.length - 1];
    benign = latestLog.dentalData.massBiopsy === 'benign';
    massLocation = latestLog.dentalData.massLocation || '';
  }

  evidence.push(`${neoplasmSymptoms.length} oral neoplasm symptoms logged over ${evaluationPeriodDays} days`);

  if (benign) {
    evidence.push('Biopsy confirmed benign (non-cancerous)');
  }

  if (massLocation) {
    evidence.push(`Mass location documented: ${massLocation}`);
  }

  // Determine rating
  if (benign) {
    supportedRating = 'Varies';
    ratingRationale.push(
        'Benign oral neoplasm confirmed',
        'No automatic 100% rating (unlike malignant)',
        'Rate based on functional impairment:',
        '   Tissue loss/bone damage (DC 9900-9916)',
        '   TMJ dysfunction if present (DC 9905)',
        '   Tooth loss if applicable (DC 9913)',
        '   Disfigurement (DC 7800)',
        '   Speech/swallowing difficulty'
    );
  } else {
    supportedRating = 'Requires Evaluation';
    ratingRationale.push(
        'Oral mass documented',
        'Biopsy results needed to confirm benign status',
        'Rating depends on functional effects of the mass'
    );
  }

  // Documentation gaps
  if (!benign) {
    gaps.push('Biopsy results needed to confirm benign (non-cancerous) status');
  }

  gaps.push('Document impact on eating, speaking, and appearance');
  gaps.push('Imaging studies (CT, MRI) showing size and location');
  gaps.push('Track pain or discomfort from the mass');
  gaps.push('If surgically removed, document residual effects');

  if (benign) {
    gaps.push('Benign tumors rated based on functional impairment, not just presence');
    gaps.push('May need multiple diagnostic codes for various impairments');
  }

  return {
    condition: 'Benign Neoplasm of Oral Cavity',
    diagnosticCode: '9917',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    criteria: BENIGN_ORAL_NEOPLASM_CRITERIA,
    disclaimer: BENIGN_ORAL_NEOPLASM_CRITERIA.disclaimer,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - PHASE 6: INFECTIOUS DISEASES
// ============================================

/**
 * Analyzes HIV/AIDS logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6351
 */
export const analyzeHIVLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const hivLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
      CONDITIONS.HIV_AIDS.symptomIds.includes(getLogSymptomId(log)) ||
      getLogSymptomId(log)?.includes('hiv')
    );
  });

  if (hivLogs.length === 0) {
    return {
      condition: 'HIV-Related Illness',
      diagnosticCode: '6351',
      hasData: false,
      message: 'No HIV-related symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging HIV-related symptoms',
        'Document constitutional symptoms (fever, night sweats, fatigue)',
        'Track opportunistic infections',
        'Record weight changes',
        'Note CD4 count and viral load from lab results',
        'Document antiretroviral medications',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptom types
  const symptomCounts = {
    opportunisticInfections: 0,
    nightSweats: 0,
    persistentFever: 0,
    weightLoss: 0,
    chronicDiarrhea: 0,
    oralThrush: 0,
    skinLesions: 0,
    lymphadenopathy: 0,
    fatigue: 0,
    cognitiveImpairment: 0,
  };

  // Check for HIV-specific form data
  let hasOpportunisticInfection = false;
  let infectionType = null;
  let hasConstitutionalSymptoms = false;
  let onAntiretrovirals = false;
  let weightLossPercentage = 0;

  hivLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    // Count symptoms
    if (symptomId === 'hiv-opportunistic-infection') {
      symptomCounts.opportunisticInfections++;
      if (log.hivData?.infectionType) {
        hasOpportunisticInfection = true;
        infectionType = log.hivData.infectionType;
      }
    }
    if (symptomId === 'hiv-night-sweats') symptomCounts.nightSweats++;
    if (symptomId === 'hiv-persistent-fever') symptomCounts.persistentFever++;
    if (symptomId === 'hiv-weight-loss') {
      symptomCounts.weightLoss++;
      if (log.hivData?.weightLossPercentage) {
        weightLossPercentage = Math.max(weightLossPercentage, parseFloat(log.hivData.weightLossPercentage));
      }
    }
    if (symptomId === 'hiv-chronic-diarrhea') symptomCounts.chronicDiarrhea++;
    if (symptomId === 'hiv-oral-thrush') symptomCounts.oralThrush++;
    if (symptomId === 'hiv-skin-lesions') symptomCounts.skinLesions++;
    if (symptomId === 'hiv-lymphadenopathy') symptomCounts.lymphadenopathy++;
    if (symptomId === 'hiv-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'hiv-cognitive-impairment') symptomCounts.cognitiveImpairment++;

    // Check for constitutional symptoms
    if (log.hivData?.constitutionalSymptoms?.length > 0) {
      hasConstitutionalSymptoms = true;
    }

    // Check for antiretroviral treatment
    if (log.hivData?.onAntiretrovirals) {
      onAntiretrovirals = true;
    }
  });

  const totalConstitutionalSymptoms =
    symptomCounts.nightSweats +
    symptomCounts.persistentFever +
    symptomCounts.weightLoss +
    symptomCounts.chronicDiarrhea +
    symptomCounts.fatigue;

  evidence.push(`${hivLogs.length} HIV-related symptoms logged over ${evaluationPeriodDays} days`);

  // Determine rating based on VA criteria

  // 100% Rating: Recurrent opportunistic infections OR debilitating symptoms with pathological weight loss
  if (hasOpportunisticInfection && symptomCounts.opportunisticInfections >= 2) {
    supportedRating = 100;
    ratingRationale.push(
      'Recurrent opportunistic infections documented',
      `${symptomCounts.opportunisticInfections} opportunistic infection episodes logged`,
      'Meets criteria for 100% rating under DC 6351'
    );
    evidence.push(`Opportunistic infection type: ${infectionType}`);
    evidence.push('Recurrent infections indicate severe immunosuppression');
  } else if (
    weightLossPercentage >= 10 &&
    totalConstitutionalSymptoms >= 15 &&
    (symptomCounts.chronicDiarrhea >= 5 || symptomCounts.fatigue >= 10)
  ) {
    supportedRating = 100;
    ratingRationale.push(
      'Pathological weight loss (>=10% body weight) with debilitating constitutional symptoms',
      `Weight loss: ${weightLossPercentage}% documented`,
      `${totalConstitutionalSymptoms} constitutional symptoms over evaluation period`,
      'Chronic diarrhea and/or severe fatigue documented',
      'Meets criteria for 100% rating'
    );
    evidence.push(`Pathological weight loss: ${weightLossPercentage}%`);
  }

  // 60% Rating: Refractory constitutional symptoms OR post-opportunistic infection
  else if (
    (hasOpportunisticInfection && symptomCounts.opportunisticInfections === 1) ||
    (totalConstitutionalSymptoms >= 10 && (symptomCounts.chronicDiarrhea >= 3 || weightLossPercentage >= 5))
  ) {
    supportedRating = 60;
    ratingRationale.push(
      hasOpportunisticInfection
        ? 'Minimum 60% rating following documented opportunistic infection'
        : 'Refractory constitutional symptoms with intermittent diarrhea',
      'Frequent constitutional symptoms documented',
      weightLossPercentage >= 5 ? `Significant weight loss: ${weightLossPercentage}%` : '',
      'Meets criteria for 60% rating'
    ).filter(Boolean);

    if (hasOpportunisticInfection) {
      evidence.push(`Opportunistic infection: ${infectionType}`);
    }
  }

  // 30% Rating: Recurrent constitutional symptoms, intermittent diarrhea, on antiretrovirals
  else if (
    totalConstitutionalSymptoms >= 5 ||
    onAntiretrovirals ||
    (symptomCounts.chronicDiarrhea >= 2 && hasConstitutionalSymptoms)
  ) {
    supportedRating = 30;
    ratingRationale.push(...[
      'Recurrent constitutional symptoms documented',
      onAntiretrovirals ? 'Use of FDA-approved antiretroviral medications' : '',
      symptomCounts.chronicDiarrhea >= 2 ? 'Intermittent diarrhea episodes' : '',
      'Meets criteria for 30% minimum rating'
    ].filter(Boolean));

    if (onAntiretrovirals) {
      evidence.push('On antiretroviral therapy');
    }
  }

  // 10% Rating: Mild constitutional symptoms following diagnosis
  else if (totalConstitutionalSymptoms >= 2 || symptomCounts.cognitiveImpairment > 0) {
    supportedRating = 10;
    ratingRationale.push(
      'Constitutional symptoms following HIV diagnosis',
      symptomCounts.cognitiveImpairment > 0 ? 'Cognitive impairment/memory loss documented' : '',
      'Meets criteria for 10% rating'
    ).filter(Boolean);
  }

  // 0% Rating: Asymptomatic but diagnosed
  else {
    supportedRating = 0;
    ratingRationale.push(
      'HIV diagnosis with minimal symptoms',
      'May have lymphadenopathy but otherwise asymptomatic',
      '0% (asymptomatic) rating'
    );
  }

  // Add symptom evidence
  if (symptomCounts.opportunisticInfections > 0) {
    evidence.push(`${symptomCounts.opportunisticInfections} opportunistic infection(s) logged`);
  }
  if (symptomCounts.nightSweats > 0) {
    evidence.push(`${symptomCounts.nightSweats} night sweats episodes`);
  }
  if (symptomCounts.persistentFever > 0) {
    evidence.push(`${symptomCounts.persistentFever} persistent fever episodes`);
  }
  if (symptomCounts.weightLoss > 0) {
    evidence.push(`${symptomCounts.weightLoss} weight loss episodes (${weightLossPercentage}% max)`);
  }
  if (symptomCounts.chronicDiarrhea > 0) {
    evidence.push(`${symptomCounts.chronicDiarrhea} chronic diarrhea episodes`);
  }
  if (symptomCounts.oralThrush > 0) {
    evidence.push(`${symptomCounts.oralThrush} oral thrush occurrences`);
  }
  if (symptomCounts.skinLesions > 0) {
    evidence.push(`${symptomCounts.skinLesions} skin lesions documented`);
  }
  if (symptomCounts.lymphadenopathy > 0) {
    evidence.push(`${symptomCounts.lymphadenopathy} swollen lymph node episodes`);
  }
  if (symptomCounts.fatigue > 0) {
    evidence.push(`${symptomCounts.fatigue} severe fatigue episodes`);
  }
  if (symptomCounts.cognitiveImpairment > 0) {
    evidence.push(`${symptomCounts.cognitiveImpairment} cognitive impairment episodes`);
  }

  // Evidence gaps
  gaps.push('Track CD4 count and viral load from lab results (use Measurements tab)');
  gaps.push('Document all medications, especially antiretrovirals');

  if (symptomCounts.opportunisticInfections === 0) {
    gaps.push('Document any opportunistic infections (PCP, CMV, MAC, toxoplasmosis, etc.)');
  }

  if (!hasConstitutionalSymptoms && totalConstitutionalSymptoms < 5) {
    gaps.push('Log constitutional symptoms consistently (fever, night sweats, fatigue)');
  }

  if (weightLossPercentage === 0) {
    gaps.push('Track body weight changes over time');
  }

  if (!onAntiretrovirals && supportedRating < 30) {
    gaps.push('Document antiretroviral medication regimen if applicable');
  }

  gaps.push('Medical records documenting HIV diagnosis and treatment history');
  gaps.push('Regular CD4 counts and viral load measurements');

  if (supportedRating >= 60) {
    gaps.push('Document impact on daily activities and work capacity');
    gaps.push('Note any hospitalizations for opportunistic infections');
  }

  return {
    condition: 'HIV-Related Illness',
    diagnosticCode: '6351',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: hivLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      hasOpportunisticInfection,
      onAntiretrovirals,
      weightLossPercentage,
    },
  };
};

/**
 * Analyzes Hepatitis C logs to determine supported rating level
 * Based on 38 CFR 4.114, DC 7354
 */
export const analyzeHepatitisCLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const hepCLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.HEPATITIS_C.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('hep')
    );
  });

  if (hepCLogs.length === 0) {
    return {
      condition: 'Hepatitis C',
      diagnosticCode: '7354',
      hasData: false,
      message: 'No Hepatitis C symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging hepatitis symptoms',
        'Document fatigue and malaise frequency',
        'Track weight changes over time',
        'Note dietary restrictions and appetite changes',
        'Record liver enzyme values from lab work',
        'Document impact on daily activities',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  // Count symptom types
  const symptomCounts = {
    fatigue: 0,
    malaise: 0,
    nausea: 0,
    abdominalPain: 0,
    jaundice: 0,
    darkUrine: 0,
    appetiteLoss: 0,
    jointPain: 0,
    cognitiveIssues: 0,
    liverTenderness: 0,
  };

  let weightLossPercentage = 0;
  let debilitating = false;
  let dietaryRestrictions = false;

  hepCLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'hep-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'hep-malaise') symptomCounts.malaise++;
    if (symptomId === 'hep-nausea') symptomCounts.nausea++;
    if (symptomId === 'hep-abdominal-pain') symptomCounts.abdominalPain++;
    if (symptomId === 'hep-jaundice') symptomCounts.jaundice++;
    if (symptomId === 'hep-dark-urine') symptomCounts.darkUrine++;
    if (symptomId === 'hep-appetite-loss') symptomCounts.appetiteLoss++;
    if (symptomId === 'hep-joint-pain') symptomCounts.jointPain++;
    if (symptomId === 'hep-cognitive-issues') symptomCounts.cognitiveIssues++;
    if (symptomId === 'hep-liver-tenderness') symptomCounts.liverTenderness++;

    if (log.hepatitisData?.weightLossPercentage) {
      weightLossPercentage = Math.max(weightLossPercentage, parseFloat(log.hepatitisData.weightLossPercentage));
    }
    if (log.hepatitisData?.debilitating) {
      debilitating = true;
    }
    if (log.hepatitisData?.dietaryRestrictions) {
      dietaryRestrictions = true;
    }
  });

  const totalSymptomCount = Object.values(symptomCounts).reduce((a, b) => a + b, 0);
  const daysWithSymptoms = hepCLogs.length;
  const dailySymptoms = daysWithSymptoms >= evaluationPeriodDays * 0.7; // 70% of days
  const intermittentSymptoms = daysWithSymptoms >= evaluationPeriodDays * 0.2; // 20% of days

  evidence.push(`${hepCLogs.length} Hepatitis C symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (debilitating && dailySymptoms && (symptomCounts.fatigue >= 50 || symptomCounts.malaise >= 50)) {
    supportedRating = 100;
    ratingRationale.push(
        'Near-constant debilitating symptoms documented',
        `Severe fatigue/malaise: ${symptomCounts.fatigue + symptomCounts.malaise} episodes`,
        'Daily symptoms with substantial lifestyle impact',
        'Meets criteria for 100% rating'
    );
  } else if (dailySymptoms && weightLossPercentage >= 10) {
    supportedRating = 60;
    ratingRationale.push(
        'Daily fatigue and malaise with substantial weight loss',
        `Weight loss: ${weightLossPercentage}% documented`,
        `Symptoms present on ${daysWithSymptoms} days`,
        'Meets criteria for 60% rating'
    );
  } else if (dailySymptoms && (weightLossPercentage >= 5 || symptomCounts.appetiteLoss >= 30)) {
    supportedRating = 30;
    ratingRationale.push(
        'Daily fatigue and malaise documented',
        weightLossPercentage > 0 ? `Minor weight loss: ${weightLossPercentage}%` : 'Appetite loss with near-normal weight',
        dietaryRestrictions ? 'Dietary restrictions required' : '',
        'Meets criteria for 30% rating'
    ).filter(Boolean);
  } else if (intermittentSymptoms) {
    supportedRating = 10;
    ratingRationale.push(
        'Intermittent fatigue and malaise',
        `Symptoms on ${daysWithSymptoms} days over ${evaluationPeriodDays} days`,
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Hepatitis C diagnosed but minimal symptoms',
        'Nonsymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.fatigue > 0) evidence.push(`${symptomCounts.fatigue} fatigue episodes`);
  if (symptomCounts.malaise > 0) evidence.push(`${symptomCounts.malaise} malaise episodes`);
  if (symptomCounts.nausea > 0) evidence.push(`${symptomCounts.nausea} nausea episodes`);
  if (symptomCounts.abdominalPain > 0) evidence.push(`${symptomCounts.abdominalPain} abdominal pain episodes`);
  if (symptomCounts.jaundice > 0) evidence.push(`${symptomCounts.jaundice} jaundice occurrences`);
  if (weightLossPercentage > 0) evidence.push(`Weight loss: ${weightLossPercentage}%`);
  if (debilitating) evidence.push('Debilitating symptoms documented');

  // Gaps
  if (symptomCounts.fatigue + symptomCounts.malaise < 20) {
    gaps.push('Log fatigue and malaise more consistently');
  }
  if (weightLossPercentage === 0) {
    gaps.push('Track weight changes over time for rating evidence');
  }
  if (!dietaryRestrictions && symptomCounts.appetiteLoss > 0) {
    gaps.push('Document any dietary restrictions or modifications');
  }
  gaps.push('Track liver enzyme levels (ALT, AST, bilirubin) via Measurements tab');
  gaps.push('Document impact on work and daily activities');
  gaps.push('Note treatment regimen and side effects');

  return {
    condition: 'Hepatitis C',
    diagnosticCode: '7354',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: hepCLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      weightLossPercentage,
      debilitating,
      dailySymptoms,
    },
  };
};

/**
 * Analyzes Hepatitis B logs to determine supported rating level
 * Based on 38 CFR 4.114, DC 7314
 */
export const analyzeHepatitisBLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const hepBLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.HEPATITIS_B.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('hep')
    );
  });

  if (hepBLogs.length === 0) {
    return {
      condition: 'Hepatitis B',
      diagnosticCode: '7314',
      hasData: false,
      message: 'No Hepatitis B symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging hepatitis symptoms',
        'Document fatigue and malaise frequency',
        'Track weight changes over time',
        'Note dietary restrictions and appetite changes',
        'Record liver enzyme values from lab work',
        'Document impact on daily activities',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    fatigue: 0,
    malaise: 0,
    nausea: 0,
    abdominalPain: 0,
    jaundice: 0,
    darkUrine: 0,
    appetiteLoss: 0,
    jointPain: 0,
    cognitiveIssues: 0,
    liverTenderness: 0,
  };

  let weightLossPercentage = 0;
  let debilitating = false;
  let dietaryRestrictions = false;

  hepBLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'hep-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'hep-malaise') symptomCounts.malaise++;
    if (symptomId === 'hep-nausea') symptomCounts.nausea++;
    if (symptomId === 'hep-abdominal-pain') symptomCounts.abdominalPain++;
    if (symptomId === 'hep-jaundice') symptomCounts.jaundice++;
    if (symptomId === 'hep-dark-urine') symptomCounts.darkUrine++;
    if (symptomId === 'hep-appetite-loss') symptomCounts.appetiteLoss++;
    if (symptomId === 'hep-joint-pain') symptomCounts.jointPain++;
    if (symptomId === 'hep-cognitive-issues') symptomCounts.cognitiveIssues++;
    if (symptomId === 'hep-liver-tenderness') symptomCounts.liverTenderness++;

    if (log.hepatitisData?.weightLossPercentage) {
      weightLossPercentage = Math.max(weightLossPercentage, parseFloat(log.hepatitisData.weightLossPercentage));
    }
    if (log.hepatitisData?.debilitating) {
      debilitating = true;
    }
    if (log.hepatitisData?.dietaryRestrictions) {
      dietaryRestrictions = true;
    }
  });

  const totalSymptomCount = Object.values(symptomCounts).reduce((a, b) => a + b, 0);
  const daysWithSymptoms = hepBLogs.length;
  const dailySymptoms = daysWithSymptoms >= evaluationPeriodDays * 0.7;
  const intermittentSymptoms = daysWithSymptoms >= evaluationPeriodDays * 0.2;

  evidence.push(`${hepBLogs.length} Hepatitis B symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination (same logic as Hep C)
  if (debilitating && dailySymptoms && (symptomCounts.fatigue >= 50 || symptomCounts.malaise >= 50)) {
    supportedRating = 100;
    ratingRationale.push(
        'Near-constant debilitating symptoms documented',
        `Severe fatigue/malaise: ${symptomCounts.fatigue + symptomCounts.malaise} episodes`,
        'Daily symptoms with substantial lifestyle impact',
        'Meets criteria for 100% rating'
    );
  } else if (dailySymptoms && weightLossPercentage >= 10) {
    supportedRating = 60;
    ratingRationale.push(
        'Daily fatigue and malaise with substantial weight loss',
        `Weight loss: ${weightLossPercentage}% documented`,
        `Symptoms present on ${daysWithSymptoms} days`,
        'Meets criteria for 60% rating'
    );
  } else if (dailySymptoms && (weightLossPercentage >= 5 || symptomCounts.appetiteLoss >= 30)) {
    supportedRating = 30;
    ratingRationale.push(...[
      'Daily fatigue and malaise documented',
      weightLossPercentage > 0 ? `Minor weight loss: ${weightLossPercentage}%` : 'Appetite loss with near-normal weight',
      dietaryRestrictions ? 'Dietary restrictions required' : '',
      'Meets criteria for 30% rating'
    ].filter(Boolean));
  } else if (intermittentSymptoms) {
    supportedRating = 10;
    ratingRationale.push(
        'Intermittent fatigue and malaise',
        `Symptoms on ${daysWithSymptoms} days over ${evaluationPeriodDays} days`,
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Hepatitis B diagnosed but minimal symptoms',
        'Nonsymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.fatigue > 0) evidence.push(`${symptomCounts.fatigue} fatigue episodes`);
  if (symptomCounts.malaise > 0) evidence.push(`${symptomCounts.malaise} malaise episodes`);
  if (symptomCounts.nausea > 0) evidence.push(`${symptomCounts.nausea} nausea episodes`);
  if (symptomCounts.jaundice > 0) evidence.push(`${symptomCounts.jaundice} jaundice occurrences`);
  if (weightLossPercentage > 0) evidence.push(`Weight loss: ${weightLossPercentage}%`);
  if (debilitating) evidence.push('Debilitating symptoms documented');

  // Gaps
  if (symptomCounts.fatigue + symptomCounts.malaise < 20) {
    gaps.push('Log fatigue and malaise more consistently');
  }
  if (weightLossPercentage === 0) {
    gaps.push('Track weight changes over time');
  }
  gaps.push('Track liver enzyme levels via Measurements tab');
  gaps.push('Document impact on work and daily activities');
  gaps.push('Note treatment regimen and compliance');

  return {
    condition: 'Hepatitis B',
    diagnosticCode: '7314',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: hepBLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      weightLossPercentage,
      debilitating,
      dailySymptoms,
    },
  };
};

/**
 * Analyzes Lyme Disease logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6319
 */
export const analyzeLymeDiseaseLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const lymeLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.LYME_DISEASE.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('lyme')
    );
  });

  if (lymeLogs.length === 0) {
    return {
      condition: 'Lyme Disease',
      diagnosticCode: '6319',
      hasData: false,
      message: 'No Lyme disease symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging Lyme disease symptoms',
        'Document active treatment if currently undergoing',
        'Track residual symptoms after treatment',
        'Note neurological symptoms (numbness, pain, cognitive issues)',
        'Document joint pain and arthritis symptoms',
        'Record any cardiac symptoms',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    rash: 0,
    fever: 0,
    headache: 0,
    fatigue: 0,
    jointPain: 0,
    muscleAches: 0,
    nervePain: 0,
    cognitive: 0,
    heartPalpitations: 0,
    facialParalysis: 0,
  };

  let activeTreatment = false;
  let treatmentCompleted = false;
  let hasNeurologicalSymptoms = false;
  let hasArthritisSymptoms = false;

  lymeLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'lyme-rash') symptomCounts.rash++;
    if (symptomId === 'lyme-fever') symptomCounts.fever++;
    if (symptomId === 'lyme-headache') symptomCounts.headache++;
    if (symptomId === 'lyme-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'lyme-joint-pain') {
      symptomCounts.jointPain++;
      hasArthritisSymptoms = true;
    }
    if (symptomId === 'lyme-muscle-aches') symptomCounts.muscleAches++;
    if (symptomId === 'lyme-nerve-pain') {
      symptomCounts.nervePain++;
      hasNeurologicalSymptoms = true;
    }
    if (symptomId === 'lyme-cognitive') {
      symptomCounts.cognitive++;
      hasNeurologicalSymptoms = true;
    }
    if (symptomId === 'lyme-heart-palpitations') symptomCounts.heartPalpitations++;
    if (symptomId === 'lyme-facial-paralysis') {
      symptomCounts.facialParalysis++;
      hasNeurologicalSymptoms = true;
    }

    if (log.lymeData?.activeTreatment) {
      activeTreatment = true;
    }
    if (log.lymeData?.treatmentCompleted) {
      treatmentCompleted = true;
    }
  });

  evidence.push(`${lymeLogs.length} Lyme disease symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (activeTreatment) {
    supportedRating = 100;
    ratingRationale.push(
        'Active Lyme disease requiring treatment',
        'Minimum 100% rating during active treatment period (6 months)',
        'After treatment, residuals rated by affected body system',
        'Meets criteria for 100% rating'
    );
    evidence.push('Currently undergoing active antibiotic treatment');
  } else if (treatmentCompleted) {
    supportedRating = 'Residuals';
    ratingRationale.push(
        'Treatment for Lyme disease completed',
        'Rate residual symptoms under appropriate body system codes:',
        hasNeurologicalSymptoms ? '   Neurological symptoms (peripheral neuropathy, cognitive issues)' : '',
        hasArthritisSymptoms ? '   Joint symptoms (arthritis codes)' : '',
        symptomCounts.fatigue > 30 ? '   Chronic fatigue syndrome' : '',
        'Consult multiple diagnostic codes for comprehensive rating'
    ).filter(Boolean);
    evidence.push('Post-treatment Lyme disease syndrome (PTLDS)');
  } else {
    supportedRating = 'Requires Evaluation';
    ratingRationale.push(
        'Lyme disease symptoms documented',
        'Determine if currently in active treatment phase',
        'If post-treatment, rate residuals by body system',
        'Active treatment = 100% minimum for 6 months'
    );
  }

  // Evidence
  if (symptomCounts.rash > 0) evidence.push(`${symptomCounts.rash} rash occurrences (bull's-eye)`);
  if (symptomCounts.nervePain > 0) evidence.push(`${symptomCounts.nervePain} nerve pain episodes`);
  if (symptomCounts.cognitive > 0) evidence.push(`${symptomCounts.cognitive} cognitive impairment episodes`);
  if (symptomCounts.jointPain > 0) evidence.push(`${symptomCounts.jointPain} joint pain episodes`);
  if (symptomCounts.fatigue > 0) evidence.push(`${symptomCounts.fatigue} fatigue episodes`);
  if (symptomCounts.facialParalysis > 0) evidence.push(`${symptomCounts.facialParalysis} facial paralysis occurrences`);

  // Gaps
  if (!activeTreatment && !treatmentCompleted) {
    gaps.push('Clarify treatment status: active treatment or post-treatment?');
  }
  if (hasNeurologicalSymptoms) {
    gaps.push('Document neurological residuals for separate rating (DC 8520 or appropriate code)');
  }
  if (hasArthritisSymptoms) {
    gaps.push('Document joint symptoms for arthritis rating (appropriate joint DC)');
  }
  if (symptomCounts.fatigue > 30) {
    gaps.push('Consider chronic fatigue syndrome rating if fatigue persists post-treatment');
  }
  gaps.push('Medical records showing Lyme diagnosis (Western blot, ELISA)');
  gaps.push('Treatment records (antibiotics type, duration, completion date)');
  gaps.push('Specialist evaluations for persistent symptoms');

  return {
    condition: 'Lyme Disease',
    diagnosticCode: '6319',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: lymeLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      activeTreatment,
      treatmentCompleted,
      hasNeurologicalSymptoms,
      hasArthritisSymptoms,
    },
  };
};

/**
 * Analyzes Malaria logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6304
 */
export const analyzeMalariaLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const malariaLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.MALARIA.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('malaria')
    );
  });

  if (malariaLogs.length === 0) {
    return {
      condition: 'Malaria',
      diagnosticCode: '6304',
      hasData: false,
      message: 'No malaria symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging malaria symptoms',
        'Document fever episodes with temperatures',
        'Track cyclical fever pattern (every 48-72 hours typical)',
        'Note any relapse episodes',
        'Record treatment medications',
        'Lab work confirming parasitemia if available',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    fever: 0,
    chills: 0,
    sweats: 0,
    headache: 0,
    muscleAches: 0,
    nausea: 0,
    fatigue: 0,
    jaundice: 0,
    anemia: 0,
    enlargedSpleen: 0,
  };

  let relapseCount = 0;
  let hospitalized = false;
  let continuousMedication = false;
  let severeComplications = false;

  malariaLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'malaria-fever') symptomCounts.fever++;
    if (symptomId === 'malaria-chills') symptomCounts.chills++;
    if (symptomId === 'malaria-sweats') symptomCounts.sweats++;
    if (symptomId === 'malaria-headache') symptomCounts.headache++;
    if (symptomId === 'malaria-muscle-aches') symptomCounts.muscleAches++;
    if (symptomId === 'malaria-nausea') symptomCounts.nausea++;
    if (symptomId === 'malaria-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'malaria-jaundice') {
      symptomCounts.jaundice++;
      severeComplications = true;
    }
    if (symptomId === 'malaria-anemia') symptomCounts.anemia++;
    if (symptomId === 'malaria-enlarged-spleen') symptomCounts.enlargedSpleen++;

    if (log.malariaData?.relapseEpisode) relapseCount++;
    if (log.malariaData?.hospitalized) hospitalized = true;
    if (log.malariaData?.continuousMedication) continuousMedication = true;
    if (log.malariaData?.severeComplications) severeComplications = true;
  });

  const totalSymptoms = Object.values(symptomCounts).reduce((a, b) => a + b, 0);
  const daysWithSymptoms = malariaLogs.length;

  evidence.push(`${malariaLogs.length} malaria symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (hospitalized || severeComplications || (continuousMedication && daysWithSymptoms >= 60)) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Active severe malaria requiring treatment',
      hospitalized ? 'Hospitalization documented' : '',
      severeComplications ? 'Severe complications present (jaundice/organ involvement)' : '',
      continuousMedication ? 'Continuous antimalarial medication required' : '',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (relapseCount >= 3 || (symptomCounts.fever >= 20 && daysWithSymptoms >= 30)) {
    supportedRating = 60;
    ratingRationale.push(...[
      'Frequent relapses with debilitating symptoms',
      `${relapseCount} relapse episodes documented`,
      `Fever episodes: ${symptomCounts.fever}`,
      symptomCounts.anemia > 5 ? 'Chronic anemia documented' : '',
      'Meets criteria for 60% rating'
    ].filter(Boolean));
  } else if (relapseCount >= 1 || daysWithSymptoms >= 15) {
    supportedRating = 30;
    ratingRationale.push(...[
      'Occasional relapses or chronic residual symptoms',
      relapseCount > 0 ? `${relapseCount} relapse episode(s) documented` : '',
      `Symptoms present on ${daysWithSymptoms} days`,
      symptomCounts.enlargedSpleen > 0 ? 'Splenomegaly documented' : '',
      'Meets criteria for 30% rating'
    ].filter(Boolean));
  } else if (daysWithSymptoms >= 3) {
    supportedRating = 10;
    ratingRationale.push(
        'Residual symptoms or minimal impact',
        `Symptoms on ${daysWithSymptoms} days`,
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Malaria treated, minimal current symptoms',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.fever > 0) evidence.push(`${symptomCounts.fever} fever episodes`);
  if (symptomCounts.chills > 0) evidence.push(`${symptomCounts.chills} episodes of chills`);
  if (symptomCounts.sweats > 0) evidence.push(`${symptomCounts.sweats} night sweats episodes`);
  if (symptomCounts.jaundice > 0) evidence.push(`${symptomCounts.jaundice} jaundice occurrences (severe complication)`);
  if (symptomCounts.anemia > 0) evidence.push(`${symptomCounts.anemia} anemia episodes`);
  if (relapseCount > 0) evidence.push(`${relapseCount} documented relapses`);

  // Gaps
  if (symptomCounts.fever < 5) {
    gaps.push('Log fever episodes consistently with temperature readings');
  }
  if (relapseCount === 0 && daysWithSymptoms > 10) {
    gaps.push('Document if symptoms represent relapse or initial infection');
  }
  gaps.push('Lab work: blood smear or rapid diagnostic test confirming parasitemia');
  gaps.push('Document antimalarial medications (chloroquine, artemisinin, primaquine)');
  gaps.push('Note cyclical pattern if fever occurs every 48-72 hours');
  if (symptomCounts.anemia > 0 || symptomCounts.jaundice > 0) {
    gaps.push('CBC and liver function tests to document severity');
  }

  return {
    condition: 'Malaria',
    diagnosticCode: '6304',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: malariaLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      relapseCount,
      hospitalized,
      severeComplications,
    },
  };
};

/**
 * Analyzes Brucellosis logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6316
 */
export const analyzeBrucellosisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const brucellosisLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.BRUCELLOSIS.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('brucellosis')
    );
  });

  if (brucellosisLogs.length === 0) {
    return {
      condition: 'Brucellosis',
      diagnosticCode: '6316',
      hasData: false,
      message: 'No brucellosis symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging brucellosis symptoms',
        'Document undulant (wave-like) fever pattern',
        'Track night sweats episodes',
        'Note joint or back pain (spondylitis common)',
        'Record treatment (doxycycline + rifampin typical)',
        'Blood cultures or serology confirming diagnosis',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    fever: 0,
    nightSweats: 0,
    fatigue: 0,
    jointPain: 0,
    muscleAches: 0,
    headache: 0,
    backPain: 0,
    weightLoss: 0,
    depression: 0,
    liverSpleen: 0,
  };

  let relapseCount = 0;
  let multiOrganInvolvement = false;
  let chronicArthritis = false;
  let neurobrucellosis = false;

  brucellosisLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'brucellosis-fever') symptomCounts.fever++;
    if (symptomId === 'brucellosis-night-sweats') symptomCounts.nightSweats++;
    if (symptomId === 'brucellosis-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'brucellosis-joint-pain') symptomCounts.jointPain++;
    if (symptomId === 'brucellosis-muscle-aches') symptomCounts.muscleAches++;
    if (symptomId === 'brucellosis-headache') symptomCounts.headache++;
    if (symptomId === 'brucellosis-back-pain') {
      symptomCounts.backPain++;
      chronicArthritis = true;
    }
    if (symptomId === 'brucellosis-weight-loss') symptomCounts.weightLoss++;
    if (symptomId === 'brucellosis-depression') symptomCounts.depression++;
    if (symptomId === 'brucellosis-liver-spleen') {
      symptomCounts.liverSpleen++;
      multiOrganInvolvement = true;
    }

    if (log.brucellosisData?.relapseEpisode) relapseCount++;
    if (log.brucellosisData?.multiOrganInvolvement) multiOrganInvolvement = true;
    if (log.brucellosisData?.chronicArthritis) chronicArthritis = true;
    if (log.brucellosisData?.neurobrucellosis) neurobrucellosis = true;
  });

  const daysWithSymptoms = brucellosisLogs.length;

  evidence.push(`${brucellosisLogs.length} brucellosis symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (neurobrucellosis || (multiOrganInvolvement && daysWithSymptoms >= 60)) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Severe active brucellosis with organ involvement',
      neurobrucellosis ? 'Neurobrucellosis (CNS involvement) documented' : '',
      multiOrganInvolvement ? 'Multiple organ involvement' : '',
      'Constant debilitating symptoms',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (relapseCount >= 3 || (chronicArthritis && daysWithSymptoms >= 30)) {
    supportedRating = 60;
    ratingRationale.push(...[
      'Active disease with relapsing pattern',
      `${relapseCount} relapse episodes documented`,
      chronicArthritis ? 'Chronic arthritis/spondylitis present' : '',
      `Symptoms on ${daysWithSymptoms} days`,
      'Meets criteria for 60% rating'
    ].filter(Boolean));
  } else if (relapseCount >= 1 || daysWithSymptoms >= 15) {
    supportedRating = 30;
    ratingRationale.push(...[
      'Occasional relapses or chronic symptoms',
      relapseCount > 0 ? `${relapseCount} relapse episode(s)` : '',
      symptomCounts.depression > 5 ? 'Chronic depression/mood changes' : '',
      'Meets criteria for 30% rating'
    ].filter(Boolean));
  } else if (daysWithSymptoms >= 3) {
    supportedRating = 10;
    ratingRationale.push(
        'Residual symptoms with minimal impact',
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Brucellosis treated, minimal symptoms',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.fever > 0) evidence.push(`${symptomCounts.fever} fever episodes`);
  if (symptomCounts.nightSweats > 0) evidence.push(`${symptomCounts.nightSweats} night sweats episodes`);
  if (symptomCounts.backPain > 0) evidence.push(`${symptomCounts.backPain} back pain episodes (spondylitis)`);
  if (symptomCounts.jointPain > 0) evidence.push(`${symptomCounts.jointPain} joint pain episodes`);
  if (symptomCounts.depression > 0) evidence.push(`${symptomCounts.depression} depression/mood episodes`);
  if (relapseCount > 0) evidence.push(`${relapseCount} documented relapses`);

  // Gaps
  gaps.push('Blood cultures or serology (IgG/IgM titers) confirming diagnosis');
  gaps.push('Document treatment (typically doxycycline + rifampin for 6+ weeks)');
  if (symptomCounts.backPain > 5) {
    gaps.push('Spine imaging (X-ray/MRI) to evaluate for spondylitis');
  }
  if (symptomCounts.jointPain > 5) {
    gaps.push('Joint imaging to document arthritis');
  }
  gaps.push('Track relapse pattern - symptoms may recur for years');

  return {
    condition: 'Brucellosis',
    diagnosticCode: '6316',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: brucellosisLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      relapseCount,
      multiOrganInvolvement,
      chronicArthritis,
      neurobrucellosis,
    },
  };
};

/**
 * Analyzes Campylobacter logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6330
 */
export const analyzeCampylobacterLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const campylobacterLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.CAMPYLOBACTER.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('campylobacter')
    );
  });

  if (campylobacterLogs.length === 0) {
    return {
      condition: 'Campylobacter jejuni Infection',
      diagnosticCode: '6330',
      hasData: false,
      message: 'No Campylobacter symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging Campylobacter-related symptoms',
        'Document GI symptoms (diarrhea, abdominal pain)',
        'Track any reactive arthritis (joint pain 1-4 weeks post-infection)',
        'Note neurological symptoms (weakness, numbness)',
        'Original stool culture confirming Campylobacter',
        'Monitor for Guillain-Barr syndrome symptoms',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    diarrhea: 0,
    abdominalPain: 0,
    fever: 0,
    nausea: 0,
    vomiting: 0,
    bloodyStool: 0,
    fatigue: 0,
    jointPain: 0,
    muscleWeakness: 0,
    nerveSymptoms: 0,
  };

  let guillainBarre = false;
  let reactiveArthritis = false;
  let chronicIBS = false;
  let peripheralNeuropathy = false;

  campylobacterLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'campylobacter-diarrhea') symptomCounts.diarrhea++;
    if (symptomId === 'campylobacter-abdominal-pain') symptomCounts.abdominalPain++;
    if (symptomId === 'campylobacter-fever') symptomCounts.fever++;
    if (symptomId === 'campylobacter-nausea') symptomCounts.nausea++;
    if (symptomId === 'campylobacter-vomiting') symptomCounts.vomiting++;
    if (symptomId === 'campylobacter-bloody-stool') symptomCounts.bloodyStool++;
    if (symptomId === 'campylobacter-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'campylobacter-joint-pain') {
      symptomCounts.jointPain++;
      reactiveArthritis = true;
    }
    if (symptomId === 'campylobacter-muscle-weakness') {
      symptomCounts.muscleWeakness++;
      if (log.campylobacterData?.guillainBarre) guillainBarre = true;
    }
    if (symptomId === 'campylobacter-nerve-symptoms') {
      symptomCounts.nerveSymptoms++;
      peripheralNeuropathy = true;
    }

    if (log.campylobacterData?.guillainBarre) guillainBarre = true;
    if (log.campylobacterData?.reactiveArthritis) reactiveArthritis = true;
    if (log.campylobacterData?.chronicIBS) chronicIBS = true;
  });

  const daysWithSymptoms = campylobacterLogs.length;

  evidence.push(`${campylobacterLogs.length} Campylobacter-related symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (guillainBarre || (symptomCounts.muscleWeakness >= 20 && symptomCounts.nerveSymptoms >= 10)) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Severe post-infectious complications',
      guillainBarre ? 'Guillain-Barr syndrome (GBS) documented' : '',
      'Severe functional impairment',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (reactiveArthritis && symptomCounts.jointPain >= 15) {
    supportedRating = 60;
    ratingRationale.push(...[
      'Moderate complications with ongoing impairment',
      'Reactive arthritis affecting multiple joints',
      `Joint pain episodes: ${symptomCounts.jointPain}`,
      peripheralNeuropathy ? 'Peripheral neuropathy present' : '',
      'Meets criteria for 60% rating'
    ].filter(Boolean));
  } else if ((reactiveArthritis && symptomCounts.jointPain >= 5) || (chronicIBS && symptomCounts.diarrhea >= 10)) {
    supportedRating = 30;
    ratingRationale.push(...[
      'Mild chronic symptoms or occasional relapses',
      reactiveArthritis ? 'Mild reactive arthritis' : '',
      chronicIBS ? 'Post-infectious IBS' : '',
      'Meets criteria for 30% rating'
    ].filter(Boolean));
  } else if (daysWithSymptoms >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        'Minimal residual symptoms',
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Fully recovered from Campylobacter infection',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.diarrhea > 0) evidence.push(`${symptomCounts.diarrhea} diarrhea episodes`);
  if (symptomCounts.jointPain > 0) evidence.push(`${symptomCounts.jointPain} joint pain episodes (reactive arthritis)`);
  if (symptomCounts.muscleWeakness > 0) evidence.push(`${symptomCounts.muscleWeakness} muscle weakness episodes`);
  if (symptomCounts.nerveSymptoms > 0) evidence.push(`${symptomCounts.nerveSymptoms} neurological symptoms`);
  if (guillainBarre) evidence.push('Guillain-Barr syndrome diagnosed');

  // Gaps
  gaps.push('Stool culture confirming Campylobacter jejuni');
  if (symptomCounts.jointPain > 5) {
    gaps.push('Rheumatology evaluation for reactive arthritis');
    gaps.push('Joint imaging if available');
  }
  if (symptomCounts.muscleWeakness > 5 || symptomCounts.nerveSymptoms > 5) {
    gaps.push('Neurological evaluation');
    gaps.push('EMG/nerve conduction studies if GBS suspected');
  }
  if (symptomCounts.diarrhea > 10) {
    gaps.push('GI evaluation for post-infectious IBS');
  }
  gaps.push('Link symptoms to original Campylobacter infection (timeline important)');

  return {
    condition: 'Campylobacter jejuni Infection',
    diagnosticCode: '6330',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: campylobacterLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      guillainBarre,
      reactiveArthritis,
      chronicIBS,
      peripheralNeuropathy,
    },
  };
};

/**
 * Analyzes Q Fever logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6331
 */
export const analyzeQFeverLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const qFeverLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.Q_FEVER.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('q-fever')
    );
  });

  if (qFeverLogs.length === 0) {
    return {
      condition: 'Q Fever',
      diagnosticCode: '6331',
      hasData: false,
      message: 'No Q fever symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging Q fever symptoms',
        'Document fever, headaches, and fatigue',
        'Track respiratory symptoms (cough, chest pain)',
        'Note night sweats and chills',
        'Record treatment (doxycycline)',
        'Serology (Phase I/II antibodies) confirming diagnosis',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    fever: 0,
    headache: 0,
    fatigue: 0,
    muscleAches: 0,
    cough: 0,
    chestPain: 0,
    nightSweats: 0,
    chills: 0,
    shortnessBreath: 0,
    jointPain: 0,
  };

  let chronicQFever = false;
  let endocarditis = false;
  let fatigueSyndrome = false;
  let monthsSinceInfection = 0;

  qFeverLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'q-fever-fever') symptomCounts.fever++;
    if (symptomId === 'q-fever-headache') symptomCounts.headache++;
    if (symptomId === 'q-fever-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'q-fever-muscle-aches') symptomCounts.muscleAches++;
    if (symptomId === 'q-fever-cough') symptomCounts.cough++;
    if (symptomId === 'q-fever-chest-pain') symptomCounts.chestPain++;
    if (symptomId === 'q-fever-night-sweats') symptomCounts.nightSweats++;
    if (symptomId === 'q-fever-chills') symptomCounts.chills++;
    if (symptomId === 'q-fever-shortness-breath') symptomCounts.shortnessBreath++;
    if (symptomId === 'q-fever-joint-pain') symptomCounts.jointPain++;

    if (log.qFeverData?.chronicQFever) chronicQFever = true;
    if (log.qFeverData?.endocarditis) {
      endocarditis = true;
      chronicQFever = true;
    }
    if (log.qFeverData?.fatigueSyndrome) fatigueSyndrome = true;
    if (log.qFeverData?.monthsSinceInfection) {
      monthsSinceInfection = Math.max(monthsSinceInfection, parseInt(log.qFeverData.monthsSinceInfection));
    }
  });

  const daysWithSymptoms = qFeverLogs.length;

  evidence.push(`${qFeverLogs.length} Q fever symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (endocarditis || (chronicQFever && monthsSinceInfection >= 6)) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Chronic Q fever with serious complications',
      endocarditis ? 'Q fever endocarditis (valve infection) documented' : '',
      chronicQFever ? `Chronic infection (${monthsSinceInfection}+ months)` : '',
      'Requires long-term antibiotics',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (fatigueSyndrome && symptomCounts.fatigue >= 30 && monthsSinceInfection >= 6) {
    supportedRating = 60;
    ratingRationale.push(...[
      'Post-Q fever fatigue syndrome',
      `Severe chronic fatigue: ${symptomCounts.fatigue} episodes`,
      `Duration: ${monthsSinceInfection} months post-infection`,
      'Substantially impacts daily function',
      'Meets criteria for 60% rating'
    ].filter(Boolean));
  } else if (daysWithSymptoms >= 20 || (monthsSinceInfection >= 3 && symptomCounts.fatigue >= 10)) {
    supportedRating = 30;
    ratingRationale.push(...[
      'Mild chronic symptoms or persistent fatigue',
      `Symptoms on ${daysWithSymptoms} days`,
      symptomCounts.fatigue > 0 ? `Chronic fatigue: ${symptomCounts.fatigue} episodes` : '',
      'Meets criteria for 30% rating'
    ].filter(Boolean));
  } else if (daysWithSymptoms >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        'Minimal residual symptoms',
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Fully recovered from acute Q fever',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.fever > 0) evidence.push(`${symptomCounts.fever} fever episodes`);
  if (symptomCounts.fatigue > 0) evidence.push(`${symptomCounts.fatigue} fatigue episodes`);
  if (symptomCounts.headache > 0) evidence.push(`${symptomCounts.headache} headache episodes`);
  if (symptomCounts.nightSweats > 0) evidence.push(`${symptomCounts.nightSweats} night sweats episodes`);
  if (endocarditis) evidence.push('Endocarditis confirmed (echocardiogram)');
  if (chronicQFever) evidence.push(`Chronic Q fever (${monthsSinceInfection}+ months)`);

  // Gaps
  gaps.push('Serology: Phase I and Phase II antibody titers');
  if (chronicQFever || monthsSinceInfection >= 6) {
    gaps.push('Echocardiogram to evaluate for endocarditis');
    gaps.push('Phase I IgG titer >1:800 indicates chronic infection');
  }
  if (symptomCounts.fatigue > 20) {
    gaps.push('Functional assessment documenting impact on daily activities');
  }
  gaps.push('Document treatment (doxycycline, +hydroxychloroquine if chronic)');
  gaps.push('Timeline: track months since initial infection');

  return {
    condition: 'Q Fever',
    diagnosticCode: '6331',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: qFeverLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      chronicQFever,
      endocarditis,
      fatigueSyndrome,
      monthsSinceInfection,
    },
  };
};

/**
 * Analyzes Salmonella logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6333
 */
export const analyzeSalmonellaLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const salmonellaLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.SALMONELLA.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('salmonella')
    );
  });

  if (salmonellaLogs.length === 0) {
    return {
      condition: 'Nontyphoid Salmonella Infection',
      diagnosticCode: '6333',
      hasData: false,
      message: 'No Salmonella symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging Salmonella symptoms',
        'Document GI symptoms (diarrhea, bloody stool, cramps)',
        'Note any joint pain (reactive arthritis)',
        'Stool culture confirming Salmonella',
        'Track fever and dehydration',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    diarrhea: 0,
    fever: 0,
    abdominalCramps: 0,
    nausea: 0,
    vomiting: 0,
    bloodyStool: 0,
    jointPain: 0,
    bacteremia: 0,
    dehydration: 0,
    fatigue: 0,
  };

  let hospitalized = false;
  let bacteremia = false;
  let reactiveArthritis = false;
  let severeComplications = false;

  salmonellaLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'salmonella-diarrhea') symptomCounts.diarrhea++;
    if (symptomId === 'salmonella-fever') symptomCounts.fever++;
    if (symptomId === 'salmonella-abdominal-cramps') symptomCounts.abdominalCramps++;
    if (symptomId === 'salmonella-nausea') symptomCounts.nausea++;
    if (symptomId === 'salmonella-vomiting') symptomCounts.vomiting++;
    if (symptomId === 'salmonella-bloody-stool') symptomCounts.bloodyStool++;
    if (symptomId === 'salmonella-joint-pain') {
      symptomCounts.jointPain++;
      reactiveArthritis = true;
    }
    if (symptomId === 'salmonella-bacteremia') {
      symptomCounts.bacteremia++;
      bacteremia = true;
      severeComplications = true;
    }
    if (symptomId === 'salmonella-dehydration') symptomCounts.dehydration++;
    if (symptomId === 'salmonella-fatigue') symptomCounts.fatigue++;

    if (log.salmonellaData?.hospitalized) hospitalized = true;
    if (log.salmonellaData?.bacteremia) {
      bacteremia = true;
      severeComplications = true;
    }
    if (log.salmonellaData?.reactiveArthritis) reactiveArthritis = true;
    if (log.salmonellaData?.severeComplications) severeComplications = true;
  });

  const daysWithSymptoms = salmonellaLogs.length;

  evidence.push(`${salmonellaLogs.length} Salmonella symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (bacteremia || hospitalized || severeComplications) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Severe complications requiring hospitalization',
      bacteremia ? 'Bacteremia/sepsis documented' : '',
      hospitalized ? 'Hospitalization required' : '',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (reactiveArthritis && symptomCounts.jointPain >= 10) {
    supportedRating = 60;
    ratingRationale.push(...[
      'Moderate symptoms with reactive arthritis',
      `Joint pain episodes: ${symptomCounts.jointPain}`,
      'Significant functional impact',
      'Meets criteria for 60% rating'
    ].filter(Boolean));
  } else if (daysWithSymptoms >= 15 || (reactiveArthritis && symptomCounts.jointPain >= 5)) {
    supportedRating = 30;
    ratingRationale.push(
        'Mild chronic symptoms',
        `Symptoms on ${daysWithSymptoms} days`,
        'Meets criteria for 30% rating'
    );
  } else if (daysWithSymptoms >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        'Minimal residual symptoms',
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Fully recovered from Salmonella',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.diarrhea > 0) evidence.push(`${symptomCounts.diarrhea} diarrhea episodes`);
  if (symptomCounts.bloodyStool > 0) evidence.push(`${symptomCounts.bloodyStool} bloody stool episodes`);
  if (symptomCounts.jointPain > 0) evidence.push(`${symptomCounts.jointPain} joint pain episodes (reactive arthritis)`);
  if (bacteremia) evidence.push('Bacteremia documented');

  // Gaps
  gaps.push('Stool culture confirming Salmonella species');
  if (symptomCounts.jointPain > 5) {
    gaps.push('Rheumatology evaluation for reactive arthritis');
  }
  if (bacteremia) {
    gaps.push('Blood culture results');
  }
  gaps.push('Document acute symptoms and post-infectious complications');

  return {
    condition: 'Nontyphoid Salmonella Infection',
    diagnosticCode: '6333',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: salmonellaLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      hospitalized,
      bacteremia,
      reactiveArthritis,
    },
  };
};

/**
 * Analyzes Shigella logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6334
 */
export const analyzeShigellaLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const shigellaLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.SHIGELLA.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('shigella')
    );
  });

  if (shigellaLogs.length === 0) {
    return {
      condition: 'Shigella Infection',
      diagnosticCode: '6334',
      hasData: false,
      message: 'No Shigella symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging Shigella symptoms',
        'Document bloody diarrhea and tenesmus',
        'Track fever and abdominal cramps',
        'Note any joint pain or seizures',
        'Stool culture confirming Shigella',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    diarrhea: 0,
    bloodyStool: 0,
    abdominalCramps: 0,
    fever: 0,
    tenesmus: 0,
    nausea: 0,
    vomiting: 0,
    dehydration: 0,
    reactiveArthritis: 0,
    seizures: 0,
  };

  let hospitalized = false;
  let hus = false;
  let reactiveArthritis = false;
  let severeComplications = false;

  shigellaLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'shigella-diarrhea') symptomCounts.diarrhea++;
    if (symptomId === 'shigella-bloody-stool') symptomCounts.bloodyStool++;
    if (symptomId === 'shigella-abdominal-cramps') symptomCounts.abdominalCramps++;
    if (symptomId === 'shigella-fever') symptomCounts.fever++;
    if (symptomId === 'shigella-tenesmus') symptomCounts.tenesmus++;
    if (symptomId === 'shigella-nausea') symptomCounts.nausea++;
    if (symptomId === 'shigella-vomiting') symptomCounts.vomiting++;
    if (symptomId === 'shigella-dehydration') symptomCounts.dehydration++;
    if (symptomId === 'shigella-reactive-arthritis') {
      symptomCounts.reactiveArthritis++;
      reactiveArthritis = true;
    }
    if (symptomId === 'shigella-seizures') {
      symptomCounts.seizures++;
      severeComplications = true;
    }

    if (log.shigellaData?.hospitalized) hospitalized = true;
    if (log.shigellaData?.hus) {
      hus = true;
      severeComplications = true;
    }
    if (log.shigellaData?.reactiveArthritis) reactiveArthritis = true;
    if (log.shigellaData?.severeComplications) severeComplications = true;
  });

  const daysWithSymptoms = shigellaLogs.length;

  evidence.push(`${shigellaLogs.length} Shigella symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (hus || hospitalized || severeComplications) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Severe complications',
      hus ? 'Hemolytic uremic syndrome (HUS)' : '',
      symptomCounts.seizures > 0 ? 'Seizures documented' : '',
      hospitalized ? 'Hospitalization required' : '',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (reactiveArthritis && symptomCounts.reactiveArthritis >= 10) {
    supportedRating = 60;
    ratingRationale.push(
        'Moderate symptoms with reactive arthritis',
        `Joint pain episodes: ${symptomCounts.reactiveArthritis}`,
        'Meets criteria for 60% rating'
    );
  } else if (daysWithSymptoms >= 15) {
    supportedRating = 30;
    ratingRationale.push(
        'Mild chronic symptoms',
        `Symptoms on ${daysWithSymptoms} days`,
        'Meets criteria for 30% rating'
    );
  } else if (daysWithSymptoms >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        'Minimal residual symptoms',
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Fully recovered from Shigella',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.diarrhea > 0) evidence.push(`${symptomCounts.diarrhea} diarrhea episodes`);
  if (symptomCounts.bloodyStool > 0) evidence.push(`${symptomCounts.bloodyStool} bloody stool episodes (dysentery)`);
  if (symptomCounts.tenesmus > 0) evidence.push(`${symptomCounts.tenesmus} tenesmus episodes`);
  if (symptomCounts.reactiveArthritis > 0) evidence.push(`${symptomCounts.reactiveArthritis} reactive arthritis episodes`);
  if (hus) evidence.push('HUS documented');

  // Gaps
  gaps.push('Stool culture confirming Shigella species');
  if (hus) {
    gaps.push('Lab work: CBC, BMP showing kidney function, platelet count');
  }
  if (reactiveArthritis) {
    gaps.push('Rheumatology evaluation');
  }
  gaps.push('Document severity of dysentery and complications');

  return {
    condition: 'Shigella Infection',
    diagnosticCode: '6334',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: shigellaLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      hospitalized,
      hus,
      reactiveArthritis,
    },
  };
};

/**
 * Analyzes West Nile Virus logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6335
 */
export const analyzeWestNileLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const westNileLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.WEST_NILE.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('west-nile')
    );
  });

  if (westNileLogs.length === 0) {
    return {
      condition: 'West Nile Virus',
      diagnosticCode: '6335',
      hasData: false,
      message: 'No West Nile symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging West Nile symptoms',
        'Document neurological symptoms (weakness, tremors, cognitive)',
        'Track chronic fatigue',
        'Serology confirming West Nile IgM antibodies',
        'Neurological evaluation if deficits present',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    fever: 0,
    headache: 0,
    bodyAches: 0,
    fatigue: 0,
    weakness: 0,
    cognitive: 0,
    tremors: 0,
    visionProblems: 0,
    numbness: 0,
    paralysis: 0,
  };

  let neuroinvasive = false;
  let permanentImpairment = false;
  let encephalitis = false;
  let acuteFlaccidParalysis = false;

  westNileLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'west-nile-fever') symptomCounts.fever++;
    if (symptomId === 'west-nile-headache') symptomCounts.headache++;
    if (symptomId === 'west-nile-body-aches') symptomCounts.bodyAches++;
    if (symptomId === 'west-nile-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'west-nile-weakness') symptomCounts.weakness++;
    if (symptomId === 'west-nile-cognitive') symptomCounts.cognitive++;
    if (symptomId === 'west-nile-tremors') symptomCounts.tremors++;
    if (symptomId === 'west-nile-vision-problems') symptomCounts.visionProblems++;
    if (symptomId === 'west-nile-numbness') symptomCounts.numbness++;
    if (symptomId === 'west-nile-paralysis') {
      symptomCounts.paralysis++;
      acuteFlaccidParalysis = true;
      neuroinvasive = true;
      permanentImpairment = true;
    }

    if (log.westNileData?.neuroinvasive) neuroinvasive = true;
    if (log.westNileData?.encephalitis) {
      encephalitis = true;
      neuroinvasive = true;
    }
    if (log.westNileData?.acuteFlaccidParalysis) {
      acuteFlaccidParalysis = true;
      permanentImpairment = true;
    }
    if (log.westNileData?.permanentImpairment) permanentImpairment = true;
  });

  const daysWithSymptoms = westNileLogs.length;

  evidence.push(`${westNileLogs.length} West Nile symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if (acuteFlaccidParalysis || encephalitis || (neuroinvasive && permanentImpairment)) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Severe neuroinvasive disease with permanent impairment',
      acuteFlaccidParalysis ? 'Acute flaccid paralysis (polio-like)' : '',
      encephalitis ? 'Encephalitis documented' : '',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (neuroinvasive || (symptomCounts.weakness >= 20 && symptomCounts.fatigue >= 20)) {
    supportedRating = 60;
    ratingRationale.push(
        'Moderate neurological symptoms or chronic fatigue',
        `Muscle weakness: ${symptomCounts.weakness} episodes`,
        `Chronic fatigue: ${symptomCounts.fatigue} episodes`,
        'Meets criteria for 60% rating'
    );
  } else if (daysWithSymptoms >= 20 || symptomCounts.weakness >= 10) {
    supportedRating = 30;
    ratingRationale.push(
        'Mild chronic symptoms',
        'Post-West Nile syndrome',
        'Meets criteria for 30% rating'
    );
  } else if (daysWithSymptoms >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        'Minimal residual symptoms',
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Fully recovered from West Nile',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.weakness > 0) evidence.push(`${symptomCounts.weakness} muscle weakness episodes`);
  if (symptomCounts.fatigue > 0) evidence.push(`${symptomCounts.fatigue} fatigue episodes`);
  if (symptomCounts.cognitive > 0) evidence.push(`${symptomCounts.cognitive} cognitive impairment episodes`);
  if (symptomCounts.paralysis > 0) evidence.push(`${symptomCounts.paralysis} paralysis episodes (AFP)`);
  if (neuroinvasive) evidence.push('Neuroinvasive disease documented');

  // Gaps
  gaps.push('Serology: West Nile IgM antibodies');
  if (neuroinvasive) {
    gaps.push('CSF analysis');
    gaps.push('MRI/CT brain imaging');
    gaps.push('Neurological examination documenting deficits');
  }
  if (symptomCounts.weakness > 10 || symptomCounts.paralysis > 0) {
    gaps.push('EMG/nerve conduction studies');
  }
  gaps.push('Document both acute illness and chronic post-West Nile syndrome');

  return {
    condition: 'West Nile Virus',
    diagnosticCode: '6335',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: westNileLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      neuroinvasive,
      encephalitis,
      acuteFlaccidParalysis,
      permanentImpairment,
    },
  };
};

/**
 * Analyzes NTM logs to determine supported rating level
 * Based on 38 CFR 4.88b, DC 6312
 */
export const analyzeNTMLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const ntmLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && (
        CONDITIONS.NTM.symptomIds.includes(getLogSymptomId(log)) ||
        getLogSymptomId(log)?.includes('ntm')
    );
  });

  if (ntmLogs.length === 0) {
    return {
      condition: 'Nontuberculous Mycobacterium Infection',
      diagnosticCode: '6312',
      hasData: false,
      message: 'No NTM symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: [
        'Start logging NTM symptoms',
        'Document chronic cough and sputum production',
        'Track weight loss and fatigue',
        'Sputum cultures (multiple) confirming NTM',
        'CT scan showing lung involvement',
        'Pulmonary function tests',
      ],
    };
  }

  const evidence = [];
  const gaps = [];
  let supportedRating = 0;
  const ratingRationale = [];

  const symptomCounts = {
    cough: 0,
    sputum: 0,
    fatigue: 0,
    fever: 0,
    nightSweats: 0,
    weightLoss: 0,
    chestPain: 0,
    shortnessBreath: 0,
    hemoptysis: 0,
    lymphNodes: 0,
  };

  let activeDisease = false;
  let onTreatment = false;
  let disseminated = false;
  let monthsOnTreatment = 0;

  ntmLogs.forEach(log => {
    const symptomId = getLogSymptomId(log);

    if (symptomId === 'ntm-cough') symptomCounts.cough++;
    if (symptomId === 'ntm-sputum') symptomCounts.sputum++;
    if (symptomId === 'ntm-fatigue') symptomCounts.fatigue++;
    if (symptomId === 'ntm-fever') symptomCounts.fever++;
    if (symptomId === 'ntm-night-sweats') symptomCounts.nightSweats++;
    if (symptomId === 'ntm-weight-loss') symptomCounts.weightLoss++;
    if (symptomId === 'ntm-chest-pain') symptomCounts.chestPain++;
    if (symptomId === 'ntm-shortness-breath') symptomCounts.shortnessBreath++;
    if (symptomId === 'ntm-hemoptysis') symptomCounts.hemoptysis++;
    if (symptomId === 'ntm-lymph-nodes') {
      symptomCounts.lymphNodes++;
      disseminated = true;
    }

    if (log.ntmData?.activeDisease) activeDisease = true;
    if (log.ntmData?.onTreatment) onTreatment = true;
    if (log.ntmData?.disseminated) disseminated = true;
    if (log.ntmData?.monthsOnTreatment) {
      monthsOnTreatment = Math.max(monthsOnTreatment, parseInt(log.ntmData.monthsOnTreatment));
    }
  });

  const daysWithSymptoms = ntmLogs.length;

  evidence.push(`${ntmLogs.length} NTM symptoms logged over ${evaluationPeriodDays} days`);

  // Rating determination
  if ((activeDisease && onTreatment && monthsOnTreatment >= 6) || disseminated) {
    supportedRating = 100;
    ratingRationale.push(...[
      'Active NTM requiring continuous treatment',
      onTreatment ? `On treatment for ${monthsOnTreatment} months` : '',
      disseminated ? 'Disseminated disease' : '',
      'Meets criteria for 100% rating'
    ].filter(Boolean));
  } else if (activeDisease && onTreatment) {
    supportedRating = 60;
    ratingRationale.push(
        'Active NTM with moderate symptoms on treatment',
        onTreatment ? 'Long-term antibiotic therapy' : '',
        'Meets criteria for 60% rating'
    );
  } else if (daysWithSymptoms >= 20 || symptomCounts.cough >= 30) {
    supportedRating = 30;
    ratingRationale.push(
        'Mild disease or post-treatment monitoring',
        'Chronic respiratory symptoms',
        'Meets criteria for 30% rating'
    );
  } else if (daysWithSymptoms >= 5) {
    supportedRating = 10;
    ratingRationale.push(
        'Colonization without active disease',
        'Meets criteria for 10% rating'
    );
  } else {
    supportedRating = 0;
    ratingRationale.push(
        'Successfully treated, no residuals',
        'Asymptomatic rating'
    );
  }

  // Evidence
  if (symptomCounts.cough > 0) evidence.push(`${symptomCounts.cough} chronic cough episodes`);
  if (symptomCounts.sputum > 0) evidence.push(`${symptomCounts.sputum} sputum production episodes`);
  if (symptomCounts.hemoptysis > 0) evidence.push(`${symptomCounts.hemoptysis} hemoptysis episodes (coughing blood)`);
  if (symptomCounts.weightLoss > 0) evidence.push(`${symptomCounts.weightLoss} weight loss documented`);
  if (onTreatment) evidence.push(`On NTM treatment for ${monthsOnTreatment} months`);

  // Gaps
  gaps.push('Multiple sputum cultures confirming NTM species (MAC, M. abscessus, M. kansasii)');
  gaps.push('CT chest showing nodular/cavitary disease');
  gaps.push('Pulmonary function tests');
  if (onTreatment) {
    gaps.push('Treatment compliance documentation (12-24 month regimen)');
    gaps.push('Drug regimen: typically macrolide + ethambutol + rifampin');
  }
  gaps.push('Infectious disease specialist notes');

  return {
    condition: 'Nontuberculous Mycobacterium Infection',
    diagnosticCode: '6312',
    hasData: true,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: ntmLogs.length,
      evaluationPeriod: evaluationPeriodDays,
      symptomCounts,
      activeDisease,
      onTreatment,
      disseminated,
      monthsOnTreatment,
    },
  };
};

// ============================================
// PHASE 8A: ANALYSIS FUNCTIONS - MENTAL HEALTH EXPANSION
// ============================================

/**
 * Analyzes Somatic Symptom Disorder symptom logs
 */
export const analyzeSomaticSymptomDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'somatic-symptom-disorder',
      CONDITIONS.SOMATIC_SYMPTOM_DISORDER.symptomIds,
      SOMATIC_SYMPTOM_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Other Specified Somatic Symptom Disorder logs
 */
export const analyzeOtherSpecifiedSomaticLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'other-specified-somatic',
      CONDITIONS.OTHER_SPECIFIED_SOMATIC.symptomIds,
      OTHER_SPECIFIED_SOMATIC_CRITERIA,
      options,
  );
};

/**
 * Analyzes Unspecified Somatic Symptom Disorder logs
 */
export const analyzeUnspecifiedSomaticLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'unspecified-somatic',
      CONDITIONS.UNSPECIFIED_SOMATIC.symptomIds,
      UNSPECIFIED_SOMATIC_CRITERIA,
      options,
  );
};

/**
 * Analyzes Illness Anxiety Disorder symptom logs
 */
export const analyzeIllnessAnxietyLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'illness-anxiety',
      CONDITIONS.ILLNESS_ANXIETY.symptomIds,
      ILLNESS_ANXIETY_CRITERIA,
      options,
  );
};

/**
 * Analyzes Other Specified Anxiety Disorder logs
 */
export const analyzeOtherSpecifiedAnxietyLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'other-specified-anxiety',
      CONDITIONS.OTHER_SPECIFIED_ANXIETY.symptomIds,
      OTHER_SPECIFIED_ANXIETY_CRITERIA,
      options,
  );
};

/**
 * Analyzes Depersonalization/Derealization Disorder logs
 */
export const analyzeDepersonalizationLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'depersonalization-derealization',
      CONDITIONS.DEPERSONALIZATION_DEREALIZATION.symptomIds,
      DEPERSONALIZATION_DEREALIZATION_CRITERIA,
      options,
  );
};

/**
 * Analyzes Cyclothymic Disorder symptom logs
 */
export const analyzeCyclothymicLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'cyclothymic',
      CONDITIONS.CYCLOTHYMIC.symptomIds,
      CYCLOTHYMIC_CRITERIA,
      options,
  );
};

/**
 * Helper function to analyze eating disorder conditions
 * Uses SPECIAL RATING FORMULA based on weight loss and incapacitating episodes
 * Different from general mental health analysis
 */
const analyzeEatingDisorderCondition = (logs, conditionKey, symptomIds, criteria, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const conditionCriteria = criteria;

  // Filter logs for this condition's symptoms within evaluation period
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && symptomIds.includes(log.symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      // Empty metrics for consistency
      metrics: {
        totalLogs: 0,
        avgSeverity: 0,
        severeSymptoms: 0,
        hospitalized: false,
        hospitalizationCount: 0,
        dangerToSelf: false,
        dangerToOthers: false,
      },
    };
  }

  // Eating disorder specific tracking
  const incapacitatingEpisodes = relevantLogs.filter(log =>
      log.symptomId.includes('incapacitating-episode')
  ).length;

  const hospitalizations = relevantLogs.filter(log =>
      log.symptomId.includes('hospitalization')
  ).length;

  const weightLossLogs = relevantLogs.filter(log =>
      log.symptomId.includes('weight-loss')
  );

  const bingeEpisodes = relevantLogs.filter(log =>
      log.symptomId.includes('binge-eating')
  ).length;

  const purgingEpisodes = relevantLogs.filter(log =>
      log.symptomId.includes('purging')
  ).length;

  // Build evidence array
  const evidence = [];
  if (incapacitatingEpisodes > 0) {
    evidence.push(`${incapacitatingEpisodes} incapacitating episode(s) documented`);
  }
  if (hospitalizations > 0) {
    evidence.push(`${hospitalizations} hospitalization(s) for tube/parenteral feeding`);
  }
  if (weightLossLogs.length > 0) {
    evidence.push(`Weight loss documented ${weightLossLogs.length} time(s)`);
  }
  if (bingeEpisodes > 0) {
    evidence.push(`${bingeEpisodes} binge eating episode(s) documented`);
  }
  if (purgingEpisodes > 0) {
    evidence.push(`${purgingEpisodes} purging episode(s) documented`);
  }

  evidence.push(`${relevantLogs.length} total eating disorder symptoms logged over ${evaluationPeriodDays} days`);

  // ===== CALCULATE METRICS FOR RATING CARD DISPLAY =====
  // Count logs with severity 8+ as severe episodes
  const severeSymptoms = relevantLogs.filter(log => log.severity >= 8).length;

  // Calculate average severity
  const logsWithSeverity = relevantLogs.filter(log => log.severity && log.severity > 0);
  const avgSeverity = logsWithSeverity.length > 0
    ? logsWithSeverity.reduce((sum, log) => sum + log.severity, 0) / logsWithSeverity.length
    : 0;

  // Check for hospitalization (eating disorders track this via symptom ID)
  const hospitalized = hospitalizations > 0;
  const hospitalizationCount = hospitalizations;

  // Check for danger indicators in notes
  const dangerToSelf = relevantLogs.some(log => {
    const notes = (log.notes || '').toLowerCase();
    return notes.includes('suicidal') || notes.includes('self-harm') || notes.includes('danger to self');
  });
  const dangerToOthers = false; // Less common in eating disorders

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: 'Requires Medical Evaluation',
    ratingRationale: [
      'Eating disorders are rated based on weight loss percentage and incapacitating episodes',
      'Medical records showing actual weight vs. expected minimum weight are required',
      'Hospitalizations for tube feeding or parenteral nutrition significantly impact rating',
      'Your symptom logs document eating disorder behaviors and episodes',
    ],
    assessmentLevel: 'Medical Evaluation Required',
    evidence,
    gaps: [
      'CRITICAL: Medical records showing current weight and height',
      'Calculate percentage of expected minimum weight (BMI charts)',
      'Document incapacitating episodes requiring bed rest and physician treatment',
      'Track hospitalization frequency for tube feeding or parenteral nutrition',
      'Medical treatment records showing eating disorder diagnosis',
      'Note: Incapacitating episodes must require bed rest and physician treatment, not just therapy',
    ],
    criteria: conditionCriteria,
    // Metrics for rating card display
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity,
      severeSymptoms,
      hospitalized,
      hospitalizationCount,
      dangerToSelf,
      dangerToOthers,
    },
    disclaimer: 'Eating disorders require objective medical evidence of weight loss and incapacitating episodes. Your documentation helps establish pattern, but medical records with actual weights, BMI calculations, and hospitalization records are essential for rating determination.',
    crisisResources: {
      veteransCrisisLine: '988 then Press 1',
      text: '838255',
      chat: 'https://www.veteranscrisisline.net/get-help-now/chat/',
      neda: 'National Eating Disorders Association Hotline: 1-800-931-2237',
    },
  };
};

/**
 * Analyzes Anorexia Nervosa symptom logs
 * Note: Uses special eating disorder rating formula
 */
export const analyzeAnorexiaNervosaLogs = (logs, options = {}) => {
  return analyzeEatingDisorderCondition(
      logs,
      'anorexia-nervosa',
      CONDITIONS.ANOREXIA_NERVOSA.symptomIds,
      ANOREXIA_NERVOSA_CRITERIA,
      options,
  );
};

/**
 * Analyzes Bulimia Nervosa symptom logs
 * Note: Uses special eating disorder rating formula
 */
export const analyzeBulimiaNervosaLogs = (logs, options = {}) => {
  return analyzeEatingDisorderCondition(
      logs,
      'bulimia-nervosa',
      CONDITIONS.BULIMIA_NERVOSA.symptomIds,
      BULIMIA_NERVOSA_CRITERIA,
      options,
  );
};

/**
 * Analyzes Schizophrenia symptom logs
 */
export const analyzeSchizophreniaLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'schizophrenia',
      CONDITIONS.SCHIZOPHRENIA.symptomIds,
      SCHIZOPHRENIA_CRITERIA,
      options,
  );
};

/**
 * Analyzes Schizoaffective Disorder symptom logs
 */
export const analyzeSchizoaffectiveDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'schizoaffective-disorder',
      CONDITIONS.SCHIZOAFFECTIVE_DISORDER.symptomIds,
      SCHIZOAFFECTIVE_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Delusional Disorder symptom logs
 */
export const analyzeDelusionalDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'delusional-disorder',
      CONDITIONS.DELUSIONAL_DISORDER.symptomIds,
      DELUSIONAL_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Psychotic Disorder NOS symptom logs
 */
export const analyzePsychoticDisorderNOSLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'psychotic-disorder-nos',
      CONDITIONS.PSYCHOTIC_DISORDER_NOS.symptomIds,
      PSYCHOTIC_DISORDER_NOS_CRITERIA,
      options,
  );
};

/**
 * Analyzes Brief Psychotic Disorder symptom logs
 */
export const analyzeBriefPsychoticDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'brief-psychotic-disorder',
      CONDITIONS.BRIEF_PSYCHOTIC_DISORDER.symptomIds,
      BRIEF_PSYCHOTIC_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Binge Eating Disorder symptom logs
 */
export const analyzeBingeEatingDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'binge-eating-disorder',
      CONDITIONS.BINGE_EATING_DISORDER.symptomIds,
      BINGE_EATING_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Dissociative Identity Disorder symptom logs
 */
export const analyzeDissociativeIdentityDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'dissociative-identity-disorder',
      CONDITIONS.DISSOCIATIVE_IDENTITY_DISORDER.symptomIds,
      DISSOCIATIVE_IDENTITY_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Dissociative Amnesia symptom logs
 */
export const analyzeDissociativeAmnesiaLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'dissociative-amnesia',
      CONDITIONS.DISSOCIATIVE_AMNESIA.symptomIds,
      DISSOCIATIVE_AMNESIA_CRITERIA,
      options,
  );
};

/**
 * Analyzes Acute Stress Disorder symptom logs
 */
export const analyzeAcuteStressDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'acute-stress-disorder',
      CONDITIONS.ACUTE_STRESS_DISORDER.symptomIds,
      ACUTE_STRESS_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Antisocial Personality Disorder symptom logs
 */
export const analyzeAntisocialPersonalityDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'antisocial-personality-disorder',
      CONDITIONS.ANTISOCIAL_PERSONALITY_DISORDER.symptomIds,
      ANTISOCIAL_PERSONALITY_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Borderline Personality Disorder symptom logs
 */
export const analyzeBorderlinePersonalityDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'borderline-personality-disorder',
      CONDITIONS.BORDERLINE_PERSONALITY_DISORDER.symptomIds,
      BORDERLINE_PERSONALITY_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Narcissistic Personality Disorder symptom logs
 */
export const analyzeNarcissisticPersonalityDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'narcissistic-personality-disorder',
      CONDITIONS.NARCISSISTIC_PERSONALITY_DISORDER.symptomIds,
      NARCISSISTIC_PERSONALITY_DISORDER_CRITERIA,
      options,
  );
};

/**
 * Analyzes Avoidant Personality Disorder symptom logs
 */
export const analyzeAvoidantPersonalityDisorderLogs = (logs, options = {}) => {
  return analyzeMentalHealthCondition(
      logs,
      'avoidant-personality-disorder',
      CONDITIONS.AVOIDANT_PERSONALITY_DISORDER.symptomIds,
      AVOIDANT_PERSONALITY_DISORDER_CRITERIA,
      options,
  );
};

// ============================================
// PHASE 9: CARDIOVASCULAR ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyze Cardiomyopathy symptom logs (DC 7020)
 * Uses General Rating Formula for Diseases of the Heart (METs-based)
 */
export const analyzeCardiomyopathyLogs = (logs, measurements = [], options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'cardiomyopathy-breathlessness', 'cardiomyopathy-fatigue', 'cardiomyopathy-edema',
    'cardiomyopathy-palpitations', 'cardiomyopathy-chest-pain', 'cardiomyopathy-dizziness',
    'cardiomyopathy-syncope', 'cardiomyopathy-activity-limitation',
    'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
    'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  const metsReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'mets-capacity' && new Date(m.timestamp) >= cutoffDate
  ) : [];
  const efReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'ejection-fraction' && new Date(m.timestamp) >= cutoffDate
  ) : [];

  if (relevantLogs.length === 0 && metsReadings.length === 0 && efReadings.length === 0) {
    return {
      hasData: false,
      condition: 'Cardiomyopathy',
      diagnosticCode: '7020',
      message: 'No cardiomyopathy logs found',
      supportedRating: null,
      ratingRationale: [],
      evidenceGaps: ['Start logging cardiomyopathy symptoms and record METs capacity from stress tests'],
      metrics: { totalLogs: 0 },
    };
  }

  const breathlessnessLogs = relevantLogs.filter(log =>
      ['cardiomyopathy-breathlessness', 'cardiac-breathlessness'].includes(getLogSymptomId(log))
  );
  const fatigueLogs = relevantLogs.filter(log =>
      ['cardiomyopathy-fatigue', 'cardiac-fatigue'].includes(getLogSymptomId(log))
  );
  const syncopeLogs = relevantLogs.filter(log =>
      ['cardiomyopathy-syncope', 'cardiac-syncope'].includes(getLogSymptomId(log))
  );
  const edemaLogs = relevantLogs.filter(log =>
      ['cardiomyopathy-edema', 'cardiac-edema'].includes(getLogSymptomId(log))
  );

  let lowestMets = null;
  if (metsReadings.length > 0) {
    lowestMets = Math.min(...metsReadings.map(m => parseFloat(m.values?.mets_level || 99)));
  }

  let hasHypertrophyOrDilatation = false;
  let latestEF = null;
  if (efReadings.length > 0) {
    latestEF = efReadings[efReadings.length - 1];
    if (latestEF.values?.hypertrophy || latestEF.values?.dilatation) {
      hasHypertrophyOrDilatation = true;
    }
  }

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (lowestMets !== null) {
    if (lowestMets <= 3.0) {
      supportedRating = 100;
      rationale = [`METs capacity <=3.0 (${lowestMets} METs documented)`, 'Severely limited functional capacity supports 100% rating'];
    } else if (lowestMets <= 5.0) {
      supportedRating = 60;
      rationale = [`METs capacity 3.1-5.0 (${lowestMets} METs documented)`, 'Moderately limited functional capacity supports 60% rating'];
    } else if (lowestMets <= 7.0 || hasHypertrophyOrDilatation) {
      supportedRating = 30;
      rationale = [lowestMets <= 7.0 ? `METs capacity 5.1-7.0 (${lowestMets} METs)` : 'Cardiac hypertrophy/dilatation documented', 'Pattern supports 30% rating'];
    } else if (lowestMets <= 10.0) {
      supportedRating = 10;
      rationale = [`METs capacity 7.1-10.0 (${lowestMets} METs documented)`, 'Mild limitation supports 10% rating'];
    }
  } else if (hasHypertrophyOrDilatation) {
    supportedRating = 30;
    rationale = ['Cardiac hypertrophy or dilatation documented', 'Supports 30% rating even without METs testing'];
  } else if (relevantLogs.length >= 10) {
    supportedRating = 10;
    rationale = ['Cardiac symptoms documented', 'METs testing recommended for accurate rating'];
  }

  if (metsReadings.length === 0) evidenceGaps.push('No METs capacity documented - request exercise stress test');
  if (efReadings.length === 0) evidenceGaps.push('No ejection fraction documented - echocardiogram recommended');

  return {
    hasData: true,
    condition: 'Cardiomyopathy',
    diagnosticCode: '7020',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      breathlessnessCount: breathlessnessLogs.length,
      fatigueCount: fatigueLogs.length,
      syncopeCount: syncopeLogs.length,
      edemaCount: edemaLogs.length,
      metsLevel: lowestMets,
      ejectionFraction: latestEF?.values?.ef_percent || null,
      hasHypertrophyOrDilatation,
    },
    criteria: CARDIOMYOPATHY_CRITERIA,
  };
};

/**
 * Analyze Coronary Artery Disease (CAD) symptom logs (DC 7005)
 * Uses General Rating Formula for Diseases of the Heart (METs-based)
 */
export const analyzeCADLogs = (logs, measurements = [], options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'cad-angina-stable', 'cad-angina-unstable', 'cad-dyspnea-exertion', 'cad-dyspnea-rest',
    'cad-fatigue', 'cad-dizziness', 'cad-syncope', 'cad-palpitations', 'cad-diaphoresis',
    'cad-nausea', 'cad-activity-limitation', 'cad-nitroglycerin-use', 'cad-hospitalization',
    'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
    'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  // Get METs readings from measurements
  const metsReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'mets-capacity' && new Date(m.timestamp) >= cutoffDate
  ) : [];
  const efReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'ejection-fraction' && new Date(m.timestamp) >= cutoffDate
  ) : [];

  if (relevantLogs.length === 0 && metsReadings.length === 0 && efReadings.length === 0) {
    return {
      hasData: false,
      condition: 'Coronary Artery Disease',
      diagnosticCode: '7005',
      message: 'No CAD symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging CAD symptoms and record METs capacity from stress tests'],
      metrics: { totalLogs: 0 },
    };
  }

  // Categorize symptoms
  const anginaLogs = relevantLogs.filter(log =>
      ['cad-angina-stable', 'cad-angina-unstable', 'cardiac-angina'].includes(getLogSymptomId(log))
  );
  const unstableAnginaLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'cad-angina-unstable'
  );
  const dyspneaLogs = relevantLogs.filter(log =>
      ['cad-dyspnea-exertion', 'cad-dyspnea-rest', 'cardiac-breathlessness'].includes(getLogSymptomId(log))
  );
  const dyspneaRestLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'cad-dyspnea-rest'
  );
  const syncopeLogs = relevantLogs.filter(log =>
      ['cad-syncope', 'cardiac-syncope'].includes(getLogSymptomId(log))
  );
  const nitroLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'cad-nitroglycerin-use'
  );
  const hospitalizationLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'cad-hospitalization'
  );

  // Get lowest METs if available
  let lowestMets = null;
  if (metsReadings.length > 0) {
    lowestMets = Math.min(...metsReadings.map(m => parseFloat(m.values?.mets_level || 99)));
  }

  // Check for hypertrophy/dilatation from EF readings
  let hasHypertrophyOrDilatation = false;
  let latestEF = null;
  if (efReadings.length > 0) {
    latestEF = efReadings[efReadings.length - 1];
    if (latestEF.values?.hypertrophy || latestEF.values?.dilatation) {
      hasHypertrophyOrDilatation = true;
    }
  }

  // Determine rating based on METs and symptoms
  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  // Check for CHF indicators (supports 100%)
  const hasCHFIndicators = dyspneaRestLogs.length > 0 &&
      (relevantLogs.filter(log => ['cad-fatigue', 'cardiac-fatigue'].includes(getLogSymptomId(log))).length > 5 ||
          relevantLogs.filter(log => ['cardiac-edema', 'hhd-edema'].includes(getLogSymptomId(log))).length > 0);

  if (lowestMets !== null) {
    if (lowestMets <= 3.0 || hasCHFIndicators) {
      supportedRating = 100;
      rationale = [
        lowestMets <= 3.0 ? `METs capacity <=3.0 (${lowestMets} METs documented)` : 'Symptoms consistent with CHF (dyspnea at rest, significant fatigue)',
        'Severely limited functional capacity supports 100% rating'
      ];
    } else if (lowestMets <= 5.0) {
      supportedRating = 60;
      rationale = [`METs capacity 3.1-5.0 (${lowestMets} METs documented)`, 'Moderate limitation supports 60% rating'];
    } else if (lowestMets <= 7.0 || hasHypertrophyOrDilatation) {
      supportedRating = 30;
      rationale = [
        lowestMets <= 7.0 ? `METs capacity 5.1-7.0 (${lowestMets} METs)` : 'Cardiac hypertrophy/dilatation documented',
        'Pattern supports 30% rating'
      ];
    } else if (lowestMets <= 10.0) {
      supportedRating = 10;
      rationale = [`METs capacity 7.1-10.0 (${lowestMets} METs documented)`, 'Mild limitation supports 10% rating'];
    }
  } else if (hasCHFIndicators) {
    supportedRating = 100;
    rationale = ['Symptoms consistent with CHF documented', 'METs testing recommended to confirm rating'];
  } else if (hasHypertrophyOrDilatation) {
    supportedRating = 30;
    rationale = ['Cardiac hypertrophy or dilatation documented', 'Supports 30% rating'];
  } else if (unstableAnginaLogs.length > 0 || hospitalizationLogs.length > 0) {
    supportedRating = 60;
    rationale = [
      unstableAnginaLogs.length > 0 ? `${unstableAnginaLogs.length} unstable angina episodes logged` : '',
      hospitalizationLogs.length > 0 ? `${hospitalizationLogs.length} cardiac hospitalizations` : '',
      'Significant cardiac events suggest at least 60% - METs testing recommended'
    ].filter(Boolean);
  } else if (anginaLogs.length >= 5 || nitroLogs.length >= 3) {
    supportedRating = 30;
    rationale = [
      anginaLogs.length >= 5 ? `${anginaLogs.length} angina episodes documented` : '',
      nitroLogs.length >= 3 ? `Nitroglycerin used ${nitroLogs.length} times` : '',
      'Pattern suggests at least 30% - METs testing recommended'
    ].filter(Boolean);
  } else if (relevantLogs.length >= 10) {
    supportedRating = 10;
    rationale = ['CAD symptoms documented', 'Continuous medication likely required - confirms 10% minimum'];
  }

  // Add evidence gaps
  if (metsReadings.length === 0) evidenceGaps.push('No METs capacity documented - request exercise stress test');
  if (efReadings.length === 0) evidenceGaps.push('No ejection fraction documented - echocardiogram recommended');
  if (anginaLogs.length === 0 && relevantLogs.length > 0) evidenceGaps.push('Document angina episodes specifically for stronger evidence');

  return {
    hasData: true,
    condition: 'Coronary Artery Disease',
    diagnosticCode: '7005',
    cfrReference: '38 CFR 4.104',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      anginaCount: anginaLogs.length,
      unstableAnginaCount: unstableAnginaLogs.length,
      dyspneaCount: dyspneaLogs.length,
      syncopeCount: syncopeLogs.length,
      nitroUseCount: nitroLogs.length,
      hospitalizationCount: hospitalizationLogs.length,
      metsLevel: lowestMets,
      ejectionFraction: latestEF?.values?.ef_percent || null,
      hasHypertrophyOrDilatation,
    },
    criteria: CAD_CRITERIA,
  };
};

/**
 * Analyze Post-Myocardial Infarction symptom logs (DC 7006)
 * 100% rating during MI and 3 months following, then METs-based
 */
export const analyzePostMILogs = (logs, measurements = [], options = {}) => {
  const { evaluationPeriodDays = 365, miDate = null } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'post-mi-chest-pain', 'post-mi-dyspnea-exertion', 'post-mi-dyspnea-rest', 'post-mi-fatigue',
    'post-mi-weakness', 'post-mi-dizziness', 'post-mi-syncope', 'post-mi-palpitations',
    'post-mi-edema', 'post-mi-activity-limitation', 'post-mi-anxiety', 'post-mi-hospitalization',
    'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
    'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  // Get METs and EF readings
  const metsReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'mets-capacity' && new Date(m.timestamp) >= cutoffDate
  ) : [];
  const efReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'ejection-fraction' && new Date(m.timestamp) >= cutoffDate
  ) : [];

  if (relevantLogs.length === 0 && metsReadings.length === 0 && efReadings.length === 0) {
    return {
      hasData: false,
      condition: 'Myocardial Infarction (Post-MI)',
      diagnosticCode: '7006',
      message: 'No post-MI symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging post-MI symptoms and record METs capacity'],
      metrics: { totalLogs: 0 },
    };
  }

  // Check if within 3-month recovery period
  let isInRecoveryPeriod = false;
  if (miDate) {
    const miDateObj = new Date(miDate);
    const threeMonthsAfterMI = new Date(miDateObj);
    threeMonthsAfterMI.setMonth(threeMonthsAfterMI.getMonth() + 3);
    isInRecoveryPeriod = new Date() <= threeMonthsAfterMI;
  }

  // Categorize symptoms
  const chestPainLogs = relevantLogs.filter(log =>
      ['post-mi-chest-pain', 'cardiac-angina'].includes(getLogSymptomId(log))
  );
  const dyspneaLogs = relevantLogs.filter(log =>
      ['post-mi-dyspnea-exertion', 'post-mi-dyspnea-rest', 'cardiac-breathlessness'].includes(getLogSymptomId(log))
  );
  const fatigueLogs = relevantLogs.filter(log =>
      ['post-mi-fatigue', 'cardiac-fatigue'].includes(getLogSymptomId(log))
  );
  const syncopeLogs = relevantLogs.filter(log =>
      ['post-mi-syncope', 'cardiac-syncope'].includes(getLogSymptomId(log))
  );
  const edemaLogs = relevantLogs.filter(log =>
      ['post-mi-edema', 'cardiac-edema'].includes(getLogSymptomId(log))
  );
  const hospitalizationLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'post-mi-hospitalization'
  );

  // Get lowest METs
  let lowestMets = null;
  if (metsReadings.length > 0) {
    lowestMets = Math.min(...metsReadings.map(m => parseFloat(m.values?.mets_level || 99)));
  }

  // Check for hypertrophy/dilatation
  let hasHypertrophyOrDilatation = false;
  let latestEF = null;
  if (efReadings.length > 0) {
    latestEF = efReadings[efReadings.length - 1];
    if (latestEF.values?.hypertrophy || latestEF.values?.dilatation) {
      hasHypertrophyOrDilatation = true;
    }
  }

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  // If in recovery period, automatic 100%
  if (isInRecoveryPeriod) {
    supportedRating = 100;
    rationale = ['Within 3-month recovery period following MI', 'Automatic 100% rating per 38 CFR 4.104'];
  } else if (lowestMets !== null) {
    if (lowestMets <= 3.0) {
      supportedRating = 100;
      rationale = [`METs capacity <=3.0 (${lowestMets} METs documented)`, 'Severely limited capacity supports 100% rating'];
    } else if (lowestMets <= 5.0) {
      supportedRating = 60;
      rationale = [`METs capacity 3.1-5.0 (${lowestMets} METs documented)`, 'Moderate limitation supports 60% rating'];
    } else if (lowestMets <= 7.0 || hasHypertrophyOrDilatation) {
      supportedRating = 30;
      rationale = [
        lowestMets <= 7.0 ? `METs capacity 5.1-7.0 (${lowestMets} METs)` : 'Cardiac hypertrophy/dilatation documented',
        'Supports 30% rating'
      ];
    } else if (lowestMets <= 10.0) {
      supportedRating = 10;
      rationale = [`METs capacity 7.1-10.0 (${lowestMets} METs)`, 'Mild limitation supports 10% rating'];
    }
  } else if (hasHypertrophyOrDilatation) {
    supportedRating = 30;
    rationale = ['Cardiac hypertrophy or dilatation documented', 'Supports 30% rating'];
  } else if (hospitalizationLogs.length > 0) {
    supportedRating = 60;
    rationale = [`${hospitalizationLogs.length} post-MI hospitalizations`, 'Significant events suggest at least 60% - METs testing needed'];
  } else if (relevantLogs.length >= 10) {
    supportedRating = 10;
    rationale = ['Post-MI symptoms documented', 'Continuous medication likely - supports minimum 10%'];
  }

  // Evidence gaps
  if (metsReadings.length === 0) evidenceGaps.push('No METs capacity documented - request cardiac stress test');
  if (efReadings.length === 0) evidenceGaps.push('No ejection fraction documented - echocardiogram recommended');
  if (!miDate) evidenceGaps.push('Document MI date for accurate recovery period tracking');

  return {
    hasData: true,
    condition: 'Myocardial Infarction (Post-MI)',
    diagnosticCode: '7006',
    cfrReference: '38 CFR 4.104',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      chestPainCount: chestPainLogs.length,
      dyspneaCount: dyspneaLogs.length,
      fatigueCount: fatigueLogs.length,
      syncopeCount: syncopeLogs.length,
      edemaCount: edemaLogs.length,
      hospitalizationCount: hospitalizationLogs.length,
      metsLevel: lowestMets,
      ejectionFraction: latestEF?.values?.ef_percent || null,
      hasHypertrophyOrDilatation,
      isInRecoveryPeriod,
    },
    criteria: POST_MI_CRITERIA,
  };
};

/**
 * Analyze Hypertensive Heart Disease symptom logs (DC 7007)
 * Requires hypertension WITH cardiac involvement
 */
export const analyzeHypertensiveHeartLogs = (logs, measurements = [], options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'hhd-dyspnea-exertion', 'hhd-dyspnea-rest', 'hhd-orthopnea', 'hhd-pnd', 'hhd-fatigue',
    'hhd-edema', 'hhd-weight-gain', 'hhd-chest-discomfort', 'hhd-palpitations', 'hhd-dizziness',
    'hhd-syncope', 'hhd-activity-limitation', 'hhd-hospitalization',
    'cardiac-breathlessness', 'cardiac-fatigue', 'cardiac-angina', 'cardiac-dizziness',
    'cardiac-syncope', 'cardiac-palpitations', 'cardiac-edema', 'cardiac-orthopnea'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  // Get METs, EF, and BP readings
  const metsReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'mets-capacity' && new Date(m.timestamp) >= cutoffDate
  ) : [];
  const efReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'ejection-fraction' && new Date(m.timestamp) >= cutoffDate
  ) : [];
  const bpReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'blood-pressure' && new Date(m.timestamp) >= cutoffDate
  ) : [];

  if (relevantLogs.length === 0 && metsReadings.length === 0 && efReadings.length === 0) {
    return {
      hasData: false,
      condition: 'Hypertensive Heart Disease',
      diagnosticCode: '7007',
      message: 'No hypertensive heart disease symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging HHD symptoms and record METs capacity and blood pressure'],
      metrics: { totalLogs: 0 },
    };
  }

  // Categorize symptoms
  const dyspneaLogs = relevantLogs.filter(log =>
      ['hhd-dyspnea-exertion', 'hhd-dyspnea-rest', 'cardiac-breathlessness'].includes(getLogSymptomId(log))
  );
  const dyspneaRestLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'hhd-dyspnea-rest'
  );
  const orthopneaLogs = relevantLogs.filter(log =>
      ['hhd-orthopnea', 'hhd-pnd', 'cardiac-orthopnea'].includes(getLogSymptomId(log))
  );
  const edemaLogs = relevantLogs.filter(log =>
      ['hhd-edema', 'cardiac-edema'].includes(getLogSymptomId(log))
  );
  const fatigueLogs = relevantLogs.filter(log =>
      ['hhd-fatigue', 'cardiac-fatigue'].includes(getLogSymptomId(log))
  );
  const syncopeLogs = relevantLogs.filter(log =>
      ['hhd-syncope', 'cardiac-syncope'].includes(getLogSymptomId(log))
  );
  const hospitalizationLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'hhd-hospitalization'
  );

  // Get lowest METs
  let lowestMets = null;
  if (metsReadings.length > 0) {
    lowestMets = Math.min(...metsReadings.map(m => parseFloat(m.values?.mets_level || 99)));
  }

  // Check for LVH or dilatation
  let hasHypertrophyOrDilatation = false;
  let latestEF = null;
  if (efReadings.length > 0) {
    latestEF = efReadings[efReadings.length - 1];
    if (latestEF.values?.hypertrophy || latestEF.values?.dilatation) {
      hasHypertrophyOrDilatation = true;
    }
  }

  // Check for documented hypertension
  let hasDocumentedHypertension = bpReadings.length > 0;
  let avgSystolic = 0;
  if (bpReadings.length > 0) {
    avgSystolic = bpReadings.reduce((sum, r) => sum + (r.values?.systolic || 0), 0) / bpReadings.length;
  }

  // Check for CHF indicators
  const hasCHFIndicators = (dyspneaRestLogs.length > 0 || orthopneaLogs.length >= 2) &&
      (edemaLogs.length >= 2 || fatigueLogs.length >= 5);

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (lowestMets !== null) {
    if (lowestMets <= 3.0 || hasCHFIndicators) {
      supportedRating = 100;
      rationale = [
        lowestMets <= 3.0 ? `METs capacity <=3.0 (${lowestMets} METs documented)` : 'CHF symptoms documented (dyspnea at rest, orthopnea, edema)',
        'Severely limited capacity supports 100% rating'
      ];
    } else if (lowestMets <= 5.0) {
      supportedRating = 60;
      rationale = [`METs capacity 3.1-5.0 (${lowestMets} METs documented)`, 'Moderate limitation supports 60% rating'];
    } else if (lowestMets <= 7.0 || hasHypertrophyOrDilatation) {
      supportedRating = 30;
      rationale = [
        lowestMets <= 7.0 ? `METs capacity 5.1-7.0 (${lowestMets} METs)` : 'Left ventricular hypertrophy/dilatation documented',
        'Supports 30% rating'
      ];
    } else if (lowestMets <= 10.0) {
      supportedRating = 10;
      rationale = [`METs capacity 7.1-10.0 (${lowestMets} METs)`, 'Mild limitation supports 10% rating'];
    }
  } else if (hasCHFIndicators) {
    supportedRating = 100;
    rationale = ['CHF symptoms documented', 'METs testing recommended to confirm rating'];
  } else if (hasHypertrophyOrDilatation) {
    supportedRating = 30;
    rationale = ['Left ventricular hypertrophy documented', 'Supports 30% rating'];
  } else if (hospitalizationLogs.length > 0) {
    supportedRating = 60;
    rationale = [`${hospitalizationLogs.length} heart failure hospitalizations`, 'Significant events suggest at least 60%'];
  } else if (relevantLogs.length >= 10) {
    supportedRating = 10;
    rationale = ['HHD symptoms documented', 'Continuous medication likely - supports minimum 10%'];
  }

  // Evidence gaps
  if (metsReadings.length === 0) evidenceGaps.push('No METs capacity documented - request cardiac stress test');
  if (efReadings.length === 0) evidenceGaps.push('No ejection fraction/LVH assessment - echocardiogram recommended');
  if (!hasDocumentedHypertension) evidenceGaps.push('Document blood pressure readings to establish hypertension connection');

  return {
    hasData: true,
    condition: 'Hypertensive Heart Disease',
    diagnosticCode: '7007',
    cfrReference: '38 CFR 4.104',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      dyspneaCount: dyspneaLogs.length,
      orthopneaCount: orthopneaLogs.length,
      edemaCount: edemaLogs.length,
      fatigueCount: fatigueLogs.length,
      syncopeCount: syncopeLogs.length,
      hospitalizationCount: hospitalizationLogs.length,
      metsLevel: lowestMets,
      ejectionFraction: latestEF?.values?.ef_percent || null,
      hasHypertrophyOrDilatation,
      avgSystolicBP: avgSystolic > 0 ? Math.round(avgSystolic) : null,
      bpReadingsCount: bpReadings.length,
    },
    criteria: HYPERTENSIVE_HEART_CRITERIA,
  };
};

/**
 * Analyze Cold Injury Residuals symptom logs (DC 7122)
 * Rates each affected body part separately
 */
export const analyzeColdInjuryLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'cold-injury-pain', 'cold-injury-numbness', 'cold-injury-cold-sensitivity',
    'cold-injury-tingling', 'cold-injury-color-changes', 'cold-injury-tissue-loss',
    'cold-injury-nail-abnormalities', 'cold-injury-impaired-sensation',
    'cold-injury-hyperhidrosis', 'cold-injury-stiffness', 'cold-injury-swelling',
    'cold-injury-xray-abnormality'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Cold Injury Residuals',
      diagnosticCode: '7122',
      message: 'No cold injury symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging cold injury symptoms - identify which body parts are affected'],
      metrics: { totalLogs: 0 },
    };
  }

  // Primary symptoms (pain, numbness, cold sensitivity)
  const primarySymptomLogs = relevantLogs.filter(log =>
      ['cold-injury-pain', 'cold-injury-numbness', 'cold-injury-cold-sensitivity', 'cold-injury-tingling'].includes(getLogSymptomId(log))
  );

  // Additional findings that increase rating
  const tissueLossLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cold-injury-tissue-loss');
  const nailAbnormalityLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cold-injury-nail-abnormalities');
  const colorChangeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cold-injury-color-changes');
  const impairedSensationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cold-injury-impaired-sensation');
  const hyperhidrosisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cold-injury-hyperhidrosis');
  const xrayAbnormalityLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cold-injury-xray-abnormality');

  // Count additional findings present
  let additionalFindings = 0;
  const findingsList = [];
  if (tissueLossLogs.length > 0) { additionalFindings++; findingsList.push('tissue loss'); }
  if (nailAbnormalityLogs.length > 0) { additionalFindings++; findingsList.push('nail abnormalities'); }
  if (colorChangeLogs.length > 0) { additionalFindings++; findingsList.push('color changes'); }
  if (impairedSensationLogs.length > 0) { additionalFindings++; findingsList.push('impaired sensation'); }
  if (hyperhidrosisLogs.length > 0) { additionalFindings++; findingsList.push('hyperhidrosis'); }
  if (xrayAbnormalityLogs.length > 0) { additionalFindings++; findingsList.push('X-ray abnormalities'); }

  const hasPrimarySymptoms = primarySymptomLogs.length > 0;

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (hasPrimarySymptoms) {
    if (additionalFindings >= 2) {
      supportedRating = 30;
      rationale = [
        'Primary symptoms (pain/numbness/cold sensitivity) documented',
        `${additionalFindings} additional findings: ${findingsList.join(', ')}`,
        'Pattern supports 30% rating per affected body part'
      ];
    } else if (additionalFindings === 1) {
      supportedRating = 20;
      rationale = [
        'Primary symptoms documented',
        `1 additional finding: ${findingsList.join(', ')}`,
        'Pattern supports 20% rating per affected body part'
      ];
    } else {
      supportedRating = 10;
      rationale = [
        'Primary symptoms (pain/numbness/cold sensitivity) documented',
        'No additional objective findings logged',
        'Pattern supports 10% rating per affected body part'
      ];
    }
  } else if (additionalFindings > 0) {
    supportedRating = 10;
    rationale = [
      `Additional findings documented: ${findingsList.join(', ')}`,
      'Document primary symptoms (pain, numbness, cold sensitivity) for higher rating'
    ];
  }

  // Evidence gaps
  if (primarySymptomLogs.length === 0) {
    evidenceGaps.push('Document primary symptoms: pain, numbness, or cold sensitivity');
  }
  if (additionalFindings < 2 && supportedRating < 30) {
    evidenceGaps.push('Document additional findings (tissue loss, nail changes, color changes, impaired sensation, hyperhidrosis, X-ray abnormalities) for higher rating');
  }
  evidenceGaps.push('Note: Each affected body part (hand, foot, ear, nose) should be documented separately');

  return {
    hasData: true,
    condition: 'Cold Injury Residuals',
    diagnosticCode: '7122',
    cfrReference: '38 CFR 4.104',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      primarySymptomCount: primarySymptomLogs.length,
      additionalFindings,
      findingsList,
      tissueLoss: tissueLossLogs.length > 0,
      nailAbnormalities: nailAbnormalityLogs.length > 0,
      colorChanges: colorChangeLogs.length > 0,
      impairedSensation: impairedSensationLogs.length > 0,
      hyperhidrosis: hyperhidrosisLogs.length > 0,
      xrayAbnormalities: xrayAbnormalityLogs.length > 0,
    },
    criteria: COLD_INJURY_CRITERIA,
  };
};

/**
 * Analyze Peripheral Arterial Disease (PAD) symptom logs (DC 7114)
 * Uses ABI measurements when available
 */
export const analyzePADLogs = (logs, measurements = [], options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'pad-claudication-mild', 'pad-claudication-moderate', 'pad-claudication-severe',
    'pad-rest-pain', 'pad-coldness', 'pad-numbness',
    'pad-trophic-thin-skin', 'pad-trophic-hair-loss', 'pad-trophic-nail-changes',
    'pad-diminished-pulses', 'pad-color-changes', 'pad-ulceration',
    'pad-slow-healing', 'pad-gangrene'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  // Get ABI readings from measurements
  const abiReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'ankle-brachial-index' && new Date(m.timestamp) >= cutoffDate
  ) : [];

  if (relevantLogs.length === 0 && abiReadings.length === 0) {
    return {
      hasData: false,
      condition: 'Peripheral Arterial Disease',
      diagnosticCode: '7114',
      message: 'No PAD symptoms logged',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging PAD symptoms and record ABI measurements'],
      metrics: { totalLogs: 0 },
    };
  }

  // Categorize symptoms
  const claudicationMildLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-claudication-mild');
  const claudicationModerateLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-claudication-moderate');
  const claudicationSevereLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-claudication-severe');
  const restPainLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-rest-pain');
  const coldnessLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-coldness');
  const ulcerationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-ulceration');
  const gangreneLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-gangrene');
  const diminishedPulsesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pad-diminished-pulses');

  // Trophic changes
  const trophicLogs = relevantLogs.filter(log =>
      ['pad-trophic-thin-skin', 'pad-trophic-hair-loss', 'pad-trophic-nail-changes'].includes(getLogSymptomId(log))
  );
  const hasTrophicChanges = trophicLogs.length > 0;

  // Get lowest ABI if available
  let lowestABI = null;
  if (abiReadings.length > 0) {
    lowestABI = Math.min(...abiReadings.map(m => {
      // Calculate ABI from ankle/brachial values if not pre-calculated
      if (m.values?.abi_calculated) return parseFloat(m.values.abi_calculated);
      if (m.values?.ankle_systolic && m.values?.brachial_systolic) {
        return parseFloat(m.values.ankle_systolic) / parseFloat(m.values.brachial_systolic);
      }
      return 99;
    }));
    if (lowestABI === 99) lowestABI = null;
  }

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  // Determine rating based on symptoms and ABI
  const hasRestPain = restPainLogs.length > 0;
  const hasUlceration = ulcerationLogs.length > 0 || gangreneLogs.length > 0;
  const hasSevereClaudication = claudicationSevereLogs.length > 0;
  const hasModerateClaudication = claudicationModerateLogs.length > 0;
  const hasMildClaudication = claudicationMildLogs.length > 0;
  const hasPersistentColdness = coldnessLogs.length >= 3; // Multiple episodes suggest persistent
  const hasDiminishedPulses = diminishedPulsesLogs.length > 0;

  // 100% rating criteria
  if (hasRestPain && (hasUlceration || (lowestABI !== null && lowestABI <= 0.4))) {
    supportedRating = 100;
    rationale = [
      'Ischemic rest pain documented',
      hasUlceration ? 'Ischemic ulceration/gangrene present' : `ABI <=0.4 (${lowestABI?.toFixed(2)})`,
      'Pattern supports 100% rating per extremity'
    ];
  }
  // 60% rating criteria
  else if (hasSevereClaudication && (hasPersistentColdness || (lowestABI !== null && lowestABI <= 0.5))) {
    supportedRating = 60;
    rationale = [
      'Severe claudication (<25 yards) documented',
      hasPersistentColdness ? 'Persistent coldness documented' : `ABI <=0.5 (${lowestABI?.toFixed(2)})`,
      'Pattern supports 60% rating per extremity'
    ];
  }
  // 40% rating criteria
  else if (hasModerateClaudication && (hasTrophicChanges || (lowestABI !== null && lowestABI <= 0.7))) {
    supportedRating = 40;
    rationale = [
      'Moderate claudication (25-100 yards) documented',
      hasTrophicChanges ? 'Trophic changes present' : `ABI <=0.7 (${lowestABI?.toFixed(2)})`,
      'Pattern supports 40% rating per extremity'
    ];
  }
  // 20% rating criteria
  else if ((hasMildClaudication || hasModerateClaudication || hasSevereClaudication) &&
      (hasDiminishedPulses || (lowestABI !== null && lowestABI <= 0.9))) {
    supportedRating = 20;
    rationale = [
      'Claudication documented',
      hasDiminishedPulses ? 'Diminished peripheral pulses documented' : `ABI <=0.9 (${lowestABI?.toFixed(2)})`,
      'Pattern supports 20% rating per extremity'
    ];
  }
  // Has symptoms but doesn't meet full criteria
  else if (relevantLogs.length > 0) {
    supportedRating = 20;
    rationale = [
      'PAD symptoms documented',
      'ABI measurement recommended to confirm rating level'
    ];
  }

  // Evidence gaps
  if (abiReadings.length === 0) {
    evidenceGaps.push('No ABI measurements documented - request vascular studies');
  }
  if (!hasRestPain && !hasSevereClaudication && !hasModerateClaudication && !hasMildClaudication) {
    evidenceGaps.push('Document claudication with specific walking distance');
  }
  if (!hasTrophicChanges && supportedRating < 40) {
    evidenceGaps.push('Document trophic changes if present (thin skin, hair loss, nail changes)');
  }

  return {
    hasData: true,
    condition: 'Peripheral Arterial Disease',
    diagnosticCode: '7114',
    cfrReference: '38 CFR 4.104',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      claudicationMild: claudicationMildLogs.length,
      claudicationModerate: claudicationModerateLogs.length,
      claudicationSevere: claudicationSevereLogs.length,
      restPainCount: restPainLogs.length,
      coldnessCount: coldnessLogs.length,
      ulcerationCount: ulcerationLogs.length,
      trophicChangeCount: trophicLogs.length,
      diminishedPulsesCount: diminishedPulsesLogs.length,
      lowestABI,
      abiReadingsCount: abiReadings.length,
    },
    criteria: PAD_CRITERIA,
  };
};


/**
 * Analyze SVT (Supraventricular Tachycardia) symptom logs (DC 7010)
 */
export const analyzeSVTLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'svt-episode', 'svt-treatment-iv', 'svt-treatment-cardioversion', 'svt-treatment-ablation',
    'svt-vagal-maneuver', 'svt-oral-medication',
    'arrhythmia-palpitations', 'arrhythmia-racing-heart', 'arrhythmia-skipped-beats',
    'arrhythmia-dizziness', 'arrhythmia-syncope', 'arrhythmia-chest-discomfort'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Supraventricular Tachycardia',
      diagnosticCode: '7010',
      message: 'No SVT logs found',
      supportedRating: null,
      ratingRationale: [],
      evidenceGaps: ['Start logging SVT episodes and any treatments required'],
      metrics: { totalLogs: 0 },
    };
  }

  const episodeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'svt-episode');
  const ivTreatmentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'svt-treatment-iv');
  const cardioversionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'svt-treatment-cardioversion');
  const ablationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'svt-treatment-ablation');
  const vagalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'svt-vagal-maneuver');
  const oralMedLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'svt-oral-medication');

  const treatmentInterventions = ivTreatmentLogs.length + cardioversionLogs.length + ablationLogs.length;

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (treatmentInterventions >= 5) {
    supportedRating = 30;
    rationale = [`${treatmentInterventions} treatment interventions documented`, 'Pattern supports 30% rating (5+ interventions/year)'];
  } else if (treatmentInterventions >= 1 || oralMedLogs.length > 0 || vagalLogs.length > 0) {
    supportedRating = 10;
    rationale = [];
    if (treatmentInterventions >= 1) rationale.push(`${treatmentInterventions} treatment intervention(s) documented`);
    if (oralMedLogs.length > 0) rationale.push('Oral medication use documented');
    if (vagalLogs.length > 0) rationale.push('Vagal maneuver use documented');
    rationale.push('Pattern supports 10% rating');
  }

  if (episodeLogs.length === 0) evidenceGaps.push('Log SVT episodes with ECG confirmation if available');
  if (treatmentInterventions === 0 && oralMedLogs.length === 0) {
    evidenceGaps.push('Document any treatments required (IV meds, cardioversion, ablation, oral meds)');
  }

  return {
    hasData: true,
    condition: 'Supraventricular Tachycardia',
    diagnosticCode: '7010',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      episodeCount: episodeLogs.length,
      treatmentInterventions,
      ivTreatments: ivTreatmentLogs.length,
      cardioversions: cardioversionLogs.length,
      ablations: ablationLogs.length,
      vagalManeuvers: vagalLogs.length,
      oralMedicationLogs: oralMedLogs.length,
    },
    criteria: SVT_CRITERIA,
  };
};

/**
 * Analyze Ventricular Arrhythmia symptom logs (DC 7011)
 */
export const analyzeVentricularArrhythmiaLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'ventricular-arrhythmia-episode', 'ventricular-arrhythmia-hospitalization',
    'aicd-implant', 'aicd-shock',
    'arrhythmia-palpitations', 'arrhythmia-racing-heart', 'arrhythmia-syncope'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Ventricular Arrhythmias',
      diagnosticCode: '7011',
      message: 'No ventricular arrhythmia logs found',
      supportedRating: null,
      ratingRationale: [],
      evidenceGaps: ['Start logging ventricular arrhythmia episodes and any AICD events'],
      metrics: { totalLogs: 0 },
    };
  }

  const episodeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ventricular-arrhythmia-episode');
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ventricular-arrhythmia-hospitalization');
  const aicdImplantLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aicd-implant');
  const aicdShockLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aicd-shock');

  const hasAICD = aicdImplantLogs.length > 0;

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (hasAICD || hospitalizationLogs.length > 0) {
    supportedRating = 100;
    rationale = [];
    if (hasAICD) rationale.push('AICD (implantable defibrillator) in place');
    if (hospitalizationLogs.length > 0) rationale.push(`${hospitalizationLogs.length} hospitalization(s) for ventricular arrhythmia`);
    rationale.push('100% rating applies with AICD or during/following hospitalization');
  } else if (episodeLogs.length > 0) {
    supportedRating = 10;
    rationale = ['Ventricular arrhythmia episodes documented', 'Rate under General Rating Formula after stabilization'];
  }

  if (!hasAICD && hospitalizationLogs.length === 0) {
    evidenceGaps.push('Document AICD implant or hospitalizations for 100% rating');
  }
  if (aicdShockLogs.length > 0) {
    rationale.push(`${aicdShockLogs.length} AICD shock(s) delivered`);
  }

  return {
    hasData: true,
    condition: 'Ventricular Arrhythmias',
    diagnosticCode: '7011',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      episodeCount: episodeLogs.length,
      hospitalizations: hospitalizationLogs.length,
      hasAICD,
      aicdShocks: aicdShockLogs.length,
    },
    criteria: VENTRICULAR_ARRHYTHMIA_CRITERIA,
  };
};

/**
 * Analyze Pericarditis symptom logs (DC 7002)
 */
export const analyzePericarditisLogs = (logs, measurements = [], options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'pericarditis-chest-pain', 'pericarditis-pain-breathing', 'pericarditis-pain-lying-down',
    'pericarditis-fever', 'pericarditis-palpitations', 'pericarditis-shortness-breath',
    'pericarditis-active-infection', 'pericarditis-effusion'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Pericarditis',
      diagnosticCode: '7002',
      message: 'No pericarditis logs found',
      supportedRating: null,
      ratingRationale: [],
      evidenceGaps: ['Start logging pericarditis symptoms including chest pain and active infection periods'],
      metrics: { totalLogs: 0 },
    };
  }

  const activeInfectionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pericarditis-active-infection');
  const chestPainLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pericarditis-chest-pain');
  const effusionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pericarditis-effusion');

  const metsReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'mets-capacity' && new Date(m.timestamp) >= cutoffDate
  ) : [];

  let lowestMets = null;
  if (metsReadings.length > 0) {
    lowestMets = Math.min(...metsReadings.map(m => parseFloat(m.values?.mets_level || 99)));
  }

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  // Check for active infection (recent logs within 90 days suggest active)
  const recentCutoff = new Date();
  recentCutoff.setDate(recentCutoff.getDate() - 90);
  const recentActiveInfection = activeInfectionLogs.some(log => new Date(log.timestamp) >= recentCutoff);

  if (recentActiveInfection) {
    supportedRating = 100;
    rationale = ['Active pericarditis infection documented', '100% rating during active infection and 3 months post-treatment'];
  } else if (lowestMets !== null) {
    if (lowestMets <= 5.0) {
      supportedRating = 60;
      rationale = [`Post-active: METs ${lowestMets} (3.1-5.0 range)`, 'Supports 60% rating'];
    } else if (lowestMets <= 7.0) {
      supportedRating = 30;
      rationale = [`Post-active: METs ${lowestMets} (5.1-7.0 range)`, 'Supports 30% rating'];
    } else if (lowestMets <= 10.0) {
      supportedRating = 10;
      rationale = [`Post-active: METs ${lowestMets} (7.1-10.0 range)`, 'Supports 10% rating'];
    }
  } else if (chestPainLogs.length > 0 || effusionLogs.length > 0) {
    supportedRating = 10;
    rationale = ['Pericarditis symptoms documented', 'METs testing needed for accurate post-active rating'];
  }

  if (metsReadings.length === 0 && !recentActiveInfection) {
    evidenceGaps.push('METs capacity needed for post-active pericarditis rating');
  }
  if (activeInfectionLogs.length === 0) {
    evidenceGaps.push('Document active infection periods for 100% rating eligibility');
  }

  return {
    hasData: true,
    condition: 'Pericarditis',
    diagnosticCode: '7002',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      activeInfectionLogs: activeInfectionLogs.length,
      chestPainLogs: chestPainLogs.length,
      effusionLogs: effusionLogs.length,
      metsLevel: lowestMets,
      recentActiveInfection,
    },
    criteria: PERICARDITIS_CRITERIA,
  };
};

/**
 * Analyze Post-Phlebitic Syndrome symptom logs (DC 7121)
 */
export const analyzePostPhlebiticLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 90 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'post-phlebitic-edema', 'post-phlebitic-pain', 'post-phlebitic-aching',
    'post-phlebitic-pigmentation', 'post-phlebitic-eczema', 'post-phlebitic-ulcer',
    'post-phlebitic-induration', 'post-phlebitic-pain-rest'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Post-Phlebitic Syndrome',
      diagnosticCode: '7121',
      message: 'No post-phlebitic syndrome logs found',
      supportedRating: null,
      ratingRationale: [],
      evidenceGaps: ['Start logging post-phlebitic symptoms including edema, skin changes, and ulcers'],
      metrics: { totalLogs: 0 },
    };
  }

  const edemaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'post-phlebitic-edema');
  const pigmentationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'post-phlebitic-pigmentation');
  const eczemaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'post-phlebitic-eczema');
  const ulcerLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'post-phlebitic-ulcer');
  const painRestLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'post-phlebitic-pain-rest');
  const achingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'post-phlebitic-aching');

  const hasSkinChanges = pigmentationLogs.length > 0 || eczemaLogs.length > 0;

  let supportedRating = 0;
  let rationale = [];
  let evidenceGaps = [];

  if (painRestLogs.length >= 30 && edemaLogs.length >= 30) {
    supportedRating = 100;
    rationale = ['Constant pain at rest with massive edema documented', 'Pattern supports 100% rating'];
  } else if (ulcerLogs.length >= 5 && edemaLogs.length >= 10 && hasSkinChanges) {
    supportedRating = 60;
    rationale = ['Persistent edema, skin changes, and persistent ulceration', 'Pattern supports 60% rating'];
  } else if (edemaLogs.length >= 10 && hasSkinChanges) {
    supportedRating = 40;
    rationale = ['Persistent edema with stasis pigmentation/eczema', 'Pattern supports 40% rating'];
  } else if (edemaLogs.length >= 5) {
    supportedRating = 20;
    rationale = ['Persistent edema documented', 'Pattern supports 20% rating'];
  } else if (achingLogs.length > 0 || edemaLogs.length > 0) {
    supportedRating = 10;
    rationale = ['Intermittent symptoms documented', 'Pattern supports 10% rating'];
  }

  evidenceGaps.push('Track symptoms separately for each leg if bilateral');
  if (ulcerLogs.length === 0) evidenceGaps.push('Document any venous ulcers - significantly affects rating');
  if (!hasSkinChanges) evidenceGaps.push('Document skin pigmentation changes or stasis eczema');

  return {
    hasData: true,
    condition: 'Post-Phlebitic Syndrome',
    diagnosticCode: '7121',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale: rationale,
    gaps: evidenceGaps,
    metrics: {
      totalLogs: relevantLogs.length,
      edemaCount: edemaLogs.length,
      pigmentationCount: pigmentationLogs.length,
      eczemaCount: eczemaLogs.length,
      ulcerCount: ulcerLogs.length,
      painAtRestCount: painRestLogs.length,
      achingCount: achingLogs.length,
    },
    criteria: POST_PHLEBITIC_CRITERIA,
  };
};


// ============================================
// PHASE 10: DIGESTIVE ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyze Cirrhosis symptom logs (DC 7312)
 */
export const analyzeCirrhosisLogs = (logs, measurements = [], options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'cirrhosis-fatigue', 'cirrhosis-ascites', 'cirrhosis-edema', 'cirrhosis-jaundice',
    'cirrhosis-encephalopathy', 'cirrhosis-variceal-bleed', 'cirrhosis-sbp', 'cirrhosis-coagulopathy',
    'cirrhosis-splenomegaly', 'cirrhosis-anorexia', 'cirrhosis-malaise', 'cirrhosis-abdominal-pain',
    'cirrhosis-itching', 'cirrhosis-hospitalization'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Cirrhosis of the Liver',
      diagnosticCode: '7312',
      message: 'No cirrhosis logs found',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging cirrhosis symptoms including fatigue, ascites, and complications'],
      metrics: { totalLogs: 0 },
    };
  }

  // Get MELD score from measurements
  const meldReadings = Array.isArray(measurements) ? measurements.filter(m =>
      m.measurementType === 'meld-score' && new Date(m.timestamp) >= cutoffDate
  ) : [];

  let latestMeld = null;
  if (meldReadings.length > 0) {
    const sorted = meldReadings.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    latestMeld = sorted[0]?.values?.meld_score;
  }

  // Count specific symptoms
  const fatigueLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-fatigue');
  const ascitesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-ascites');
  const encephalopathyLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-encephalopathy');
  const varicealBleedLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-variceal-bleed');
  const sbpLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-sbp');
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-hospitalization');
  const anorexiaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-anorexia');
  const malaiseLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-malaise');
  const painLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-abdominal-pain');
  const splenomegalyLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cirrhosis-splenomegaly');

  const hasMajorComplication = encephalopathyLogs.length > 0 || varicealBleedLogs.length > 0 ||
      sbpLogs.length > 0 || ascitesLogs.length > 0;
  const hasPortalHypertensionSigns = ascitesLogs.length > 0 || splenomegalyLogs.length > 0;
  const hasMildSymptoms = anorexiaLogs.length > 0 || fatigueLogs.length > 0 ||
      malaiseLogs.length > 0 || painLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  // Determine rating based on MELD or symptoms
  if (latestMeld && latestMeld >= 15) {
    supportedRating = 100;
    ratingRationale = [`MELD score ${latestMeld} (>=15 supports 100%)`];
  } else if (hasMajorComplication && fatigueLogs.length >= 20) {
    supportedRating = 100;
    ratingRationale = ['Daily debilitating symptoms with major complication documented'];
    if (encephalopathyLogs.length > 0) ratingRationale.push('Hepatic encephalopathy documented');
    if (varicealBleedLogs.length > 0) ratingRationale.push('Variceal hemorrhage documented');
    if (sbpLogs.length > 0) ratingRationale.push('Spontaneous bacterial peritonitis documented');
    if (ascitesLogs.length > 0) ratingRationale.push('Ascites documented');
  } else if (latestMeld && latestMeld >= 12) {
    supportedRating = 60;
    ratingRationale = [`MELD score ${latestMeld} (12-14 supports 60%)`];
  } else if (fatigueLogs.length >= 10 && (varicealBleedLogs.length > 0 || encephalopathyLogs.length > 0)) {
    supportedRating = 60;
    ratingRationale = ['Daily fatigue with variceal hemorrhage or encephalopathy in past year'];
  } else if (latestMeld && latestMeld >= 10) {
    supportedRating = 30;
    ratingRationale = [`MELD score ${latestMeld} (10-11 supports 30%)`];
  } else if (hasPortalHypertensionSigns && hasMildSymptoms) {
    supportedRating = 30;
    ratingRationale = ['Portal hypertension signs with weakness/anorexia/pain/malaise'];
  } else if (latestMeld && latestMeld > 6) {
    supportedRating = 10;
    ratingRationale = [`MELD score ${latestMeld} (7-9 supports 10%)`];
  } else if (hasMildSymptoms) {
    supportedRating = 10;
    ratingRationale = ['Symptoms documented (anorexia, weakness, pain, or malaise)'];
  } else {
    ratingRationale = ['Cirrhosis symptoms documented', 'Document symptom severity for rating determination'];
  }

  // Documentation gaps
  if (!latestMeld) {
    gaps.push('Record MELD score from lab values for accurate rating');
  }
  if (ascitesLogs.length === 0) {
    gaps.push('Document ascites episodes if present');
  }
  if (encephalopathyLogs.length === 0 && hospitalizationLogs.length > 0) {
    gaps.push('Document hepatic encephalopathy episodes if experienced');
  }

  return {
    hasData: true,
    condition: 'Cirrhosis of the Liver',
    diagnosticCode: '7312',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      meldScore: latestMeld,
      fatigueLogs: fatigueLogs.length,
      ascitesLogs: ascitesLogs.length,
      encephalopathyLogs: encephalopathyLogs.length,
      varicealBleedLogs: varicealBleedLogs.length,
      hospitalizationLogs: hospitalizationLogs.length,
    },
    criteria: CIRRHOSIS_CRITERIA,
  };
};

/**
 * Analyze Gastritis symptom logs (DC 7307) - Rated as Peptic Ulcer DC 7304
 */
export const analyzeGastritisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'gastritis-abdominal-pain', 'gastritis-nausea', 'gastritis-vomiting', 'gastritis-bloating',
    'gastritis-indigestion', 'gastritis-hematemesis', 'gastritis-melena', 'gastritis-hospitalization'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Gastritis, Chronic',
      diagnosticCode: '7307',
      message: 'No gastritis logs found',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging gastritis symptoms including pain episodes, nausea, and any bleeding'],
      metrics: { totalLogs: 0 },
    };
  }

  const painLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'gastritis-abdominal-pain');
  const nauseaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'gastritis-nausea');
  const vomitingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'gastritis-vomiting');
  const bleedingLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'gastritis-hematemesis' || getLogSymptomId(log) === 'gastritis-melena'
  );
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'gastritis-hospitalization');

  // Estimate episodes (clusters of symptoms)
  const totalSymptomDays = new Set(relevantLogs.map(log =>
      new Date(log.timestamp).toDateString()
  )).size;

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (hospitalizationLogs.length >= 1 && bleedingLogs.length > 0) {
    supportedRating = 60;
    ratingRationale = [
      'Hospitalization with GI bleeding documented',
      'Consistent with severe gastritis (rated as peptic ulcer disease)',
    ];
  } else if (painLogs.length >= 12 || totalSymptomDays >= 12) {
    supportedRating = 40;
    ratingRationale = [
      'Multiple symptom episodes documented',
      'Pattern suggests 4+ episodes per year lasting 3+ days',
    ];
    gaps.push('Confirm daily medication use (PPI or H2 blocker)');
  } else if (painLogs.length >= 3 || totalSymptomDays >= 9) {
    supportedRating = 20;
    ratingRationale = [
      'Symptom episodes documented',
      'Pattern suggests 1-3 episodes per year',
    ];
    gaps.push('Confirm daily medication use for gastritis');
  } else {
    ratingRationale = [
      'Gastritis symptoms logged',
      'Document episode duration (must be 3+ consecutive days for compensable rating)',
    ];
  }

  if (bleedingLogs.length === 0) {
    gaps.push('Document any GI bleeding if present');
  }

  return {
    hasData: true,
    condition: 'Gastritis, Chronic',
    diagnosticCode: '7307',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      painLogs: painLogs.length,
      nauseaLogs: nauseaLogs.length,
      vomitingLogs: vomitingLogs.length,
      bleedingLogs: bleedingLogs.length,
      hospitalizationLogs: hospitalizationLogs.length,
      totalSymptomDays,
    },
    criteria: GASTRITIS_CRITERIA,
  };
};

/**
 * Analyze Chronic Pancreatitis symptom logs (DC 7347)
 */
export const analyzePancreatitisLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'pancreatitis-abdominal-pain', 'pancreatitis-back-pain', 'pancreatitis-nausea', 'pancreatitis-vomiting',
    'pancreatitis-maldigestion', 'pancreatitis-weight-loss', 'pancreatitis-enzyme-use',
    'pancreatitis-dietary-restriction', 'pancreatitis-tube-feeding', 'pancreatitis-cyst',
    'pancreatitis-hospitalization'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Pancreatitis, Chronic',
      diagnosticCode: '7347',
      message: 'No pancreatitis logs found',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging pancreatitis symptoms including pain episodes and hospitalizations'],
      metrics: { totalLogs: 0 },
    };
  }

  const painLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'pancreatitis-abdominal-pain' || getLogSymptomId(log) === 'pancreatitis-back-pain'
  );
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pancreatitis-hospitalization');
  const enzymeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pancreatitis-enzyme-use');
  const dietaryLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pancreatitis-dietary-restriction');
  const tubeFeedingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pancreatitis-tube-feeding');
  const maldigestionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pancreatitis-maldigestion');
  const complicationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pancreatitis-cyst');

  // Count unique pain days to estimate episodes
  const painDays = new Set(painLogs.map(log => new Date(log.timestamp).toDateString())).size;
  const hasMaldigestion = maldigestionLogs.length > 0 || enzymeLogs.length > 0;
  const hasDietaryRestriction = dietaryLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (hospitalizationLogs.length >= 3 && hasMaldigestion && hasDietaryRestriction && painDays >= 30) {
    supportedRating = 100;
    ratingRationale = [
      `${hospitalizationLogs.length} hospitalizations in evaluation period (3+ required)`,
      'Maldigestion requiring enzyme supplementation documented',
      'Dietary restriction documented',
      'Daily pain pattern documented',
    ];
  } else if (painDays >= 10 && hospitalizationLogs.length >= 1) {
    supportedRating = 60;
    ratingRationale = [
      'Multiple pain episodes documented',
      `${hospitalizationLogs.length} hospitalization(s) for complications`,
    ];
    if (tubeFeedingLogs.length > 0) {
      ratingRationale.push('Tube feeding complications documented');
    }
  } else if (painDays >= 3 || complicationLogs.length > 0) {
    supportedRating = 30;
    ratingRationale = [
      'Pain episodes requiring ongoing treatment documented',
    ];
    if (complicationLogs.length > 0) {
      ratingRationale.push('Complications (cyst/pseudocyst) documented');
    }
  } else {
    ratingRationale = [
      'Pancreatitis symptoms documented',
      'Continue logging pain episodes and hospitalizations',
    ];
  }

  // Documentation gaps
  if (hospitalizationLogs.length === 0) {
    gaps.push('Document hospitalizations for pancreatitis if any');
  }
  if (!hasMaldigestion) {
    gaps.push('Document maldigestion symptoms and enzyme use if applicable');
  }
  if (!hasDietaryRestriction) {
    gaps.push('Document dietary restrictions if required');
  }

  return {
    hasData: true,
    condition: 'Pancreatitis, Chronic',
    diagnosticCode: '7347',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      painLogs: painLogs.length,
      painDays,
      hospitalizationLogs: hospitalizationLogs.length,
      enzymeLogs: enzymeLogs.length,
      hasMaldigestion,
      hasDietaryRestriction,
      complicationLogs: complicationLogs.length,
    },
    criteria: PANCREATITIS_CRITERIA,
  };
};

/**
 * Analyze Chronic Biliary Tract Disease symptom logs (DC 7314)
 */
export const analyzeBiliaryTractLogs = (logs, options = {}) => {
  const { evaluationPeriodDays = 365 } = options;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const symptomIds = [
    'biliary-ruq-pain', 'biliary-nausea', 'biliary-vomiting', 'biliary-jaundice',
    'biliary-fever', 'biliary-dilation', 'biliary-attack'
  ];

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Chronic Biliary Tract Disease',
      diagnosticCode: '7314',
      message: 'No biliary tract disease logs found',
      supportedRating: null,
      ratingRationale: [],
      gaps: ['Start logging biliary symptoms including RUQ pain attacks with nausea/vomiting'],
      metrics: { totalLogs: 0 },
    };
  }

  const ruqPainLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'biliary-ruq-pain');
  const nauseaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'biliary-nausea');
  const vomitingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'biliary-vomiting');
  const attackLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'biliary-attack');
  const dilationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'biliary-dilation');
  const feverLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'biliary-fever');

  // Count documented attacks (RUQ pain with nausea AND vomiting)
  // Estimate by looking at days with all three symptoms or explicit attack logs
  const attackDays = new Set(attackLogs.map(log => new Date(log.timestamp).toDateString())).size;
  const ruqPainDays = new Set(ruqPainLogs.map(log => new Date(log.timestamp).toDateString()));
  const nauseaDays = new Set(nauseaLogs.map(log => new Date(log.timestamp).toDateString()));
  const vomitingDays = new Set(vomitingLogs.map(log => new Date(log.timestamp).toDateString()));

  // Count days with RUQ pain + nausea + vomiting
  let symptomClusterDays = 0;
  ruqPainDays.forEach(day => {
    if (nauseaDays.has(day) && vomitingDays.has(day)) {
      symptomClusterDays++;
    }
  });

  const totalDocumentedAttacks = Math.max(attackDays, symptomClusterDays);
  const hasStrictureDilation = dilationLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  let gaps = [];

  if (totalDocumentedAttacks >= 3 || hasStrictureDilation) {
    supportedRating = 30;
    ratingRationale = [];
    if (totalDocumentedAttacks >= 3) {
      ratingRationale.push(`${totalDocumentedAttacks} documented attacks with RUQ pain, nausea, and vomiting`);
    }
    if (hasStrictureDilation) {
      ratingRationale.push('Biliary stricture dilation procedure documented');
    }
  } else if (totalDocumentedAttacks >= 1) {
    supportedRating = 10;
    ratingRationale = [
      `${totalDocumentedAttacks} documented attack(s) in evaluation period`,
      '1-2 attacks supports 10% rating',
    ];
  } else if (ruqPainLogs.length > 0) {
    ratingRationale = [
      'RUQ pain logged but full attack criteria not met',
      'Attack requires RUQ pain WITH nausea AND vomiting on same day',
    ];
    gaps.push('Log nausea and vomiting when they occur with RUQ pain');
  }

  // Documentation gaps
  if (totalDocumentedAttacks < 3 && !hasStrictureDilation) {
    gaps.push('Document attacks with medical visits for clinical confirmation');
  }
  if (feverLogs.length === 0 && totalDocumentedAttacks > 0) {
    gaps.push('Document fever/cholangitis episodes if present');
  }

  return {
    hasData: true,
    condition: 'Chronic Biliary Tract Disease',
    diagnosticCode: '7314',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      ruqPainLogs: ruqPainLogs.length,
      nauseaLogs: nauseaLogs.length,
      vomitingLogs: vomitingLogs.length,
      attackLogs: attackLogs.length,
      dilationLogs: dilationLogs.length,
      totalDocumentedAttacks,
      hasStrictureDilation,
    },
    criteria: BILIARY_TRACT_CRITERIA,
  };
};


// ============================================
// PHASE 5A: HERNIA ANALYSIS (DC 7338)
// ============================================

/**
 * Analyze Hernia symptom logs against VA rating criteria
 * DC 7338 - Rated by size, repairability, and pain with activities
 */
export const analyzeHerniaLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.HERNIA.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Hernia',
      diagnosticCode: '7338',
      message: 'No hernia symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms
  const painBendingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-pain-bending');
  const painAdlLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-pain-adl');
  const painWalkingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-pain-walking');
  const painStairsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-pain-stairs');
  const painStrainingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-pain-straining');
  const painStandingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-pain-standing');

  const reducibleLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-reducible');
  const irreducibleLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-irreducible');

  const sizeSmallLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-size-small');
  const sizeMediumLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-size-medium');
  const sizeLargeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-size-large');

  const trussLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-truss-required');
  const recurrentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-recurrent');
  const postSurgicalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-post-surgical');
  const strangulationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-strangulation-risk');
  const functionalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hernia-functional-limitation');

  const bulgeLogs = relevantLogs.filter(log =>
      ['hernia-groin-bulge', 'hernia-abdominal-bulge', 'hernia-umbilical-bulge'].includes(getLogSymptomId(log))
  );

  // Determine hernia characteristics
  const isIrreducible = irreducibleLogs.length > 0;
  const isLargeSize = sizeLargeLogs.length > 0; // >=15cm
  const isMediumSize = sizeMediumLogs.length > 0; // 3-15cm
  const isSmallSize = sizeSmallLogs.length > 0 && !isMediumSize && !isLargeSize; // <3cm

  // Count pain activities (the 4 specific activities VA considers)
  let painActivitiesCount = 0;
  const painActivities = [];

  if (painBendingLogs.length > 0) {
    painActivitiesCount++;
    painActivities.push('bending over');
  }
  if (painAdlLogs.length > 0) {
    painActivitiesCount++;
    painActivities.push('ADLs');
  }
  if (painWalkingLogs.length > 0) {
    painActivitiesCount++;
    painActivities.push('walking');
  }
  if (painStairsLogs.length > 0) {
    painActivitiesCount++;
    painActivities.push('climbing stairs');
  }

  // Calculate total pain logs for severity tracking
  const totalPainLogs = painBendingLogs.length + painAdlLogs.length + painWalkingLogs.length +
      painStairsLogs.length + painStrainingLogs.length + painStandingLogs.length;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  // Note: VA requires 12+ months duration which we can't verify from logs alone
  // We document current status and note duration requirement

  if (isIrreducible || irreducibleLogs.length > 0 || recurrentLogs.length > 0) {
    // Irreparable/recurrent hernia pathway
    if (isLargeSize && painActivitiesCount >= 3) {
      supportedRating = 100;
      ratingRationale = [
        `Hernia size >=15cm documented`,
        `Pain with ${painActivitiesCount} activities: ${painActivities.join(', ')}`,
        'Irreducible/irreparable hernia documented',
        'Note: VA requires 12+ months duration - ensure medical documentation',
      ];
    } else if (isLargeSize && painActivitiesCount >= 2) {
      supportedRating = 60;
      ratingRationale = [
        `Hernia size >=15cm documented`,
        `Pain with ${painActivitiesCount} activities: ${painActivities.join(', ')}`,
        'Irreducible/irreparable hernia documented',
        'Note: VA requires 12+ months duration - ensure medical documentation',
      ];
    } else if (isMediumSize && painActivitiesCount >= 2) {
      supportedRating = 30;
      ratingRationale = [
        `Hernia size 3-15cm documented`,
        `Pain with ${painActivitiesCount} activities: ${painActivities.join(', ')}`,
        'Irreducible/irreparable hernia documented',
      ];
    } else if (isMediumSize && painActivitiesCount >= 1) {
      supportedRating = 20;
      ratingRationale = [
        `Hernia size 3-15cm documented`,
        `Pain with ${painActivitiesCount} activity: ${painActivities.join(', ')}`,
        'Irreducible/irreparable hernia documented',
      ];
    } else if (isSmallSize || (!isLargeSize && !isMediumSize)) {
      supportedRating = 10;
      ratingRationale = [
        'Irreducible/irreparable hernia documented',
        isSmallSize ? 'Hernia size <3cm documented' : 'Document hernia size for accurate rating',
      ];
    }
  } else if (reducibleLogs.length > 0 || bulgeLogs.length > 0) {
    // Reducible/repairable hernia - typically 0% unless symptomatic
    supportedRating = 0;
    ratingRationale = [
      'Hernia present but appears reducible/repairable',
      'Asymptomatic repairable hernias rated at 0%',
      `${totalPainLogs} pain episodes logged - document if hernia becomes irreparable`,
    ];
  }

  // Documentation gaps
  if (!isLargeSize && !isMediumSize && !isSmallSize) {
    gaps.push('Document hernia size (measured in cm) for accurate rating');
  }
  if (irreducibleLogs.length === 0 && reducibleLogs.length === 0) {
    gaps.push('Document whether hernia is reducible or irreducible');
  }
  if (painActivitiesCount < 3 && (isLargeSize || isMediumSize)) {
    gaps.push(`Log pain with specific activities: bending, ADLs, walking, stairs (${3 - painActivitiesCount} more types needed for higher rating)`);
  }
  if (supportedRating > 0) {
    gaps.push('Obtain medical documentation confirming hernia is irreparable and duration of 12+ months');
  }
  if (strangulationLogs.length > 0) {
    gaps.push('URGENT: Strangulation symptoms logged - seek immediate medical attention');
  }

  return {
    hasData: true,
    condition: 'Hernia',
    diagnosticCode: '7338',
    cfrReference: '38 CFR 4.114',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      bulgeLogs: bulgeLogs.length,
      totalPainLogs,
      painActivitiesCount,
      painActivities,
      irreducibleLogs: irreducibleLogs.length,
      reducibleLogs: reducibleLogs.length,
      sizeLargeLogs: sizeLargeLogs.length,
      sizeMediumLogs: sizeMediumLogs.length,
      sizeSmallLogs: sizeSmallLogs.length,
      trussLogs: trussLogs.length,
      recurrentLogs: recurrentLogs.length,
      strangulationLogs: strangulationLogs.length,
      functionalLogs: functionalLogs.length,
    },
    criteria: HERNIA_CRITERIA,
  };
};

// ============================================
// PHASE 5A: PERITONEAL ADHESIONS ANALYSIS (DC 7301)
// ============================================

/**
 * Analyze Peritoneal Adhesions symptom logs against VA rating criteria
 * DC 7301 - Rated by obstruction severity, dietary modification, and symptoms
 */
export const analyzePeritonealAdhesionsLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.PERITONEAL_ADHESIONS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Peritoneal Adhesions',
      diagnosticCode: '7301',
      message: 'No peritoneal adhesion symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms
  const abdominalPainLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-abdominal-pain');
  const nauseaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-nausea');
  const vomitingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-vomiting');
  const colicLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-colic');
  const constipationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-constipation');
  const diarrheaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-diarrhea');
  const distensionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-distension');

  const partialObstructionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-obstruction-partial');
  const completeObstructionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-obstruction-complete');
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-hospitalization');
  const dietaryModLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-dietary-modification');
  const tpnLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-tpn-required');
  const inoperableLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-inoperable');
  const recurrentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pa-recurrent');

  const causeLogs = relevantLogs.filter(log =>
      ['pa-post-surgical', 'pa-post-trauma', 'pa-inflammatory'].includes(getLogSymptomId(log))
  );

  // Count GI symptoms (the 6 symptoms VA considers)
  let giSymptomsCount = 0;
  const giSymptoms = [];

  if (abdominalPainLogs.length > 0) {
    giSymptomsCount++;
    giSymptoms.push('abdominal pain');
  }
  if (nauseaLogs.length > 0) {
    giSymptomsCount++;
    giSymptoms.push('nausea');
  }
  if (vomitingLogs.length > 0) {
    giSymptomsCount++;
    giSymptoms.push('vomiting');
  }
  if (colicLogs.length > 0) {
    giSymptomsCount++;
    giSymptoms.push('colic');
  }
  if (constipationLogs.length > 0) {
    giSymptomsCount++;
    giSymptoms.push('constipation');
  }
  if (diarrheaLogs.length > 0) {
    giSymptomsCount++;
    giSymptoms.push('diarrhea');
  }

  const hasTPN = tpnLogs.length > 0;
  const hasInoperableObstruction = inoperableLogs.length > 0 || (partialObstructionLogs.length > 0 && inoperableLogs.length > 0);
  const hasPersistentObstruction = partialObstructionLogs.length >= 3 || completeObstructionLogs.length > 0;
  const hasHospitalization = hospitalizationLogs.length > 0;
  const hasDietaryModification = dietaryModLogs.length > 0;
  const hasGISymptoms = giSymptomsCount > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  if (hasTPN || (hasPersistentObstruction && hasInoperableObstruction)) {
    supportedRating = 80;
    ratingRationale = [
      hasTPN ? 'Total parenteral nutrition (TPN) required' : 'Persistent partial obstruction - inoperable/refractory',
      `${partialObstructionLogs.length + completeObstructionLogs.length} obstruction episodes documented`,
    ];
  } else if (hasHospitalization && hasDietaryModification && hasGISymptoms) {
    supportedRating = 50;
    ratingRationale = [
      `Hospitalization required (${hospitalizationLogs.length} episodes logged)`,
      'Medically-directed dietary modification documented',
      `GI symptoms present: ${giSymptoms.join(', ')}`,
    ];
  } else if (hasDietaryModification && hasGISymptoms) {
    supportedRating = 30;
    ratingRationale = [
      'Medically-directed dietary modification documented',
      `GI symptoms present: ${giSymptoms.join(', ')}`,
    ];
  } else if (hasGISymptoms) {
    supportedRating = 10;
    ratingRationale = [
      'Symptomatic adhesions with GI symptoms',
      `Symptoms documented: ${giSymptoms.join(', ')}`,
    ];
  }

  // Add cause information to rationale if available
  if (causeLogs.length > 0 && supportedRating > 0) {
    const causes = [];
    if (relevantLogs.some(log => getLogSymptomId(log) === 'pa-post-surgical')) causes.push('post-surgical');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'pa-post-trauma')) causes.push('post-trauma');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'pa-inflammatory')) causes.push('inflammatory disease');
    ratingRationale.push(`Adhesion cause: ${causes.join(', ')}`);
  }

  // Documentation gaps
  if (causeLogs.length === 0) {
    gaps.push('Document cause of adhesions (surgery, trauma, or inflammatory disease)');
  }
  if (!hasDietaryModification && supportedRating < 50) {
    gaps.push('Document if medically-directed dietary modification is required');
  }
  if (!hasHospitalization && supportedRating < 80) {
    gaps.push('Document any hospitalizations for obstruction episodes');
  }
  if (giSymptomsCount === 0) {
    gaps.push('Log specific GI symptoms: pain, nausea, vomiting, colic, constipation, diarrhea');
  }
  if (completeObstructionLogs.length > 0) {
    gaps.push('Complete obstruction episodes require emergency documentation');
  }

  return {
    hasData: true,
    condition: 'Peritoneal Adhesions',
    diagnosticCode: '7301',
    cfrReference: '38 CFR 4.114',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      abdominalPainLogs: abdominalPainLogs.length,
      nauseaLogs: nauseaLogs.length,
      vomitingLogs: vomitingLogs.length,
      colicLogs: colicLogs.length,
      constipationLogs: constipationLogs.length,
      diarrheaLogs: diarrheaLogs.length,
      distensionLogs: distensionLogs.length,
      giSymptomsCount,
      giSymptoms,
      partialObstructionLogs: partialObstructionLogs.length,
      completeObstructionLogs: completeObstructionLogs.length,
      hospitalizationLogs: hospitalizationLogs.length,
      dietaryModLogs: dietaryModLogs.length,
      tpnLogs: tpnLogs.length,
      inoperableLogs: inoperableLogs.length,
      recurrentLogs: recurrentLogs.length,
    },
    criteria: PERITONEAL_ADHESIONS_CRITERIA,
  };
};

// ============================================
// PHASE 5B: ESOPHAGEAL STRICTURE ANALYSIS (DC 7203)
// Also used for DC 7204 (Esophageal Spasm/Motility)
// ============================================

/**
 * Analyze Esophageal Stricture/Spasm symptom logs against VA rating criteria
 * DC 7203 - Rated by dysphagia severity, dilatation frequency, aspiration, nutritional impact
 * DC 7204 - Esophageal Spasm/Motility rated using DC 7203 criteria
 */
export const analyzeEsophagealLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;

  // Combine symptom IDs from both DC 7203 and DC 7204
  const strictureSymptomIds = CONDITIONS.ESOPHAGEAL_STRICTURE.symptomIds;
  const spasmSymptomIds = CONDITIONS.ESOPHAGEAL_SPASM.symptomIds;
  const allSymptomIds = [...strictureSymptomIds, ...spasmSymptomIds];

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && allSymptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Esophageal Stricture/Spasm',
      diagnosticCode: '7203/7204',
      message: 'No esophageal symptoms logged in evaluation period',
    };
  }

  // Categorize stricture symptoms
  const dysphagiaSolidsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-dysphagia-solids');
  const dysphagiaLiquidsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-dysphagia-liquids');
  const dysphagiaPillsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-dysphagia-pills');
  const foodImpactionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-food-impaction');
  const regurgitationLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'es-regurgitation' || getLogSymptomId(log) === 'esp-regurgitation'
  );
  const aspirationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-aspiration');
  const weightLossLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'es-weight-loss' || getLogSymptomId(log) === 'esp-weight-loss'
  );
  const undernutritionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-undernutrition');
  const dilatationLogs = relevantLogs.filter(log =>
      getLogSymptomId(log) === 'es-dilatation' || getLogSymptomId(log) === 'es-dilatation-steroids'
  );
  const stentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-stent');
  const pegTubeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-peg-tube');
  const dailyMedLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-daily-medication');
  const recurrentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-recurrent');
  const refractoryLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'es-refractory');

  // Categorize spasm symptoms
  const spasmChestPainLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'esp-chest-pain');
  const spasmDysphagiaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'esp-dysphagia');
  const achalasiaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'esp-achalasia');

  // Calculate totals
  const totalDysphagiaLogs = dysphagiaSolidsLogs.length + dysphagiaLiquidsLogs.length +
      dysphagiaPillsLogs.length + spasmDysphagiaLogs.length;
  const hasDysphagia = totalDysphagiaLogs > 0;
  const hasAspiration = aspirationLogs.length > 0;
  const hasUndernutrition = undernutritionLogs.length > 0 || weightLossLogs.length >= 3;
  const hasPEGTube = pegTubeLogs.length > 0;
  const hasRefractory = refractoryLogs.length > 0;
  const hasRecurrent = recurrentLogs.length > 0;
  const dilatationCount = dilatationLogs.length;
  const hasDailyMedication = dailyMedLogs.length > 0;

  // Determine if this is stricture or spasm
  const isStrictureRelated = strictureSymptomIds.some(id =>
      relevantLogs.some(log => getLogSymptomId(log) === id)
  );
  const isSpasmRelated = spasmSymptomIds.some(id =>
      relevantLogs.some(log => getLogSymptomId(log) === id)
  );

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  if ((hasRefractory || hasRecurrent) && hasAspiration && hasUndernutrition && hasPEGTube) {
    supportedRating = 80;
    ratingRationale = [
      'Refractory/recurrent stricture documented',
      'Aspiration documented',
      'Undernutrition present',
      'PEG tube required',
    ];
  } else if ((hasRefractory || hasRecurrent) && hasDysphagia && hasAspiration && hasUndernutrition) {
    supportedRating = 50;
    ratingRationale = [
      'Refractory/recurrent stricture with dysphagia',
      'Aspiration documented',
      'Undernutrition present',
    ];
  } else if (dilatationCount >= 3) {
    supportedRating = 50;
    ratingRationale = [
      `${dilatationCount} dilatation procedures documented (>=3/year criteria met)`,
    ];
  } else if (hasRecurrent && hasDysphagia && dilatationCount > 0 && dilatationCount <= 2) {
    supportedRating = 30;
    ratingRationale = [
      'Recurrent stricture with dysphagia',
      `${dilatationCount} dilatation(s) documented (<=2/year)`,
    ];
  } else if (hasDysphagia && hasDailyMedication) {
    supportedRating = 10;
    ratingRationale = [
      'Dysphagia present',
      'Daily medication required for control',
    ];
  } else if (hasDysphagia || isSpasmRelated) {
    supportedRating = 10;
    ratingRationale = [
      hasDysphagia ? `Dysphagia documented (${totalDysphagiaLogs} episodes)` : 'Esophageal spasm symptoms documented',
      'Document daily medication use if applicable for confirmed 10% rating',
    ];
  }

  // Add condition type to rationale
  if (supportedRating > 0) {
    if (isStrictureRelated && isSpasmRelated) {
      ratingRationale.push('Symptoms include both stricture and motility disorder');
    } else if (isSpasmRelated && !isStrictureRelated) {
      ratingRationale.push('DC 7204 (Esophageal Spasm) rated using DC 7203 criteria');
    }
  }

  // Documentation gaps
  if (!hasRecurrent && !hasRefractory && supportedRating < 50) {
    gaps.push('Document if stricture is recurrent or refractory for higher rating consideration');
  }
  if (dilatationCount === 0 && hasDysphagia) {
    gaps.push('Document dilatation procedures if performed');
  }
  if (!hasAspiration && supportedRating >= 30) {
    gaps.push('Document aspiration episodes if occurring');
  }
  if (!hasDailyMedication && supportedRating < 30) {
    gaps.push('Document daily medication use for dysphagia if applicable');
  }
  if (aspirationLogs.length > 0) {
    gaps.push('Aspiration documented - ensure pulmonary evaluation is current');
  }

  return {
    hasData: true,
    condition: 'Esophageal Stricture/Spasm',
    diagnosticCode: '7203/7204',
    cfrReference: '38 CFR 4.114',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      totalDysphagiaLogs,
      dysphagiaSolidsLogs: dysphagiaSolidsLogs.length,
      dysphagiaLiquidsLogs: dysphagiaLiquidsLogs.length,
      foodImpactionLogs: foodImpactionLogs.length,
      aspirationLogs: aspirationLogs.length,
      weightLossLogs: weightLossLogs.length,
      undernutritionLogs: undernutritionLogs.length,
      dilatationCount,
      pegTubeLogs: pegTubeLogs.length,
      dailyMedLogs: dailyMedLogs.length,
      recurrentLogs: recurrentLogs.length,
      refractoryLogs: refractoryLogs.length,
      spasmChestPainLogs: spasmChestPainLogs.length,
      achalasiaLogs: achalasiaLogs.length,
      isStrictureRelated,
      isSpasmRelated,
    },
    criteria: ESOPHAGEAL_STRICTURE_CRITERIA,
  };
};

// ============================================
// PHASE 5B: POSTGASTRECTOMY SYNDROME ANALYSIS (DC 7308)
// Rated as DC 7303 (Chronic Complications of Upper GI Surgery)
// ============================================

/**
 * Analyze Postgastrectomy Syndrome symptom logs against VA rating criteria
 * DC 7308 - Rated using DC 7303 criteria
 */
export const analyzePostgastrectomyLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.POSTGASTRECTOMY.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Postgastrectomy Syndrome',
      diagnosticCode: '7308',
      message: 'No postgastrectomy symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms
  const dumpingEarlyLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-dumping-early');
  const dumpingLateLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-dumping-late');
  const nauseaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-nausea');
  const vomitingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-vomiting');
  const vomitingDailyLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-vomiting-daily');
  const diarrheaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-diarrhea');
  const diarrheaExplosiveLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-diarrhea-explosive');
  const syncopeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-syncope');
  const sweatingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-sweating');
  const abdominalPainLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-abdominal-pain');
  const dietaryModLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-dietary-modification');
  const medicationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-medication');
  const tpnLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-tpn');
  const tubeFeedingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-tube-feeding');
  const weightLossLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pgs-weight-loss');

  // Determine key indicators
  const hasTPN = tpnLogs.length > 0;
  const hasTubeFeeding = tubeFeedingLogs.length > 0;
  const hasDailyVomiting = vomitingDailyLogs.length > 0 || vomitingLogs.length >= 20; // Approximate daily
  const hasExplosiveDiarrhea = diarrheaExplosiveLogs.length > 0;
  const hasFrequentWateryBMs = diarrheaLogs.length >= 15; // Approximating 6+/day frequency
  const hasSyncopeWithSweating = syncopeLogs.length > 0 && sweatingLogs.length > 0;
  const hasMedication = medicationLogs.length > 0;
  const hasDietaryModification = dietaryModLogs.length > 0;
  const hasDumpingSyndrome = dumpingEarlyLogs.length > 0 || dumpingLateLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria (DC 7303)
  if (hasTPN || hasTubeFeeding) {
    supportedRating = 80;
    ratingRationale = [
      hasTPN ? 'Total parenteral nutrition (TPN) required' : 'Tube feeding required',
      'Note: VA requires 30+ consecutive days during 12-month period',
    ];
  } else if (hasDailyVomiting) {
    supportedRating = 50;
    ratingRationale = [
      'Daily vomiting despite dietary modification',
      `${vomitingLogs.length + vomitingDailyLogs.length} vomiting episodes documented`,
    ];
  } else if (hasFrequentWateryBMs || hasExplosiveDiarrhea) {
    supportedRating = 50;
    ratingRationale = hasExplosiveDiarrhea
        ? ['Explosive, unpredictable bowel movements documented']
        : [`Frequent watery bowel movements (${diarrheaLogs.length} episodes documented)`];
  } else if (hasSyncopeWithSweating) {
    supportedRating = 30;
    ratingRationale = [
      'Post-prandial syncope/lightheadedness documented',
      'Associated sweating episodes documented',
    ];
  } else if (hasMedication && hasDumpingSyndrome) {
    supportedRating = 30;
    ratingRationale = [
      'Dumping syndrome documented',
      'Medication required for control',
    ];
  } else if (hasDietaryModification && (hasDumpingSyndrome || nauseaLogs.length > 0 || diarrheaLogs.length > 0)) {
    supportedRating = 10;
    ratingRationale = [
      'Chronic symptoms present',
      'Controlled with dietary modification',
    ];
  } else if (hasDumpingSyndrome || nauseaLogs.length > 0 || vomitingLogs.length > 0) {
    supportedRating = 10;
    ratingRationale = [
      'Postgastrectomy symptoms documented',
      'Document dietary modification plan for confirmed rating',
    ];
  }

  // Documentation gaps
  if (!hasDietaryModification && supportedRating <= 30) {
    gaps.push('Document medically-directed dietary modification if in use');
  }
  if (!hasMedication && hasDumpingSyndrome && supportedRating < 50) {
    gaps.push('Document medication use for dumping syndrome if applicable');
  }
  if (hasTPN || hasTubeFeeding) {
    gaps.push('Document 30+ consecutive days of TPN/tube feeding for 80% rating confirmation');
  }
  if (syncopeLogs.length > 0 && sweatingLogs.length === 0) {
    gaps.push('Document sweating with syncope episodes for 30% rating');
  }
  if (diarrheaLogs.length > 0 && !hasExplosiveDiarrhea) {
    gaps.push('Document if bowel movements are explosive/unpredictable for higher rating');
  }

  return {
    hasData: true,
    condition: 'Postgastrectomy Syndrome',
    diagnosticCode: '7308',
    cfrReference: '38 CFR 4.114 (rated as DC 7303)',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      dumpingEarlyLogs: dumpingEarlyLogs.length,
      dumpingLateLogs: dumpingLateLogs.length,
      nauseaLogs: nauseaLogs.length,
      vomitingLogs: vomitingLogs.length,
      vomitingDailyLogs: vomitingDailyLogs.length,
      diarrheaLogs: diarrheaLogs.length,
      diarrheaExplosiveLogs: diarrheaExplosiveLogs.length,
      syncopeLogs: syncopeLogs.length,
      sweatingLogs: sweatingLogs.length,
      abdominalPainLogs: abdominalPainLogs.length,
      dietaryModLogs: dietaryModLogs.length,
      medicationLogs: medicationLogs.length,
      tpnLogs: tpnLogs.length,
      tubeFeedingLogs: tubeFeedingLogs.length,
      weightLossLogs: weightLossLogs.length,
    },
    criteria: POSTGASTRECTOMY_CRITERIA,
  };
};

// ============================================
// PHASE 5B: INTESTINAL FISTULA ANALYSIS (DC 7330)
// ============================================

/**
 * Analyze Intestinal Fistula symptom logs against VA rating criteria
 * DC 7330 - Rated by TPN needs, drainage amount, BMI, and duration
 */
export const analyzeIntestinalFistulaLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.INTESTINAL_FISTULA.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Intestinal Fistula',
      diagnosticCode: '7330',
      message: 'No intestinal fistula symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms
  const drainageMinimalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-drainage-minimal');
  const drainageModerateLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-drainage-moderate');
  const drainageHeavyLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-drainage-heavy');
  const fecalDischargeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-fecal-discharge');
  const persistentDrainageLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-persistent-drainage');
  const skinIrritationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-skin-irritation');
  const infectionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-infection');
  const painLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-pain');
  const enteralNutritionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-enteral-nutrition');
  const tpnLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-tpn');
  const lowBMILogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-low-bmi');
  const veryLowBMILogs = relevantLogs.filter(log => getLogSymptomId(log) === 'if-very-low-bmi');

  const causeLogs = relevantLogs.filter(log =>
      ['if-post-surgical', 'if-post-radiation', 'if-post-trauma'].includes(getLogSymptomId(log))
  );

  // Determine key indicators
  const hasTPN = tpnLogs.length > 0;
  const hasEnteralNutrition = enteralNutritionLogs.length > 0;
  const hasHeavyDrainage = drainageHeavyLogs.length > 0;
  const hasModerateDrainage = drainageModerateLogs.length > 0;
  const hasMinimalDrainage = drainageMinimalLogs.length > 0;
  const hasVeryLowBMI = veryLowBMILogs.length > 0; // BMI < 16
  const hasLowBMI = lowBMILogs.length > 0; // BMI 16-18
  const hasPersistentDrainage = persistentDrainageLogs.length > 0;

  // Estimate drainage duration based on log frequency
  const drainageDurationMonths = persistentDrainageLogs.length >= 3 ? '3+' :
      persistentDrainageLogs.length >= 1 ? '1-3' : '<1';

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  if (hasTPN) {
    supportedRating = 100;
    ratingRationale = [
      'Total parenteral nutrition (TPN) required for fistula-related symptoms',
    ];
  } else if (hasEnteralNutrition) {
    supportedRating = 60;
    ratingRationale = [
      'Enteral nutrition required for fistula-related symptoms',
    ];
  } else if (hasHeavyDrainage && hasVeryLowBMI) {
    supportedRating = 60;
    ratingRationale = [
      'Heavy drainage documented (3+ bags or 10+ pads/day)',
      'BMI < 16 documented',
    ];
  } else if (hasHeavyDrainage && drainageDurationMonths === '3+') {
    supportedRating = 60;
    ratingRationale = [
      'Heavy drainage documented (3+ bags or 10+ pads/day)',
      'Drainage persisting 3+ months',
    ];
  } else if (hasHeavyDrainage && hasLowBMI) {
    supportedRating = 30;
    ratingRationale = [
      'Heavy drainage documented (3+ bags or 10+ pads/day)',
      'BMI 16-18 documented',
    ];
  } else if (hasHeavyDrainage && (drainageDurationMonths === '1-3')) {
    supportedRating = 30;
    ratingRationale = [
      'Heavy drainage documented (3+ bags or 10+ pads/day)',
      'Drainage persisting 1-3 months',
    ];
  } else if ((hasModerateDrainage || hasMinimalDrainage) && hasVeryLowBMI) {
    supportedRating = 30;
    ratingRationale = [
      'Fistula drainage documented',
      'BMI < 16 documented',
    ];
  } else if (hasModerateDrainage || hasMinimalDrainage || fecalDischargeLogs.length > 0) {
    // Has fistula symptoms but doesn't meet higher criteria
    supportedRating = 30;
    ratingRationale = [
      'Intestinal fistula with drainage documented',
      'Document drainage volume and BMI for accurate rating',
    ];
  }

  // Add cause to rationale if documented
  if (causeLogs.length > 0 && supportedRating > 0) {
    const causes = [];
    if (relevantLogs.some(log => getLogSymptomId(log) === 'if-post-surgical')) causes.push('post-surgical');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'if-post-radiation')) causes.push('post-radiation');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'if-post-trauma')) causes.push('post-trauma');
    ratingRationale.push(`Fistula cause: ${causes.join(', ')}`);
  }

  // Documentation gaps
  if (!hasHeavyDrainage && !hasModerateDrainage && !hasMinimalDrainage) {
    gaps.push('Document drainage amount (bags/day or pad changes) for accurate rating');
  }
  if (!hasVeryLowBMI && !hasLowBMI) {
    gaps.push('Document BMI if below 18 - affects rating level');
  }
  if (!hasPersistentDrainage && supportedRating < 60) {
    gaps.push('Document drainage duration (1-3 months vs 3+ months)');
  }
  if (causeLogs.length === 0) {
    gaps.push('Document fistula cause (surgical, radiation, trauma)');
  }
  if (infectionLogs.length > 0) {
    gaps.push('Infection documented - ensure appropriate medical follow-up');
  }

  return {
    hasData: true,
    condition: 'Intestinal Fistula',
    diagnosticCode: '7330',
    cfrReference: '38 CFR 4.114',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      drainageMinimalLogs: drainageMinimalLogs.length,
      drainageModerateLogs: drainageModerateLogs.length,
      drainageHeavyLogs: drainageHeavyLogs.length,
      fecalDischargeLogs: fecalDischargeLogs.length,
      persistentDrainageLogs: persistentDrainageLogs.length,
      skinIrritationLogs: skinIrritationLogs.length,
      infectionLogs: infectionLogs.length,
      painLogs: painLogs.length,
      enteralNutritionLogs: enteralNutritionLogs.length,
      tpnLogs: tpnLogs.length,
      lowBMILogs: lowBMILogs.length,
      veryLowBMILogs: veryLowBMILogs.length,
      drainageDurationMonths,
    },
    criteria: INTESTINAL_FISTULA_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - ACNE (DC 7828)
// Phase 6A - Rated by depth and extent of involvement
// ============================================

/**
 * Analyze Acne symptom logs against VA rating criteria
 * DC 7828 - Rated based on deep vs superficial acne and extent
 */
export const analyzeAcneLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.ACNE.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Acne',
      diagnosticCode: '7828',
      message: 'No acne symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms - Superficial types
  const comedonesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-superficial-comedones');
  const papulesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-superficial-papules');
  const pustulesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-superficial-pustules');

  // Categorize symptoms - Deep types
  const nodulesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-deep-nodules');
  const cystsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-deep-cysts');

  // Location/extent
  const faceNeckUnder40Logs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-face-neck-under40');
  const faceNeck40PlusLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-face-neck-40plus');
  const bodyOtherLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-body-other');

  // Complications
  const scarringLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-scarring');
  const disfigurementLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'acne-disfigurement');

  // Treatment logs
  const treatmentLogs = relevantLogs.filter(log =>
      ['acne-topical-treatment', 'acne-oral-antibiotics', 'acne-isotretinoin', 'acne-hormonal-therapy'].includes(getLogSymptomId(log))
  );

  // Determine key indicators
  const hasDeepAcne = nodulesLogs.length > 0 || cystsLogs.length > 0;
  const hasSuperficialOnly = !hasDeepAcne && (comedonesLogs.length > 0 || papulesLogs.length > 0 || pustulesLogs.length > 0);
  const hasFaceNeck40Plus = faceNeck40PlusLogs.length > 0;
  const hasFaceNeckUnder40 = faceNeckUnder40Logs.length > 0;
  const hasBodyAcne = bodyOtherLogs.length > 0;
  const hasScarring = scarringLogs.length > 0;
  const hasDisfigurement = disfigurementLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  if (hasDeepAcne && hasFaceNeck40Plus) {
    supportedRating = 30;
    ratingRationale = [
      'Deep acne (nodules/cysts) documented',
      'Face and neck involvement >=40% documented',
    ];
  } else if (hasDeepAcne && (hasFaceNeckUnder40 || hasBodyAcne)) {
    supportedRating = 10;
    ratingRationale = [
      'Deep acne (nodules/cysts) documented',
    ];
    if (hasFaceNeckUnder40) {
      ratingRationale.push('Face/neck involvement <40%');
    }
    if (hasBodyAcne) {
      ratingRationale.push('Body involvement (non-face/neck) documented');
    }
  } else if (hasDeepAcne) {
    // Deep acne but no extent documented
    supportedRating = 10;
    ratingRationale = [
      'Deep acne (nodules/cysts) documented',
      'Extent of involvement not specified - document face/neck percentage',
    ];
  } else if (hasSuperficialOnly) {
    supportedRating = 0;
    ratingRationale = [
      'Superficial acne documented (comedones, papules, pustules)',
      'No deep nodules or cysts documented',
      'Superficial acne rates 0% regardless of extent',
    ];
  }

  // Add scarring/disfigurement note
  if (hasScarring || hasDisfigurement) {
    ratingRationale.push('Scarring/disfigurement present - may qualify for alternative rating under DC 7800-7805');
  }

  // Add treatment documentation
  if (treatmentLogs.length > 0) {
    const treatments = [];
    if (relevantLogs.some(log => getLogSymptomId(log) === 'acne-topical-treatment')) treatments.push('topical');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'acne-oral-antibiotics')) treatments.push('oral antibiotics');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'acne-isotretinoin')) treatments.push('isotretinoin');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'acne-hormonal-therapy')) treatments.push('hormonal therapy');
    ratingRationale.push(`Treatment documented: ${treatments.join(', ')}`);
  }

  // Documentation gaps
  if (!hasDeepAcne && relevantLogs.length > 0) {
    gaps.push('Document if nodules or cysts are present (deep acne) for potential 10-30% rating');
  }
  if (hasDeepAcne && !hasFaceNeck40Plus && !hasFaceNeckUnder40 && !hasBodyAcne) {
    gaps.push('Document percentage of face/neck affected for accurate rating');
  }
  if (!hasScarring && supportedRating > 0) {
    gaps.push('Document any scarring - may qualify for additional rating under scar DCs');
  }
  if (treatmentLogs.length === 0) {
    gaps.push('Document all treatments tried (topical, oral, isotretinoin)');
  }

  return {
    hasData: true,
    condition: 'Acne',
    diagnosticCode: '7828',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      comedonesLogs: comedonesLogs.length,
      papulesLogs: papulesLogs.length,
      pustulesLogs: pustulesLogs.length,
      nodulesLogs: nodulesLogs.length,
      cystsLogs: cystsLogs.length,
      faceNeckUnder40: faceNeckUnder40Logs.length,
      faceNeck40Plus: faceNeck40PlusLogs.length,
      bodyOther: bodyOtherLogs.length,
      scarringLogs: scarringLogs.length,
      disfigurementLogs: disfigurementLogs.length,
      treatmentLogs: treatmentLogs.length,
      hasDeepAcne,
      hasSuperficialOnly,
    },
    criteria: ACNE_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - CHLORACNE (DC 7829)
// Phase 6A - Agent Orange presumptive condition
// ============================================

/**
 * Analyze Chloracne symptom logs against VA rating criteria
 * DC 7829 - Agent Orange presumptive condition, rated like acne with intertriginous consideration
 */
export const analyzeChloracneLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.CHLORACNE.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Chloracne',
      diagnosticCode: '7829',
      message: 'No chloracne symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms - Superficial types
  const comedonesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-comedones');
  const papulesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-papules');
  const pustulesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-pustules');

  // Deep types
  const nodulesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-deep-nodules');
  const cystsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-deep-cysts');

  // Location/extent
  const faceNeckUnder40Logs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-face-neck-under40');
  const faceNeck40PlusLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-face-neck-40plus');
  const intertriginousLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-intertriginous');
  const bodyOtherLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-body-other');

  // Complications
  const scarringLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-scarring');
  const disfigurementLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-disfigurement');

  // Exposure documentation
  const agentOrangeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-agent-orange');
  const dioxinLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-dioxin-exposure');
  const onsetWithinYearLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'chloracne-onset-within-year');

  // Determine key indicators
  const hasDeepChloracne = nodulesLogs.length > 0 || cystsLogs.length > 0;
  const hasSuperficialOnly = !hasDeepChloracne && (comedonesLogs.length > 0 || papulesLogs.length > 0 || pustulesLogs.length > 0);
  const hasFaceNeck40Plus = faceNeck40PlusLogs.length > 0;
  const hasFaceNeckUnder40 = faceNeckUnder40Logs.length > 0;
  const hasIntertriginous = intertriginousLogs.length > 0;
  const hasBodyOther = bodyOtherLogs.length > 0;
  const hasScarring = scarringLogs.length > 0;
  const hasDisfigurement = disfigurementLogs.length > 0;
  const hasExposureDocumented = agentOrangeLogs.length > 0 || dioxinLogs.length > 0;
  const hasOnsetDocumented = onsetWithinYearLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  if (hasDeepChloracne && hasFaceNeck40Plus) {
    supportedRating = 30;
    ratingRationale = [
      'Deep chloracne (nodules/cysts) documented',
      'Face and neck involvement >=40% documented',
    ];
  } else if (hasDeepChloracne && hasIntertriginous) {
    supportedRating = 20;
    ratingRationale = [
      'Deep chloracne (nodules/cysts) documented',
      'Intertriginous area involvement documented (axilla, anogenital, breast folds, or between digits)',
    ];
  } else if (hasDeepChloracne && (hasFaceNeckUnder40 || hasBodyOther)) {
    supportedRating = 10;
    ratingRationale = [
      'Deep chloracne (nodules/cysts) documented',
    ];
    if (hasFaceNeckUnder40) {
      ratingRationale.push('Face/neck involvement <40%');
    }
    if (hasBodyOther) {
      ratingRationale.push('Non-intertriginous body involvement');
    }
  } else if (hasDeepChloracne) {
    supportedRating = 10;
    ratingRationale = [
      'Deep chloracne (nodules/cysts) documented',
      'Extent/location not fully documented - may qualify for higher rating',
    ];
  } else if (hasSuperficialOnly) {
    supportedRating = 0;
    ratingRationale = [
      'Superficial chloracne documented',
      'No deep nodules or cysts documented',
      'Superficial chloracne rates 0%',
    ];
  }

  // Add exposure documentation to rationale
  if (hasExposureDocumented) {
    if (agentOrangeLogs.length > 0) {
      ratingRationale.push('Agent Orange exposure documented - presumptive service connection may apply');
    } else if (dioxinLogs.length > 0) {
      ratingRationale.push('Dioxin/chemical exposure documented');
    }
  }

  if (hasOnsetDocumented && supportedRating > 0) {
    ratingRationale.push('Onset within one year of exposure documented');
  }

  // Add scarring/disfigurement note
  if (hasScarring || hasDisfigurement) {
    ratingRationale.push('Scarring/disfigurement present - may qualify for alternative rating under DC 7800-7805');
  }

  // Documentation gaps
  if (!hasDeepChloracne && relevantLogs.length > 0) {
    gaps.push('Document if nodules or cysts are present (deep chloracne) for potential rating');
  }
  if (hasDeepChloracne && !hasFaceNeck40Plus && !hasIntertriginous && !hasFaceNeckUnder40 && !hasBodyOther) {
    gaps.push('Document specific areas affected (face/neck %, intertriginous, or body)');
  }
  if (!hasExposureDocumented) {
    gaps.push('Document herbicide/dioxin exposure history for presumptive service connection');
  }
  if (!hasOnsetDocumented && hasExposureDocumented) {
    gaps.push('Document that onset was within one year of last exposure');
  }
  if (!hasScarring && supportedRating > 0) {
    gaps.push('Document any scarring - may qualify for additional rating');
  }

  return {
    hasData: true,
    condition: 'Chloracne',
    diagnosticCode: '7829',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      comedonesLogs: comedonesLogs.length,
      papulesLogs: papulesLogs.length,
      pustulesLogs: pustulesLogs.length,
      nodulesLogs: nodulesLogs.length,
      cystsLogs: cystsLogs.length,
      faceNeckUnder40: faceNeckUnder40Logs.length,
      faceNeck40Plus: faceNeck40PlusLogs.length,
      intertriginousLogs: intertriginousLogs.length,
      bodyOther: bodyOtherLogs.length,
      scarringLogs: scarringLogs.length,
      disfigurementLogs: disfigurementLogs.length,
      agentOrangeLogs: agentOrangeLogs.length,
      dioxinLogs: dioxinLogs.length,
      onsetWithinYearLogs: onsetWithinYearLogs.length,
      hasDeepChloracne,
      hasSuperficialOnly,
      hasIntertriginous,
    },
    criteria: CHLORACNE_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - ALOPECIA AREATA (DC 7831)
// Phase 6A - Rated by extent of hair loss
// ============================================

/**
 * Analyze Alopecia Areata symptom logs against VA rating criteria
 * DC 7831 - Rated based on extent of hair loss (all body hair = 10%, scalp/face only = 0%)
 */
export const analyzeAlopeciaAreataLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.ALOPECIA_AREATA.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Alopecia Areata',
      diagnosticCode: '7831',
      message: 'No alopecia areata symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms - Scalp/Face
  const patchyScalpLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-patchy-scalp');
  const completeScalpLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-complete-scalp');
  const eyebrowLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-eyebrow-loss');
  const eyelashLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-eyelash-loss');
  const beardLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-beard-loss');

  // Body hair loss
  const bodyHairLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-body-hair-loss');
  const allBodyHairLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-all-body-hair');

  // Associated symptoms
  const nailChangesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-nail-changes');
  const exclamationHairsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-exclamation-hairs');
  const regrowthLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-regrowth');
  const recurrentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'aa-recurrent');

  // Treatment
  const treatmentLogs = relevantLogs.filter(log =>
      ['aa-steroid-injections', 'aa-topical-treatment', 'aa-immunotherapy'].includes(getLogSymptomId(log))
  );

  // Determine key indicators
  const hasAllBodyHairLoss = allBodyHairLogs.length > 0;
  const hasBodyHairLoss = bodyHairLogs.length > 0;
  const hasScalpLoss = patchyScalpLogs.length > 0 || completeScalpLogs.length > 0;
  const hasFacialLoss = eyebrowLogs.length > 0 || eyelashLogs.length > 0 || beardLogs.length > 0;
  const hasNailChanges = nailChangesLogs.length > 0;
  const hasActiveDisease = exclamationHairsLogs.length > 0;
  const hasRegrowth = regrowthLogs.length > 0;
  const isRecurrent = recurrentLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  // Key criterion: 10% ONLY if ALL body hair is lost (alopecia universalis)
  if (hasAllBodyHairLoss) {
    supportedRating = 10;
    ratingRationale = [
      'Loss of ALL body hair documented (alopecia universalis)',
      'This is the maximum rating under DC 7831',
    ];
  } else {
    supportedRating = 0;
    ratingRationale = [];

    if (hasScalpLoss || hasFacialLoss) {
      ratingRationale.push('Hair loss limited to scalp and/or face');
    }
    if (hasBodyHairLoss && !hasAllBodyHairLoss) {
      ratingRationale.push('Partial body hair loss documented - not complete');
    }
    if (hasScalpLoss && completeScalpLogs.length > 0) {
      ratingRationale.push('Complete scalp hair loss (alopecia totalis) - still rates 0% without complete body hair loss');
    }
    if (ratingRationale.length === 0) {
      ratingRationale.push('Alopecia areata documented but does not meet criteria for 10% rating');
    }
    ratingRationale.push('10% rating requires loss of ALL body hair (alopecia universalis)');
  }

  // Add additional relevant information
  if (hasNailChanges) {
    ratingRationale.push('Nail changes present - associated with more severe disease');
  }
  if (hasActiveDisease) {
    ratingRationale.push('Active disease indicators present (exclamation point hairs)');
  }
  if (isRecurrent) {
    ratingRationale.push('Recurrent episodes documented');
  }
  if (hasRegrowth) {
    ratingRationale.push('Regrowth documented in some areas');
  }

  // Treatment documentation
  if (treatmentLogs.length > 0) {
    const treatments = [];
    if (relevantLogs.some(log => getLogSymptomId(log) === 'aa-steroid-injections')) treatments.push('steroid injections');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'aa-topical-treatment')) treatments.push('topical therapy');
    if (relevantLogs.some(log => getLogSymptomId(log) === 'aa-immunotherapy')) treatments.push('immunotherapy');
    ratingRationale.push(`Treatment: ${treatments.join(', ')}`);
  }

  // Documentation gaps
  if (!hasAllBodyHairLoss && (hasScalpLoss || hasFacialLoss)) {
    gaps.push('Document if body hair (arms, legs, chest, etc.) is also lost for potential 10% rating');
  }
  if (!hasAllBodyHairLoss && hasBodyHairLoss) {
    gaps.push('Document if ALL body hair is lost (including arms, legs, chest, pubic) for 10% rating');
  }
  if (supportedRating === 0) {
    gaps.push('Consider documenting psychological impact for potential secondary mental health rating');
  }
  if (treatmentLogs.length === 0) {
    gaps.push('Document treatment history (injections, topical, immunotherapy)');
  }

  return {
    hasData: true,
    condition: 'Alopecia Areata',
    diagnosticCode: '7831',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      patchyScalpLogs: patchyScalpLogs.length,
      completeScalpLogs: completeScalpLogs.length,
      eyebrowLogs: eyebrowLogs.length,
      eyelashLogs: eyelashLogs.length,
      beardLogs: beardLogs.length,
      bodyHairLogs: bodyHairLogs.length,
      allBodyHairLogs: allBodyHairLogs.length,
      nailChangesLogs: nailChangesLogs.length,
      exclamationHairsLogs: exclamationHairsLogs.length,
      regrowthLogs: regrowthLogs.length,
      recurrentLogs: recurrentLogs.length,
      treatmentLogs: treatmentLogs.length,
      hasAllBodyHairLoss,
      hasScalpLoss,
      hasFacialLoss,
      hasBodyHairLoss,
    },
    criteria: ALOPECIA_AREATA_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - HYPERHIDROSIS (DC 7832)
// Phase 6A - Rated by functional impairment and therapy response
// ============================================

/**
 * Analyze Hyperhidrosis symptom logs against VA rating criteria
 * DC 7832 - Rated based on ability to handle paper/tools and response to therapy
 */
export const analyzeHyperhidrosisLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.HYPERHIDROSIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Hyperhidrosis',
      diagnosticCode: '7832',
      message: 'No hyperhidrosis symptoms logged in evaluation period',
    };
  }

  // Categorize by location
  const palmarLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-palmar');
  const plantarLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-plantar');
  const axillaryLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-axillary');
  const facialLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-facial');
  const generalizedLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-generalized');

  // Severity indicators
  const drippingSweatLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-dripping-sweat');

  // Functional impairment - KEY CRITERIA
  const paperHandlingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-paper-handling');
  const toolHandlingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-tool-handling');
  const keyboardLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-keyboard-difficulty');
  const handshakeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-handshake-avoidance');
  const clothingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-clothing-changes');
  const occupationalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-occupational-impact');

  // Complications
  const macerationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-skin-maceration');
  const infectionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-fungal-infections');

  // Treatment
  const antiperspirantLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-antiperspirant');
  const iontophoresisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-iontophoresis');
  const botoxLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-botox');
  const oralMedLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-oral-medication');
  const surgeryLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-surgery');

  // Therapy response - KEY CRITERIA
  const therapyResponsiveLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-therapy-responsive');
  const therapyUnresponsiveLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'hh-therapy-unresponsive');

  // Determine key indicators
  const hasAnyTreatment = antiperspirantLogs.length > 0 || iontophoresisLogs.length > 0 ||
      botoxLogs.length > 0 || oralMedLogs.length > 0 || surgeryLogs.length > 0;
  const cannotHandlePaperTools = paperHandlingLogs.length > 0 || toolHandlingLogs.length > 0;
  const isTherapyUnresponsive = therapyUnresponsiveLogs.length > 0;
  const isTherapyResponsive = therapyResponsiveLogs.length > 0;
  const hasOccupationalImpact = occupationalLogs.length > 0;
  const hasComplications = macerationLogs.length > 0 || infectionLogs.length > 0;

  // Determine affected areas
  const affectedAreas = [];
  if (palmarLogs.length > 0) affectedAreas.push('palms/hands');
  if (plantarLogs.length > 0) affectedAreas.push('soles/feet');
  if (axillaryLogs.length > 0) affectedAreas.push('underarms');
  if (facialLogs.length > 0) affectedAreas.push('face');
  if (generalizedLogs.length > 0) affectedAreas.push('generalized');

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on VA criteria
  // 30% requires: (1) Unable to handle paper OR tools due to moisture AND (2) Unresponsive to therapy
  if (cannotHandlePaperTools && isTherapyUnresponsive) {
    supportedRating = 30;
    ratingRationale = [
      'Unable to handle paper or tools due to moisture documented',
      'Condition unresponsive to therapy documented',
      'Both criteria met for 30% rating',
    ];
  } else if (cannotHandlePaperTools && !isTherapyUnresponsive && !isTherapyResponsive && hasAnyTreatment) {
    // Has functional impairment and treatment, but therapy response not documented
    supportedRating = 0;
    ratingRationale = [
      'Unable to handle paper or tools documented',
      'Treatment attempted but therapy response not documented',
      '30% requires BOTH functional impairment AND unresponsive to therapy',
    ];
  } else if (cannotHandlePaperTools && isTherapyResponsive) {
    supportedRating = 0;
    ratingRationale = [
      'Functional impairment documented but condition responsive to therapy',
      '30% rating requires condition to be unresponsive to therapy',
    ];
  } else if (isTherapyResponsive || (hasAnyTreatment && !cannotHandlePaperTools)) {
    supportedRating = 0;
    ratingRationale = [
      'Hyperhidrosis present and treatment documented',
      'Able to handle paper or tools after therapy',
    ];
  } else {
    supportedRating = 0;
    ratingRationale = [
      'Hyperhidrosis symptoms documented',
      '30% rating requires inability to handle paper/tools AND unresponsive to therapy',
    ];
  }

  // Add location information
  if (affectedAreas.length > 0) {
    ratingRationale.push(`Affected areas: ${affectedAreas.join(', ')}`);
  }

  // Add treatment history
  if (hasAnyTreatment) {
    const treatments = [];
    if (antiperspirantLogs.length > 0) treatments.push('clinical antiperspirant');
    if (iontophoresisLogs.length > 0) treatments.push('iontophoresis');
    if (botoxLogs.length > 0) treatments.push('Botox');
    if (oralMedLogs.length > 0) treatments.push('oral medication');
    if (surgeryLogs.length > 0) treatments.push('surgery');
    ratingRationale.push(`Treatments tried: ${treatments.join(', ')}`);
  }

  // Add occupational impact
  if (hasOccupationalImpact) {
    ratingRationale.push('Occupational impact documented');
  }

  // Add complications
  if (hasComplications) {
    const complications = [];
    if (macerationLogs.length > 0) complications.push('skin maceration');
    if (infectionLogs.length > 0) complications.push('secondary infections');
    ratingRationale.push(`Complications: ${complications.join(', ')} - may warrant separate rating`);
  }

  // Documentation gaps
  if (!cannotHandlePaperTools) {
    gaps.push('Document if unable to handle paper or tools due to sweating (key criterion for 30%)');
  }
  if (cannotHandlePaperTools && !isTherapyUnresponsive && !isTherapyResponsive) {
    gaps.push('Document whether condition responds to therapy (required for rating determination)');
  }
  if (!hasAnyTreatment) {
    gaps.push('Document all treatments tried (antiperspirant, iontophoresis, Botox, oral meds, surgery)');
  }
  if (!hasOccupationalImpact && cannotHandlePaperTools) {
    gaps.push('Document specific occupational impact for claim support');
  }
  if (infectionLogs.length > 0) {
    gaps.push('Secondary infections documented - ensure appropriate medical treatment');
  }

  return {
    hasData: true,
    condition: 'Hyperhidrosis',
    diagnosticCode: '7832',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      palmarLogs: palmarLogs.length,
      plantarLogs: plantarLogs.length,
      axillaryLogs: axillaryLogs.length,
      facialLogs: facialLogs.length,
      generalizedLogs: generalizedLogs.length,
      drippingSweatLogs: drippingSweatLogs.length,
      paperHandlingLogs: paperHandlingLogs.length,
      toolHandlingLogs: toolHandlingLogs.length,
      keyboardLogs: keyboardLogs.length,
      occupationalLogs: occupationalLogs.length,
      macerationLogs: macerationLogs.length,
      infectionLogs: infectionLogs.length,
      therapyResponsiveLogs: therapyResponsiveLogs.length,
      therapyUnresponsiveLogs: therapyUnresponsiveLogs.length,
      treatmentLogs: hasAnyTreatment ? 1 : 0,
      affectedAreas,
      cannotHandlePaperTools,
      isTherapyUnresponsive,
      isTherapyResponsive,
    },
    criteria: HYPERHIDROSIS_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - GENERAL SKIN FORMULA CONDITIONS
// Phase 6B - DC 7809, 7813, 7815, 7820
// All use body % and systemic therapy criteria
// ============================================

/**
 * Helper function for General Rating Formula for the Skin
 * Used by multiple skin conditions: DC 7809, 7813, 7815, 7820
 */
const analyzeGeneralSkinFormula = (relevantLogs, getLogSymptomId, prefix) => {
  // Body percentage affected
  const under5Logs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-under5-body`);
  const fiveTo20Logs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-5to20-body`);
  const twentyTo40Logs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-20to40-body`);
  const over40Logs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-over40-body`);

  // Treatment level
  const topicalOnlyLogs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-topical-only`);
  const systemicIntermittentLogs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-systemic-intermittent`);
  const systemic6WeeksLogs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-systemic-6weeks`);
  const systemicConstantLogs = relevantLogs.filter(log => getLogSymptomId(log) === `${prefix}-systemic-constant`);

  // Determine highest body percentage documented
  let bodyPercentage = null;
  if (over40Logs.length > 0) bodyPercentage = '>40%';
  else if (twentyTo40Logs.length > 0) bodyPercentage = '20-40%';
  else if (fiveTo20Logs.length > 0) bodyPercentage = '5-20%';
  else if (under5Logs.length > 0) bodyPercentage = '<5%';

  // Determine highest treatment level documented
  let treatmentLevel = null;
  if (systemicConstantLogs.length > 0) treatmentLevel = 'constant';
  else if (systemic6WeeksLogs.length > 0) treatmentLevel = '6weeks';
  else if (systemicIntermittentLogs.length > 0) treatmentLevel = 'intermittent';
  else if (topicalOnlyLogs.length > 0) treatmentLevel = 'topical';

  return {
    bodyPercentage,
    treatmentLevel,
    metrics: {
      under5Logs: under5Logs.length,
      fiveTo20Logs: fiveTo20Logs.length,
      twentyTo40Logs: twentyTo40Logs.length,
      over40Logs: over40Logs.length,
      topicalOnlyLogs: topicalOnlyLogs.length,
      systemicIntermittentLogs: systemicIntermittentLogs.length,
      systemic6WeeksLogs: systemic6WeeksLogs.length,
      systemicConstantLogs: systemicConstantLogs.length,
    },
  };
};

/**
 * Determine rating based on General Skin Formula
 */
const determineGeneralSkinRating = (bodyPercentage, treatmentLevel) => {
  // 60%: >40% body OR constant systemic
  if (bodyPercentage === '>40%' || treatmentLevel === 'constant') {
    return 60;
  }
  // 30%: 20-40% body OR systemic >=6 weeks
  if (bodyPercentage === '20-40%' || treatmentLevel === '6weeks') {
    return 30;
  }
  // 10%: 5-20% body OR intermittent systemic
  if (bodyPercentage === '5-20%' || treatmentLevel === 'intermittent') {
    return 10;
  }
  // 0%: <5% body with topical only
  if (bodyPercentage === '<5%' || treatmentLevel === 'topical') {
    return 0;
  }
  return null;
};

// ============================================
// ANALYSIS FUNCTIONS - DISCOID LUPUS (DC 7809)
// Phase 6B - Uses General Rating Formula for the Skin
// ============================================

/**
 * Analyze Discoid Lupus Erythematosus symptom logs against VA rating criteria
 * DC 7809 - Uses General Rating Formula for the Skin
 */
export const analyzeDiscoidLupusLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.DISCOID_LUPUS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Discoid Lupus Erythematosus',
      diagnosticCode: '7809',
      message: 'No discoid lupus symptoms logged in evaluation period',
    };
  }

  // Condition-specific symptoms
  const discoidLesionsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-discoid-lesions');
  const erythematousPlaquesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-erythematous-plaques');
  const scarringLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-scarring');
  const hyperpigmentationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-hyperpigmentation');
  const hypopigmentationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-hypopigmentation');
  const scalpLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-scalp-involvement');
  const earLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-ear-involvement');
  const faceLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-face-involvement');
  const photosensitivityLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-photosensitivity');
  const follicularPluggingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'dle-follicular-plugging');

  // Use general skin formula helper
  const skinFormula = analyzeGeneralSkinFormula(relevantLogs, getLogSymptomId, 'dle');
  const { bodyPercentage, treatmentLevel, metrics: formulaMetrics } = skinFormula;

  let supportedRating = determineGeneralSkinRating(bodyPercentage, treatmentLevel);
  let ratingRationale = [];
  const gaps = [];

  // Build rationale
  if (supportedRating === 60) {
    if (bodyPercentage === '>40%') {
      ratingRationale.push('More than 40% of body or exposed areas affected');
    }
    if (treatmentLevel === 'constant') {
      ratingRationale.push('Constant/near-constant systemic therapy required');
    }
  } else if (supportedRating === 30) {
    if (bodyPercentage === '20-40%') {
      ratingRationale.push('20-40% of body or exposed areas affected');
    }
    if (treatmentLevel === '6weeks') {
      ratingRationale.push('Systemic therapy >=6 weeks over past 12 months');
    }
  } else if (supportedRating === 10) {
    if (bodyPercentage === '5-20%') {
      ratingRationale.push('5-20% of body or exposed areas affected');
    }
    if (treatmentLevel === 'intermittent') {
      ratingRationale.push('Intermittent systemic therapy <6 weeks');
    }
  } else if (supportedRating === 0) {
    ratingRationale.push('Less than 5% of body affected with topical therapy only');
  } else {
    ratingRationale.push('Discoid lupus documented - document body % and treatment for rating');
  }

  // Add symptom details
  if (discoidLesionsLogs.length > 0 || erythematousPlaquesLogs.length > 0) {
    ratingRationale.push('Characteristic discoid lesions documented');
  }
  if (scarringLogs.length > 0) {
    ratingRationale.push('Scarring documented - may qualify for additional rating under DC 7800-7805');
  }
  if (faceLogs.length > 0 || earLogs.length > 0 || scalpLogs.length > 0) {
    const locations = [];
    if (faceLogs.length > 0) locations.push('face');
    if (earLogs.length > 0) locations.push('ears');
    if (scalpLogs.length > 0) locations.push('scalp');
    ratingRationale.push(`Exposed area involvement: ${locations.join(', ')}`);
  }
  if (photosensitivityLogs.length > 0) {
    ratingRationale.push('Photosensitivity documented');
  }

  // Documentation gaps
  if (!bodyPercentage) {
    gaps.push('Document percentage of body/exposed areas affected (key rating criterion)');
  }
  if (!treatmentLevel) {
    gaps.push('Document treatment type: topical only vs systemic therapy');
  }
  if (treatmentLevel && treatmentLevel !== 'topical' && treatmentLevel !== 'constant') {
    gaps.push('Document duration of systemic therapy (<6 weeks vs >=6 weeks vs constant)');
  }
  if (scarringLogs.length === 0 && (discoidLesionsLogs.length > 0 || erythematousPlaquesLogs.length > 0)) {
    gaps.push('Document any scarring - may qualify for separate rating');
  }

  return {
    hasData: true,
    condition: 'Discoid Lupus Erythematosus',
    diagnosticCode: '7809',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      discoidLesionsLogs: discoidLesionsLogs.length,
      erythematousPlaquesLogs: erythematousPlaquesLogs.length,
      scarringLogs: scarringLogs.length,
      hyperpigmentationLogs: hyperpigmentationLogs.length,
      hypopigmentationLogs: hypopigmentationLogs.length,
      scalpLogs: scalpLogs.length,
      earLogs: earLogs.length,
      faceLogs: faceLogs.length,
      photosensitivityLogs: photosensitivityLogs.length,
      follicularPluggingLogs: follicularPluggingLogs.length,
      bodyPercentage,
      treatmentLevel,
      ...formulaMetrics,
    },
    criteria: DISCOID_LUPUS_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - BULLOUS DISORDERS (DC 7815)
// Phase 6B - Uses General Rating Formula for the Skin
// ============================================

/**
 * Analyze Bullous Disorders symptom logs against VA rating criteria
 * DC 7815 - Uses General Rating Formula for the Skin
 */
export const analyzeBullousDisordersLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.BULLOUS_DISORDERS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Bullous Disorders',
      diagnosticCode: '7815',
      message: 'No bullous disorder symptoms logged in evaluation period',
    };
  }

  // Condition-specific symptoms
  const blistersLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-blisters');
  const erosionsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-erosions');
  const crustingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-crusting');
  const nikolskyLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-nikolsky-sign');
  const oralMucosalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-oral-mucosal');
  const ocularLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-ocular');
  const giLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-gi-involvement');
  const genitalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-genital');
  const itchingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-itching');
  const burningLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-burning');
  const scarringLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bullous-scarring');

  // Use general skin formula helper
  const skinFormula = analyzeGeneralSkinFormula(relevantLogs, getLogSymptomId, 'bullous');
  const { bodyPercentage, treatmentLevel, metrics: formulaMetrics } = skinFormula;

  let supportedRating = determineGeneralSkinRating(bodyPercentage, treatmentLevel);
  let ratingRationale = [];
  const gaps = [];

  // Build rationale
  if (supportedRating === 60) {
    if (bodyPercentage === '>40%') {
      ratingRationale.push('More than 40% of body or exposed areas affected');
    }
    if (treatmentLevel === 'constant') {
      ratingRationale.push('Constant/near-constant systemic therapy required');
    }
  } else if (supportedRating === 30) {
    if (bodyPercentage === '20-40%') {
      ratingRationale.push('20-40% of body or exposed areas affected');
    }
    if (treatmentLevel === '6weeks') {
      ratingRationale.push('Systemic therapy >=6 weeks over past 12 months');
    }
  } else if (supportedRating === 10) {
    if (bodyPercentage === '5-20%') {
      ratingRationale.push('5-20% of body or exposed areas affected');
    }
    if (treatmentLevel === 'intermittent') {
      ratingRationale.push('Intermittent systemic therapy <6 weeks');
    }
  } else if (supportedRating === 0) {
    ratingRationale.push('Less than 5% of body affected with topical therapy only');
  } else {
    ratingRationale.push('Bullous disorder documented - document body % and treatment for rating');
  }

  // Add symptom details
  if (blistersLogs.length > 0 || erosionsLogs.length > 0) {
    ratingRationale.push('Characteristic blisters/erosions documented');
  }
  if (nikolskyLogs.length > 0) {
    ratingRationale.push('Positive Nikolsky sign documented (indicates active pemphigus)');
  }

  // Mucosal involvement - rate separately
  const hasMucosalInvolvement = oralMucosalLogs.length > 0 || ocularLogs.length > 0 ||
      giLogs.length > 0 || genitalLogs.length > 0;
  if (hasMucosalInvolvement) {
    const mucosalAreas = [];
    if (oralMucosalLogs.length > 0) mucosalAreas.push('oral');
    if (ocularLogs.length > 0) mucosalAreas.push('ocular');
    if (giLogs.length > 0) mucosalAreas.push('GI');
    if (genitalLogs.length > 0) mucosalAreas.push('genital');
    ratingRationale.push(`Mucosal involvement (${mucosalAreas.join(', ')}) - rate SEPARATELY under appropriate DC`);
  }

  if (scarringLogs.length > 0) {
    ratingRationale.push('Scarring documented - may qualify for additional rating');
  }

  // Documentation gaps
  if (!bodyPercentage) {
    gaps.push('Document percentage of body/exposed areas affected');
  }
  if (!treatmentLevel) {
    gaps.push('Document treatment type: topical only vs systemic therapy');
  }
  if (hasMucosalInvolvement) {
    gaps.push('Mucosal complications should be evaluated separately - document impact on function');
  }

  return {
    hasData: true,
    condition: 'Bullous Disorders',
    diagnosticCode: '7815',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      blistersLogs: blistersLogs.length,
      erosionsLogs: erosionsLogs.length,
      crustingLogs: crustingLogs.length,
      nikolskyLogs: nikolskyLogs.length,
      oralMucosalLogs: oralMucosalLogs.length,
      ocularLogs: ocularLogs.length,
      giLogs: giLogs.length,
      genitalLogs: genitalLogs.length,
      itchingLogs: itchingLogs.length,
      burningLogs: burningLogs.length,
      scarringLogs: scarringLogs.length,
      hasMucosalInvolvement,
      bodyPercentage,
      treatmentLevel,
      ...formulaMetrics,
    },
    criteria: BULLOUS_DISORDERS_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - CUTANEOUS VASCULITIS (DC 7826)
// Phase 6B - Rated by episodes and immunosuppressive therapy
// ============================================

/**
 * Analyze Primary Cutaneous Vasculitis symptom logs against VA rating criteria
 * DC 7826 - Rated by documented episodes and immunosuppressive requirements
 */
export const analyzeCutaneousVasculitisLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.CUTANEOUS_VASCULITIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Primary Cutaneous Vasculitis',
      diagnosticCode: '7826',
      message: 'No cutaneous vasculitis symptoms logged in evaluation period',
    };
  }

  // Symptom categorization
  const purpuraLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-purpura');
  const petechiaeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-petechiae');
  const ulcersLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-ulcers');
  const nodulesLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-nodules');
  const livedoLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-livedo-reticularis');
  const necrosisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-necrosis');
  const scarringLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-scarring');
  const disfigurementLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-disfigurement');

  // Episode frequency
  const episodeDocumentedLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-episode-documented');
  const episodes1to3Logs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-episodes-1to3');
  const episodes4PlusLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-episodes-4plus');

  // Treatment
  const noSystemicLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-no-systemic-med');
  const continuousSystemicLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-continuous-systemic');
  const intermittentImmunoLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-intermittent-immuno');
  const refractoryLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'cv-refractory');

  // Determine episode frequency
  let episodeFrequency = null;
  if (episodes4PlusLogs.length > 0) episodeFrequency = '4+';
  else if (episodes1to3Logs.length > 0) episodeFrequency = '1-3';
  else if (episodeDocumentedLogs.length > 0) episodeFrequency = 'documented';

  // Determine treatment level
  let treatmentLevel = null;
  const isRefractory = refractoryLogs.length > 0;
  const hasContinuousSystemic = continuousSystemicLogs.length > 0;
  const hasIntermittentImmuno = intermittentImmunoLogs.length > 0;
  const hasNoSystemic = noSystemicLogs.length > 0;

  if (isRefractory) treatmentLevel = 'refractory';
  else if (hasContinuousSystemic) treatmentLevel = 'continuous';
  else if (hasIntermittentImmuno) treatmentLevel = 'intermittent';
  else if (hasNoSystemic) treatmentLevel = 'none';

  let supportedRating = null;
  let ratingRationale = [];
  const gaps = [];

  // Determine rating based on DC 7826 criteria
  // 60%: Persistent episodes refractory to continuous immunosuppressive therapy
  if (isRefractory) {
    supportedRating = 60;
    ratingRationale.push('Persistent vasculitis refractory to continuous immunosuppressive therapy');
  }
  // 30%: 4+ episodes/year requiring intermittent immunosuppressive therapy
  else if (episodeFrequency === '4+' && hasIntermittentImmuno) {
    supportedRating = 30;
    ratingRationale.push('4+ documented episodes in past 12 months');
    ratingRationale.push('Requiring intermittent immunosuppressive therapy');
  }
  // 10%: 1-3 episodes with intermittent immunosuppressive OR continuous systemic for control
  else if ((episodeFrequency === '1-3' && hasIntermittentImmuno) || (hasContinuousSystemic && !isRefractory)) {
    supportedRating = 10;
    if (episodeFrequency === '1-3' && hasIntermittentImmuno) {
      ratingRationale.push('1-3 documented episodes requiring intermittent immunosuppressive therapy');
    }
    if (hasContinuousSystemic) {
      ratingRationale.push('Requires continuous systemic medication for control');
    }
  }
  // Has symptoms but doesn't meet specific criteria
  else if (relevantLogs.length > 0) {
    supportedRating = 10;
    ratingRationale.push('Cutaneous vasculitis documented');
    ratingRationale.push('Document episode frequency and treatment for accurate rating');
  }

  // Add symptom details
  const manifestations = [];
  if (purpuraLogs.length > 0) manifestations.push('purpura');
  if (petechiaeLogs.length > 0) manifestations.push('petechiae');
  if (ulcersLogs.length > 0) manifestations.push('ulcers');
  if (nodulesLogs.length > 0) manifestations.push('nodules');
  if (livedoLogs.length > 0) manifestations.push('livedo reticularis');
  if (necrosisLogs.length > 0) manifestations.push('necrosis');
  if (manifestations.length > 0) {
    ratingRationale.push(`Manifestations: ${manifestations.join(', ')}`);
  }

  if (scarringLogs.length > 0 || disfigurementLogs.length > 0) {
    ratingRationale.push('Scarring/disfigurement documented - may qualify for alternative rating under DC 7800-7805');
  }

  // Documentation gaps
  if (!episodeFrequency) {
    gaps.push('Document frequency of vasculitic episodes (1-3/year vs 4+/year)');
  }
  if (!treatmentLevel) {
    gaps.push('Document treatment: no systemic, intermittent immunosuppressive, continuous, or refractory');
  }
  if (episodeFrequency === '4+' && !hasIntermittentImmuno) {
    gaps.push('Document if intermittent immunosuppressive therapy is required for 30% rating');
  }

  return {
    hasData: true,
    condition: 'Primary Cutaneous Vasculitis',
    diagnosticCode: '7826',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      purpuraLogs: purpuraLogs.length,
      petechiaeLogs: petechiaeLogs.length,
      ulcersLogs: ulcersLogs.length,
      nodulesLogs: nodulesLogs.length,
      livedoLogs: livedoLogs.length,
      necrosisLogs: necrosisLogs.length,
      scarringLogs: scarringLogs.length,
      disfigurementLogs: disfigurementLogs.length,
      episodeDocumentedLogs: episodeDocumentedLogs.length,
      episodes1to3Logs: episodes1to3Logs.length,
      episodes4PlusLogs: episodes4PlusLogs.length,
      noSystemicLogs: noSystemicLogs.length,
      continuousSystemicLogs: continuousSystemicLogs.length,
      intermittentImmunoLogs: intermittentImmunoLogs.length,
      refractoryLogs: refractoryLogs.length,
      episodeFrequency,
      treatmentLevel,
      isRefractory,
    },
    criteria: CUTANEOUS_VASCULITIS_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - DERMATOPHYTOSIS (DC 7813)
// Phase 6B - Uses General Rating Formula for the Skin
// ============================================

/**
 * Analyze Dermatophytosis symptom logs against VA rating criteria
 * DC 7813 - Uses General Rating Formula for the Skin
 */
export const analyzeDermatophytosisLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.DERMATOPHYTOSIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Dermatophytosis',
      diagnosticCode: '7813',
      message: 'No dermatophytosis symptoms logged in evaluation period',
    };
  }

  // Condition-specific symptoms - types of fungal infection
  const tineaCorporisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-tinea-corporis');
  const tineaCapitisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-tinea-capitis');
  const tineaPedisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-tinea-pedis');
  const tineaCrurisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-tinea-cruris');
  const tineaBarbaeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-tinea-barbae');
  const onychomycosisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-onychomycosis');
  const tineaVersicolorLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-tinea-versicolor');

  // Other symptoms
  const scalingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-scaling');
  const itchingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-itching');
  const ringPatternLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-ring-pattern');
  const hairLossLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-hair-loss');
  const nailThickeningLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-nail-thickening');
  const recurrentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'derm-recurrent');

  // Use general skin formula helper
  const skinFormula = analyzeGeneralSkinFormula(relevantLogs, getLogSymptomId, 'derm');
  const { bodyPercentage, treatmentLevel, metrics: formulaMetrics } = skinFormula;

  let supportedRating = determineGeneralSkinRating(bodyPercentage, treatmentLevel);
  let ratingRationale = [];
  const gaps = [];

  // Build rationale
  if (supportedRating === 60) {
    if (bodyPercentage === '>40%') {
      ratingRationale.push('More than 40% of body or exposed areas affected');
    }
    if (treatmentLevel === 'constant') {
      ratingRationale.push('Constant/near-constant systemic antifungal therapy required');
    }
  } else if (supportedRating === 30) {
    if (bodyPercentage === '20-40%') {
      ratingRationale.push('20-40% of body or exposed areas affected');
    }
    if (treatmentLevel === '6weeks') {
      ratingRationale.push('Systemic antifungal therapy >=6 weeks over past 12 months');
    }
  } else if (supportedRating === 10) {
    if (bodyPercentage === '5-20%') {
      ratingRationale.push('5-20% of body or exposed areas affected');
    }
    if (treatmentLevel === 'intermittent') {
      ratingRationale.push('Intermittent systemic antifungal therapy <6 weeks');
    }
  } else if (supportedRating === 0) {
    ratingRationale.push('Less than 5% of body affected with topical therapy only');
  } else {
    ratingRationale.push('Dermatophytosis documented - document body % and treatment for rating');
  }

  // Add infection type details
  const infectionTypes = [];
  if (tineaCorporisLogs.length > 0) infectionTypes.push('body ringworm');
  if (tineaCapitisLogs.length > 0) infectionTypes.push('scalp ringworm');
  if (tineaPedisLogs.length > 0) infectionTypes.push('athlete\'s foot');
  if (tineaCrurisLogs.length > 0) infectionTypes.push('jock itch');
  if (tineaBarbaeLogs.length > 0) infectionTypes.push('beard ringworm');
  if (onychomycosisLogs.length > 0) infectionTypes.push('nail fungus');
  if (tineaVersicolorLogs.length > 0) infectionTypes.push('tinea versicolor');

  if (infectionTypes.length > 0) {
    ratingRationale.push(`Fungal infection types: ${infectionTypes.join(', ')}`);
  }

  if (recurrentLogs.length > 0) {
    ratingRationale.push('Recurrent infections documented');
  }

  if (onychomycosisLogs.length > 0 && treatmentLevel !== 'constant' && treatmentLevel !== '6weeks') {
    ratingRationale.push('Note: Nail fungus typically requires prolonged oral antifungal therapy');
  }

  // Documentation gaps
  if (!bodyPercentage) {
    gaps.push('Document percentage of body/exposed areas affected');
  }
  if (!treatmentLevel) {
    gaps.push('Document treatment type: topical only vs oral antifungals');
  }
  if (onychomycosisLogs.length > 0) {
    gaps.push('Nail fungus often requires 3-6 months oral therapy - document duration');
  }

  return {
    hasData: true,
    condition: 'Dermatophytosis',
    diagnosticCode: '7813',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      tineaCorporisLogs: tineaCorporisLogs.length,
      tineaCapitisLogs: tineaCapitisLogs.length,
      tineaPedisLogs: tineaPedisLogs.length,
      tineaCrurisLogs: tineaCrurisLogs.length,
      tineaBarbaeLogs: tineaBarbaeLogs.length,
      onychomycosisLogs: onychomycosisLogs.length,
      tineaVersicolorLogs: tineaVersicolorLogs.length,
      scalingLogs: scalingLogs.length,
      itchingLogs: itchingLogs.length,
      ringPatternLogs: ringPatternLogs.length,
      hairLossLogs: hairLossLogs.length,
      nailThickeningLogs: nailThickeningLogs.length,
      recurrentLogs: recurrentLogs.length,
      bodyPercentage,
      treatmentLevel,
      ...formulaMetrics,
    },
    criteria: DERMATOPHYTOSIS_CRITERIA,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - SKIN INFECTIONS (DC 7820)
// Phase 6B - Uses General Rating Formula for the Skin
// ============================================

/**
 * Analyze Skin Infections symptom logs against VA rating criteria
 * DC 7820 - Uses General Rating Formula for the Skin
 */
export const analyzeSkinInfectionsLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.SKIN_INFECTIONS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Skin Infections',
      diagnosticCode: '7820',
      message: 'No skin infection symptoms logged in evaluation period',
    };
  }

  // Infection types
  const bacterialLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-bacterial');
  const cellulitisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-cellulitis');
  const abscessLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-abscess');
  const impetigoLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-impetigo');
  const folliculitisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-folliculitis');
  const viralLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-viral');
  const herpesSimplexLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-herpes-simplex');
  const herpesZosterLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-herpes-zoster');
  const wartsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-warts');
  const molluscumLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-molluscum');
  const parasiticLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-parasitic');
  const recurrentLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'skinf-recurrent');

  // Use general skin formula helper
  const skinFormula = analyzeGeneralSkinFormula(relevantLogs, getLogSymptomId, 'skinf');
  const { bodyPercentage, treatmentLevel, metrics: formulaMetrics } = skinFormula;

  let supportedRating = determineGeneralSkinRating(bodyPercentage, treatmentLevel);
  let ratingRationale = [];
  const gaps = [];

  // Build rationale
  if (supportedRating === 60) {
    if (bodyPercentage === '>40%') {
      ratingRationale.push('More than 40% of body or exposed areas affected');
    }
    if (treatmentLevel === 'constant') {
      ratingRationale.push('Constant/near-constant systemic therapy required');
    }
  } else if (supportedRating === 30) {
    if (bodyPercentage === '20-40%') {
      ratingRationale.push('20-40% of body or exposed areas affected');
    }
    if (treatmentLevel === '6weeks') {
      ratingRationale.push('Systemic therapy >=6 weeks over past 12 months');
    }
  } else if (supportedRating === 10) {
    if (bodyPercentage === '5-20%') {
      ratingRationale.push('5-20% of body or exposed areas affected');
    }
    if (treatmentLevel === 'intermittent') {
      ratingRationale.push('Intermittent systemic therapy <6 weeks');
    }
  } else if (supportedRating === 0) {
    ratingRationale.push('Less than 5% of body affected with topical therapy only');
  } else {
    ratingRationale.push('Skin infection documented - document body % and treatment for rating');
  }

  // Add infection type details
  const infectionTypes = [];
  if (bacterialLogs.length > 0) infectionTypes.push('bacterial');
  if (cellulitisLogs.length > 0) infectionTypes.push('cellulitis');
  if (abscessLogs.length > 0) infectionTypes.push('abscess');
  if (impetigoLogs.length > 0) infectionTypes.push('impetigo');
  if (folliculitisLogs.length > 0) infectionTypes.push('folliculitis');
  if (viralLogs.length > 0) infectionTypes.push('viral');
  if (herpesSimplexLogs.length > 0) infectionTypes.push('herpes simplex');
  if (herpesZosterLogs.length > 0) infectionTypes.push('shingles');
  if (wartsLogs.length > 0) infectionTypes.push('warts');
  if (molluscumLogs.length > 0) infectionTypes.push('molluscum');
  if (parasiticLogs.length > 0) infectionTypes.push('parasitic');

  if (infectionTypes.length > 0) {
    ratingRationale.push(`Infection types: ${infectionTypes.join(', ')}`);
  }

  if (recurrentLogs.length > 0) {
    ratingRationale.push('Recurrent infections documented');
  }

  if (herpesZosterLogs.length > 0) {
    ratingRationale.push('Note: Post-herpetic neuralgia from shingles may warrant separate neurological rating');
  }

  // Documentation gaps
  if (!bodyPercentage) {
    gaps.push('Document percentage of body/exposed areas affected');
  }
  if (!treatmentLevel) {
    gaps.push('Document treatment type: topical only vs systemic antibiotics/antivirals');
  }
  if (recurrentLogs.length > 0) {
    gaps.push('Document each infection episode with dates and treatment');
  }

  return {
    hasData: true,
    condition: 'Skin Infections',
    diagnosticCode: '7820',
    cfrReference: '38 CFR 4.118',
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      bacterialLogs: bacterialLogs.length,
      cellulitisLogs: cellulitisLogs.length,
      abscessLogs: abscessLogs.length,
      impetigoLogs: impetigoLogs.length,
      folliculitisLogs: folliculitisLogs.length,
      viralLogs: viralLogs.length,
      herpesSimplexLogs: herpesSimplexLogs.length,
      herpesZosterLogs: herpesZosterLogs.length,
      wartsLogs: wartsLogs.length,
      molluscumLogs: molluscumLogs.length,
      parasiticLogs: parasiticLogs.length,
      recurrentLogs: recurrentLogs.length,
      bodyPercentage,
      treatmentLevel,
      ...formulaMetrics,
    },
    criteria: SKIN_INFECTIONS_CRITERIA,
  };
};

// ============================================
// PHASE 7A: EYE CONDITIONS ANALYSIS FUNCTIONS
// ============================================

// Helper function to count treatment visits from logged episodes
const countEyeTreatmentVisits = (logs, prefix) => {
  let visitCount = 0;

  // Count individual treatment visit logs
  const treatmentVisitLogs = logs.filter(log => {
    const symptomId = getLogSymptomId(log);
    return symptomId === `${prefix}-treatment-visit`;
  });
  visitCount += treatmentVisitLogs.length;

  // Also check for episode range indicators and add their implied counts
  const hasEpisodes7plus = logs.some(log => getLogSymptomId(log) === `${prefix}-episodes-7plus`);
  const hasEpisodes5to6 = logs.some(log => getLogSymptomId(log) === `${prefix}-episodes-5to6`);
  const hasEpisodes3to4 = logs.some(log => getLogSymptomId(log) === `${prefix}-episodes-3to4`);
  const hasEpisodes1to2 = logs.some(log => getLogSymptomId(log) === `${prefix}-episodes-1to2`);

  // Return the highest documented episode count if logged
  if (hasEpisodes7plus) return Math.max(visitCount, 7);
  if (hasEpisodes5to6) return Math.max(visitCount, 5);
  if (hasEpisodes3to4) return Math.max(visitCount, 3);
  if (hasEpisodes1to2) return Math.max(visitCount, 1);

  return visitCount;
};

// Helper function to determine rating based on treatment visits
const getEyeRatingFromVisits = (visitCount) => {
  if (visitCount >= 7) return 60;
  if (visitCount >= 5) return 40;
  if (visitCount >= 3) return 20;
  if (visitCount >= 1) return 10;
  return 0;
};

// DC 6000: UVEITIS / CHOROIDOPATHY ANALYSIS
export const analyzeUveitis = (logs) => {
  const symptomIds = CONDITIONS.UVEITIS.symptomIds;
  const conditionLogs = logs.filter(log => {
    const symptomId = getLogSymptomId(log);
    return symptomIds.includes(symptomId);
  });

  if (conditionLogs.length === 0) {
    return { hasData: false };
  }

  // Calculate metrics
  const totalLogs = conditionLogs.length;
  const severityLogs = conditionLogs.filter(log => log.severity != null);
  const avgSeverity = severityLogs.length > 0
      ? severityLogs.reduce((sum, log) => sum + log.severity, 0) / severityLogs.length
      : 0;

  // Count treatment visits
  const treatmentVisits = countEyeTreatmentVisits(conditionLogs, 'uveitis');

  // Identify location/type
  const hasAnterior = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-anterior');
  const hasIntermediate = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-intermediate');
  const hasPosterior = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-posterior');
  const hasPanuveitis = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-panuveitis');

  // Identify laterality
  const isBilateral = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-bilateral');
  const isUnilateral = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-unilateral');

  // Check for advanced treatments (indicates severity)
  const hasImmunosuppressants = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-immunosuppressants');
  const hasBiologics = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-biologic-agents');
  const hasIntravitreal = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-intravitreal-injection');
  const hasPeriocular = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-periocular-injection');
  const hasLaser = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-laser-treatment');
  const hasSurgery = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-surgery');

  // Check for complications
  const hasGlaucoma = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-glaucoma');
  const hasCataract = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-cataract');
  const hasMacularEdema = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-macular-edema');
  const hasSynechiae = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-synechiae');
  const isChronic = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-chronic');
  const hasVisualAcuityLoss = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-visual-acuity-decreased');
  const hasVisualFieldLoss = conditionLogs.some(log => getLogSymptomId(log) === 'uveitis-visual-field-loss');

  // Determine rating based on treatment visits
  let supportedRating = getEyeRatingFromVisits(treatmentVisits);

  // Build rationale
  const ratingRationale = [];

  if (treatmentVisits >= 7) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 60% rating`);
  } else if (treatmentVisits >= 5) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 40% rating`);
  } else if (treatmentVisits >= 3) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 20% rating`);
  } else if (treatmentVisits >= 1) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visit(s) in past 12 months, supporting 10% rating`);
  } else {
    ratingRationale.push('No documented treatment visits - log clinic visits for eye condition treatment');
  }

  // Location information
  const locations = [];
  if (hasAnterior) locations.push('anterior (iritis)');
  if (hasIntermediate) locations.push('intermediate (cyclitis)');
  if (hasPosterior) locations.push('posterior (choroiditis)');
  if (hasPanuveitis) locations.push('panuveitis');
  if (locations.length > 0) {
    ratingRationale.push(`Uveitis type: ${locations.join(', ')}`);
  }

  // Laterality
  if (isBilateral) {
    ratingRationale.push('Bilateral involvement documented');
  } else if (isUnilateral) {
    ratingRationale.push('Unilateral involvement documented');
  }

  // Advanced treatments
  const advancedTreatments = [];
  if (hasImmunosuppressants) advancedTreatments.push('immunosuppressants');
  if (hasBiologics) advancedTreatments.push('biologic agents');
  if (hasIntravitreal) advancedTreatments.push('intravitreal injections');
  if (hasPeriocular) advancedTreatments.push('periocular injections');
  if (hasLaser) advancedTreatments.push('laser treatment');
  if (hasSurgery) advancedTreatments.push('surgery');
  if (advancedTreatments.length > 0) {
    ratingRationale.push(`Advanced treatments documented: ${advancedTreatments.join(', ')}`);
  }

  // Complications
  const complications = [];
  if (hasGlaucoma) complications.push('secondary glaucoma');
  if (hasCataract) complications.push('cataract');
  if (hasMacularEdema) complications.push('macular edema');
  if (hasSynechiae) complications.push('synechiae');
  if (complications.length > 0) {
    ratingRationale.push(`Complications documented: ${complications.join(', ')} - may warrant separate rating`);
  }

  if (isChronic) {
    ratingRationale.push('Chronic/recurrent uveitis documented');
  }

  if (hasVisualAcuityLoss || hasVisualFieldLoss) {
    ratingRationale.push('Visual impairment documented - consider rating under DC 6061-6091 if higher');
  }

  // Build gaps
  const gaps = [];
  if (treatmentVisits === 0) {
    gaps.push('Log each clinic visit for uveitis treatment as a "Treatment Visit" symptom');
  }
  if (treatmentVisits > 0 && treatmentVisits < 7) {
    gaps.push(`${7 - treatmentVisits} more treatment visits would support 60% rating`);
  }
  if (locations.length === 0) {
    gaps.push('Document uveitis type (anterior, intermediate, posterior, or panuveitis)');
  }
  if (!isBilateral && !isUnilateral) {
    gaps.push('Document whether condition affects one eye (unilateral) or both eyes (bilateral)');
  }
  if (!isChronic && totalLogs > 5) {
    gaps.push('If condition is chronic or recurrent, document this pattern');
  }
  if (hasGlaucoma || hasCataract || hasMacularEdema) {
    gaps.push('Complications may be rated separately - ensure visual acuity is documented');
  }
  if (advancedTreatments.length === 0 && treatmentVisits > 2) {
    gaps.push('Document specific treatments received (injections, immunosuppressants, etc.)');
  }

  return {
    hasData: true,
    condition: 'Uveitis / Choroidopathy',
    diagnosticCode: '6000',
    cfrReference: '38 CFR 4.79',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      treatmentVisits,
      isBilateral,
      isChronic,
      hasComplications: complications.length > 0,
      complicationCount: complications.length,
    },
    criteria: UVEITIS_CRITERIA,
  };
};

// DC 6001: KERATITIS / KERATOPATHY ANALYSIS
export const analyzeKeratitis = (logs) => {
  const symptomIds = CONDITIONS.KERATITIS.symptomIds;
  const conditionLogs = logs.filter(log => {
    const symptomId = getLogSymptomId(log);
    return symptomIds.includes(symptomId);
  });

  if (conditionLogs.length === 0) {
    return { hasData: false };
  }

  // Calculate metrics
  const totalLogs = conditionLogs.length;
  const severityLogs = conditionLogs.filter(log => log.severity != null);
  const avgSeverity = severityLogs.length > 0
      ? severityLogs.reduce((sum, log) => sum + log.severity, 0) / severityLogs.length
      : 0;

  // Count treatment visits
  const treatmentVisits = countEyeTreatmentVisits(conditionLogs, 'keratitis');

  // Identify type/cause
  const isBacterial = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-bacterial');
  const isViral = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-viral');
  const isFungal = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-fungal');
  const isAcanthamoeba = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-acanthamoeba');
  const isExposure = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-exposure');
  const isNeurotrophic = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-neurotrophic');

  // Identify laterality
  const isBilateral = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-bilateral');
  const isUnilateral = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-unilateral');

  // Check for treatments
  const hasAntibiotics = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-antibiotic-drops');
  const hasAntivirals = conditionLogs.some(log =>
      getLogSymptomId(log) === 'keratitis-antiviral-drops' || getLogSymptomId(log) === 'keratitis-oral-antivirals'
  );
  const hasAntifungals = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-antifungal-drops');
  const hasSteroids = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-steroid-drops');
  const hasBandageLens = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-bandage-lens');
  const hasCornealScraping = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-corneal-scraping');
  const hasCornealTransplant = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-corneal-transplant');

  // Check for complications
  const hasCornealUlcer = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-corneal-ulcer');
  const hasCornealScarring = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-corneal-scarring');
  const hasCornealPerforation = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-corneal-perforation');
  const isChronic = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-chronic-recurrent');
  const hasVisualAcuityLoss = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-visual-acuity-decreased');
  const hasGlareSensitivity = conditionLogs.some(log => getLogSymptomId(log) === 'keratitis-glare-sensitivity');

  // Determine rating based on treatment visits
  let supportedRating = getEyeRatingFromVisits(treatmentVisits);

  // Build rationale
  const ratingRationale = [];

  if (treatmentVisits >= 7) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 60% rating`);
  } else if (treatmentVisits >= 5) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 40% rating`);
  } else if (treatmentVisits >= 3) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 20% rating`);
  } else if (treatmentVisits >= 1) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visit(s) in past 12 months, supporting 10% rating`);
  } else {
    ratingRationale.push('No documented treatment visits - log clinic visits for eye condition treatment');
  }

  // Type information
  const types = [];
  if (isBacterial) types.push('bacterial');
  if (isViral) types.push('viral (herpes)');
  if (isFungal) types.push('fungal');
  if (isAcanthamoeba) types.push('acanthamoeba');
  if (isExposure) types.push('exposure keratopathy');
  if (isNeurotrophic) types.push('neurotrophic');
  if (types.length > 0) {
    ratingRationale.push(`Keratitis type: ${types.join(', ')}`);
  }

  // Laterality
  if (isBilateral) {
    ratingRationale.push('Bilateral involvement documented');
  } else if (isUnilateral) {
    ratingRationale.push('Unilateral involvement documented');
  }

  // Treatments
  const treatments = [];
  if (hasAntibiotics) treatments.push('antibiotic drops');
  if (hasAntivirals) treatments.push('antiviral medication');
  if (hasAntifungals) treatments.push('antifungal drops');
  if (hasSteroids) treatments.push('steroid drops');
  if (hasBandageLens) treatments.push('bandage contact lens');
  if (hasCornealScraping) treatments.push('corneal scraping/debridement');
  if (hasCornealTransplant) treatments.push('corneal transplant');
  if (treatments.length > 0) {
    ratingRationale.push(`Treatments documented: ${treatments.join(', ')}`);
  }

  // Complications
  const complications = [];
  if (hasCornealUlcer) complications.push('corneal ulcer');
  if (hasCornealScarring) complications.push('corneal scarring');
  if (hasCornealPerforation) complications.push('corneal perforation');
  if (complications.length > 0) {
    ratingRationale.push(`Complications documented: ${complications.join(', ')} - may affect visual acuity rating`);
  }

  if (isChronic) {
    ratingRationale.push('Chronic/recurrent keratitis documented');
  }

  if (hasVisualAcuityLoss) {
    ratingRationale.push('Visual impairment documented - consider rating under DC 6061-6091 if higher');
  }

  // Build gaps
  const gaps = [];
  if (treatmentVisits === 0) {
    gaps.push('Log each clinic visit for keratitis treatment as a "Treatment Visit" symptom');
  }
  if (treatmentVisits > 0 && treatmentVisits < 7) {
    gaps.push(`${7 - treatmentVisits} more treatment visits would support 60% rating`);
  }
  if (types.length === 0) {
    gaps.push('Document keratitis type (bacterial, viral, fungal, etc.)');
  }
  if (!isBilateral && !isUnilateral) {
    gaps.push('Document whether condition affects one eye (unilateral) or both eyes (bilateral)');
  }
  if (!isChronic && totalLogs > 5) {
    gaps.push('If condition is chronic or recurrent, document this pattern');
  }
  if (hasCornealScarring && !hasVisualAcuityLoss) {
    gaps.push('Corneal scarring present - document any visual acuity changes');
  }
  if (treatments.length === 0 && treatmentVisits > 0) {
    gaps.push('Document specific treatments received (antibiotic drops, antivirals, procedures, etc.)');
  }

  return {
    hasData: true,
    condition: 'Keratitis / Keratopathy',
    diagnosticCode: '6001',
    cfrReference: '38 CFR 4.79',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      treatmentVisits,
      isBilateral,
      isChronic,
      hasComplications: complications.length > 0,
      complicationCount: complications.length,
    },
    criteria: KERATITIS_CRITERIA,
  };
};

// DC 6018: CHRONIC CONJUNCTIVITIS ANALYSIS
export const analyzeChronicConjunctivitis = (logs) => {
  const symptomIds = CONDITIONS.CHRONIC_CONJUNCTIVITIS.symptomIds;
  const conditionLogs = logs.filter(log => {
    const symptomId = getLogSymptomId(log);
    return symptomIds.includes(symptomId);
  });

  if (conditionLogs.length === 0) {
    return { hasData: false };
  }

  // Calculate metrics
  const totalLogs = conditionLogs.length;
  const severityLogs = conditionLogs.filter(log => log.severity != null);
  const avgSeverity = severityLogs.length > 0
      ? severityLogs.reduce((sum, log) => sum + log.severity, 0) / severityLogs.length
      : 0;

  // Count treatment visits
  const treatmentVisits = countEyeTreatmentVisits(conditionLogs, 'conj');

  // Identify type
  const isAllergic = conditionLogs.some(log => getLogSymptomId(log) === 'conj-allergic');
  const isBacterial = conditionLogs.some(log => getLogSymptomId(log) === 'conj-bacterial');
  const isViral = conditionLogs.some(log => getLogSymptomId(log) === 'conj-viral');
  const isGiantPapillary = conditionLogs.some(log => getLogSymptomId(log) === 'conj-giant-papillary');
  const isAtopic = conditionLogs.some(log => getLogSymptomId(log) === 'conj-atopic');

  // Identify status (critical for DC 6018)
  const isActive = conditionLogs.some(log => getLogSymptomId(log) === 'conj-active');
  const isInactive = conditionLogs.some(log => getLogSymptomId(log) === 'conj-inactive');
  const isChronic = conditionLogs.some(log => getLogSymptomId(log) === 'conj-chronic');
  const isRecurrent = conditionLogs.some(log => getLogSymptomId(log) === 'conj-recurrent');

  // Identify laterality
  const isBilateral = conditionLogs.some(log => getLogSymptomId(log) === 'conj-bilateral');
  const isUnilateral = conditionLogs.some(log => getLogSymptomId(log) === 'conj-unilateral');

  // Check for treatments
  const hasArtificialTears = conditionLogs.some(log => getLogSymptomId(log) === 'conj-artificial-tears');
  const hasAntihistamineDrops = conditionLogs.some(log => getLogSymptomId(log) === 'conj-antihistamine-drops');
  const hasMastCellStabilizer = conditionLogs.some(log => getLogSymptomId(log) === 'conj-mast-cell-stabilizer');
  const hasAntibioticDrops = conditionLogs.some(log => getLogSymptomId(log) === 'conj-antibiotic-drops');
  const hasSteroidDrops = conditionLogs.some(log => getLogSymptomId(log) === 'conj-steroid-drops');
  const hasImmunomodulator = conditionLogs.some(log => getLogSymptomId(log) === 'conj-immunomodulator');
  const hasOralAntihistamines = conditionLogs.some(log => getLogSymptomId(log) === 'conj-oral-antihistamines');

  // Check for residuals (for inactive rating)
  const hasScarring = conditionLogs.some(log => getLogSymptomId(log) === 'conj-scarring');
  const hasSymblepharon = conditionLogs.some(log => getLogSymptomId(log) === 'conj-symblepharon');
  const hasDryEye = conditionLogs.some(log => getLogSymptomId(log) === 'conj-dry-eye');
  const hasDisfigurement = conditionLogs.some(log => getLogSymptomId(log) === 'conj-disfigurement');
  const hasVisualImpairment = conditionLogs.some(log => getLogSymptomId(log) === 'conj-visual-impairment');

  // Determine rating based on treatment visits and active/inactive status
  let supportedRating = getEyeRatingFromVisits(treatmentVisits);

  // DC 6018 special rule: Active conjunctivitis has minimum 10% rating
  // If marked as active but no treatment visits logged, still gets minimum 10%
  if (isActive && supportedRating < 10) {
    supportedRating = 10;
  }

  // Build rationale
  const ratingRationale = [];

  // Active vs Inactive status
  if (isActive) {
    ratingRationale.push('ACTIVE chronic conjunctivitis - minimum 10% rating applies');
    if (treatmentVisits >= 7) {
      ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 60% rating`);
    } else if (treatmentVisits >= 5) {
      ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 40% rating`);
    } else if (treatmentVisits >= 3) {
      ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 20% rating`);
    } else if (treatmentVisits >= 1) {
      ratingRationale.push(`Documented ${treatmentVisits} treatment visit(s) in past 12 months, supporting 10% rating`);
    }
  } else if (isInactive) {
    ratingRationale.push('INACTIVE conjunctivitis - rate based on residuals (visual impairment, disfigurement)');
    if (hasVisualImpairment) {
      ratingRationale.push('Visual impairment documented - rate under DC 6061-6091');
    }
    if (hasDisfigurement) {
      ratingRationale.push('Disfigurement documented - may rate under DC 7800');
    }
    if (!hasVisualImpairment && !hasDisfigurement && !hasScarring && !hasSymblepharon) {
      supportedRating = 0;
      ratingRationale.push('No residuals documented - 0% rating for inactive without residuals');
    }
  } else {
    // Status not specified - use treatment visits
    if (treatmentVisits >= 1) {
      ratingRationale.push('Active status not specified - rating based on treatment visits');
      ratingRationale.push(`Documented ${treatmentVisits} treatment visit(s) in past 12 months`);
    } else {
      ratingRationale.push('Document whether conjunctivitis is active or inactive for accurate rating');
    }
  }

  // Type information
  const types = [];
  if (isAllergic) types.push('allergic');
  if (isBacterial) types.push('bacterial');
  if (isViral) types.push('viral');
  if (isGiantPapillary) types.push('giant papillary (contact lens)');
  if (isAtopic) types.push('atopic');
  if (types.length > 0) {
    ratingRationale.push(`Conjunctivitis type: ${types.join(', ')}`);
  }

  // Chronicity
  if (isChronic) {
    ratingRationale.push('Chronic conjunctivitis (>4 weeks duration) documented');
  }
  if (isRecurrent) {
    ratingRationale.push('Recurrent episodes documented');
  }

  // Laterality
  if (isBilateral) {
    ratingRationale.push('Bilateral involvement documented');
  } else if (isUnilateral) {
    ratingRationale.push('Unilateral involvement documented');
  }

  // Treatments
  const treatments = [];
  if (hasArtificialTears) treatments.push('artificial tears');
  if (hasAntihistamineDrops) treatments.push('antihistamine drops');
  if (hasMastCellStabilizer) treatments.push('mast cell stabilizer');
  if (hasAntibioticDrops) treatments.push('antibiotic drops');
  if (hasSteroidDrops) treatments.push('steroid drops');
  if (hasImmunomodulator) treatments.push('immunomodulator (cyclosporine)');
  if (hasOralAntihistamines) treatments.push('oral antihistamines');
  if (treatments.length > 0) {
    ratingRationale.push(`Treatments documented: ${treatments.join(', ')}`);
  }

  // Residuals
  const residuals = [];
  if (hasScarring) residuals.push('conjunctival scarring');
  if (hasSymblepharon) residuals.push('symblepharon');
  if (hasDryEye) residuals.push('secondary dry eye');
  if (residuals.length > 0) {
    ratingRationale.push(`Residuals documented: ${residuals.join(', ')}`);
  }

  // Build gaps
  const gaps = [];
  if (!isActive && !isInactive) {
    gaps.push('IMPORTANT: Document whether conjunctivitis is ACTIVE or INACTIVE - this determines rating method');
  }
  if (treatmentVisits === 0 && isActive) {
    gaps.push('Log each clinic visit for conjunctivitis treatment as a "Treatment Visit" symptom');
  }
  if (treatmentVisits > 0 && treatmentVisits < 7 && isActive) {
    gaps.push(`${7 - treatmentVisits} more treatment visits would support 60% rating`);
  }
  if (!isChronic && !isRecurrent) {
    gaps.push('Document chronic nature (>4 weeks) or recurrent pattern');
  }
  if (types.length === 0) {
    gaps.push('Document conjunctivitis type (allergic, bacterial, viral, etc.)');
  }
  if (!isBilateral && !isUnilateral) {
    gaps.push('Document whether condition affects one eye (unilateral) or both eyes (bilateral)');
  }
  if (isInactive && !hasVisualImpairment && !hasDisfigurement) {
    gaps.push('For inactive conjunctivitis, document any residuals (visual impairment, scarring, disfigurement)');
  }

  return {
    hasData: true,
    condition: 'Chronic Conjunctivitis',
    diagnosticCode: '6018',
    cfrReference: '38 CFR 4.79',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      treatmentVisits,
      isActive,
      isInactive,
      isBilateral,
      isChronic: isChronic || isRecurrent,
      hasResiduals: residuals.length > 0,
      residualCount: residuals.length,
    },
    criteria: CHRONIC_CONJUNCTIVITIS_CRITERIA,
  };
};

// DC 6002: SCLERITIS ANALYSIS
export const analyzeScleritis = (logs) => {
  const symptomIds = CONDITIONS.SCLERITIS.symptomIds;
  const conditionLogs = logs.filter(log => {
    const symptomId = getLogSymptomId(log);
    return symptomIds.includes(symptomId);
  });

  if (conditionLogs.length === 0) {
    return { hasData: false };
  }

  // Calculate metrics
  const totalLogs = conditionLogs.length;
  const severityLogs = conditionLogs.filter(log => log.severity != null);
  const avgSeverity = severityLogs.length > 0
      ? severityLogs.reduce((sum, log) => sum + log.severity, 0) / severityLogs.length
      : 0;

  // Count treatment visits
  const treatmentVisits = countEyeTreatmentVisits(conditionLogs, 'scleritis');

  // Identify type
  const isDiffuse = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-anterior-diffuse');
  const isNodular = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-anterior-nodular');
  const isNecrotizing = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-necrotizing');
  const isPosterior = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-posterior');

  // Identify laterality
  const isBilateral = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-bilateral');
  const isUnilateral = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-unilateral');

  // Associated conditions
  const isAutoimmune = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-autoimmune');
  const isInfectious = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-infectious');

  // Check for treatments
  const hasNSAIDs = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-nsaid-oral');
  const hasOralSteroids = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-oral-steroids');
  const hasImmunosuppressants = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-immunosuppressants');
  const hasBiologics = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-biologic-agents');
  const hasSubconjunctivalInjection = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-subconjunctival-injection');
  const hasSurgery = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-surgery');

  // Check for complications
  const hasScleralThinning = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-scleral-thinning');
  const hasScleromalacia = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-scleromalacia');
  const hasUveitis = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-uveitis');
  const hasGlaucoma = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-glaucoma');
  const hasCataract = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-cataract');
  const isChronic = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-chronic-recurrent');
  const hasVisualAcuityLoss = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-visual-acuity-decreased');
  const hasPermanentVisionLoss = conditionLogs.some(log => getLogSymptomId(log) === 'scleritis-vision-loss-permanent');

  // Determine rating based on treatment visits
  let supportedRating = getEyeRatingFromVisits(treatmentVisits);

  // Build rationale
  const ratingRationale = [];

  if (treatmentVisits >= 7) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 60% rating`);
  } else if (treatmentVisits >= 5) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 40% rating`);
  } else if (treatmentVisits >= 3) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visits in past 12 months, supporting 20% rating`);
  } else if (treatmentVisits >= 1) {
    ratingRationale.push(`Documented ${treatmentVisits} treatment visit(s) in past 12 months, supporting 10% rating`);
  } else {
    ratingRationale.push('No documented treatment visits - log clinic visits for eye condition treatment');
  }

  // Type information
  const types = [];
  if (isDiffuse) types.push('anterior diffuse');
  if (isNodular) types.push('anterior nodular');
  if (isNecrotizing) types.push('NECROTIZING (severe)');
  if (isPosterior) types.push('posterior');
  if (types.length > 0) {
    ratingRationale.push(`Scleritis type: ${types.join(', ')}`);
  }

  // Severity indicator for necrotizing
  if (isNecrotizing) {
    ratingRationale.push(' Necrotizing scleritis is the most severe form - high risk of vision loss');
  }

  // Laterality
  if (isBilateral) {
    ratingRationale.push('Bilateral involvement documented');
  } else if (isUnilateral) {
    ratingRationale.push('Unilateral involvement documented');
  }

  // Associated conditions
  if (isAutoimmune) {
    ratingRationale.push('Associated with autoimmune disease - systemic condition may warrant separate rating');
  }
  if (isInfectious) {
    ratingRationale.push('Infectious etiology documented');
  }

  // Treatments
  const treatments = [];
  if (hasNSAIDs) treatments.push('oral NSAIDs');
  if (hasOralSteroids) treatments.push('oral corticosteroids');
  if (hasImmunosuppressants) treatments.push('immunosuppressants');
  if (hasBiologics) treatments.push('biologic agents');
  if (hasSubconjunctivalInjection) treatments.push('subconjunctival injection');
  if (hasSurgery) treatments.push('surgical intervention');
  if (treatments.length > 0) {
    ratingRationale.push(`Treatments documented: ${treatments.join(', ')}`);
  }

  // Complications
  const complications = [];
  if (hasScleralThinning) complications.push('scleral thinning');
  if (hasScleromalacia) complications.push('scleromalacia');
  if (hasUveitis) complications.push('secondary uveitis');
  if (hasGlaucoma) complications.push('secondary glaucoma');
  if (hasCataract) complications.push('cataract');
  if (complications.length > 0) {
    ratingRationale.push(`Complications documented: ${complications.join(', ')} - may warrant separate ratings`);
  }

  if (isChronic) {
    ratingRationale.push('Chronic/recurrent scleritis documented');
  }

  if (hasVisualAcuityLoss || hasPermanentVisionLoss) {
    ratingRationale.push('Visual impairment documented - consider rating under DC 6061-6091 if higher');
  }

  // Build gaps
  const gaps = [];
  if (treatmentVisits === 0) {
    gaps.push('Log each clinic visit for scleritis treatment as a "Treatment Visit" symptom');
  }
  if (treatmentVisits > 0 && treatmentVisits < 7) {
    gaps.push(`${7 - treatmentVisits} more treatment visits would support 60% rating`);
  }
  if (types.length === 0) {
    gaps.push('Document scleritis type (diffuse, nodular, necrotizing, or posterior)');
  }
  if (!isBilateral && !isUnilateral) {
    gaps.push('Document whether condition affects one eye (unilateral) or both eyes (bilateral)');
  }
  if (!isAutoimmune && !isInfectious) {
    gaps.push('Document associated conditions (autoimmune disease, infection) if applicable');
  }
  if (!isChronic && totalLogs > 5) {
    gaps.push('If condition is chronic or recurrent, document this pattern');
  }
  if (isNecrotizing && !hasScleralThinning && !hasScleromalacia) {
    gaps.push('Necrotizing scleritis - document scleral thinning or scleromalacia if present');
  }
  if (hasUveitis) {
    gaps.push('Secondary uveitis present - may be rated separately under DC 6000');
  }
  if (hasGlaucoma) {
    gaps.push('Secondary glaucoma present - may be rated separately under DC 6012/6013');
  }

  return {
    hasData: true,
    condition: 'Scleritis',
    diagnosticCode: '6002',
    cfrReference: '38 CFR 4.79',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      treatmentVisits,
      isBilateral,
      isChronic,
      isNecrotizing,
      hasComplications: complications.length > 0,
      complicationCount: complications.length,
      hasAutoimmune: isAutoimmune,
    },
    criteria: SCLERITIS_CRITERIA,
  };
};


// ============================================
// PHASE 7B: EAR CONDITIONS ANALYSIS FUNCTIONS
// ============================================

/**
 * Analyze Peripheral Vestibular Disorders symptom logs against VA rating criteria
 * DC 6204 - 30% for dizziness with staggering, 10% for occasional dizziness
 */
export const analyzePeripheralVestibular = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = log.symptomId || log.symptom;
    return logDate >= cutoffDate && symptomId?.startsWith('vest-');
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Peripheral Vestibular Disorders',
      diagnosticCode: '6204',
      message: 'No vestibular symptoms logged in evaluation period',
    };
  }

  // Key symptoms for rating
  const hasDizziness = relevantLogs.some(log => {
    const id = log.symptomId || log.symptom;
    return id === 'vest-dizziness' || id === 'vest-vertigo' || id === 'vest-occasional' || id === 'vest-frequent';
  });

  const hasStaggering = relevantLogs.some(log => {
    const id = log.symptomId || log.symptom;
    return id === 'vest-staggering' || id === 'vest-with-staggering';
  });

  const hasOccasionalDizziness = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-occasional');
  const hasDizzinessWithStaggering = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-with-staggering');

  // Other symptoms
  const hasVertigo = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-vertigo');
  const hasImbalance = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-imbalance');
  const hasNausea = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-nausea');
  const hasNystagmus = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-nystagmus');
  const hasFalls = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-fall-risk');

  // Functional impact
  const hasDrivingAffected = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-driving-affected');
  const hasWorkAffected = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-work-affected');
  const hasDailyActivities = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-daily-activities');

  // Triggers
  const hasPositionTrigger = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-position-triggered');
  const hasVisualTrigger = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-visual-trigger');

  // Treatment
  const hasMedication = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-medication');
  const hasPhysicalTherapy = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-physical-therapy');
  const hasProcedure = relevantLogs.some(log => (log.symptomId || log.symptom) === 'vest-procedure');

  // Calculate rating per DC 6204 criteria
  let supportedRating = 0;
  if ((hasDizziness || hasVertigo) && hasStaggering) {
    supportedRating = 30;
  } else if (hasDizzinessWithStaggering) {
    supportedRating = 30;
  } else if (hasDizziness || hasVertigo || hasOccasionalDizziness) {
    supportedRating = 10;
  }

  // Build rationale
  const ratingRationale = [];

  if (supportedRating === 30) {
    ratingRationale.push('Dizziness WITH occasional staggering documented (30% criteria)');
  } else if (supportedRating === 10) {
    ratingRationale.push('Occasional dizziness documented (10% criteria)');
  }

  // Count vertigo episodes
  const vertigoLogs = relevantLogs.filter(log => {
    const id = log.symptomId || log.symptom;
    return id === 'vest-vertigo' || id === 'vest-dizziness';
  });
  if (vertigoLogs.length > 0) {
    ratingRationale.push(`${vertigoLogs.length} vertigo/dizziness episodes logged`);
  }

  if (hasNystagmus) ratingRationale.push('Nystagmus documented (objective finding)');
  if (hasFalls) ratingRationale.push('Falls or near-falls documented');

  // Functional impact
  const impacts = [];
  if (hasDrivingAffected) impacts.push('driving');
  if (hasWorkAffected) impacts.push('work');
  if (hasDailyActivities) impacts.push('daily activities');
  if (impacts.length > 0) {
    ratingRationale.push(`Functional impact: ${impacts.join(', ')} affected`);
  }

  // Triggers
  if (hasPositionTrigger) ratingRationale.push('Symptoms triggered by position changes (suggests BPPV)');

  // Treatments
  const treatments = [];
  if (hasMedication) treatments.push('medication');
  if (hasPhysicalTherapy) treatments.push('vestibular rehabilitation');
  if (hasProcedure) treatments.push('procedure/surgery');
  if (treatments.length > 0) {
    ratingRationale.push(`Treatment: ${treatments.join(', ')}`);
  }

  // Gaps
  const gaps = [];
  if (!hasNystagmus) {
    gaps.push('IMPORTANT: Document objective findings (nystagmus, abnormal testing) - required for compensable rating');
  }
  if (hasDizziness && !hasStaggering && supportedRating === 10) {
    gaps.push('Documenting staggering gait with dizziness would support 30% rating');
  }
  if (!hasDizziness && !hasVertigo) {
    gaps.push('Document dizziness or vertigo episodes');
  }

  // Calculate average severity
  const severities = relevantLogs.filter(log => log.severity).map(log => log.severity);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  return {
    hasData: true,
    condition: 'Peripheral Vestibular Disorders',
    diagnosticCode: '6204',
    cfrReference: '38 CFR 4.87',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      vertigoEpisodes: vertigoLogs.length,
      avgSeverity,
      hasDizziness,
      hasStaggering,
      hasObjectiveFindings: hasNystagmus,
      hasFalls,
    },
    criteria: PERIPHERAL_VESTIBULAR_CRITERIA,
  };
};

/**
 * Analyze Chronic Suppurative Otitis Media symptom logs against VA rating criteria
 * DC 6200 - 10% during suppuration or with aural polyps
 */
export const analyzeChronicSuppurativeOtitisMedia = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = log.symptomId || log.symptom;
    return logDate >= cutoffDate && symptomId?.startsWith('csom-');
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Chronic Suppurative Otitis Media',
      diagnosticCode: '6200',
      message: 'No chronic otitis media symptoms logged in evaluation period',
    };
  }

  // Key criteria for 10% rating
  const hasSuppuration = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-suppuration');
  const hasAuralPolyp = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-aural-polyp');
  const hasDrainage = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-ear-drainage');

  // Other symptoms
  const hasEarPain = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-ear-pain');
  const hasHearingChange = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-hearing-change');
  const hasTympanicPerforation = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-tympanic-perforation');
  const hasFoulOdor = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-foul-odor');

  // Laterality
  const isRightEar = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-right-ear');
  const isLeftEar = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-left-ear');
  const isBilateral = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-bilateral');

  // Complications (rated separately per Note)
  const hasLabyrinthitis = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-labyrinthitis');
  const hasTinnitus = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-tinnitus');
  const hasFacialParalysis = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-facial-paralysis');
  const hasBoneLoss = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-bone-loss');
  const hasCholesteatoma = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-cholesteatoma');
  const hasMastoiditis = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-mastoiditis');

  // Treatment
  const hasEarDrops = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-ear-drops');
  const hasOralAntibiotics = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-oral-antibiotics');
  const hasEarCleaning = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-ear-cleaning');
  const hasSurgery = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-surgery');
  const hasTubePlacement = relevantLogs.some(log => (log.symptomId || log.symptom) === 'csom-tube-placement');

  // Calculate rating per DC 6200 criteria - max is 10%
  let supportedRating = 0;
  if (hasSuppuration || hasAuralPolyp) {
    supportedRating = 10;
  }

  // Build rationale
  const ratingRationale = [];

  if (hasSuppuration) {
    ratingRationale.push('Active suppuration (pus drainage) documented - meets 10% criteria');
  }
  if (hasAuralPolyp) {
    ratingRationale.push('Aural polyp present - meets 10% criteria');
  }
  if (!hasSuppuration && !hasAuralPolyp && hasDrainage) {
    ratingRationale.push('Ear drainage documented - specify if suppurative (pus) for 10% rating');
  }

  // Laterality
  if (isBilateral) {
    ratingRationale.push('Bilateral ear involvement');
  } else if (isRightEar || isLeftEar) {
    ratingRationale.push(`${isRightEar ? 'Right' : 'Left'} ear affected`);
  }

  if (hasCholesteatoma) ratingRationale.push('Cholesteatoma present');
  if (hasMastoiditis) ratingRationale.push('Mastoiditis present');
  if (hasTympanicPerforation) ratingRationale.push('Tympanic membrane perforation');

  // Complications - these get separate ratings
  const complications = [];
  if (hasHearingChange) complications.push('hearing impairment (rate separately under DC 6100)');
  if (hasLabyrinthitis) complications.push('labyrinthitis');
  if (hasTinnitus) complications.push('tinnitus (rate separately under DC 6260)');
  if (hasFacialParalysis) complications.push('facial nerve paralysis');
  if (hasBoneLoss) complications.push('bone loss');
  if (complications.length > 0) {
    ratingRationale.push(`Complications present: ${complications.join(', ')}`);
  }

  // Treatments
  const treatments = [];
  if (hasEarDrops) treatments.push('ear drops');
  if (hasOralAntibiotics) treatments.push('oral antibiotics');
  if (hasEarCleaning) treatments.push('professional cleaning');
  if (hasSurgery) treatments.push('surgery');
  if (hasTubePlacement) treatments.push('tube placement');
  if (treatments.length > 0) {
    ratingRationale.push(`Treatment: ${treatments.join(', ')}`);
  }

  // Gaps
  const gaps = [];
  if (!hasSuppuration && !hasAuralPolyp) {
    gaps.push('Document active suppuration (pus drainage) OR aural polyps for 10% rating');
  }
  if (hasHearingChange) {
    gaps.push('Hearing impairment should be evaluated separately under DC 6100 and combined');
  }
  if (hasTinnitus) {
    gaps.push('Tinnitus should be evaluated separately under DC 6260 (10%) and combined');
  }
  if (hasLabyrinthitis || hasFacialParalysis || hasBoneLoss) {
    gaps.push('Complications should be evaluated separately and combined');
  }

  // Calculate average severity
  const severities = relevantLogs.filter(log => log.severity).map(log => log.severity);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  return {
    hasData: true,
    condition: 'Chronic Suppurative Otitis Media',
    diagnosticCode: '6200',
    cfrReference: '38 CFR 4.87',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity,
      hasSuppuration,
      hasAuralPolyp,
      isBilateral,
      hasComplications: complications.length > 0,
      complicationCount: complications.length,
    },
    criteria: CHRONIC_SUPPURATIVE_OTITIS_MEDIA_CRITERIA,
  };
};

/**
 * Analyze Chronic Otitis Externa symptom logs against VA rating criteria
 * DC 6210 - 10% for swelling + dry/scaly or discharge + itching + frequent/prolonged treatment
 */
export const analyzeChronicOtitisExterna = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = log.symptomId || log.symptom;
    return logDate >= cutoffDate && symptomId?.startsWith('coe-');
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Chronic Otitis Externa',
      diagnosticCode: '6210',
      message: 'No otitis externa symptoms logged in evaluation period',
    };
  }

  // ALL criteria required for 10% rating
  const hasSwelling = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-swelling');
  const hasDryScaly = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-dry-scaly');
  const hasSerousDischarge = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-serous-discharge');
  const hasItching = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-itching');
  const hasFrequentTreatment = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-frequent-treatment');
  const hasProlongedTreatment = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-prolonged-treatment');

  // Check if all criteria met
  const hasSkinChanges = hasDryScaly || hasSerousDischarge;
  const hasTreatmentRequirement = hasFrequentTreatment || hasProlongedTreatment;
  const allCriteriaMet = hasSwelling && hasSkinChanges && hasItching && hasTreatmentRequirement;

  // Other symptoms
  const hasEarPain = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-ear-pain');
  const hasTenderness = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-tenderness');
  const hasRedness = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-redness');
  const hasDebris = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-debris');
  const isChronic = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-chronic');

  // Laterality
  const isRightEar = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-right-ear');
  const isLeftEar = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-left-ear');
  const isBilateral = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-bilateral');

  // Type
  const isBacterial = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-bacterial');
  const isFungal = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-fungal');
  const isEczematous = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-eczematous');

  // Treatment
  const hasEarDrops = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-ear-drops');
  const hasOralMedication = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-oral-medication');
  const hasEarCleaning = relevantLogs.some(log => (log.symptomId || log.symptom) === 'coe-ear-cleaning');

  // Calculate rating - ALL criteria must be met for 10%
  let supportedRating = allCriteriaMet ? 10 : 0;

  // Build rationale
  const ratingRationale = [];

  // Check each criterion
  const criteriaStatus = [];
  criteriaStatus.push(`Swelling: ${hasSwelling ? '' : ''}`);
  criteriaStatus.push(`Dry/scaly OR serous discharge: ${hasSkinChanges ? '' : ''}`);
  criteriaStatus.push(`Itching: ${hasItching ? '' : ''}`);
  criteriaStatus.push(`Frequent/prolonged treatment: ${hasTreatmentRequirement ? '' : ''}`);

  if (allCriteriaMet) {
    ratingRationale.push('ALL criteria met for 10% rating');
  } else {
    ratingRationale.push('Not all criteria met - see gaps below');
  }
  ratingRationale.push(`Criteria status: ${criteriaStatus.join(', ')}`);

  // Type
  const types = [];
  if (isBacterial) types.push('bacterial');
  if (isFungal) types.push('fungal');
  if (isEczematous) types.push('eczematous');
  if (types.length > 0) {
    ratingRationale.push(`Type: ${types.join(', ')}`);
  }

  // Laterality
  if (isBilateral) {
    ratingRationale.push('Bilateral ear involvement');
  } else if (isRightEar || isLeftEar) {
    ratingRationale.push(`${isRightEar ? 'Right' : 'Left'} ear affected`);
  }

  if (isChronic) ratingRationale.push('Chronic pattern documented');

  // Treatments
  const treatments = [];
  if (hasEarDrops) treatments.push('ear drops');
  if (hasOralMedication) treatments.push('oral medication');
  if (hasEarCleaning) treatments.push('professional cleaning');
  if (treatments.length > 0) {
    ratingRationale.push(`Treatment: ${treatments.join(', ')}`);
  }

  // Gaps - show missing criteria
  const gaps = [];
  if (!hasSwelling) {
    gaps.push('Document ear canal swelling');
  }
  if (!hasSkinChanges) {
    gaps.push('Document dry/scaly skin OR serous discharge');
  }
  if (!hasItching) {
    gaps.push('Document ear canal itching');
  }
  if (!hasTreatmentRequirement) {
    gaps.push('Document that treatment is FREQUENT and PROLONGED');
  }
  if (!allCriteriaMet) {
    gaps.push('ALL four criteria must be documented for 10% rating');
  }

  // Calculate average severity
  const severities = relevantLogs.filter(log => log.severity).map(log => log.severity);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  return {
    hasData: true,
    condition: 'Chronic Otitis Externa',
    diagnosticCode: '6210',
    cfrReference: '38 CFR 4.87',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity,
      hasSwelling,
      hasSkinChanges,
      hasItching,
      hasTreatmentRequirement,
      allCriteriaMet,
      isBilateral,
    },
    criteria: CHRONIC_OTITIS_EXTERNA_CRITERIA,
  };
};

/**
 * Analyze Chronic Nonsuppurative Otitis Media symptom logs
 * DC 6201 - Rate hearing impairment under DC 6100
 */
export const analyzeChronicNonsuppurativeOtitisMedia = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = log.symptomId || log.symptom;
    return logDate >= cutoffDate && symptomId?.startsWith('cnsom-');
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: 'Chronic Nonsuppurative Otitis Media',
      diagnosticCode: '6201',
      message: 'No serous otitis media symptoms logged in evaluation period',
    };
  }

  // Symptoms
  const hasEarFullness = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-ear-fullness');
  const hasFluidSensation = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-fluid-sensation');
  const hasHearingLoss = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-hearing-loss');
  const hasMuffledHearing = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-muffled-hearing');
  const hasPopping = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-popping-clicking');
  const hasDiscomfort = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-ear-discomfort');
  const hasBalanceIssues = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-balance-issues');
  const hasTinnitus = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-tinnitus');

  // Laterality
  const isRightEar = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-right-ear');
  const isLeftEar = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-left-ear');
  const isBilateral = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-bilateral');

  // Chronicity
  const isChronic = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-chronic');
  const isRecurrent = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-recurrent');
  const isPersistent = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-persistent');

  // Treatment
  const hasDecongestants = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-decongestants');
  const hasAntihistamines = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-antihistamines');
  const hasNasalSteroids = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-nasal-steroids');
  const hasTubes = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-tubes');
  const hasMonitoring = relevantLogs.some(log => (log.symptomId || log.symptom) === 'cnsom-monitoring');

  // DC 6201 doesn't have its own rating - rate hearing impairment
  const supportedRating = 'Variable - Rate hearing impairment';

  // Build rationale
  const ratingRationale = [];

  ratingRationale.push('DC 6201 rates based on resulting hearing impairment under DC 6100');

  // Symptoms
  const symptoms = [];
  if (hasEarFullness) symptoms.push('ear fullness');
  if (hasFluidSensation) symptoms.push('fluid sensation');
  if (hasHearingLoss || hasMuffledHearing) symptoms.push('hearing changes');
  if (hasPopping) symptoms.push('popping/clicking');
  if (hasBalanceIssues) symptoms.push('balance issues');
  if (hasTinnitus) symptoms.push('tinnitus');
  if (symptoms.length > 0) {
    ratingRationale.push(`Symptoms: ${symptoms.join(', ')}`);
  }

  // Laterality
  if (isBilateral) {
    ratingRationale.push('Bilateral ear involvement');
  } else if (isRightEar || isLeftEar) {
    ratingRationale.push(`${isRightEar ? 'Right' : 'Left'} ear affected`);
  }

  if (isChronic || isRecurrent || isPersistent) {
    ratingRationale.push('Chronic/persistent effusion documented');
  }

  // Treatments
  const treatments = [];
  if (hasDecongestants) treatments.push('decongestants');
  if (hasAntihistamines) treatments.push('antihistamines');
  if (hasNasalSteroids) treatments.push('nasal steroids');
  if (hasTubes) treatments.push('tympanostomy tubes');
  if (hasMonitoring) treatments.push('audiological monitoring');
  if (treatments.length > 0) {
    ratingRationale.push(`Treatment: ${treatments.join(', ')}`);
  }

  // Gaps
  const gaps = [];
  gaps.push('IMPORTANT: Rating requires audiometric testing (hearing test) - DC 6201 rates based on hearing impairment');
  if (!hasHearingLoss && !hasMuffledHearing) {
    gaps.push('Document any hearing changes for evaluation');
  }
  if (!isBilateral && !isRightEar && !isLeftEar) {
    gaps.push('Document which ear(s) affected');
  }

  // Calculate average severity
  const severities = relevantLogs.filter(log => log.severity).map(log => log.severity);
  const avgSeverity = severities.length > 0
      ? severities.reduce((a, b) => a + b, 0) / severities.length
      : 0;

  return {
    hasData: true,
    condition: 'Chronic Nonsuppurative Otitis Media',
    diagnosticCode: '6201',
    cfrReference: '38 CFR 4.87',
    supportedRating: 0, // Display as variable, but use 0 for numeric purposes
    supportedRatingDisplay: supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity,
      hasHearingLoss: hasHearingLoss || hasMuffledHearing,
      hasTinnitus,
      isBilateral,
      isChronic: isChronic || isRecurrent || isPersistent,
    },
    criteria: CHRONIC_NONSUPPURATIVE_OTITIS_MEDIA_CRITERIA,
  };
};


// ============================================
// ANALYSIS FUNCTIONS - BRONCHIECTASIS (DC 6601)
// Phase 11 - Rated by incapacitating episodes OR as chronic bronchitis
// ============================================

/**
 * Analyze Bronchiectasis symptom logs against VA rating criteria
 * DC 6601 - Rated by incapacitating episodes or pulmonary function (as DC 6600)
 */
export const analyzeBronchiectasisLogs = (logs, options = {}) => {
  const conditionCriteria = BRONCHIECTASIS_CRITERIA;
  const evaluationPeriodDays = options.days || 365;
  const symptomIds = CONDITIONS.BRONCHIECTASIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No bronchiectasis symptoms logged in evaluation period',
    };
  }

  const incapacitatingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-incapacitating');
  const infectionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-infection');
  const antibioticLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-antibiotic');
  const hemoptysisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-hemoptysis');
  const purulentSputumLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-purulent-sputum');
  const dailySputumLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-sputum');
  const weightLossLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-weight-loss');
  const anorexiaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'bronchiectasis-anorexia');

  const estimatedIncapacitatingWeeks = incapacitatingLogs.length;
  const hasNearConstantSymptoms = purulentSputumLogs.length >= 10 && (hemoptysisLogs.length > 0 || weightLossLogs.length > 0 || anorexiaLogs.length > 0);
  const hasContinuousAntibiotics = antibioticLogs.length >= 6;
  const hasDailyProductiveCough = dailySputumLogs.length >= 20 || purulentSputumLogs.length >= 10;
  const hasProlongedAntibiotics = antibioticLogs.length >= 3;
  const hasIntermittentInfections = infectionLogs.length >= 2 || antibioticLogs.length >= 2;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];
  const evidence = [];

  if (incapacitatingLogs.length > 0) evidence.push(`${incapacitatingLogs.length} incapacitating episodes (~${estimatedIncapacitatingWeeks} weeks)`);
  if (infectionLogs.length > 0) evidence.push(`${infectionLogs.length} respiratory infections documented`);
  if (antibioticLogs.length > 0) evidence.push(`${antibioticLogs.length} antibiotic courses recorded`);
  if (hemoptysisLogs.length > 0) evidence.push(`${hemoptysisLogs.length} hemoptysis episodes`);

  if (estimatedIncapacitatingWeeks >= 6) {
    supportedRating = 100;
    ratingRationale = [`${estimatedIncapacitatingWeeks} weeks incapacitating episodes (6+ weeks criteria)`];
  } else if (estimatedIncapacitatingWeeks >= 4 || (hasNearConstantSymptoms && hasContinuousAntibiotics)) {
    supportedRating = 60;
    ratingRationale = [estimatedIncapacitatingWeeks >= 4 ? `${estimatedIncapacitatingWeeks} weeks incapacitating episodes` : 'Near-constant symptoms with continuous antibiotics'];
  } else if (estimatedIncapacitatingWeeks >= 2 || (hasDailyProductiveCough && hasProlongedAntibiotics)) {
    supportedRating = 30;
    ratingRationale = [estimatedIncapacitatingWeeks >= 2 ? `${estimatedIncapacitatingWeeks} weeks incapacitating episodes` : 'Daily productive cough with prolonged antibiotics'];
  } else if (hasIntermittentInfections) {
    supportedRating = 10;
    ratingRationale = ['Intermittent infections requiring antibiotics 2+ times/year'];
  }

  if (incapacitatingLogs.length === 0) gaps.push('Document incapacitating episodes (requires bedrest + physician treatment)');
  if (antibioticLogs.length < 2) gaps.push('Log all antibiotic courses with duration');
  if (supportedRating < 100) gaps.push('Consider PFTs - can rate as DC 6600 (chronic bronchitis)');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      incapacitatingEpisodes: incapacitatingLogs.length,
      estimatedIncapacitatingWeeks,
      infectionEpisodes: infectionLogs.length,
      antibioticCourses: antibioticLogs.length,
      hemoptysisEpisodes: hemoptysisLogs.length,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - PULMONARY FIBROSIS (DC 6825)
// Phase 11 - Uses Interstitial Lung Disease formula (FVC/DLCO based)
// ============================================

/**
 * Analyze Pulmonary Fibrosis symptom logs against VA rating criteria
 * DC 6825 - Uses General Rating Formula for Interstitial Lung Disease
 */
export const analyzePulmonaryFibrosisLogs = (logs, options = {}) => {
  const conditionCriteria = PULMONARY_FIBROSIS_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.PULMONARY_FIBROSIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  const fvcMeasurements = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && log.type === 'measurement' && log.measurementType === 'fvc';
  });

  const dlcoMeasurements = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    return logDate >= cutoffDate && log.type === 'measurement' && log.measurementType === 'dlco';
  });

  if (relevantLogs.length === 0 && fvcMeasurements.length === 0 && dlcoMeasurements.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No pulmonary fibrosis symptoms or PFT measurements logged',
    };
  }

  const oxygenUseLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pf-oxygen-use');
  const exacerbationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pf-exacerbation');
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pf-hospitalization');
  const hasOxygenUse = oxygenUseLogs.length > 0;

  let fvcPercent = null;
  if (fvcMeasurements.length > 0) {
    const latestFVC = fvcMeasurements[fvcMeasurements.length - 1];
    if (latestFVC.values?.fvc && latestFVC.values?.fvcPredicted) {
      fvcPercent = (latestFVC.values.fvc / latestFVC.values.fvcPredicted) * 100;
    }
  }

  let dlcoPercent = null;
  if (dlcoMeasurements.length > 0) {
    const latestDLCO = dlcoMeasurements[dlcoMeasurements.length - 1];
    if (latestDLCO.values?.dlco && latestDLCO.values?.dlcoPredicted) {
      dlcoPercent = (latestDLCO.values.dlco / latestDLCO.values.dlcoPredicted) * 100;
    }
  }

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];
  const evidence = [];

  if (relevantLogs.length > 0) evidence.push(`${relevantLogs.length} symptom logs in ${evaluationPeriodDays} days`);
  if (fvcPercent !== null) evidence.push(`FVC: ${fvcPercent.toFixed(0)}% predicted`);
  if (dlcoPercent !== null) evidence.push(`DLCO: ${dlcoPercent.toFixed(0)}% predicted`);
  if (hasOxygenUse) evidence.push('Supplemental oxygen use documented');

  // Rating determination based on ILD formula (FVC/DLCO)
  if (hasOxygenUse || (fvcPercent !== null && fvcPercent < 50) || (dlcoPercent !== null && dlcoPercent < 40)) {
    supportedRating = 100;
    ratingRationale = [];
    if (hasOxygenUse) ratingRationale.push('Requires supplemental oxygen therapy');
    if (fvcPercent !== null && fvcPercent < 50) ratingRationale.push(`FVC ${fvcPercent.toFixed(0)}% (<50% criteria)`);
    if (dlcoPercent !== null && dlcoPercent < 40) ratingRationale.push(`DLCO ${dlcoPercent.toFixed(0)}% (<40% criteria)`);
  } else if ((fvcPercent !== null && fvcPercent >= 50 && fvcPercent <= 64) || (dlcoPercent !== null && dlcoPercent >= 40 && dlcoPercent <= 55)) {
    supportedRating = 60;
    if (fvcPercent !== null && fvcPercent >= 50 && fvcPercent <= 64) ratingRationale.push(`FVC ${fvcPercent.toFixed(0)}% (50-64% criteria)`);
    if (dlcoPercent !== null && dlcoPercent >= 40 && dlcoPercent <= 55) ratingRationale.push(`DLCO ${dlcoPercent.toFixed(0)}% (40-55% criteria)`);
  } else if ((fvcPercent !== null && fvcPercent >= 65 && fvcPercent <= 74) || (dlcoPercent !== null && dlcoPercent >= 56 && dlcoPercent <= 65)) {
    supportedRating = 30;
    if (fvcPercent !== null && fvcPercent >= 65 && fvcPercent <= 74) ratingRationale.push(`FVC ${fvcPercent.toFixed(0)}% (65-74% criteria)`);
    if (dlcoPercent !== null && dlcoPercent >= 56 && dlcoPercent <= 65) ratingRationale.push(`DLCO ${dlcoPercent.toFixed(0)}% (56-65% criteria)`);
  } else if ((fvcPercent !== null && fvcPercent >= 75 && fvcPercent <= 80) || (dlcoPercent !== null && dlcoPercent >= 66 && dlcoPercent <= 80)) {
    supportedRating = 10;
    if (fvcPercent !== null && fvcPercent >= 75 && fvcPercent <= 80) ratingRationale.push(`FVC ${fvcPercent.toFixed(0)}% (75-80% criteria)`);
    if (dlcoPercent !== null && dlcoPercent >= 66 && dlcoPercent <= 80) ratingRationale.push(`DLCO ${dlcoPercent.toFixed(0)}% (66-80% criteria)`);
  } else if (fvcPercent === null && dlcoPercent === null) {
    supportedRating = 'Requires PFT';
    ratingRationale = ['Pulmonary function tests (FVC and DLCO) required for rating'];
  } else {
    supportedRating = 0;
    ratingRationale = ['PFT values above compensable thresholds'];
  }

  if (fvcMeasurements.length === 0) gaps.push('Get FVC (Forced Vital Capacity) testing - required for ILD rating');
  if (dlcoMeasurements.length === 0) gaps.push('Get DLCO (Diffusion Capacity) testing - important for ILD');
  if (!hasOxygenUse && exacerbationLogs.length > 0) gaps.push('Document if supplemental oxygen is prescribed');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: supportedRating?.toString() || 'Requires PFT',
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      fvcPercent: fvcPercent ? fvcPercent.toFixed(0) : null,
      dlcoPercent: dlcoPercent ? dlcoPercent.toFixed(0) : null,
      oxygenUseDays: oxygenUseLogs.length,
      exacerbations: exacerbationLogs.length,
      hospitalizations: hospitalizationLogs.length,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

// ============================================
// ANALYSIS FUNCTIONS - SARCOIDOSIS (DC 6846)
// Phase 11 - Specific criteria OR rate as chronic bronchitis (DC 6600)
// ============================================

/**
 * Analyze Sarcoidosis symptom logs against VA rating criteria
 * DC 6846 - Has specific rating criteria based on treatment requirements
 */
export const analyzeSarcoidosisLogs = (logs, options = {}) => {
  const conditionCriteria = SARCOIDOSIS_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.SARCOIDOSIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No sarcoidosis symptoms logged in evaluation period',
    };
  }

  const dyspneaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-shortness-breath');
  const feverLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-fever');
  const nightSweatsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-night-sweats');
  const weightLossLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-weight-loss');
  const corticosteroidLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-corticosteroid');
  const cardiacLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-cardiac');
  const skinLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-skin-lesions');
  const eyeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'sarcoid-eye-symptoms');

  const hasSystemicSymptoms = feverLogs.length > 0 && nightSweatsLogs.length > 0 && weightLossLogs.length > 0;
  const hasCardiacInvolvement = cardiacLogs.length > 0;
  const hasPulmonarySymptoms = dyspneaLogs.length > 0;
  const hasCorticosteroidUse = corticosteroidLogs.length > 0;
  const frequentCorticosteroidUse = corticosteroidLogs.length >= 10;
  const hasExtraPulmonary = skinLogs.length > 0 || eyeLogs.length > 0 || cardiacLogs.length > 0;

  let supportedRating = 0;
  let ratingRationale = [];
  const gaps = [];
  const evidence = [];

  if (dyspneaLogs.length > 0) evidence.push(`${dyspneaLogs.length} days with shortness of breath`);
  if (corticosteroidLogs.length > 0) evidence.push(`${corticosteroidLogs.length} days on corticosteroids`);
  if (hasSystemicSymptoms) evidence.push('Systemic symptoms (fever, night sweats, weight loss) documented');
  if (hasCardiacInvolvement) evidence.push('Cardiac involvement documented');
  if (hasExtraPulmonary) evidence.push('Extra-pulmonary involvement documented');

  // Rating determination
  if (hasCardiacInvolvement || hasSystemicSymptoms) {
    supportedRating = 100;
    ratingRationale = [];
    if (hasCardiacInvolvement) ratingRationale.push('Cardiac involvement documented');
    if (hasSystemicSymptoms) ratingRationale.push('Progressive disease with fever, night sweats, and weight loss');
  } else if (frequentCorticosteroidUse && hasPulmonarySymptoms) {
    supportedRating = 60;
    ratingRationale = ['Pulmonary involvement requiring frequent/high-dose corticosteroids'];
  } else if (hasCorticosteroidUse && hasPulmonarySymptoms) {
    supportedRating = 30;
    ratingRationale = ['Pulmonary involvement with persistent symptoms requiring corticosteroids'];
  } else if (hasPulmonarySymptoms) {
    supportedRating = 0;
    ratingRationale = ['Pulmonary symptoms present but no corticosteroid treatment documented'];
    gaps.push('Document corticosteroid use if prescribed');
  }

  if (!hasCorticosteroidUse) gaps.push('Log corticosteroid use (prednisone, etc.) - key rating factor');
  if (!hasPulmonarySymptoms) gaps.push('Document pulmonary symptoms (shortness of breath, cough)');
  if (hasExtraPulmonary) gaps.push('Extra-pulmonary sarcoidosis should be rated separately under specific body system');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      dyspneaDays: dyspneaLogs.length,
      corticosteroidDays: corticosteroidLogs.length,
      hasSystemicSymptoms,
      hasCardiacInvolvement,
      hasExtraPulmonary,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};


// ============================================
// PHASE 1A: MULTIPLE SCLEROSIS ANALYSIS (DC 8018)
// ============================================

/**
 * Analyze Multiple Sclerosis symptom logs against VA rating criteria
 * DC 8018 - Minimum rating 30%, higher ratings based on specific residuals
 */
export const analyzeMultipleSclerosisLogs = (logs, options = {}) => {
  const conditionCriteria = MULTIPLE_SCLEROSIS_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.MULTIPLE_SCLEROSIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No multiple sclerosis symptoms logged in evaluation period',
    };
  }

  // Categorize symptoms by type for evidence building
  const fatigueLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-fatigue');
  const numbnessLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-numbness-tingling');
  const visionLogs = relevantLogs.filter(log =>
      ['ms-vision-problems', 'ms-double-vision'].includes(getLogSymptomId(log))
  );
  const weaknessLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-muscle-weakness');
  const spasticityLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-spasticity');
  const balanceLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-balance-problems');
  const cognitiveLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-cognitive-fog');
  const bladderLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-bladder-dysfunction');
  const bowelLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-bowel-dysfunction');
  const relapseLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-relapse');
  const walkingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-walking-difficulty');
  const painLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-pain');
  const heatSensitivityLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'ms-heat-sensitivity');

  // Build evidence summary
  const evidence = [];
  evidence.push(`${relevantLogs.length} MS symptom logs in ${evaluationPeriodDays} days`);

  if (fatigueLogs.length > 0) evidence.push(`Fatigue: ${fatigueLogs.length} days`);
  if (numbnessLogs.length > 0) evidence.push(`Numbness/tingling: ${numbnessLogs.length} occurrences`);
  if (visionLogs.length > 0) evidence.push(`Vision problems: ${visionLogs.length} occurrences`);
  if (weaknessLogs.length > 0) evidence.push(`Muscle weakness: ${weaknessLogs.length} occurrences`);
  if (spasticityLogs.length > 0) evidence.push(`Spasticity: ${spasticityLogs.length} occurrences`);
  if (balanceLogs.length > 0) evidence.push(`Balance problems: ${balanceLogs.length} occurrences`);
  if (cognitiveLogs.length > 0) evidence.push(`Cognitive issues: ${cognitiveLogs.length} occurrences`);
  if (bladderLogs.length > 0) evidence.push(`Bladder dysfunction: ${bladderLogs.length} occurrences`);
  if (bowelLogs.length > 0) evidence.push(`Bowel dysfunction: ${bowelLogs.length} occurrences`);
  if (relapseLogs.length > 0) evidence.push(`Relapses: ${relapseLogs.length} documented`);
  if (walkingLogs.length > 0) evidence.push(`Walking difficulty: ${walkingLogs.length} occurrences`);

  // MS has minimum 30% rating when residuals present
  let supportedRating = 30;
  let ratingRationale = [
    'Minimum 30% rating supported - ascertainable MS residuals documented',
  ];

  // Identify which residuals may warrant additional separate ratings
  const additionalRatingPotential = [];

  if (visionLogs.length > 5) {
    additionalRatingPotential.push('Vision impairment may warrant separate rating under eye codes');
  }
  if (bladderLogs.length > 5) {
    additionalRatingPotential.push('Bladder dysfunction may warrant separate rating under DC 7542');
  }
  if (bowelLogs.length > 5) {
    additionalRatingPotential.push('Bowel dysfunction may warrant separate rating under DC 7332');
  }
  if (weaknessLogs.length > 10 || walkingLogs.length > 10) {
    additionalRatingPotential.push('Extremity weakness may warrant separate rating under peripheral nerve codes');
  }
  if (cognitiveLogs.length > 10) {
    additionalRatingPotential.push('Cognitive impairment should be evaluated for potential separate rating');
  }

  // Evidence gaps
  const gaps = [];
  if (relapseLogs.length === 0) {
    gaps.push('Document any relapses/exacerbations with dates and duration');
  }
  if (relevantLogs.length < 10) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  if (bladderLogs.length === 0 && bowelLogs.length === 0) {
    gaps.push('Document any bladder or bowel dysfunction if present');
  }
  if (visionLogs.length === 0) {
    gaps.push('Document any vision problems if present (may warrant separate rating)');
  }

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    additionalRatingPotential,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      fatigueDays: fatigueLogs.length,
      numbnessOccurrences: numbnessLogs.length,
      visionOccurrences: visionLogs.length,
      weaknessOccurrences: weaknessLogs.length,
      spasticityOccurrences: spasticityLogs.length,
      balanceOccurrences: balanceLogs.length,
      cognitiveOccurrences: cognitiveLogs.length,
      bladderOccurrences: bladderLogs.length,
      bowelOccurrences: bowelLogs.length,
      relapseCount: relapseLogs.length,
      walkingOccurrences: walkingLogs.length,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

// ============================================
// PHASE 1A: PARKINSON'S DISEASE ANALYSIS (DC 8004)
// ============================================

/**
 * Analyze Parkinson's Disease symptom logs against VA rating criteria
 * DC 8004 - Minimum rating 30%, higher ratings based on specific residuals
 */
export const analyzeParkinsonsDiseaseLogs = (logs, options = {}) => {
  const conditionCriteria = PARKINSONS_DISEASE_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.PARKINSONS_DISEASE.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: "No Parkinson's disease symptoms logged in evaluation period",
    };
  }

  // Categorize motor symptoms (cardinal features)
  const tremorLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-resting-tremor');
  const rigidityLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-rigidity');
  const bradykinesiaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-bradykinesia');
  const posturalLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-postural-instability');
  const freezingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-freezing-gait');
  const shufflingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-shuffling-walk');
  const fallsLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-falls');

  // Categorize non-motor symptoms
  const sleepLogs = relevantLogs.filter(log =>
      ['pd-sleep-disturbance', 'pd-rem-sleep-disorder'].includes(getLogSymptomId(log))
  );
  const depressionLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-depression');
  const anxietyLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-anxiety');
  const cognitiveLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-cognitive-changes');
  const swallowingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-swallowing-difficulty');
  const speechLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-soft-speech');
  const constipationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-constipation');
  const urinaryLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-urinary-problems');

  // Medication-related
  const offEpisodeLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-off-episodes');
  const dyskinesiaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'pd-dyskinesia');

  // Build evidence summary
  const evidence = [];
  evidence.push(`${relevantLogs.length} PD symptom logs in ${evaluationPeriodDays} days`);

  // Motor symptoms
  if (tremorLogs.length > 0) evidence.push(`Resting tremor: ${tremorLogs.length} occurrences`);
  if (rigidityLogs.length > 0) evidence.push(`Rigidity: ${rigidityLogs.length} occurrences`);
  if (bradykinesiaLogs.length > 0) evidence.push(`Bradykinesia: ${bradykinesiaLogs.length} occurrences`);
  if (posturalLogs.length > 0) evidence.push(`Postural instability: ${posturalLogs.length} occurrences`);
  if (freezingLogs.length > 0) evidence.push(`Freezing of gait: ${freezingLogs.length} episodes`);
  if (fallsLogs.length > 0) evidence.push(`Falls: ${fallsLogs.length} documented`);

  // Non-motor symptoms
  if (sleepLogs.length > 0) evidence.push(`Sleep disturbances: ${sleepLogs.length} occurrences`);
  if (depressionLogs.length > 0) evidence.push(`Depression symptoms: ${depressionLogs.length} occurrences`);
  if (cognitiveLogs.length > 0) evidence.push(`Cognitive changes: ${cognitiveLogs.length} occurrences`);
  if (swallowingLogs.length > 0) evidence.push(`Swallowing difficulty: ${swallowingLogs.length} occurrences`);

  // Medication effects
  if (offEpisodeLogs.length > 0) evidence.push(`OFF episodes: ${offEpisodeLogs.length} documented`);
  if (dyskinesiaLogs.length > 0) evidence.push(`Dyskinesia: ${dyskinesiaLogs.length} occurrences`);

  // PD has minimum 30% rating when residuals present
  let supportedRating = 30;
  let ratingRationale = [
    "Minimum 30% rating supported - ascertainable Parkinson's residuals documented",
  ];

  // Count cardinal motor symptoms present
  const cardinalSymptomsPresent = [
    tremorLogs.length > 0,
    rigidityLogs.length > 0,
    bradykinesiaLogs.length > 0,
    posturalLogs.length > 0,
  ].filter(Boolean).length;

  if (cardinalSymptomsPresent >= 3) {
    ratingRationale.push(`${cardinalSymptomsPresent} of 4 cardinal motor symptoms documented`);
  }

  // Identify which residuals may warrant additional separate ratings
  const additionalRatingPotential = [];

  if (depressionLogs.length > 5 || anxietyLogs.length > 5) {
    additionalRatingPotential.push('Depression/anxiety may warrant separate rating under mental health codes');
  }
  if (cognitiveLogs.length > 10) {
    additionalRatingPotential.push('Cognitive impairment should be evaluated for dementia rating if severe');
  }
  if (swallowingLogs.length > 5) {
    additionalRatingPotential.push('Dysphagia may warrant evaluation under digestive system codes');
  }
  if (urinaryLogs.length > 5) {
    additionalRatingPotential.push('Urinary dysfunction may warrant separate rating under voiding dysfunction');
  }
  if (tremorLogs.length > 15 || rigidityLogs.length > 15) {
    additionalRatingPotential.push('Severe motor symptoms may warrant evaluation of extremity functional impairment');
  }

  // Evidence gaps
  const gaps = [];
  if (tremorLogs.length === 0 && rigidityLogs.length === 0 && bradykinesiaLogs.length === 0) {
    gaps.push('Document cardinal motor symptoms (tremor, rigidity, bradykinesia)');
  }
  if (relevantLogs.length < 10) {
    gaps.push('Continue logging symptoms regularly to establish pattern and progression');
  }
  if (fallsLogs.length === 0 && posturalLogs.length > 0) {
    gaps.push('Document any falls if occurring - important for safety assessment');
  }
  if (offEpisodeLogs.length === 0) {
    gaps.push('Document medication wearing-off or OFF episodes if occurring');
  }

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    additionalRatingPotential,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      tremorOccurrences: tremorLogs.length,
      rigidityOccurrences: rigidityLogs.length,
      bradykinesiaOccurrences: bradykinesiaLogs.length,
      posturalOccurrences: posturalLogs.length,
      freezingEpisodes: freezingLogs.length,
      fallCount: fallsLogs.length,
      sleepOccurrences: sleepLogs.length,
      depressionOccurrences: depressionLogs.length,
      cognitiveOccurrences: cognitiveLogs.length,
      offEpisodes: offEpisodeLogs.length,
      dyskinesiaOccurrences: dyskinesiaLogs.length,
      cardinalSymptomsPresent,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

// ============================================
// PHASE 1A: MYASTHENIA GRAVIS ANALYSIS (DC 8025)
// ============================================

/**
 * Analyze Myasthenia Gravis symptom logs against VA rating criteria
 * DC 8025 - Minimum rating 30%, higher ratings based on muscle group involvement
 */
export const analyzeMyastheniaGravisLogs = (logs, options = {}) => {
  const conditionCriteria = MYASTHENIA_GRAVIS_CRITERIA;
  const evaluationPeriodDays = options.days || 90;
  const symptomIds = CONDITIONS.MYASTHENIA_GRAVIS.symptomIds;

  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    const symptomId = getLogSymptomId(log);
    return logDate >= cutoffDate && symptomId && symptomIds.includes(symptomId);
  });

  if (relevantLogs.length === 0) {
    return {
      hasData: false,
      condition: conditionCriteria.condition,
      diagnosticCode: conditionCriteria.diagnosticCode,
      message: 'No myasthenia gravis symptoms logged in evaluation period',
    };
  }

  // Categorize by muscle group involvement
  // Ocular symptoms
  const ptosisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-ptosis');
  const diplopiaLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-diplopia');

  // Bulbar symptoms
  const facialLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-facial-weakness');
  const chewingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-difficulty-chewing');
  const swallowingLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-difficulty-swallowing');
  const speechLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-slurred-speech');
  const voiceLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-voice-fatigue');

  // Limb/axial symptoms
  const limbLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-limb-weakness');
  const neckLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-neck-weakness');
  const armLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-arm-elevation-difficulty');

  // Respiratory
  const respiratoryLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-respiratory-weakness');

  // Crisis/hospitalization
  const crisisLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-crisis');
  const hospitalizationLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-hospitalization');

  // Characteristic features
  const fatigueActivityLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-fatigue-activity');
  const improvementRestLogs = relevantLogs.filter(log => getLogSymptomId(log) === 'mg-improvement-rest');

  // Determine involvement pattern
  const hasOcularOnly = (ptosisLogs.length > 0 || diplopiaLogs.length > 0) &&
      limbLogs.length === 0 && respiratoryLogs.length === 0 &&
      chewingLogs.length === 0 && swallowingLogs.length === 0;

  const hasBulbarInvolvement = chewingLogs.length > 0 || swallowingLogs.length > 0 ||
      speechLogs.length > 0 || facialLogs.length > 0;

  const hasGeneralizedWeakness = limbLogs.length > 0 || neckLogs.length > 0 || armLogs.length > 0;

  const hasRespiratoryInvolvement = respiratoryLogs.length > 0;

  const hasCrisis = crisisLogs.length > 0;

  // Build evidence summary
  const evidence = [];
  evidence.push(`${relevantLogs.length} MG symptom logs in ${evaluationPeriodDays} days`);

  // Ocular
  if (ptosisLogs.length > 0) evidence.push(`Ptosis: ${ptosisLogs.length} occurrences`);
  if (diplopiaLogs.length > 0) evidence.push(`Diplopia: ${diplopiaLogs.length} occurrences`);

  // Bulbar
  if (chewingLogs.length > 0) evidence.push(`Difficulty chewing: ${chewingLogs.length} occurrences`);
  if (swallowingLogs.length > 0) evidence.push(`Difficulty swallowing: ${swallowingLogs.length} occurrences`);
  if (speechLogs.length > 0) evidence.push(`Slurred speech: ${speechLogs.length} occurrences`);

  // Limb/axial
  if (limbLogs.length > 0) evidence.push(`Limb weakness: ${limbLogs.length} occurrences`);
  if (neckLogs.length > 0) evidence.push(`Neck weakness: ${neckLogs.length} occurrences`);

  // Respiratory
  if (respiratoryLogs.length > 0) evidence.push(`Respiratory weakness: ${respiratoryLogs.length} occurrences`);

  // Crisis
  if (crisisLogs.length > 0) evidence.push(`Myasthenic crisis: ${crisisLogs.length} episodes`);
  if (hospitalizationLogs.length > 0) evidence.push(`Hospitalizations: ${hospitalizationLogs.length}`);

  // Characteristic pattern
  if (fatigueActivityLogs.length > 0) evidence.push(`Fatigue with activity documented: ${fatigueActivityLogs.length} times`);
  if (improvementRestLogs.length > 0) evidence.push(`Improvement with rest documented: ${improvementRestLogs.length} times`);

  // MG has minimum 30% rating when residuals present
  let supportedRating = 30;
  let ratingRationale = [
    'Minimum 30% rating supported - ascertainable MG residuals documented',
  ];

  // Note severity based on involvement pattern
  if (hasCrisis) {
    supportedRating = 100;
    ratingRationale = [
      'Myasthenic crisis documented - 100% rating during crisis/recovery period',
      'Rate residuals after stabilization',
    ];
  } else if (hasRespiratoryInvolvement) {
    ratingRationale.push('Respiratory involvement present - may warrant higher rating');
    ratingRationale.push('PFT (FVC) testing recommended to document respiratory impairment');
  } else if (hasBulbarInvolvement && hasGeneralizedWeakness) {
    ratingRationale.push('Generalized MG with bulbar involvement documented');
  } else if (hasOcularOnly) {
    ratingRationale.push('Ocular MG pattern - symptoms limited to eye muscles');
  }

  // Identify additional rating potential
  const additionalRatingPotential = [];

  if (ptosisLogs.length > 5 || diplopiaLogs.length > 5) {
    additionalRatingPotential.push('Visual impairment from ptosis/diplopia may warrant separate eye rating');
  }
  if (swallowingLogs.length > 5) {
    additionalRatingPotential.push('Dysphagia may warrant evaluation under digestive codes if affecting nutrition');
  }
  if (respiratoryLogs.length > 0) {
    additionalRatingPotential.push('Respiratory weakness should be evaluated with PFT for potential respiratory rating');
  }
  if (limbLogs.length > 10) {
    additionalRatingPotential.push('Limb weakness may warrant evaluation under peripheral nerve codes');
  }

  // Evidence gaps
  const gaps = [];
  if (fatigueActivityLogs.length === 0 && improvementRestLogs.length === 0) {
    gaps.push('Document characteristic fatigable weakness pattern (worse with activity, better with rest)');
  }
  if (relevantLogs.length < 10) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  if (respiratoryLogs.length > 0) {
    gaps.push('Get pulmonary function testing (FVC) to document respiratory involvement');
  }
  if (crisisLogs.length === 0 && (respiratoryLogs.length > 0 || swallowingLogs.length > 5)) {
    gaps.push('Be aware of crisis warning signs - seek emergency care if breathing/swallowing severely affected');
  }

  // Determine MGFA class approximation based on logged symptoms
  let mgfaClassEstimate = 'I';
  if (hasCrisis) {
    mgfaClassEstimate = 'V';
  } else if (hasRespiratoryInvolvement || (hasBulbarInvolvement && hasGeneralizedWeakness && (swallowingLogs.length > 10 || respiratoryLogs.length > 5))) {
    mgfaClassEstimate = 'IV';
  } else if (hasBulbarInvolvement && hasGeneralizedWeakness) {
    mgfaClassEstimate = 'III';
  } else if (hasGeneralizedWeakness || hasBulbarInvolvement) {
    mgfaClassEstimate = 'II';
  }

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    evaluationPeriodDays,
    supportedRating: supportedRating.toString(),
    ratingRationale,
    additionalRatingPotential,
    evidence,
    gaps,
    mgfaClassEstimate,
    metrics: {
      totalLogs: relevantLogs.length,
      ptosisOccurrences: ptosisLogs.length,
      diplopiaOccurrences: diplopiaLogs.length,
      chewingOccurrences: chewingLogs.length,
      swallowingOccurrences: swallowingLogs.length,
      speechOccurrences: speechLogs.length,
      limbOccurrences: limbLogs.length,
      neckOccurrences: neckLogs.length,
      respiratoryOccurrences: respiratoryLogs.length,
      crisisCount: crisisLogs.length,
      hospitalizationCount: hospitalizationLogs.length,
      hasOcularOnly,
      hasBulbarInvolvement,
      hasGeneralizedWeakness,
      hasRespiratoryInvolvement,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};


// ============================================
// PHASE 1B: ADDITIONAL NEUROLOGICAL - ANALYSIS
// ============================================

/**
 * Analyze Narcolepsy symptoms (DC 8108)
 * Rated on frequency of sleep attacks, cataplexy, and functional impairment
 */
export const analyzeNarcolepsyLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 90;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const conditionCriteria = NARCOLEPSY_CRITERIA;

  // Filter relevant logs
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    if (logDate < cutoffDate) return false;
    const symptomId = (log.symptomId || log.symptom || '').toLowerCase();
    const category = (log.category || '').toLowerCase();
    return symptomId.startsWith('narco-') || category.includes('narcolepsy');
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: conditionCriteria.condition };
  }

  // Count specific symptom types
  const sleepAttacks = relevantLogs.filter(l =>
      (l.symptomId || '').includes('sleep-attack') || (l.symptomId || '').includes('microsleep')
  ).length;

  const cataplexyEpisodes = relevantLogs.filter(l =>
      (l.symptomId || '').includes('cataplexy')
  ).length;

  const sleepParalysis = relevantLogs.filter(l =>
      (l.symptomId || '').includes('sleep-paralysis')
  ).length;

  const hallucinations = relevantLogs.filter(l =>
      (l.symptomId || '').includes('hallucination')
  ).length;

  const excessiveSleepiness = relevantLogs.filter(l =>
      (l.symptomId || '').includes('excessive-sleepiness')
  ).length;

  const automaticBehavior = relevantLogs.filter(l =>
      (l.symptomId || '').includes('automatic-behavior')
  ).length;

  // Calculate frequencies
  const weeksInPeriod = evaluationPeriodDays / 7;
  const sleepAttacksPerWeek = sleepAttacks / weeksInPeriod;
  const cataplexyPerWeek = cataplexyEpisodes / weeksInPeriod;

  // Check for narcolepsy-specific data
  const hasCataplexy = cataplexyEpisodes > 0;
  const hasType1Features = hasCataplexy; // Type 1 narcolepsy has cataplexy

  // Determine rating
  let supportedRating = 0;
  let ratingRationale = [];
  const evidence = [];
  const gaps = [];

  // 80%: Severe - daily sleep attacks, frequent cataplexy
  if (sleepAttacksPerWeek >= 7 && cataplexyPerWeek >= 3) {
    supportedRating = 80;
    ratingRationale = [
      'Daily or near-daily sleep attacks documented',
      'Frequent cataplexy episodes',
      'Severe functional impairment indicated',
    ];
  }
  // 60%: Moderately severe - multiple weekly attacks, cataplexy present
  else if (sleepAttacksPerWeek >= 3 && hasCataplexy) {
    supportedRating = 60;
    ratingRationale = [
      'Multiple sleep attacks per week',
      'Cataplexy episodes present',
      'Significant functional impairment',
    ];
  }
  // 40%: Moderate - weekly attacks, mild cataplexy
  else if (sleepAttacksPerWeek >= 1 || (hasCataplexy && cataplexyPerWeek >= 0.5)) {
    supportedRating = 40;
    ratingRationale = [
      'Weekly sleep attacks or cataplexy episodes',
      'Moderate functional impact',
    ];
  }
  // 20%: Mild - occasional attacks
  else if (sleepAttacks >= 2 || hasCataplexy) {
    supportedRating = 20;
    ratingRationale = [
      'Occasional sleep attacks or cataplexy documented',
      'Mild functional impact',
    ];
  }
  // 10%: Minimal symptoms
  else if (relevantLogs.length >= 3) {
    supportedRating = 10;
    ratingRationale = [
      'Narcolepsy symptoms present',
      'Minimal functional impairment documented',
    ];
  }

  // Build evidence
  if (sleepAttacks > 0) evidence.push(`${sleepAttacks} sleep attacks logged (${sleepAttacksPerWeek.toFixed(1)}/week)`);
  if (hasCataplexy) evidence.push(`${cataplexyEpisodes} cataplexy episodes (Type 1 narcolepsy)`);
  if (sleepParalysis > 0) evidence.push(`${sleepParalysis} sleep paralysis episodes`);
  if (hallucinations > 0) evidence.push(`${hallucinations} hypnagogic/hypnopompic hallucinations`);
  if (automaticBehavior > 0) evidence.push(`${automaticBehavior} automatic behavior episodes`);

  // Identify gaps
  if (sleepAttacks < 5) gaps.push('Continue logging sleep attacks to establish frequency pattern');
  if (!hasCataplexy) gaps.push('Document cataplexy episodes if present (indicates Type 1 narcolepsy)');
  if (relevantLogs.length < 10) gaps.push('More symptom logs strengthen claim documentation');
  gaps.push('Obtain sleep study (MSLT) showing sleep latency <8 min and 2+ SOREMPs');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    cfrReference: conditionCriteria.cfrReference,
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      sleepAttacks,
      sleepAttacksPerWeek: parseFloat(sleepAttacksPerWeek.toFixed(1)),
      cataplexyEpisodes,
      hasCataplexy,
      hasType1Features,
      sleepParalysis,
      hallucinations,
      automaticBehavior,
      excessiveSleepiness,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

/**
 * Analyze ALS symptoms (DC 8017)
 * Progressive motor neuron disease - rated on extent of weakness and bulbar/respiratory involvement
 */
export const analyzeALSLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 90;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const conditionCriteria = ALS_CRITERIA;

  // Filter relevant logs
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    if (logDate < cutoffDate) return false;
    const symptomId = (log.symptomId || log.symptom || '').toLowerCase();
    const category = (log.category || '').toLowerCase();
    return symptomId.startsWith('als-') || category.includes('als') || category.includes('amyotrophic');
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: conditionCriteria.condition };
  }

  // Count specific symptom types
  const weaknessLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('weakness') || (l.symptomId || '').includes('atrophy')
  ).length;

  const fasciculationLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('fasciculation')
  ).length;

  const bulbarLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('speaking') || (l.symptomId || '').includes('swallowing') || (l.symptomId || '').includes('drooling')
  ).length;

  const respiratoryLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('respiratory')
  ).length;

  const mobilityLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('foot-drop') || (l.symptomId || '').includes('tripping')
  ).length;

  const spasticityLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('spasticity') || (l.symptomId || '').includes('cramp')
  ).length;

  const emotionalLability = relevantLogs.filter(l =>
      (l.symptomId || '').includes('emotional-lability')
  ).length;

  // Determine severity indicators
  const hasBulbarInvolvement = bulbarLogs >= 2;
  const hasRespiratoryInvolvement = respiratoryLogs >= 1;
  const hasSignificantWeakness = weaknessLogs >= 5;
  const hasMobilityIssues = mobilityLogs >= 2;

  // Calculate average severity
  const avgSeverity = relevantLogs.length > 0
      ? relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / relevantLogs.length
      : 0;

  // Determine rating - ALS is progressive, minimum 30%
  let supportedRating = 30; // Minimum for confirmed ALS
  let ratingRationale = [];
  const evidence = [];
  const gaps = [];

  // 100%: Total disability
  if (hasRespiratoryInvolvement && hasBulbarInvolvement && avgSeverity >= 8) {
    supportedRating = 100;
    ratingRationale = [
      'Respiratory involvement documented',
      'Severe bulbar symptoms (speech/swallowing)',
      'High symptom severity indicates advanced disease',
    ];
  }
  // 80%: Severe
  else if ((hasRespiratoryInvolvement || hasBulbarInvolvement) && hasSignificantWeakness) {
    supportedRating = 80;
    ratingRationale = [
      hasBulbarInvolvement ? 'Bulbar involvement present' : 'Respiratory symptoms present',
      'Significant weakness documented',
      'Multiple body regions affected',
    ];
  }
  // 60%: Moderately severe
  else if (hasSignificantWeakness && (hasBulbarInvolvement || hasMobilityIssues)) {
    supportedRating = 60;
    ratingRationale = [
      'Progressive weakness in multiple regions',
      hasBulbarInvolvement ? 'Early bulbar involvement' : 'Mobility significantly affected',
    ];
  }
  // 40%: Moderate
  else if (weaknessLogs >= 3 || hasMobilityIssues) {
    supportedRating = 40;
    ratingRationale = [
      'Definite weakness affecting function',
      'Motor symptoms documented',
    ];
  }
  // 30%: Minimum - confirmed ALS
  else {
    ratingRationale = [
      'ALS diagnosis with early motor symptoms',
      'Minimum 30% rating for confirmed ALS',
    ];
  }

  // Build evidence
  evidence.push(`${relevantLogs.length} ALS-related symptoms logged`);
  if (weaknessLogs > 0) evidence.push(`${weaknessLogs} weakness/atrophy episodes`);
  if (fasciculationLogs > 0) evidence.push(`${fasciculationLogs} fasciculation episodes`);
  if (bulbarLogs > 0) evidence.push(`${bulbarLogs} bulbar symptoms (speech/swallowing)`);
  if (respiratoryLogs > 0) evidence.push(`${respiratoryLogs} respiratory difficulty episodes`);
  evidence.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Identify gaps
  if (!hasRespiratoryInvolvement) gaps.push('Document respiratory symptoms if present - key rating factor');
  if (!hasBulbarInvolvement) gaps.push('Log speech/swallowing difficulties if occurring');
  gaps.push('Obtain pulmonary function tests (FVC) for respiratory status');
  gaps.push('EMG/nerve conduction studies document disease progression');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    cfrReference: conditionCriteria.cfrReference,
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
      weaknessLogs,
      fasciculationLogs,
      bulbarLogs,
      respiratoryLogs,
      mobilityLogs,
      spasticityLogs,
      emotionalLability,
      hasBulbarInvolvement,
      hasRespiratoryInvolvement,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

/**
 * Analyze Syringomyelia symptoms (DC 8024)
 * Rated on sensory loss, motor weakness, and functional impairment
 */
export const analyzeSyringomyeliaLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 90;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const conditionCriteria = SYRINGOMYELIA_CRITERIA;

  // Filter relevant logs
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    if (logDate < cutoffDate) return false;
    const symptomId = (log.symptomId || log.symptom || '').toLowerCase();
    const category = (log.category || '').toLowerCase();
    return symptomId.startsWith('syring-') || category.includes('syringomyelia');
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: conditionCriteria.condition };
  }

  // Count specific symptom types
  const painLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('pain')
  ).length;

  const weaknessLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('weakness') || (l.symptomId || '').includes('muscle-wasting')
  ).length;

  const sensoryLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('sensory') || (l.symptomId || '').includes('numbness') ||
      (l.symptomId || '').includes('tingling') || (l.symptomId || '').includes('insensitivity')
  ).length;

  const tempInsensitivity = relevantLogs.filter(l =>
      (l.symptomId || '').includes('temp-insensitivity')
  ).length;

  const painInsensitivity = relevantLogs.filter(l =>
      (l.symptomId || '').includes('pain-insensitivity')
  ).length;

  const bowelBladderLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('bowel-bladder')
  ).length;

  // Determine severity indicators
  const hasDissociatedSensoryLoss = tempInsensitivity > 0 || painInsensitivity > 0;
  const hasSignificantSensoryLoss = sensoryLogs >= 5;
  const hasWeakness = weaknessLogs >= 2;
  const hasAutonomicInvolvement = bowelBladderLogs > 0;

  // Calculate average severity
  const avgSeverity = relevantLogs.length > 0
      ? relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / relevantLogs.length
      : 0;

  // Determine rating
  let supportedRating = 0;
  let ratingRationale = [];
  const evidence = [];
  const gaps = [];

  // 100%: Severe - profound deficits
  if (avgSeverity >= 8 && hasSignificantSensoryLoss && hasWeakness && hasAutonomicInvolvement) {
    supportedRating = 100;
    ratingRationale = [
      'Profound sensory and motor deficits',
      'Bowel/bladder involvement',
      'Severe functional impairment',
    ];
  }
  // 80%: Marked deficits
  else if (avgSeverity >= 7 && hasSignificantSensoryLoss && hasWeakness) {
    supportedRating = 80;
    ratingRationale = [
      'Marked sensory loss documented',
      'Significant weakness present',
      'Major functional impairment',
    ];
  }
  // 60%: Moderate deficits
  else if ((hasSignificantSensoryLoss || hasWeakness) && avgSeverity >= 5) {
    supportedRating = 60;
    ratingRationale = [
      'Moderate sensory or motor deficits',
      'Functional limitations present',
    ];
  }
  // 40%: Definite symptoms
  else if (hasDissociatedSensoryLoss || (sensoryLogs >= 3 && weaknessLogs >= 1)) {
    supportedRating = 40;
    ratingRationale = [
      hasDissociatedSensoryLoss ? 'Characteristic dissociated sensory loss' : 'Definite sensory changes',
      'Mild to moderate functional impairment',
    ];
  }
  // 20%: Mild symptoms
  else if (relevantLogs.length >= 3) {
    supportedRating = 20;
    ratingRationale = [
      'Syringomyelia symptoms present',
      'Mild functional impact',
    ];
  }

  // Build evidence
  evidence.push(`${relevantLogs.length} syringomyelia symptoms logged`);
  if (sensoryLogs > 0) evidence.push(`${sensoryLogs} sensory symptom episodes`);
  if (hasDissociatedSensoryLoss) evidence.push('Dissociated sensory loss (temp/pain insensitivity) - characteristic finding');
  if (weaknessLogs > 0) evidence.push(`${weaknessLogs} weakness/atrophy episodes`);
  if (painLogs > 0) evidence.push(`${painLogs} pain episodes`);
  evidence.push(`Average severity: ${avgSeverity.toFixed(1)}/10`);

  // Identify gaps
  if (!hasDissociatedSensoryLoss) gaps.push('Document temperature/pain insensitivity if present - characteristic of syringomyelia');
  if (sensoryLogs < 5) gaps.push('Continue logging sensory symptoms to establish pattern');
  gaps.push('MRI showing syrinx size and location strengthens claim');
  if (hasAutonomicInvolvement) gaps.push('Bladder/bowel dysfunction may warrant separate rating');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    cfrReference: conditionCriteria.cfrReference,
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
      painLogs,
      weaknessLogs,
      sensoryLogs,
      tempInsensitivity,
      painInsensitivity,
      bowelBladderLogs,
      hasDissociatedSensoryLoss,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

/**
 * Analyze Myelitis symptoms (DC 8010)
 * Rated on motor/sensory deficits, bladder/bowel involvement, and functional impairment
 */
export const analyzeMyelitisLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 90;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const conditionCriteria = MYELITIS_CRITERIA;

  // Filter relevant logs
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp);
    if (logDate < cutoffDate) return false;
    const symptomId = (log.symptomId || log.symptom || '').toLowerCase();
    const category = (log.category || '').toLowerCase();
    return symptomId.startsWith('myel-') || category.includes('myelitis');
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: conditionCriteria.condition };
  }

  // Count specific symptom types
  const weaknessLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('weakness') || (l.symptomId || '').includes('paralysis')
  ).length;

  const sensoryLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('sensory') || (l.symptomId || '').includes('numbness') ||
      (l.symptomId || '').includes('tingling') || (l.symptomId || '').includes('band-sensation')
  ).length;

  const bladderLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('bladder')
  ).length;

  const bowelLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('bowel')
  ).length;

  const painLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('pain')
  ).length;

  const spasticityLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('spasticity')
  ).length;

  const paralysisLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('paralysis')
  ).length;

  const sexualDysfunctionLogs = relevantLogs.filter(l =>
      (l.symptomId || '').includes('sexual-dysfunction')
  ).length;

  // Determine severity indicators
  const hasParalysis = paralysisLogs > 0;
  const hasBladderInvolvement = bladderLogs >= 2;
  const hasBowelInvolvement = bowelLogs >= 2;
  const hasSignificantWeakness = weaknessLogs >= 5;
  const hasAutonomicInvolvement = hasBladderInvolvement || hasBowelInvolvement;

  // Calculate average severity
  const avgSeverity = relevantLogs.length > 0
      ? relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / relevantLogs.length
      : 0;

  // Determine rating
  let supportedRating = 0;
  let ratingRationale = [];
  const evidence = [];
  const gaps = [];

  // 100%: Complete/near-complete paralysis
  if (hasParalysis && avgSeverity >= 8 && hasAutonomicInvolvement) {
    supportedRating = 100;
    ratingRationale = [
      'Paralysis documented',
      'Complete or near-complete loss of function below lesion',
      'Bladder/bowel involvement present',
    ];
  }
  // 80%: Severe - marked weakness, significant autonomic
  else if (hasSignificantWeakness && hasAutonomicInvolvement && avgSeverity >= 7) {
    supportedRating = 80;
    ratingRationale = [
      'Marked weakness documented',
      'Significant bladder/bowel dysfunction',
      'Severe sensory impairment',
    ];
  }
  // 60%: Moderately severe
  else if ((hasSignificantWeakness || hasAutonomicInvolvement) && avgSeverity >= 5) {
    supportedRating = 60;
    ratingRationale = [
      hasSignificantWeakness ? 'Significant weakness affecting ambulation' : 'Autonomic dysfunction present',
      'Moderate functional impairment',
    ];
  }
  // 40%: Moderate
  else if (weaknessLogs >= 3 || (hasBladderInvolvement || hasBowelInvolvement)) {
    supportedRating = 40;
    ratingRationale = [
      'Definite weakness or bladder/bowel symptoms',
      'Ambulatory with difficulty',
    ];
  }
  // 20%: Mild residuals
  else if (relevantLogs.length >= 3) {
    supportedRating = 20;
    ratingRationale = [
      'Myelitis residuals present',
      'Mild functional impairment',
    ];
  }

  // Build evidence
  evidence.push(`${relevantLogs.length} myelitis symptoms logged`);
  if (weaknessLogs > 0) evidence.push(`${weaknessLogs} weakness episodes`);
  if (hasParalysis) evidence.push('Paralysis documented');
  if (sensoryLogs > 0) evidence.push(`${sensoryLogs} sensory symptom episodes`);
  if (bladderLogs > 0) evidence.push(`${bladderLogs} bladder dysfunction episodes`);
  if (bowelLogs > 0) evidence.push(`${bowelLogs} bowel dysfunction episodes`);
  if (spasticityLogs > 0) evidence.push(`${spasticityLogs} spasticity episodes`);
  evidence.push(`Average severity: ${avgSeverity.toFixed(1)}/10`);

  // Identify gaps
  if (!hasAutonomicInvolvement) gaps.push('Document bladder/bowel symptoms if present - may warrant separate ratings');
  if (weaknessLogs < 5) gaps.push('Continue logging weakness episodes to establish severity');
  gaps.push('MRI documenting spinal cord lesion location and extent');
  if (hasBladderInvolvement) gaps.push('Bladder dysfunction (DC 7542) may be rated separately');
  if (hasBowelInvolvement) gaps.push('Bowel dysfunction (DC 7332) may be rated separately');

  return {
    hasData: true,
    condition: conditionCriteria.condition,
    diagnosticCode: conditionCriteria.diagnosticCode,
    cfrReference: conditionCriteria.cfrReference,
    evaluationPeriodDays,
    supportedRating,
    ratingRationale,
    evidence,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity: parseFloat(avgSeverity.toFixed(1)),
      weaknessLogs,
      sensoryLogs,
      bladderLogs,
      bowelLogs,
      painLogs,
      spasticityLogs,
      paralysisLogs,
      sexualDysfunctionLogs,
      hasParalysis,
      hasAutonomicInvolvement,
    },
    criteria: conditionCriteria,
    disclaimer: conditionCriteria.disclaimer,
  };
};

// ============================================
// PHASE 1C: PERIPHERAL NERVE ANALYSIS FUNCTIONS
// 38 CFR 4.124a
// ============================================

/**
 * Helper function to determine severity level for peripheral nerve conditions
 * Based on symptom frequency, motor vs sensory involvement, and functional impact
 */
const determineNerveSeverity = (logs, motorSymptomIds, sensorySymptomIds, functionalSymptomIds = []) => {
  const motorLogs = logs.filter(log => motorSymptomIds.some(id =>
      getLogSymptomId(log).toLowerCase() === id.toLowerCase()
  ));
  const sensoryLogs = logs.filter(log => sensorySymptomIds.some(id =>
      getLogSymptomId(log).toLowerCase() === id.toLowerCase()
  ));
  const functionalLogs = logs.filter(log => functionalSymptomIds.some(id =>
      getLogSymptomId(log).toLowerCase() === id.toLowerCase()
  ));

  const hasMotorInvolvement = motorLogs.length > 0;
  const hasSensoryInvolvement = sensoryLogs.length > 0;
  const hasFunctionalImpact = functionalLogs.length > 0;

  // Calculate average severity from logs
  const allLogs = [...motorLogs, ...sensoryLogs, ...functionalLogs];
  const severityScores = allLogs
  .map(log => log.severity)
  .filter(s => s !== undefined && s !== null);
  const avgSeverity = severityScores.length > 0
      ? severityScores.reduce((a, b) => a + b, 0) / severityScores.length
      : 0;

  // Determine paralysis type based on involvement pattern
  // Per 38 CFR 4.124a: "When involvement is wholly sensory, rate as mild or at most moderate"
  const isWholySensory = hasSensoryInvolvement && !hasMotorInvolvement;

  let severityLevel = 'mild';
  if (isWholySensory) {
    // Sensory only - max is moderate per VA regulation
    severityLevel = avgSeverity >= 7 ? 'moderate' : 'mild';
  } else if (hasMotorInvolvement) {
    if (avgSeverity >= 9 || (motorLogs.length >= 10 && hasFunctionalImpact)) {
      severityLevel = 'complete';
    } else if (avgSeverity >= 7 || (motorLogs.length >= 5 && avgSeverity >= 6)) {
      severityLevel = 'severe';
    } else if (avgSeverity >= 5 || motorLogs.length >= 3) {
      severityLevel = 'moderate';
    } else {
      severityLevel = 'mild';
    }
  }

  return {
    severityLevel,
    hasMotorInvolvement,
    hasSensoryInvolvement,
    isWholySensory,
    hasFunctionalImpact,
    motorLogCount: motorLogs.length,
    sensoryLogCount: sensoryLogs.length,
    avgSeverity: avgSeverity.toFixed(1),
    totalLogs: allLogs.length,
  };
};

/**
 * Helper function to determine rating based on severity and extremity for upper extremity nerves
 */
const getUpperExtremityNerveRating = (severityLevel, isMajorExtremity, ratingScale) => {
  // ratingScale is an object like: { complete: {major: 70, minor: 60}, severe: {major: 50, minor: 40}, ... }
  const scale = ratingScale[severityLevel];
  if (!scale) return ratingScale.mild?.major || ratingScale.mild?.both || 0;

  if (scale.both !== undefined) return scale.both;
  return isMajorExtremity ? scale.major : scale.minor;
};

/**
 * Analyze Upper Radicular Group (C5-C6) - DC 8510/8610/8710
 */
export const analyzeUpperRadicularGroupLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.UPPER_RADICULAR_GROUP.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['uprn-shoulder-weakness', 'uprn-elbow-weakness', 'uprn-shoulder-movement-loss', 'uprn-elbow-movement-loss', 'uprn-muscle-atrophy'];
  const sensorySymptoms = ['uprn-numbness', 'uprn-tingling', 'uprn-pain'];
  const functionalSymptoms = ['uprn-reflex-loss'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, functionalSymptoms);

  const ratingScale = {
    complete: { major: 70, minor: 60 },
    severe: { major: 50, minor: 40 },
    moderate: { major: 40, minor: 30 },
    mild: { both: 20 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} upper radicular group symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (weakness, movement loss) if present for higher rating');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis and severity');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
    },
    condition: 'Upper Radicular Group (C5-C6)',
    diagnosticCodes: { paralysis: '8510', neuritis: '8610', neuralgia: '8710' },
  };
};

/**
 * Analyze Middle Radicular Group (C7) - DC 8511/8611/8711
 */
export const analyzeMiddleRadicularGroupLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.MIDDLE_RADICULAR_GROUP.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['mdrn-arm-weakness', 'mdrn-wrist-extension-weakness', 'mdrn-elbow-extension-weakness', 'mdrn-finger-extension-weakness', 'mdrn-muscle-atrophy'];
  const sensorySymptoms = ['mdrn-numbness', 'mdrn-tingling', 'mdrn-pain'];
  const functionalSymptoms = ['mdrn-reflex-loss'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, functionalSymptoms);

  const ratingScale = {
    complete: { major: 70, minor: 60 },
    severe: { major: 50, minor: 40 },
    moderate: { major: 40, minor: 30 },
    mild: { both: 20 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} middle radicular group symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (wrist/elbow/finger extension weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis and severity');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
    },
    condition: 'Middle Radicular Group (C7)',
    diagnosticCodes: { paralysis: '8511', neuritis: '8611', neuralgia: '8711' },
  };
};

/**
 * Analyze Lower Radicular Group (C8-T1) - DC 8512/8612/8712
 */
export const analyzeLowerRadicularGroupLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.LOWER_RADICULAR_GROUP.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['lwrn-hand-weakness', 'lwrn-grip-weakness', 'lwrn-finger-flexion-weakness', 'lwrn-intrinsic-muscle-weakness', 'lwrn-muscle-atrophy'];
  const sensorySymptoms = ['lwrn-numbness', 'lwrn-tingling', 'lwrn-pain'];
  const functionalSymptoms = ['lwrn-clumsiness'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, functionalSymptoms);

  const ratingScale = {
    complete: { major: 70, minor: 60 },
    severe: { major: 50, minor: 40 },
    moderate: { major: 40, minor: 30 },
    mild: { both: 20 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} lower radicular group symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (hand/grip weakness, intrinsic muscle weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis and severity');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
    },
    condition: 'Lower Radicular Group (C8-T1)',
    diagnosticCodes: { paralysis: '8512', neuritis: '8612', neuralgia: '8712' },
  };
};

/**
 * Analyze All Radicular Groups (Brachial Plexus) - DC 8513/8613/8713
 */
export const analyzeAllRadicularGroupsLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.ALL_RADICULAR_GROUPS.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['alrn-complete-arm-paralysis', 'alrn-arm-weakness', 'alrn-shoulder-weakness', 'alrn-elbow-weakness', 'alrn-wrist-weakness', 'alrn-hand-weakness', 'alrn-muscle-atrophy'];
  const sensorySymptoms = ['alrn-numbness', 'alrn-tingling', 'alrn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // All radicular groups has different rating scale - higher ratings
  const ratingScale = {
    complete: { major: 90, minor: 80 },
    severe: { major: 70, minor: 60 },
    moderate: { major: 40, minor: 30 },
    mild: { both: 20 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} brachial plexus symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits at all levels (shoulder, elbow, wrist, hand) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Comprehensive brachial plexus evaluation with EMG/NCS required');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
    },
    condition: 'All Radicular Groups (Brachial Plexus)',
    diagnosticCodes: { paralysis: '8513', neuritis: '8613', neuralgia: '8713' },
  };
};

/**
 * Analyze Radial Nerve (Musculospiral) - DC 8514/8614/8714
 */
export const analyzeRadialNerveLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.RADIAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['radn-wrist-drop', 'radn-finger-drop', 'radn-extension-weakness', 'radn-supination-weakness', 'radn-thumb-extension-loss', 'radn-grip-weakness', 'radn-muscle-atrophy'];
  const sensorySymptoms = ['radn-numbness', 'radn-tingling', 'radn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  const ratingScale = {
    complete: { major: 70, minor: 60 },
    severe: { major: 50, minor: 40 },
    moderate: { major: 30, minor: 20 },
    mild: { both: 20 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} radial nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for wrist drop - hallmark of radial nerve palsy
  const hasWristDrop = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'radn-wrist-drop'
  );
  if (hasWristDrop) {
    ratingRationale.push('Wrist drop documented - hallmark sign of radial nerve palsy');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!hasWristDrop && severity.hasMotorInvolvement) {
    gaps.push('Document presence or absence of wrist drop');
  }
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (wrist drop, extension weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis and severity');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
      hasWristDrop,
    },
    condition: 'Radial Nerve (Musculospiral)',
    diagnosticCodes: { paralysis: '8514', neuritis: '8614', neuralgia: '8714' },
  };
};

/**
 * Analyze Median Nerve (Carpal Tunnel) - DC 8515/8615/8715
 */
export const analyzeMedianNerveLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.MEDIAN_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['medn-thenar-weakness', 'medn-thenar-atrophy', 'medn-grip-weakness', 'medn-dropping-objects', 'medn-opposition-weakness', 'medn-pronation-weakness', 'medn-ape-hand'];
  const sensorySymptoms = ['medn-numbness', 'medn-tingling', 'medn-pain', 'medn-night-symptoms', 'medn-trophic-changes'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  const ratingScale = {
    complete: { major: 70, minor: 60 },
    severe: { major: 50, minor: 40 },
    moderate: { major: 30, minor: 20 },
    mild: { both: 10 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} median nerve/carpal tunnel symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for thenar atrophy - sign of severe/chronic carpal tunnel
  const hasThenarAtrophy = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'medn-thenar-atrophy'
  );
  if (hasThenarAtrophy) {
    ratingRationale.push('Thenar atrophy documented - indicates severe/chronic involvement');
  }

  // Check for night symptoms - classic carpal tunnel presentation
  const hasNightSymptoms = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'medn-night-symptoms'
  );
  if (hasNightSymptoms) {
    ratingRationale.push('Night symptoms documented - classic carpal tunnel presentation');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (thenar weakness, opposition difficulty) if present');
  }
  if (!hasThenarAtrophy && severity.severityLevel === 'severe') {
    gaps.push('Document presence or absence of thenar atrophy');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain nerve conduction study to confirm carpal tunnel diagnosis and severity');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
      hasThenarAtrophy,
      hasNightSymptoms,
    },
    condition: 'Median Nerve (Carpal Tunnel)',
    diagnosticCodes: { paralysis: '8515', neuritis: '8615', neuralgia: '8715' },
  };
};

/**
 * Analyze Ulnar Nerve (Cubital Tunnel) - DC 8516/8616/8716
 */
export const analyzeUlnarNerveLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.ULNAR_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['ulnn-grip-weakness', 'ulnn-pinch-weakness', 'ulnn-finger-spread-weakness', 'ulnn-claw-hand', 'ulnn-interossei-atrophy', 'ulnn-hypothenar-atrophy', 'ulnn-thumb-adduction-weakness', 'ulnn-wrist-flexion-weakness'];
  const sensorySymptoms = ['ulnn-numbness', 'ulnn-tingling', 'ulnn-pain', 'ulnn-elbow-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  const ratingScale = {
    complete: { major: 60, minor: 50 },
    severe: { major: 40, minor: 30 },
    moderate: { major: 30, minor: 20 },
    mild: { both: 10 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} ulnar nerve/cubital tunnel symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for claw hand - hallmark of severe ulnar palsy
  const hasClawHand = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'ulnn-claw-hand'
  );
  if (hasClawHand) {
    ratingRationale.push('Claw hand deformity documented - hallmark sign of ulnar nerve palsy');
  }

  // Check for interossei atrophy
  const hasInterosseiAtrophy = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'ulnn-interossei-atrophy'
  );
  if (hasInterosseiAtrophy) {
    ratingRationale.push('Interossei muscle atrophy documented');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (grip weakness, finger spread weakness) if present');
  }
  if (!hasClawHand && severity.severityLevel === 'severe') {
    gaps.push('Document presence or absence of claw hand deformity');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain nerve conduction study to confirm cubital tunnel diagnosis and severity');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
      hasClawHand,
      hasInterosseiAtrophy,
    },
    condition: 'Ulnar Nerve (Cubital Tunnel)',
    diagnosticCodes: { paralysis: '8516', neuritis: '8616', neuralgia: '8716' },
  };
};

/**
 * Analyze Musculocutaneous Nerve - DC 8517/8617/8717
 */
export const analyzeMusculocutaneousNerveLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.MUSCULOCUTANEOUS_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['mscn-biceps-weakness', 'mscn-elbow-flexion-weakness', 'mscn-supination-weakness', 'mscn-muscle-atrophy'];
  const sensorySymptoms = ['mscn-numbness', 'mscn-tingling', 'mscn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // Musculocutaneous has lower max ratings
  const ratingScale = {
    complete: { major: 30, minor: 20 },
    severe: { both: 20 },
    moderate: { both: 10 },
    mild: { both: 0 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} musculocutaneous nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);
  ratingRationale.push('Note: Complete paralysis does not result in total loss of elbow flexion due to compensation by other muscles');

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (biceps weakness, elbow flexion weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
    },
    condition: 'Musculocutaneous Nerve',
    diagnosticCodes: { paralysis: '8517', neuritis: '8617', neuralgia: '8717' },
  };
};

/**
 * Analyze Circumflex (Axillary) Nerve - DC 8518/8618/8718
 */
export const analyzeCircumflexNerveLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.CIRCUMFLEX_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['crcn-shoulder-abduction-weakness', 'crcn-arm-raise-difficulty', 'crcn-external-rotation-weakness', 'crcn-deltoid-weakness', 'crcn-deltoid-atrophy'];
  const sensorySymptoms = ['crcn-numbness', 'crcn-tingling', 'crcn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  const ratingScale = {
    complete: { major: 50, minor: 40 },
    severe: { major: 30, minor: 20 },
    moderate: { both: 10 },
    mild: { both: 0 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} circumflex (axillary) nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for deltoid atrophy
  const hasDeltoidAtrophy = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'crcn-deltoid-atrophy'
  );
  if (hasDeltoidAtrophy) {
    ratingRationale.push('Deltoid atrophy documented - indicates chronic/severe involvement');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (shoulder abduction weakness, deltoid weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      isWholySensory: severity.isWholySensory,
      hasDeltoidAtrophy,
    },
    condition: 'Circumflex (Axillary) Nerve',
    diagnosticCodes: { paralysis: '8518', neuritis: '8618', neuralgia: '8718' },
  };
};

/**
 * Analyze Long Thoracic Nerve - DC 8519/8619/8719
 */
export const analyzeLongThoracicNerveLogs = (logs, options = {}) => {
  const { days = 90, isMajorExtremity = true } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.LONG_THORACIC_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['ltn-winged-scapula', 'ltn-arm-elevation-difficulty', 'ltn-shoulder-weakness', 'ltn-pushing-difficulty', 'ltn-serratus-weakness'];
  const sensorySymptoms = ['ltn-pain', 'ltn-fatigue'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // Long thoracic has lower max ratings
  const ratingScale = {
    complete: { major: 30, minor: 20 },
    severe: { both: 20 },
    moderate: { both: 10 },
    mild: { both: 0 },
  };

  const supportedRating = getUpperExtremityNerveRating(severity.severityLevel, isMajorExtremity, ratingScale);

  const ratingRationale = [];
  const extremityText = isMajorExtremity ? 'major (dominant)' : 'minor (non-dominant)';

  ratingRationale.push(`${relevantLogs.length} long thoracic nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Affected extremity: ${extremityText}`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for winged scapula - hallmark sign
  const hasWingedScapula = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'ltn-winged-scapula'
  );
  if (hasWingedScapula) {
    ratingRationale.push('Winged scapula documented - hallmark sign of long thoracic nerve palsy');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);
  ratingRationale.push('Note: Not to be combined with lost motion above shoulder level');

  const gaps = [];
  if (!hasWingedScapula) {
    gaps.push('Document presence or absence of winged scapula');
  }
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (difficulty raising arm above shoulder) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain clinical examination documenting scapular winging');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isMajorExtremity,
      hasWingedScapula,
    },
    condition: 'Long Thoracic Nerve',
    diagnosticCodes: { paralysis: '8519', neuritis: '8619', neuralgia: '8719' },
  };
};

// ============================================
// LOWER EXTREMITY NERVE ANALYSIS FUNCTIONS
// Note: Lower extremity nerves do NOT have major/minor distinction
// ============================================

/**
 * Analyze Sciatic Nerve - DC 8520/8620/8720
 */
export const analyzeSciaticNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.SCIATIC_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['scin-leg-weakness', 'scin-foot-drop', 'scin-knee-flexion-weakness', 'scin-muscle-atrophy', 'scin-difficulty-walking'];
  const sensorySymptoms = ['scin-radiating-pain', 'scin-numbness', 'scin-tingling', 'scin-burning', 'scin-sitting-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // Sciatic nerve rating scale (no major/minor distinction for lower extremity)
  let supportedRating = 0;
  switch (severity.severityLevel) {
    case 'complete':
      supportedRating = 80;
      break;
    case 'severe':
      supportedRating = 60;
      break;
    case 'moderate':
      // Check for "moderately severe" based on atrophy
      const hasAtrophy = relevantLogs.some(log =>
          getLogSymptomId(log).toLowerCase() === 'scin-muscle-atrophy'
      );
      supportedRating = hasAtrophy ? 40 : 20;
      break;
    default:
      supportedRating = 10;
  }

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} sciatic nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for foot drop
  const hasFootDrop = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'scin-foot-drop'
  );
  if (hasFootDrop) {
    ratingRationale.push('Foot drop documented - indicates significant motor involvement');
  }

  // Check for muscle atrophy
  const hasAtrophy = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'scin-muscle-atrophy'
  );
  if (hasAtrophy) {
    ratingRationale.push('Marked muscular atrophy documented - supports higher rating');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (leg weakness, foot drop) if present');
  }
  if (!hasAtrophy && severity.severityLevel === 'severe') {
    gaps.push('Document presence or absence of muscular atrophy');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis and severity');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isWholySensory: severity.isWholySensory,
      hasFootDrop,
      hasAtrophy,
    },
    condition: 'Sciatic Nerve',
    diagnosticCodes: { paralysis: '8520', neuritis: '8620', neuralgia: '8720' },
  };
};

/**
 * Analyze Common Peroneal (External Popliteal) Nerve - DC 8521/8621/8721
 */
export const analyzeCommonPeronealNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.COMMON_PERONEAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['cpn-foot-drop', 'cpn-dorsiflexion-weakness', 'cpn-toe-extension-weakness', 'cpn-eversion-weakness', 'cpn-steppage-gait', 'cpn-tripping', 'cpn-muscle-atrophy'];
  const sensorySymptoms = ['cpn-numbness', 'cpn-tingling', 'cpn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  let supportedRating = 0;
  switch (severity.severityLevel) {
    case 'complete':
      supportedRating = 40;
      break;
    case 'severe':
      supportedRating = 30;
      break;
    case 'moderate':
      supportedRating = 20;
      break;
    default:
      supportedRating = 10;
  }

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} common peroneal nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for foot drop - hallmark sign
  const hasFootDrop = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'cpn-foot-drop'
  );
  if (hasFootDrop) {
    ratingRationale.push('Foot drop documented - hallmark sign of common peroneal nerve palsy');
  }

  // Check for steppage gait
  const hasSteppageGait = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'cpn-steppage-gait'
  );
  if (hasSteppageGait) {
    ratingRationale.push('Steppage gait documented - compensatory gait pattern for foot drop');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!hasFootDrop && severity.hasMotorInvolvement) {
    gaps.push('Document presence or absence of foot drop');
  }
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (foot drop, dorsiflexion weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isWholySensory: severity.isWholySensory,
      hasFootDrop,
      hasSteppageGait,
    },
    condition: 'Common Peroneal (External Popliteal) Nerve',
    diagnosticCodes: { paralysis: '8521', neuritis: '8621', neuralgia: '8721' },
  };
};

/**
 * Analyze Superficial Peroneal Nerve - DC 8522/8622/8722
 */
export const analyzeSuperficialPeronealNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.SUPERFICIAL_PERONEAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['spn-eversion-weakness', 'spn-ankle-instability', 'spn-muscle-atrophy'];
  const sensorySymptoms = ['spn-numbness', 'spn-tingling', 'spn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // Superficial peroneal has lower max ratings
  let supportedRating = 0;
  switch (severity.severityLevel) {
    case 'complete':
      supportedRating = 30;
      break;
    case 'severe':
      supportedRating = 20;
      break;
    case 'moderate':
      supportedRating = 10;
      break;
    default:
      supportedRating = 0;
  }

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} superficial peroneal nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (eversion weakness, ankle instability) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isWholySensory: severity.isWholySensory,
    },
    condition: 'Superficial Peroneal Nerve',
    diagnosticCodes: { paralysis: '8522', neuritis: '8622', neuralgia: '8722' },
  };
};

/**
 * Analyze Deep Peroneal (Anterior Tibial) Nerve - DC 8523/8623/8723
 */
export const analyzeDeepPeronealNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.DEEP_PERONEAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['dpn-dorsiflexion-loss', 'dpn-toe-extension-weakness', 'dpn-foot-drop', 'dpn-muscle-atrophy'];
  const sensorySymptoms = ['dpn-numbness', 'dpn-tingling', 'dpn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // Deep peroneal has lower max ratings
  let supportedRating = 0;
  switch (severity.severityLevel) {
    case 'complete':
      supportedRating = 30;
      break;
    case 'severe':
      supportedRating = 20;
      break;
    case 'moderate':
      supportedRating = 10;
      break;
    default:
      supportedRating = 0;
  }

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} deep peroneal nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for dorsiflexion loss
  const hasDorsiflexionLoss = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'dpn-dorsiflexion-loss'
  );
  if (hasDorsiflexionLoss) {
    ratingRationale.push('Dorsiflexion loss documented - indicates significant motor involvement');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (dorsiflexion weakness, foot drop) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isWholySensory: severity.isWholySensory,
      hasDorsiflexionLoss,
    },
    condition: 'Deep Peroneal (Anterior Tibial) Nerve',
    diagnosticCodes: { paralysis: '8523', neuritis: '8623', neuralgia: '8723' },
  };
};

/**
 * Analyze Tibial (Internal Popliteal) Nerve - DC 8524/8624/8724
 */
export const analyzeTibialNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.TIBIAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['tibn-plantar-flexion-weakness', 'tibn-toe-flexion-weakness', 'tibn-foot-inversion-weakness', 'tibn-calf-weakness', 'tibn-difficulty-walking-tiptoe', 'tibn-muscle-atrophy'];
  const sensorySymptoms = ['tibn-numbness', 'tibn-tingling', 'tibn-burning'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  let supportedRating = 0;
  switch (severity.severityLevel) {
    case 'complete':
      supportedRating = 40;
      break;
    case 'severe':
      supportedRating = 30;
      break;
    case 'moderate':
      supportedRating = 20;
      break;
    default:
      supportedRating = 10;
  }

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} tibial nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for plantar flexion weakness
  const hasPlantarFlexionWeakness = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'tibn-plantar-flexion-weakness'
  );
  if (hasPlantarFlexionWeakness) {
    ratingRationale.push('Plantar flexion weakness documented');
  }

  // Check for difficulty walking on tiptoe
  const hasTiptoeWalkingDifficulty = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'tibn-difficulty-walking-tiptoe'
  );
  if (hasTiptoeWalkingDifficulty) {
    ratingRationale.push('Difficulty walking on tiptoe documented - indicates significant calf weakness');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (plantar flexion weakness, calf weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isWholySensory: severity.isWholySensory,
      hasPlantarFlexionWeakness,
      hasTiptoeWalkingDifficulty,
    },
    condition: 'Tibial (Internal Popliteal) Nerve',
    diagnosticCodes: { paralysis: '8524', neuritis: '8624', neuralgia: '8724' },
  };
};

/**
 * Analyze Posterior Tibial Nerve - DC 8525/8625/8725
 */
export const analyzePosteriorTibialNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.POSTERIOR_TIBIAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['ptn-sole-paralysis', 'ptn-toe-flexion-weakness', 'ptn-foot-adduction-weakness', 'ptn-muscle-atrophy'];
  const sensorySymptoms = ['ptn-numbness', 'ptn-tingling', 'ptn-burning', 'ptn-tarsal-tunnel'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // Posterior tibial has lower max ratings
  let supportedRating = 0;
  switch (severity.severityLevel) {
    case 'complete':
      supportedRating = 30;
      break;
    case 'severe':
      supportedRating = 20;
      break;
    default:
      supportedRating = 10; // Moderate and mild both rate 10%
  }

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} posterior tibial nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for tarsal tunnel symptoms
  const hasTarsalTunnel = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'ptn-tarsal-tunnel'
  );
  if (hasTarsalTunnel) {
    ratingRationale.push('Tarsal tunnel syndrome symptoms documented');
  }

  // Check for burning pain (causalgic)
  const hasBurningPain = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'ptn-burning'
  );
  if (hasBurningPain) {
    ratingRationale.push('Burning (causalgic) pain documented - common with posterior tibial nerve injury');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (sole weakness, toe flexion weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isWholySensory: severity.isWholySensory,
      hasTarsalTunnel,
      hasBurningPain,
    },
    condition: 'Posterior Tibial Nerve',
    diagnosticCodes: { paralysis: '8525', neuritis: '8625', neuralgia: '8725' },
  };
};

/**
 * Analyze Femoral (Anterior Crural) Nerve - DC 8526/8626/8726
 */
export const analyzeFemoralNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.FEMORAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['femn-quadriceps-weakness', 'femn-knee-extension-weakness', 'femn-knee-buckling', 'femn-difficulty-stairs', 'femn-difficulty-rising', 'femn-muscle-atrophy'];
  const sensorySymptoms = ['femn-numbness', 'femn-tingling', 'femn-pain'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  let supportedRating = 0;
  switch (severity.severityLevel) {
    case 'complete':
      supportedRating = 40;
      break;
    case 'severe':
      supportedRating = 30;
      break;
    case 'moderate':
      supportedRating = 20;
      break;
    default:
      supportedRating = 10;
  }

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} femoral nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel} incomplete paralysis`);

  // Check for knee buckling
  const hasKneeBuckling = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'femn-knee-buckling'
  );
  if (hasKneeBuckling) {
    ratingRationale.push('Knee buckling/giving way documented - indicates significant quadriceps weakness');
  }

  // Check for difficulty with stairs
  const hasDifficultyStairs = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'femn-difficulty-stairs'
  );
  if (hasDifficultyStairs) {
    ratingRationale.push('Difficulty with stairs documented - functional impact of quadriceps weakness');
  }

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  if (severity.isWholySensory) {
    ratingRationale.push('Involvement is wholly sensory - rating limited to moderate per 38 CFR 4.124a');
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (quadriceps weakness, knee buckling) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
      isWholySensory: severity.isWholySensory,
      hasKneeBuckling,
      hasDifficultyStairs,
    },
    condition: 'Femoral (Anterior Crural) Nerve',
    diagnosticCodes: { paralysis: '8526', neuritis: '8626', neuralgia: '8726' },
  };
};

/**
 * Analyze Saphenous (Internal Saphenous) Nerve - DC 8527/8627/8727
 * Note: Purely sensory nerve - max rating is 10%
 */
export const analyzeSaphenousNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.SAPHENOUS_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  // Saphenous is purely sensory
  const sensorySymptoms = ['sapn-numbness', 'sapn-tingling', 'sapn-pain', 'sapn-burning', 'sapn-hypersensitivity'];

  const severityScores = relevantLogs
  .map(log => log.severity)
  .filter(s => s !== undefined && s !== null);
  const avgSeverity = severityScores.length > 0
      ? severityScores.reduce((a, b) => a + b, 0) / severityScores.length
      : 0;

  // Max rating is 10% for this purely sensory nerve
  const supportedRating = avgSeverity >= 5 || relevantLogs.length >= 5 ? 10 : 0;

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} saphenous nerve symptoms logged in ${days} days`);
  ratingRationale.push('Saphenous nerve is purely sensory - no motor function');
  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  if (supportedRating === 10) {
    ratingRationale.push('Severe to complete involvement - 10% rating (maximum for this nerve)');
  } else {
    ratingRationale.push('Mild to moderate involvement - 0% rating');
  }

  const gaps = [];
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Document distribution of sensory loss (medial leg from knee to ankle)');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity: avgSeverity.toFixed(1),
      isPurelySensory: true,
    },
    condition: 'Saphenous (Internal Saphenous) Nerve',
    diagnosticCodes: { paralysis: '8527', neuritis: '8627', neuralgia: '8727' },
  };
};

/**
 * Analyze Obturator Nerve - DC 8528/8628/8728
 */
export const analyzeObturatorNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.OBTURATOR_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  const motorSymptoms = ['obtn-thigh-adduction-weakness', 'obtn-gait-instability', 'obtn-muscle-atrophy'];
  const sensorySymptoms = ['obtn-groin-pain', 'obtn-medial-thigh-pain', 'obtn-numbness', 'obtn-tingling'];

  const severity = determineNerveSeverity(relevantLogs, motorSymptoms, sensorySymptoms, []);

  // Max rating is 10% for obturator nerve
  const supportedRating = (severity.severityLevel === 'complete' || severity.severityLevel === 'severe') ? 10 : 0;

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} obturator nerve symptoms logged in ${days} days`);
  ratingRationale.push(`Severity level: ${severity.severityLevel}`);

  if (severity.hasMotorInvolvement) {
    ratingRationale.push(`Motor involvement documented (${severity.motorLogCount} motor symptoms)`);
  }
  ratingRationale.push(`Average symptom severity: ${severity.avgSeverity}/10`);

  if (supportedRating === 10) {
    ratingRationale.push('Severe to complete involvement - 10% rating (maximum for this nerve)');
  } else {
    ratingRationale.push('Mild to moderate involvement - 0% rating');
  }

  const gaps = [];
  if (!severity.hasMotorInvolvement) {
    gaps.push('Document motor deficits (thigh adduction weakness) if present');
  }
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Obtain EMG/nerve conduction study to confirm diagnosis');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      motorLogs: severity.motorLogCount,
      sensoryLogs: severity.sensoryLogCount,
      avgSeverity: severity.avgSeverity,
      severityLevel: severity.severityLevel,
    },
    condition: 'Obturator Nerve',
    diagnosticCodes: { paralysis: '8528', neuritis: '8628', neuralgia: '8728' },
  };
};

/**
 * Analyze Lateral Femoral Cutaneous Nerve (Meralgia Paresthetica) - DC 8529/8629/8729
 * Note: Purely sensory nerve - max rating is 10%
 */
export const analyzeLateralFemoralCutaneousNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.LATERAL_FEMORAL_CUTANEOUS_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  // Purely sensory nerve
  const sensorySymptoms = ['lfcn-numbness', 'lfcn-tingling', 'lfcn-burning', 'lfcn-hypersensitivity', 'lfcn-pain-standing', 'lfcn-pain-walking'];

  const severityScores = relevantLogs
  .map(log => log.severity)
  .filter(s => s !== undefined && s !== null);
  const avgSeverity = severityScores.length > 0
      ? severityScores.reduce((a, b) => a + b, 0) / severityScores.length
      : 0;

  // Max rating is 10% for this purely sensory nerve
  const supportedRating = avgSeverity >= 5 || relevantLogs.length >= 5 ? 10 : 0;

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} lateral femoral cutaneous nerve (meralgia paresthetica) symptoms logged in ${days} days`);
  ratingRationale.push('Lateral femoral cutaneous nerve is purely sensory - no motor function');
  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Check for burning pain - classic meralgia paresthetica
  const hasBurningPain = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'lfcn-burning'
  );
  if (hasBurningPain) {
    ratingRationale.push('Burning pain documented - classic meralgia paresthetica presentation');
  }

  if (supportedRating === 10) {
    ratingRationale.push('Severe to complete involvement - 10% rating (maximum for this nerve)');
  } else {
    ratingRationale.push('Mild to moderate involvement - 0% rating');
  }

  const gaps = [];
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Document distribution of sensory loss (lateral/outer thigh)');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity: avgSeverity.toFixed(1),
      isPurelySensory: true,
      hasBurningPain,
    },
    condition: 'Lateral Femoral Cutaneous Nerve (Meralgia Paresthetica)',
    diagnosticCodes: { paralysis: '8529', neuritis: '8629', neuralgia: '8729' },
  };
};

/**
 * Analyze Ilio-inguinal Nerve - DC 8530/8630/8730
 * Note: Primarily sensory nerve - max rating is 10%
 */
export const analyzeIlioinguinalNerveLogs = (logs, options = {}) => {
  const { days = 90 } = options;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - days);

  const symptomIds = CONDITIONS.ILIOINGUINAL_NERVE.symptomIds;
  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.date);
    return logDate >= cutoffDate && symptomIds.some(id =>
        getLogSymptomId(log).toLowerCase() === id.toLowerCase()
    );
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, supportedRating: null, ratingRationale: [], gaps: [], metrics: {} };
  }

  // Primarily sensory nerve
  const sensorySymptoms = ['iin-groin-numbness', 'iin-genital-numbness', 'iin-inner-thigh-numbness', 'iin-groin-pain', 'iin-burning', 'iin-hypersensitivity', 'iin-pain-movement'];

  const severityScores = relevantLogs
  .map(log => log.severity)
  .filter(s => s !== undefined && s !== null);
  const avgSeverity = severityScores.length > 0
      ? severityScores.reduce((a, b) => a + b, 0) / severityScores.length
      : 0;

  // Max rating is 10% for this primarily sensory nerve
  const supportedRating = avgSeverity >= 5 || relevantLogs.length >= 5 ? 10 : 0;

  const ratingRationale = [];
  ratingRationale.push(`${relevantLogs.length} ilio-inguinal nerve symptoms logged in ${days} days`);
  ratingRationale.push('Ilio-inguinal nerve is primarily sensory');
  ratingRationale.push(`Average symptom severity: ${avgSeverity.toFixed(1)}/10`);

  // Check for pain with movement
  const hasPainWithMovement = relevantLogs.some(log =>
      getLogSymptomId(log).toLowerCase() === 'iin-pain-movement'
  );
  if (hasPainWithMovement) {
    ratingRationale.push('Pain with movement/coughing documented - common post-surgical finding');
  }

  if (supportedRating === 10) {
    ratingRationale.push('Severe to complete involvement - 10% rating (maximum for this nerve)');
  } else {
    ratingRationale.push('Mild to moderate involvement - 0% rating');
  }

  const gaps = [];
  if (relevantLogs.length < 5) {
    gaps.push('Continue logging symptoms regularly to establish pattern');
  }
  gaps.push('Document distribution of sensory loss (groin, upper medial thigh, genital area)');

  return {
    hasData: true,
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs: relevantLogs.length,
      avgSeverity: avgSeverity.toFixed(1),
      isPurelySensory: true,
      hasPainWithMovement,
    },
    condition: 'Ilio-inguinal Nerve',
    diagnosticCodes: { paralysis: '8530', neuritis: '8630', neuralgia: '8730' },
  };
};

// WEAK FOOT ANALYSIS FUNCTION (DC 5277)
export const analyzeWeakFootLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp || log.date);
    return logDate >= cutoffDate && CONDITIONS.WEAK_FOOT.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: 'Weak Foot', diagnosticCode: '5277' };
  }

  const totalLogs = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / totalLogs;

  // Count specific symptoms
  const atrophyCount = relevantLogs.filter(l => getLogSymptomId(l) === 'wf-muscle-atrophy').length;
  const circulationCount = relevantLogs.filter(l => getLogSymptomId(l) === 'wf-circulation-problems').length;
  const weaknessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'wf-weakness').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'wf-functional-loss').length;

  // Check for bilateral indicators in notes
  const bilateralMentions = relevantLogs.filter(l =>
      l.notes?.toLowerCase().includes('bilateral') ||
      l.notes?.toLowerCase().includes('both feet') ||
      l.notes?.toLowerCase().includes('both sides')
  ).length;

  // DC 5277 provides 10% for bilateral weak foot
  let supportedRating = 10;
  const ratingRationale = [];
  const gaps = [];

  if (bilateralMentions > 0) {
    ratingRationale.push(`Bilateral involvement documented in ${bilateralMentions} log(s)`);
  } else {
    gaps.push('Document bilateral (both feet) involvement - DC 5277 requires bilateral condition');
  }

  if (atrophyCount > 0) {
    ratingRationale.push(`Muscle atrophy documented ${atrophyCount} time(s)`);
  } else {
    gaps.push('Document muscle atrophy in feet');
  }

  if (circulationCount > 0) {
    ratingRationale.push(`Circulation problems noted ${circulationCount} time(s)`);
  } else {
    gaps.push('Document disturbed circulation (cold feet, color changes)');
  }

  if (weaknessCount > 0) {
    ratingRationale.push(`Foot weakness logged ${weaknessCount} time(s)`);
  }

  if (functionalLossCount > 0) {
    ratingRationale.push(`Functional loss documented ${functionalLossCount} time(s)`);
  }

  ratingRationale.push(`${totalLogs} total symptoms logged over evaluation period`);
  ratingRationale.push(`Average severity: ${avgSeverity.toFixed(1)}/10`);

  gaps.push('Identify and document underlying constitutional condition');

  return {
    hasData: true,
    condition: 'Weak Foot (Bilateral)',
    diagnosticCode: '5277',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      atrophyCount,
      circulationCount,
      weaknessCount,
      functionalLossCount,
      bilateralMentions,
    },
    criteria: WEAK_FOOT_CRITERIA,
  };
};

// CLAW FOOT (PES CAVUS) ANALYSIS FUNCTION (DC 5278)
export const analyzeClawFootLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp || log.date);
    return logDate >= cutoffDate && CONDITIONS.CLAW_FOOT.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: 'Claw Foot (Pes Cavus)', diagnosticCode: '5278' };
  }

  const totalLogs = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / totalLogs;

  // Count specific symptoms
  const hammerToesCount = relevantLogs.filter(l => getLogSymptomId(l) === 'cf-hammer-toes').length;
  const callositiesCount = relevantLogs.filter(l => getLogSymptomId(l) === 'cf-callosities').length;
  const varusCount = relevantLogs.filter(l => getLogSymptomId(l) === 'cf-varus-deformity').length;
  const droppedForefootCount = relevantLogs.filter(l => getLogSymptomId(l) === 'cf-dropped-forefoot').length;
  const ankleLimitedCount = relevantLogs.filter(l => getLogSymptomId(l) === 'cf-ankle-dorsiflexion-limited').length;
  const metatarsalTendernessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'cf-metatarsal-tenderness').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'cf-functional-loss').length;

  // Check for bilateral
  const bilateralMentions = relevantLogs.filter(l =>
      l.notes?.toLowerCase().includes('bilateral') ||
      l.notes?.toLowerCase().includes('both feet')
  ).length;
  const isBilateral = bilateralMentions > 0;

  // Determine severity indicators
  const hasSevereFeatures = hammerToesCount > 0 && callositiesCount > 0 && varusCount > 0 && droppedForefootCount > 0;
  const hasModerateFeatures = ankleLimitedCount > 0 && metatarsalTendernessCount > 0;

  // Determine rating
  let supportedRating = 10; // Base rating
  const ratingRationale = [];
  const gaps = [];

  if (hasSevereFeatures && isBilateral) {
    supportedRating = 50;
    ratingRationale.push('Severe bilateral claw foot with hammer toes, callosities, varus deformity, and dropped forefoot');
  } else if (hasSevereFeatures && !isBilateral) {
    supportedRating = 30;
    ratingRationale.push('Severe unilateral claw foot with hammer toes, callosities, varus deformity, and dropped forefoot');
  } else if (hasModerateFeatures && isBilateral) {
    supportedRating = 30;
    ratingRationale.push('Bilateral claw foot with ankle limitation and metatarsal tenderness');
  } else if (hasModerateFeatures && !isBilateral) {
    supportedRating = 20;
    ratingRationale.push('Unilateral claw foot with ankle limitation and metatarsal tenderness');
  } else if (isBilateral) {
    supportedRating = 10;
    ratingRationale.push('Bilateral claw foot with basic findings');
  } else {
    supportedRating = 10;
    ratingRationale.push('Unilateral claw foot with basic findings');
  }

  ratingRationale.push(`${totalLogs} total symptoms logged`);
  ratingRationale.push(`Average severity: ${avgSeverity.toFixed(1)}/10`);

  if (!isBilateral) {
    gaps.push('Document if condition affects both feet (bilateral = higher rating)');
  }
  if (hammerToesCount === 0) {
    gaps.push('Document hammer toe deformity if present');
  }
  if (callositiesCount === 0) {
    gaps.push('Document painful callosities if present');
  }
  if (varusCount === 0) {
    gaps.push('Document varus (heel inward tilting) if present');
  }

  return {
    hasData: true,
    condition: 'Claw Foot (Pes Cavus)',
    diagnosticCode: '5278',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      hammerToesCount,
      callositiesCount,
      varusCount,
      droppedForefootCount,
      ankleLimitedCount,
      metatarsalTendernessCount,
      functionalLossCount,
      isBilateral,
    },
    criteria: CLAW_FOOT_CRITERIA,
  };
};

// METATARSALGIA ANALYSIS FUNCTION (DC 5279)
export const analyzeMetatarsalgiaLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp || log.date);
    return logDate >= cutoffDate && CONDITIONS.METATARSALGIA.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: "Metatarsalgia (Morton's Disease)", diagnosticCode: '5279' };
  }

  const totalLogs = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / totalLogs;

  // Count specific symptoms
  const ballFootPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'mt-ball-foot-pain').length;
  const numbnessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'mt-numbness-toes').length;
  const burningCount = relevantLogs.filter(l => getLogSymptomId(l) === 'mt-burning').length;
  const shootingPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'mt-shooting-pain').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'mt-functional-loss').length;

  // DC 5279 only provides 10% rating
  const supportedRating = 10;
  const ratingRationale = [];
  const gaps = [];

  ratingRationale.push('DC 5279 provides 10% rating for metatarsalgia (unilateral or bilateral)');
  ratingRationale.push(`${totalLogs} total symptoms logged over evaluation period`);
  ratingRationale.push(`Average severity: ${avgSeverity.toFixed(1)}/10`);

  if (ballFootPainCount > 0) {
    ratingRationale.push(`Ball of foot pain documented ${ballFootPainCount} time(s)`);
  }
  if (shootingPainCount > 0) {
    ratingRationale.push(`Shooting pain (Morton neuroma indicator) logged ${shootingPainCount} time(s)`);
  }

  if (avgSeverity >= 7) {
    gaps.push('Severe symptoms may warrant extraschedular consideration - discuss with VSO');
  }
  if (functionalLossCount === 0) {
    gaps.push('Document functional limitations (walking, standing restrictions)');
  }

  return {
    hasData: true,
    condition: "Metatarsalgia (Morton's Disease)",
    diagnosticCode: '5279',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      ballFootPainCount,
      numbnessCount,
      burningCount,
      shootingPainCount,
      functionalLossCount,
    },
    criteria: METATARSALGIA_CRITERIA,
  };
};

// HALLUX VALGUS ANALYSIS FUNCTION (DC 5280)
export const analyzeHalluxValgusLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp || log.date);
    return logDate >= cutoffDate && CONDITIONS.HALLUX_VALGUS.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: 'Hallux Valgus (Bunion)', diagnosticCode: '5280' };
  }

  const totalLogs = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / totalLogs;

  // Count specific symptoms
  const bunionPainCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hv-bunion-pain').length;
  const deformityCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hv-deformity').length;
  const postSurgicalCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hv-post-surgical').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hv-functional-loss').length;
  const limitedMotionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hv-limited-motion').length;

  // Check for surgical history or severe functional loss
  const hasSurgery = postSurgicalCount > 0 || relevantLogs.some(l =>
      l.notes?.toLowerCase().includes('surgery') ||
      l.notes?.toLowerCase().includes('bunionectomy') ||
      l.notes?.toLowerCase().includes('resection')
  );
  const isSevere = avgSeverity >= 7 && (functionalLossCount > 0 || limitedMotionCount > 2);

  // Determine rating
  let supportedRating = 0;
  const ratingRationale = [];
  const gaps = [];

  if (hasSurgery) {
    supportedRating = 10;
    ratingRationale.push('Operated hallux valgus with metatarsal head resection');
  } else if (isSevere) {
    supportedRating = 10;
    ratingRationale.push('Severe hallux valgus equivalent to functional amputation of great toe');
    ratingRationale.push(`High average severity: ${avgSeverity.toFixed(1)}/10`);
  } else {
    supportedRating = 0;
    ratingRationale.push('Hallux valgus present but does not meet criteria for 10% rating');
    ratingRationale.push('Requires surgery with resection OR severity equivalent to great toe amputation');
  }

  ratingRationale.push(`${totalLogs} total symptoms logged`);

  if (!hasSurgery && !isSevere) {
    gaps.push('Document surgical history if bunionectomy performed');
    gaps.push('Document severe functional loss equivalent to great toe amputation');
  }
  if (functionalLossCount === 0) {
    gaps.push('Document functional limitations from bunion');
  }

  // Check for bilateral
  const bilateralMentions = relevantLogs.filter(l =>
      l.notes?.toLowerCase().includes('bilateral') ||
      l.notes?.toLowerCase().includes('both feet')
  ).length;
  if (bilateralMentions > 0) {
    ratingRationale.push('Note: Each foot can be rated separately if bilateral');
  }

  return {
    hasData: true,
    condition: 'Hallux Valgus (Bunion)',
    diagnosticCode: '5280',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      bunionPainCount,
      deformityCount,
      postSurgicalCount,
      functionalLossCount,
      limitedMotionCount,
      hasSurgery,
      isSevere,
    },
    criteria: HALLUX_VALGUS_CRITERIA,
  };
};

// HALLUX RIGIDUS ANALYSIS FUNCTION (DC 5281)
export const analyzeHalluxRigidusLogs = (logs, options = {}) => {
  const evaluationPeriodDays = options.evaluationPeriodDays || 365;
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - evaluationPeriodDays);

  const relevantLogs = logs.filter(log => {
    const logDate = new Date(log.timestamp || log.date);
    return logDate >= cutoffDate && CONDITIONS.HALLUX_RIGIDUS.symptomIds.includes(getLogSymptomId(log));
  });

  if (relevantLogs.length === 0) {
    return { hasData: false, condition: 'Hallux Rigidus', diagnosticCode: '5281' };
  }

  const totalLogs = relevantLogs.length;
  const avgSeverity = relevantLogs.reduce((sum, log) => sum + (log.severity || 5), 0) / totalLogs;

  // Count specific symptoms
  const stiffnessCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hr-toe-stiffness').length;
  const painCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hr-toe-pain').length;
  const limitedMotionCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hr-limited-motion').length;
  const boneSpurCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hr-bone-spur').length;
  const grindingCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hr-grinding').length;
  const functionalLossCount = relevantLogs.filter(l => getLogSymptomId(l) === 'hr-functional-loss').length;

  // Severe hallux rigidus gets 10%
  const isSevere = avgSeverity >= 6 || limitedMotionCount >= 2 || functionalLossCount > 0;

  let supportedRating = 0;
  const ratingRationale = [];
  const gaps = [];

  if (isSevere) {
    supportedRating = 10;
    ratingRationale.push('Severe hallux rigidus - rated as severe hallux valgus per DC 5281');
    if (limitedMotionCount > 0) {
      ratingRationale.push(`Limited big toe motion documented ${limitedMotionCount} time(s)`);
    }
    if (functionalLossCount > 0) {
      ratingRationale.push(`Functional loss documented ${functionalLossCount} time(s)`);
    }
  } else {
    supportedRating = 0;
    ratingRationale.push('Hallux rigidus present but not meeting severe criteria');
  }

  ratingRationale.push(`${totalLogs} total symptoms logged`);
  ratingRationale.push(`Average severity: ${avgSeverity.toFixed(1)}/10`);

  if (stiffnessCount > 0) {
    ratingRationale.push(`Big toe stiffness logged ${stiffnessCount} time(s)`);
  }

  if (!isSevere) {
    gaps.push('Document severity of limited motion (requires severe for 10% rating)');
  }
  if (limitedMotionCount === 0) {
    gaps.push('Document limited dorsiflexion of big toe');
  }
  if (boneSpurCount === 0) {
    gaps.push('Document bone spur if present on examination/X-ray');
  }

  return {
    hasData: true,
    condition: 'Hallux Rigidus',
    diagnosticCode: '5281',
    cfrReference: '38 CFR 4.71a',
    supportedRating,
    ratingRationale,
    gaps,
    metrics: {
      totalLogs,
      avgSeverity,
      stiffnessCount,
      painCount,
      limitedMotionCount,
      boneSpurCount,
      grindingCount,
      functionalLossCount,
      isSevere,
    },
    criteria: HALLUX_RIGIDUS_CRITERIA,
  };
};

// ============================================
// HELPER FUNCTIONS
// ============================================

export const getMigraineRatingCriteria = (percent) => {
  return MIGRAINE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};

export const getSleepApneaRatingCriteria = (percent) => {
  return SLEEP_APNEA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};

export const getAllMigraineRatings = () => {
  return MIGRAINE_CRITERIA.ratings;
};

export const getAllSleepApneaRatings = () => {
  return SLEEP_APNEA_CRITERIA.ratings;
};

export const getMigraineDefinition = (term) => {
  return MIGRAINE_CRITERIA.definitions[term] || null;
};

export const getSleepApneaDefinition = (term) => {
  return SLEEP_APNEA_CRITERIA.definitions[term] || null;
};

export const getPTSDRatingCriteria = (percent) => {
  return PTSD_CRITERIA.ratings.find(r => r.percent === percent) || null;
};

export const getAllPTSDRatings = () => {
  return PTSD_CRITERIA.ratings;
};

export const getPTSDDefinition = (term) => {
  return PTSD_CRITERIA.definitions[term] || null;
};

export const getMajorDepressionRatingCriteria = (percent) => {
  return MAJOR_DEPRESSION_CRITERIA.ratings.find(r => r.percent === percent) ||
      null;
};

export const getAllMajorDepressionRatings = () => {
  return MAJOR_DEPRESSION_CRITERIA.ratings;
};

export const getMajorDepressionDefinition = (term) => {
  return MAJOR_DEPRESSION_CRITERIA.definitions[term] || null;
};

export const getGeneralizedAnxietyRatingCriteria = (percent) => {
  return GENERALIZED_ANXIETY_CRITERIA.ratings.find(
      r => r.percent === percent) || null;
};

export const getAllGeneralizedAnxietyRatings = () => {
  return GENERALIZED_ANXIETY_CRITERIA.ratings;
};

export const getGeneralizedAnxietyDefinition = (term) => {
  return GENERALIZED_ANXIETY_CRITERIA.definitions[term] || null;
};

export const getPanicDisorderRatingCriteria = (percent) => {
  return PANIC_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) ||
      null;
};

export const getAllPanicDisorderRatings = () => {
  return PANIC_DISORDER_CRITERIA.ratings;
};

export const getPanicDisorderDefinition = (term) => {
  return PANIC_DISORDER_CRITERIA.definitions[term] || null;
};

export const getBipolarRatingCriteria = (percent) => {
  return BIPOLAR_CRITERIA.ratings.find(r => r.percent === percent) || null;
};

export const getAllBipolarRatings = () => {
  return BIPOLAR_CRITERIA.ratings;
};

export const getBipolarDefinition = (term) => {
  return BIPOLAR_CRITERIA.definitions[term] || null;
};

export const formatRating = (percent) => {
  if (percent === null) return 'N/A';
  return `${percent}%`;
};

export const getRatingColorClass = (percent) => {
  switch (percent) {
    case 100:
      return 'bg-purple-100 text-purple-800 border-purple-300 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-700';
    case 50:
      return 'bg-red-100 text-red-800 border-red-300 dark:bg-red-900/30 dark:text-red-300 dark:border-red-700';
    case 30:
      return 'bg-orange-100 text-orange-800 border-orange-300 dark:bg-orange-900/30 dark:text-orange-300 dark:border-orange-700';
    case 10:
      return 'bg-yellow-100 text-yellow-800 border-yellow-300 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-700';
    case 0:
      return 'bg-gray-100 text-gray-800 border-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600';
    default:
      return 'bg-gray-100 text-gray-600 border-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:border-gray-600';
  }
};

export const getEvaluationPeriod = (days = 90) => {
  const endDate = new Date();
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - days);

  return {
    startDate,
    endDate,
    days,
    months: (days / 30).toFixed(1),
  };
};

// Helper functions for new conditions
export const getLumbosacralStrainRatingCriteria = (percent) => {
  return LUMBOSACRAL_STRAIN_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getIntervertebralDiscRatingCriteria = (percent) => {
  const incapEpisodes = INTERVERTEBRAL_DISC_CRITERIA.ratingsIncapacitatingEpisodes.find(r => r.percent === percent);
  if (incapEpisodes) return incapEpisodes;
  return INTERVERTEBRAL_DISC_CRITERIA.ratingsGeneralFormula.find(r => r.percent === percent) || null;
};
export const getKneeInstabilityRatingCriteria = (percent) => {
  return KNEE_INSTABILITY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getTBIRatingCriteria = (percent) => {
  return TBI_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHypertensionRatingCriteria = (percent) => {
  return HYPERTENSION_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getTinnitusRatingCriteria = (percent) => {
  return TINNITUS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getFibromyalgiaRatingCriteria = (percent) => {
  return FIBROMYALGIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSocialAnxietyRatingCriteria = (percent) => {
    return SOCIAL_ANXIETY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getOCDRatingCriteria = (percent) => {
    return OCD_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPersistentDepressiveRatingCriteria = (percent) => {
    return PERSISTENT_DEPRESSIVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAdjustmentDisorderRatingCriteria = (percent) => {
    return ADJUSTMENT_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getUnspecifiedAnxietyRatingCriteria = (percent) => {
    return UNSPECIFIED_ANXIETY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getUnspecifiedDepressiveRatingCriteria = (percent) => {
    return UNSPECIFIED_DEPRESSIVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getKidneyStonesRatingCriteria = (percent) => {
  return KIDNEY_STONES_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getChronicRenalDiseaseRatingCriteria = (percent) => {
  return CHRONIC_RENAL_DISEASE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getVoidingDysfunctionIncontinenceRating = (percent) => {
  return VOIDING_DYSFUNCTION_CRITERIA.ratingsIncontinence.find(r => r.percent === percent) || null;
};
export const getVoidingDysfunctionFrequencyRating = (percent) => {
  return VOIDING_DYSFUNCTION_CRITERIA.ratingsFrequency.find(r => r.percent === percent) || null;
};
export const getVoidingDysfunctionObstructionRating = (percent) => {
  return VOIDING_DYSFUNCTION_CRITERIA.ratingsObstruction.find(r => r.percent === percent) || null;
};
export const getSphincterImpairmentRatingCriteria = (percent) => {
  return SPHINCTER_IMPAIRMENT_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getErectileDysfunctionRatingCriteria = (percent) => {
  return ERECTILE_DYSFUNCTION_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 4: Gynecological Helper Functions
export const getEndometriosisRatingCriteria = (percent) => {
  return ENDOMETRIOSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getFemaleReproductiveOrgansRatingCriteria = (percent) => {
  return FEMALE_REPRODUCTIVE_ORGANS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPelvicProlapseRatingCriteria = (percent) => {
  return PELVIC_PROLAPSE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getFemaleArousalDisorderRatingCriteria = (percent) => {
  return FEMALE_SEXUAL_AROUSAL_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 5: Hemic/Lymphatic Helper Functions
export const getIronDeficiencyAnemiaRatingCriteria = (percent) => {
  return IRON_DEFICIENCY_ANEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getFolateDeficiencyAnemiaRatingCriteria = (percent) => {
  return FOLATE_DEFICIENCY_ANEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPerniciousAnemiaRatingCriteria = (percent) => {
  return PERNICIOUS_ANEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHemolyticAnemiaRatingCriteria = (percent) => {
  return HEMOLYTIC_ANEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSickleCellAnemiaRatingCriteria = (percent) => {
  return SICKLE_CELL_ANEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAplasticAnemiaRatingCriteria = (percent) => {
  return APLASTIC_ANEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPolycythemiaVeraRatingCriteria = (percent) => {
  return POLYCYTHEMIA_VERA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getImmuneThrombocytopeniaRatingCriteria = (percent) => {
  return IMMUNE_THROMBOCYTOPENIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getLeukemiaRatingCriteria = (percent) => {
  return LEUKEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHodgkinsLymphomaRatingCriteria = (percent) => {
  return HODGKINS_LYMPHOMA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMultipleMyelomaRatingCriteria = (percent) => {
  return MULTIPLE_MYELOMA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getNonHodgkinsLymphomaRatingCriteria = (percent) => {
  return NON_HODGKINS_LYMPHOMA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMyeloproliferative7718RatingCriteria = (percent) => {
  return MYELOPROLIFERATIVE_7718_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getChronicMyelogenousLeukemiaRatingCriteria = (percent) => {
  return CHRONIC_MYELOGENOUS_LEUKEMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSolitaryPlasmacytomaRatingCriteria = (percent) => {
  return SOLITARY_PLASMACYTOMA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMyelodysplasticSyndromesRatingCriteria = (percent) => {
  return MYELODYSPLASTIC_SYNDROMES_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 7: Dental/Oral Helper Functions
export const getTMJDisorderRatingCriteria = (percent) => {
  return TMJ_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getToothLossRatingCriteria = (percent) => {
  return TOOTH_LOSS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMandibleNonunionRatingCriteria = (percent) => {
  return MANDIBLE_NONUNION_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMalignantOralNeoplasmRatingCriteria = (percent) => {
  return MALIGNANT_ORAL_NEOPLASM_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBenignOralNeoplasmRatingCriteria = (percent) => {
  return BENIGN_ORAL_NEOPLASM_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHIVAIDSRatingCriteria = (percent) => {
  return HIV_AIDS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHepatitisCRatingCriteria = (percent) => {
  return HEPATITIS_C_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHepatitisBRatingCriteria = (percent) => {
  return HEPATITIS_B_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getLymeDiseaseRatingCriteria = (percent) => {
  return LYME_DISEASE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMalariaRatingCriteria = (percent) => {
  return MALARIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBrucellosisRatingCriteria = (percent) => {
  return BRUCELLOSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getCampylobacterRatingCriteria = (percent) => {
  return CAMPYLOBACTER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getQFeverRatingCriteria = (percent) => {
  return Q_FEVER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSalmonellaRatingCriteria = (percent) => {
  return SALMONELLA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getShigellaRatingCriteria = (percent) => {
  return SHIGELLA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getWestNileRatingCriteria = (percent) => {
  return WEST_NILE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getNTMRatingCriteria = (percent) => {
  return NTM_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 8B: Additional Mental Health getRatingCriteria helpers
export const getSchizophreniaRatingCriteria = (percent) => {
  return SCHIZOPHRENIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSchizoaffectiveDisorderRatingCriteria = (percent) => {
  return SCHIZOAFFECTIVE_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDelusionalDisorderRatingCriteria = (percent) => {
  return DELUSIONAL_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPsychoticDisorderNOSRatingCriteria = (percent) => {
  return PSYCHOTIC_DISORDER_NOS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBriefPsychoticDisorderRatingCriteria = (percent) => {
  return BRIEF_PSYCHOTIC_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBingeEatingDisorderRatingCriteria = (percent) => {
  return BINGE_EATING_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDissociativeIdentityDisorderRatingCriteria = (percent) => {
  return DISSOCIATIVE_IDENTITY_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDissociativeAmnesiaRatingCriteria = (percent) => {
  return DISSOCIATIVE_AMNESIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAcuteStressDisorderRatingCriteria = (percent) => {
  return ACUTE_STRESS_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAntisocialPersonalityDisorderRatingCriteria = (percent) => {
  return ANTISOCIAL_PERSONALITY_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBorderlinePersonalityDisorderRatingCriteria = (percent) => {
  return BORDERLINE_PERSONALITY_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getNarcissisticPersonalityDisorderRatingCriteria = (percent) => {
  return NARCISSISTIC_PERSONALITY_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAvoidantPersonalityDisorderRatingCriteria = (percent) => {
  return AVOIDANT_PERSONALITY_DISORDER_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 9: Cardiovascular getRatingCriteria functions
export const getCardiomyopathyRatingCriteria = (percent) => {
  return CARDIOMYOPATHY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSVTRatingCriteria = (percent) => {
  return SVT_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getVentricularArrhythmiaRatingCriteria = (percent) => {
  return VENTRICULAR_ARRHYTHMIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPericarditisRatingCriteria = (percent) => {
  return PERICARDITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPostPhlebiticRatingCriteria = (percent) => {
  return POST_PHLEBITIC_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 2B: Vascular getRatingCriteria functions
export const getColdInjuryRatingCriteria = (percent) => {
  return COLD_INJURY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPADRatingCriteria = (percent) => {
  return PAD_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHyperthyroidismRatingCriteria = (percent) => {
  return HYPERTHYROIDISM_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getThyroiditisRatingCriteria = (percent) => {
  return THYROIDITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHyperparathyroidismRatingCriteria = (percent) => {
  return HYPERPARATHYROIDISM_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHypoparathyroidismRatingCriteria = (percent) => {
  return HYPOPARATHYROIDISM_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 3B: Adrenal & Pituitary Helper Functions
export const getAddisonsDiseaseRatingCriteria = (percent) => {
  return ADDISONS_DISEASE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getCushingsSyndromeRatingCriteria = (percent) => {
  return CUSHINGS_SYNDROME_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDiabetesInsipidusRatingCriteria = (percent) => {
  return DIABETES_INSIPIDUS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHyperaldosteronismRatingCriteria = (percent) => {
  return HYPERALDOSTERONISM_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 10: Digestive getRatingCriteria functions
export const getCirrhosisRatingCriteria = (percent) => {
  return CIRRHOSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getGastritisRatingCriteria = (percent) => {
  return GASTRITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPancreatitisRatingCriteria = (percent) => {
  return PANCREATITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBiliaryTractRatingCriteria = (percent) => {
  return BILIARY_TRACT_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 11: Respiratory getRatingCriteria functions
export const getBronchiectasisRatingCriteria = (percent) => {
  return BRONCHIECTASIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPulmonaryFibrosisRatingCriteria = (percent) => {
  return PULMONARY_FIBROSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSarcoidosisRatingCriteria = (percent) => {
  return SARCOIDOSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMultipleSclerosisRatingCriteria = (percent) => {
  return MULTIPLE_SCLEROSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
}
export const getParkinsonsRatingCriteria = (percent) => {
  return PARKINSONS_DISEASE_CRITERIA.ratings.find(r => r.percent === percent) || null;
}
export const getMyastheniaGravisRatingCriteria = (percent) => {
  return MYASTHENIA_GRAVIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
}
// Narcolepsy helpers
export const getNarcolepsyRatingCriteria = (percent) => {
  return NARCOLEPSY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// ALS helpers
export const getALSRatingCriteria = (percent) => {
  return ALS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Syringomyelia helpers
export const getSyringomyeliaRatingCriteria = (percent) => {
  return SYRINGOMYELIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Myelitis helpers
export const getMyelitisRatingCriteria = (percent) => {
  return MYELITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// PHASE 1C: PERIPHERAL NERVE getRatingCriteria HELPERS
// Upper Extremity Nerves
export const getUpperRadicularGroupRatingCriteria = (percent) => {
  return UPPER_RADICULAR_GROUP_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMiddleRadicularGroupRatingCriteria = (percent) => {
  return MIDDLE_RADICULAR_GROUP_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getLowerRadicularGroupRatingCriteria = (percent) => {
  return LOWER_RADICULAR_GROUP_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAllRadicularGroupsRatingCriteria = (percent) => {
  return ALL_RADICULAR_GROUPS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getRadialNerveRatingCriteria = (percent) => {
  return RADIAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMedianNerveRatingCriteria = (percent) => {
  return MEDIAN_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getUlnarNerveRatingCriteria = (percent) => {
  return ULNAR_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMusculocutaneousNerveRatingCriteria = (percent) => {
  return MUSCULOCUTANEOUS_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getCircumflexNerveRatingCriteria = (percent) => {
  return CIRCUMFLEX_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getLongThoracicNerveRatingCriteria = (percent) => {
  return LONG_THORACIC_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Lower Extremity Nerves
export const getSciaticNerveRatingCriteria = (percent) => {
  return SCIATIC_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getCommonPeronealNerveRatingCriteria = (percent) => {
  return COMMON_PERONEAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSuperficialPeronealNerveRatingCriteria = (percent) => {
  return SUPERFICIAL_PERONEAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDeepPeronealNerveRatingCriteria = (percent) => {
  return DEEP_PERONEAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getTibialNerveRatingCriteria = (percent) => {
  return TIBIAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPosteriorTibialNerveRatingCriteria = (percent) => {
  return POSTERIOR_TIBIAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getFemoralNerveRatingCriteria = (percent) => {
  return FEMORAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSaphenousNerveRatingCriteria = (percent) => {
  return SAPHENOUS_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getObturatorNerveRatingCriteria = (percent) => {
  return OBTURATOR_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getLateralFemoralCutaneousNerveRatingCriteria = (percent) => {
  return LATERAL_FEMORAL_CUTANEOUS_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getIlioinguinalNerveRatingCriteria = (percent) => {
  return ILIOINGUINAL_NERVE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getJacksonianEpilepsyRatingCriteria = (percent) => {
  return  EPILEPSY_JACKSONIAN_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDiencephalicEpilepsyRatingCriteria = (percent) => {
  return  EPILEPSY_DIENCEPHALIC_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPsychomotorEpilepsyRatingCriteria = (percent) => {
  return  EPILEPSY_PSYCHOMOTOR_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getGoutRatingCriteria = (percent) => {
  return GOUT_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBursitisRatingCriteria = (percent) => {
  return BURSITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getTendinitisRatingCriteria = (percent) => {
  return TENDINITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMyositisRatingCriteria = (percent) => {
  return MYOSITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getOsteomyelitisRatingCriteria = (percent) => {
  return OSTEOMYELITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMultiJointArthritisRatingCriteria = (percent) => {
  return MULTI_JOINT_ARTHRITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 4C: Spine Expansion getRatingCriteria functions
export const getVertebralFractureRatingCriteria = (percent) => {
  return VERTEBRAL_FRACTURE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSacroiliacInjuryRatingCriteria = (percent) => {
  return SACROILIAC_INJURY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSpinalStenosisRatingCriteria = (percent) => {
  return SPINAL_STENOSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAnkylosingSpondylitisRatingCriteria = (percent) => {
  return ANKYLOSING_SPONDYLITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSpinalFusionRatingCriteria = (percent) => {
  return SPINAL_FUSION_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getWeakFootRatingCriteria = (percent) => {
  return WEAK_FOOT_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getClawFootRatingCriteria = (percent) => {
  return CLAW_FOOT_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getMetatarsalgiaRatingCriteria = (percent) => {
  return METATARSALGIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHalluxValgusRatingCriteria = (percent) => {
  return HALLUX_VALGUS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHalluxRigidusRatingCriteria = (percent) => {
  return HALLUX_RIGIDUS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 5A: Hernia & Structural getRatingCriteria functions
export const getHerniaRatingCriteria = (percent) => {
  return HERNIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPeritonealAdhesionsRatingCriteria = (percent) => {
  return PERITONEAL_ADHESIONS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 5B: Esophageal & Post-Surgical getRatingCriteria functions
export const getEsophagealStrictureRatingCriteria = (percent) => {
  return ESOPHAGEAL_STRICTURE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getPostgastrectomyRatingCriteria = (percent) => {
  return POSTGASTRECTOMY_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getIntestinalFistulaRatingCriteria = (percent) => {
  return INTESTINAL_FISTULA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAcneRating = (percent) => {
  return ACNE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getChloracneRating = (percent) => {
  return CHLORACNE_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getAlopeciaAreataRating = (percent) => {
  return ALOPECIA_AREATA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getHyperhidrosisRating = (percent) => {
  return HYPERHIDROSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDiscoidLupusRating = (percent) => {
  return DISCOID_LUPUS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getBullousDisordersRating = (percent) => {
  return BULLOUS_DISORDERS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getCutaneousVasculitisRating = (percent) => {
  return CUTANEOUS_VASCULITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getDermatophytosisRating = (percent) => {
  return DERMATOPHYTOSIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getSkinInfectionsRating = (percent) => {
  return SKIN_INFECTIONS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getGeneralEyeFormulaRating = (percent) => {
  return GENERAL_EYE_FORMULA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getUveitisRating = (percent) => {
  return UVEITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getKeratitisRating = (percent) => {
  return KERATITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getChronicConjunctivitisRating = (percent) => {
  return CHRONIC_CONJUNCTIVITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getScleritisRating = (percent) => {
  return SCLERITIS_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
// Phase 7B: Ear Conditions
export const getPeripheralVestibularRating = (percent) => {
  return PERIPHERAL_VESTIBULAR_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getChronicSuppurativeOtitisMediaRating = (percent) => {
  return CHRONIC_SUPPURATIVE_OTITIS_MEDIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getChronicOtitisExternaRating = (percent) => {
  return CHRONIC_OTITIS_EXTERNA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};
export const getChronicNonsuppurativeOtitisMediaRating = (percent) => {
  return CHRONIC_NONSUPPURATIVE_OTITIS_MEDIA_CRITERIA.ratings.find(r => r.percent === percent) || null;
};



export const getAllLumbosacralStrainRatings = () => LUMBOSACRAL_STRAIN_CRITERIA.ratings;
export const getAllIntervertebralDiscRatings = () => INTERVERTEBRAL_DISC_CRITERIA.ratingsIncapacitatingEpisodes;
export const getAllKneeInstabilityRatings = () => KNEE_INSTABILITY_CRITERIA.ratings;
export const getAllTBIRatings = () => TBI_CRITERIA.ratings;
export const getAllHypertensionRatings = () => HYPERTENSION_CRITERIA.ratings;
export const getAllTinnitusRatings = () => TINNITUS_CRITERIA.ratings;
export const getAllFibromyalgiaRatings = () => FIBROMYALGIA_CRITERIA.ratings;
export const getAllSocialAnxietyRatings = () => SOCIAL_ANXIETY_CRITERIA.ratings;
export const getAllOCDRatings = () => OCD_CRITERIA.ratings;
export const getAllPersistentDepressiveRatings = () => PERSISTENT_DEPRESSIVE_CRITERIA.ratings;
export const getAllAdjustmentDisorderRatings = () => ADJUSTMENT_DISORDER_CRITERIA.ratings;
export const getAllUnspecifiedAnxietyRatings = () => UNSPECIFIED_ANXIETY_CRITERIA.ratings;
export const getAllUnspecifiedDepressiveRatings = () => UNSPECIFIED_DEPRESSIVE_CRITERIA.ratings;
export const getAllEpilepsyMajorRatings = () => EPILEPSY_MAJOR_CRITERIA.ratings;
export const getAllEpilepsyMinorRatings = () => EPILEPSY_MINOR_CRITERIA.ratings;
export const getAllVisionLossRatings = () => VISION_LOSS_CRITERIA.ratings;
export const getAllGlaucomaRatings = () => GLAUCOMA_CRITERIA.ratings;
export const getAllAsthmaRatings = () => ASTHMA_CRITERIA.ratings;
export const getAllIronDeficiencyAnemiaRatings = () => IRON_DEFICIENCY_ANEMIA_CRITERIA.ratings;
export const getAllFolateDeficiencyAnemiaRatings = () => FOLATE_DEFICIENCY_ANEMIA_CRITERIA.ratings;
export const getAllPerniciousAnemiaRatings = () => PERNICIOUS_ANEMIA_CRITERIA.ratings;
export const getAllHemolyticAnemiaRatings = () => HEMOLYTIC_ANEMIA_CRITERIA.ratings;
export const getAllSickleCellAnemiaRatings = () => SICKLE_CELL_ANEMIA_CRITERIA.ratings;
export const getAllAplasticAnemiaRatings = () => APLASTIC_ANEMIA_CRITERIA.ratings;
export const getAllPolycythemiaVeraRatings = () => POLYCYTHEMIA_VERA_CRITERIA.ratings;
export const getAllImmuneThrombocytopeniaRatings = () => IMMUNE_THROMBOCYTOPENIA_CRITERIA.ratings;
export const getAllLeukemiaRatings = () => LEUKEMIA_CRITERIA.ratings;
export const getAllHodgkinsLymphomaRatings = () => HODGKINS_LYMPHOMA_CRITERIA.ratings;
export const getAllMultipleMyelomaRatings = () => MULTIPLE_MYELOMA_CRITERIA.ratings;
export const getAllNonHodgkinsLymphomaRatings = () => NON_HODGKINS_LYMPHOMA_CRITERIA.ratings;
export const getAllMyeloproliferative7718Ratings = () => MYELOPROLIFERATIVE_7718_CRITERIA.ratings;
export const getAllChronicMyelogenousLeukemiaRatings = () => CHRONIC_MYELOGENOUS_LEUKEMIA_CRITERIA.ratings;
export const getAllSolitaryPlasmacytomaRatings = () => SOLITARY_PLASMACYTOMA_CRITERIA.ratings;
export const getAllMyelodysplasticSyndromesRatings = () => MYELODYSPLASTIC_SYNDROMES_CRITERIA.ratings;
export const getAllTMJDisorderRatings = () => TMJ_DISORDER_CRITERIA.ratings;
export const getAllToothLossRatings = () => TOOTH_LOSS_CRITERIA.ratings;
export const getAllMandibleNonunionRatings = () => MANDIBLE_NONUNION_CRITERIA.ratings;
export const getAllMalignantOralNeoplasmRatings = () => MALIGNANT_ORAL_NEOPLASM_CRITERIA.ratings;
export const getAllBenignOralNeoplasmRatings = () => BENIGN_ORAL_NEOPLASM_CRITERIA.ratings;
export const getAllHIVAIDSRatings = () => HIV_AIDS_CRITERIA.ratings;
export const getAllHepatitisCRatings = () => HEPATITIS_C_CRITERIA.ratings;
export const getAllHepatitisBRatings = () => HEPATITIS_B_CRITERIA.ratings;
export const getAllLymeDiseaseRatings = () => LYME_DISEASE_CRITERIA.ratings;
export const getAllMalariaRatings = () => MALARIA_CRITERIA.ratings;
export const getAllBrucellosisRatings = () => BRUCELLOSIS_CRITERIA.ratings;
export const getAllCampylobacterRatings = () => CAMPYLOBACTER_CRITERIA.ratings;
export const getAllQFeverRatings = () => Q_FEVER_CRITERIA.ratings;
export const getAllSalmonellaRatings = () => SALMONELLA_CRITERIA.ratings;
export const getAllShigellaRatings = () => SHIGELLA_CRITERIA.ratings;
export const getAllWestNileRatings = () => WEST_NILE_CRITERIA.ratings;
export const getAllNTMRatings = () => NTM_CRITERIA.ratings;
export const getAllSomaticSymptomDisorderRatings = () => SOMATIC_SYMPTOM_DISORDER_CRITERIA.ratings;
export const getAllOtherSpecifiedSomaticRatings = () => OTHER_SPECIFIED_SOMATIC_CRITERIA.ratings;
export const getAllUnspecifiedSomaticRatings = () => UNSPECIFIED_SOMATIC_CRITERIA.ratings;
export const getAllIllnessAnxietyRatings = () => ILLNESS_ANXIETY_CRITERIA.ratings;
export const getAllOtherSpecifiedAnxietyRatings = () => OTHER_SPECIFIED_ANXIETY_CRITERIA.ratings;
export const getAllDepersonalizationRatings = () => DEPERSONALIZATION_DEREALIZATION_CRITERIA.ratings;
export const getAllCyclothymicRatings = () => CYCLOTHYMIC_CRITERIA.ratings;
export const getAllAnorexiaNervosaRatings = () => ANOREXIA_NERVOSA_CRITERIA.ratings;
export const getAllBulimiaNervosaRatings = () => BULIMIA_NERVOSA_CRITERIA.ratings;
export const getAllSchizophreniaRatings = () => SCHIZOPHRENIA_CRITERIA.ratings;
export const getAllSchizoaffectiveDisorderRatings = () => SCHIZOAFFECTIVE_DISORDER_CRITERIA.ratings;
export const getAllDelusionalDisorderRatings = () => DELUSIONAL_DISORDER_CRITERIA.ratings;
export const getAllPsychoticDisorderNOSRatings = () => PSYCHOTIC_DISORDER_NOS_CRITERIA.ratings;
export const getAllBriefPsychoticDisorderRatings = () => BRIEF_PSYCHOTIC_DISORDER_CRITERIA.ratings;
export const getAllBingeEatingDisorderRatings = () => BINGE_EATING_DISORDER_CRITERIA.ratings;
export const getAllDissociativeIdentityDisorderRatings = () => DISSOCIATIVE_IDENTITY_DISORDER_CRITERIA.ratings;
export const getAllDissociativeAmnesiaRatings = () => DISSOCIATIVE_AMNESIA_CRITERIA.ratings;
export const getAllAcuteStressDisorderRatings = () => ACUTE_STRESS_DISORDER_CRITERIA.ratings;
export const getAllAntisocialPersonalityDisorderRatings = () => ANTISOCIAL_PERSONALITY_DISORDER_CRITERIA.ratings;
export const getAllBorderlinePersonalityDisorderRatings = () => BORDERLINE_PERSONALITY_DISORDER_CRITERIA.ratings;
export const getAllNarcissisticPersonalityDisorderRatings = () => NARCISSISTIC_PERSONALITY_DISORDER_CRITERIA.ratings;
export const getAllAvoidantPersonalityDisorderRatings = () => AVOIDANT_PERSONALITY_DISORDER_CRITERIA.ratings;
export const getAllCardiomyopathyRatings = () => CARDIOMYOPATHY_CRITERIA.ratings;
export const getAllSVTRatings = () => SVT_CRITERIA.ratings;
export const getAllVentricularArrhythmiaRatings = () => VENTRICULAR_ARRHYTHMIA_CRITERIA.ratings;
export const getAllPericarditisRatings = () => PERICARDITIS_CRITERIA.ratings;
export const getAllPostPhlebiticRatings = () => POST_PHLEBITIC_CRITERIA.ratings;
export const getAllCirrhosisRatings = () => CIRRHOSIS_CRITERIA.ratings;
export const getAllGastritisRatings = () => GASTRITIS_CRITERIA.ratings;
export const getAllPancreatitisRatings = () => PANCREATITIS_CRITERIA.ratings;
export const getAllBiliaryTractRatings = () => BILIARY_TRACT_CRITERIA.ratings;
export const getAllBronchiectasisRatings = () => BRONCHIECTASIS_CRITERIA.ratings;
export const getAllPulmonaryFibrosisRatings = () => PULMONARY_FIBROSIS_CRITERIA.ratings;
export const getAllSarcoidosisRatings = () => SARCOIDOSIS_CRITERIA.ratings;
export const getAllMultipleSclerosisDefinition = () => MULTIPLE_SCLEROSIS_CRITERIA.ratings;
export const getAllParkinsonsDefinition = () => PARKINSONS_DISEASE_CRITERIA.ratings;
export const getAllMyastheniaGravisDefinition = () => MYASTHENIA_GRAVIS_CRITERIA.ratings;
export const getAllNarcolepsyRatings = () => NARCOLEPSY_CRITERIA.ratings;
export const getAllALSRatings = () => ALS_CRITERIA.ratings;
export const getAllSyringomyeliaRatings = () => SYRINGOMYELIA_CRITERIA.ratings;
export const getAllMyelitisRatings = () => MYELITIS_CRITERIA.ratings;
export const getAllUpperRadicularGroupRatings = () => UPPER_RADICULAR_GROUP_CRITERIA.ratings;
export const getAllMiddleRadicularGroupRatings = () => MIDDLE_RADICULAR_GROUP_CRITERIA.ratings;
export const getAllLowerRadicularGroupRatings = () => LOWER_RADICULAR_GROUP_CRITERIA.ratings;
export const getAllAllRadicularGroupsRatings = () => ALL_RADICULAR_GROUPS_CRITERIA.ratings;
export const getAllRadialNerveRatings = () => RADIAL_NERVE_CRITERIA.ratings;
export const getAllMedianNerveRatings = () => MEDIAN_NERVE_CRITERIA.ratings;
export const getAllUlnarNerveRatings = () => ULNAR_NERVE_CRITERIA.ratings;
export const getAllMusculocutaneousNerveRatings = () => MUSCULOCUTANEOUS_NERVE_CRITERIA.ratings;
export const getAllCircumflexNerveRatings = () => CIRCUMFLEX_NERVE_CRITERIA.ratings;
export const getAllLongThoracicNerveRatings = () => LONG_THORACIC_NERVE_CRITERIA.ratings;
export const getAllSciaticNerveRatings = () => SCIATIC_NERVE_CRITERIA.ratings;
export const getAllCommonPeronealNerveRatings = () => COMMON_PERONEAL_NERVE_CRITERIA.ratings;
export const getAllSuperficialPeronealNerveRatings = () => SUPERFICIAL_PERONEAL_NERVE_CRITERIA.ratings;
export const getAllDeepPeronealNerveRatings = () => DEEP_PERONEAL_NERVE_CRITERIA.ratings;
export const getAllTibialNerveRatings = () => TIBIAL_NERVE_CRITERIA.ratings;
export const getAllPosteriorTibialNerveRatings = () => POSTERIOR_TIBIAL_NERVE_CRITERIA.ratings;
export const getAllFemoralNerveRatings = () => FEMORAL_NERVE_CRITERIA.ratings;
export const getAllSaphenousNerveRatings = () => SAPHENOUS_NERVE_CRITERIA.ratings;
export const getAllObturatorNerveRatings = () => OBTURATOR_NERVE_CRITERIA.ratings;
export const getAllLateralFemoralCutaneousNerveRatings = () => LATERAL_FEMORAL_CUTANEOUS_NERVE_CRITERIA.ratings;
export const getAllIlioinguinalNerveRatings = () => ILIOINGUINAL_NERVE_CRITERIA.ratings;
export const getAllJacksonianEpilepsyRatings = () => EPILEPSY_JACKSONIAN_CRITERIA.ratings;
export const getAllDiencephalicEpilepsyRatings = () => EPILEPSY_DIENCEPHALIC_CRITERIA.ratings;
export const getAllPsychomotorEpilepsyRatings = () => EPILEPSY_PSYCHOMOTOR_CRITERIA.ratings;
export const getAllColdInjuryRatings = () => COLD_INJURY_CRITERIA.ratings;
export const getAllPADRatings = () => PAD_CRITERIA.ratings;
export const getAllHyperthyroidismRatings = () => HYPERTHYROIDISM_CRITERIA.ratings;
export const getAllThyroiditisRatings = () => THYROIDITIS_CRITERIA.ratings;
export const getAllHyperparathyroidismRatings = () => HYPERPARATHYROIDISM_CRITERIA.ratings;
export const getAllHypoparathyroidismRatings = () => HYPOPARATHYROIDISM_CRITERIA.ratings;
export const getAllAddisonsDiseaseRatings = () => ADDISONS_DISEASE_CRITERIA.ratings;
export const getAllCushingsSyndromeRatings = () => CUSHINGS_SYNDROME_CRITERIA.ratings;
export const getAllDiabetesInsipidusRatings = () => DIABETES_INSIPIDUS_CRITERIA.ratings;
export const getAllHyperaldosteronismRatings = () => HYPERALDOSTERONISM_CRITERIA.ratings;
export const getAllGoutRatings = () => GOUT_CRITERIA.ratings;
export const getAllBursitisRatings = () => BURSITIS_CRITERIA.ratings;
export const getAllTendinitisRatings = () => TENDINITIS_CRITERIA.ratings;
export const getAllMyositisRatings = () => MYOSITIS_CRITERIA.ratings;
export const getAllOsteomyelitisRatings = () => OSTEOMYELITIS_CRITERIA.ratings;
export const getAllMultiJointArthritisRatings = () => MULTI_JOINT_ARTHRITIS_CRITERIA.ratings;
export const getAllVertebralFractureRatings = () => VERTEBRAL_FRACTURE_CRITERIA.ratings;
export const getAllSacroiliacInjuryRatings = () => SACROILIAC_INJURY_CRITERIA.ratings;
export const getAllSpinalStenosisRatings = () => SPINAL_STENOSIS_CRITERIA.ratings;
export const getAllAnkylosingSpondylitisRatings = () => ANKYLOSING_SPONDYLITIS_CRITERIA.ratings;
export const getAllSpinalFusionRatings = () => SPINAL_FUSION_CRITERIA.ratings;
export const getAllWeakFootRatings = () => WEAK_FOOT_CRITERIA.ratings;
export const getAllClawFootRatings = () => CLAW_FOOT_CRITERIA.ratings;
export const getAllMetatarsalgiaRatings = () => METATARSALGIA_CRITERIA.ratings;
export const getAllHalluxValgusRatings = () => HALLUX_VALGUS_CRITERIA.ratings;
export const getAllHalluxRigidusRatings = () => HALLUX_RIGIDUS_CRITERIA.ratings;
export const getAllHerniaRatings = () => HERNIA_CRITERIA.ratings;
export const getAllPeritonealAdhesionsRatings = () => PERITONEAL_ADHESIONS_CRITERIA.ratings;
export const getAllEsophagealStrictureRatings = () => ESOPHAGEAL_STRICTURE_CRITERIA.ratings;
export const getAllPostgastrectomyRatings = () => POSTGASTRECTOMY_CRITERIA.ratings;
export const getAllIntestinalFistulaRatings = () => INTESTINAL_FISTULA_CRITERIA.ratings;
export const getAllAcneRatings = () => ACNE_CRITERIA.ratings;
export const getAllChloracneRatings = () => CHLORACNE_CRITERIA.ratings;
export const getAllAlopeciaAreataRatings = () => ALOPECIA_AREATA_CRITERIA.ratings;
export const getAllHyperhidrosisRatings = () => HYPERHIDROSIS_CRITERIA.ratings;
export const getAllDiscoidLupusRatings = () => DISCOID_LUPUS_CRITERIA.ratings;
export const getAllBullousDisordersRatings = () => BULLOUS_DISORDERS_CRITERIA.ratings;
export const getAllCutaneousVasculitisRatings = () => CUTANEOUS_VASCULITIS_CRITERIA.ratings;
export const getAllDermatophytosisRatings = () => DERMATOPHYTOSIS_CRITERIA.ratings;
export const getAllSkinInfectionsRatings = () => SKIN_INFECTIONS_CRITERIA.ratings;
export const getAllGeneralSkinFormulaRatings = () => GENERAL_SKIN_FORMULA_CRITERIA.ratings;
export const getAllGeneralEyeFormulaRatings = () => GENERAL_EYE_FORMULA_CRITERIA.ratings;
export const getAllUveitisRatings = () => UVEITIS_CRITERIA.ratings;
export const getAllKeratitisRatings = () => KERATITIS_CRITERIA.ratings;
export const getAllChronicConjunctivitisRatings = () => CHRONIC_CONJUNCTIVITIS_CRITERIA.ratings;
export const getAllScleritisRatings = () => SCLERITIS_CRITERIA.ratings;
export const getAllPeripheralVestibularRatings = () => PERIPHERAL_VESTIBULAR_CRITERIA.ratings;
export const getAllChronicSuppurativeOtitisMediaRatings = () => CHRONIC_SUPPURATIVE_OTITIS_MEDIA_CRITERIA.ratings;
export const getAllChronicOtitisExternaRatings = () => CHRONIC_OTITIS_EXTERNA_CRITERIA.ratings;
export const getAllChronicNonsuppurativeOtitisMediaRatings = () => CHRONIC_NONSUPPURATIVE_OTITIS_MEDIA_CRITERIA.ratings;



export const getEpilepsyMajorDefinition = (term) => EPILEPSY_MAJOR_CRITERIA.definitions[term] || null;
export const getEpilepsyMinorDefinition = (term) => EPILEPSY_MINOR_CRITERIA.definitions[term] || null;
export const getLumbosacralStrainDefinition = (term) => LUMBOSACRAL_STRAIN_CRITERIA.definitions[term] || null;
export const getIntervertebralDiscDefinition = (term) => INTERVERTEBRAL_DISC_CRITERIA.definitions[term] || null;
export const getKneeInstabilityDefinition = (term) => KNEE_INSTABILITY_CRITERIA.definitions[term] || null;
export const getTBIDefinition = (term) => TBI_CRITERIA.definitions[term] || null;
export const getHypertensionDefinition = (term) => HYPERTENSION_CRITERIA.definitions[term] || null;
export const getTinnitusDefinition = (term) => TINNITUS_CRITERIA.definitions[term] || null;
export const getFibromyalgiaDefinition = (term) => FIBROMYALGIA_CRITERIA.definitions[term] || null;
export const getAsthmaDefinition = (term) => ASTHMA_CRITERIA.definitions[term] || null;
export const getSocialAnxietyDefinition = (term) => SOCIAL_ANXIETY_CRITERIA.definitions[term] || null;
export const getOCDDefinition = (term) => OCD_CRITERIA.definitions[term] || null;
export const getPersistentDepressiveDefinition = (term) => PERSISTENT_DEPRESSIVE_CRITERIA.definitions[term] || null;
export const getAdjustmentDisorderDefinition = (term) => ADJUSTMENT_DISORDER_CRITERIA.definitions[term] || null;
export const getUnspecifiedAnxietyDefinition = (term) => UNSPECIFIED_ANXIETY_CRITERIA.definitions[term] || null;
export const getUnspecifiedDepressiveDefinition = (term) => UNSPECIFIED_DEPRESSIVE_CRITERIA.definitions[term] || null;
export const getVisionLossDefinition = (term) => VISION_LOSS_CRITERIA.definitions[term] || null;
export const getGlaucomaDefinition = (term) => GLAUCOMA_CRITERIA.definitions[term] || null;
export const getDiabeticRetinopathyDefinition = (term) => DIABETIC_RETINOPATHY_CRITERIA.definitions[term] || null;
export const getMacularDegenerationDefinition = (term) => MACULAR_DEGENERATION_CRITERIA.definitions[term] || null;
export const getChronicCystitisRatingCriteria = getVoidingDysfunctionIncontinenceRating;
export const getNeurogenicBladderRatingCriteria = getVoidingDysfunctionIncontinenceRating;
export const getProstateConditionsRatingCriteria = getVoidingDysfunctionFrequencyRating;
export const getUrethralStrictureRatingCriteria = getVoidingDysfunctionObstructionRating;
export const getIronDeficiencyAnemiaDefinition = (term) => IRON_DEFICIENCY_ANEMIA_CRITERIA.definitions[term] || null;
export const getFolateDeficiencyAnemiaDefinition = (term) => FOLATE_DEFICIENCY_ANEMIA_CRITERIA.definitions[term] || null;
export const getPerniciousAnemiaDefinition = (term) => PERNICIOUS_ANEMIA_CRITERIA.definitions[term] || null;
export const getHemolyticAnemiaDefinition = (term) => HEMOLYTIC_ANEMIA_CRITERIA.definitions[term] || null;
export const getSickleCellAnemiaDefinition = (term) => SICKLE_CELL_ANEMIA_CRITERIA.definitions[term] || null;
export const getAplasticAnemiaDefinition = (term) => APLASTIC_ANEMIA_CRITERIA.definitions[term] || null;
export const getPolycythemiaVeraDefinition = (term) => POLYCYTHEMIA_VERA_CRITERIA.definitions[term] || null;
export const getImmuneThrombocytopeniaDefinition = (term) => IMMUNE_THROMBOCYTOPENIA_CRITERIA.definitions[term] || null;
export const getLeukemiaDefinition = (term) => LEUKEMIA_CRITERIA.definitions[term] || null;
export const getHodgkinsLymphomaDefinition = (term) => HODGKINS_LYMPHOMA_CRITERIA.definitions[term] || null;
export const getMultipleMyelomaDefinition = (term) => MULTIPLE_MYELOMA_CRITERIA.definitions[term] || null;
export const getNonHodgkinsLymphomaDefinition = (term) => NON_HODGKINS_LYMPHOMA_CRITERIA.definitions[term] || null;
export const getMyeloproliferative7718Definition = (term) => MYELOPROLIFERATIVE_7718_CRITERIA.definitions[term] || null;
export const getChronicMyelogenousLeukemiaDefinition = (term) => CHRONIC_MYELOGENOUS_LEUKEMIA_CRITERIA.definitions[term] || null;
export const getSolitaryPlasmacytomaDefinition = (term) => SOLITARY_PLASMACYTOMA_CRITERIA.definitions[term] || null;
export const getMyelodysplasticSyndromesDefinition = (term) => MYELODYSPLASTIC_SYNDROMES_CRITERIA.definitions[term] || null;
export const getTMJDisorderDefinition = (term) => TMJ_DISORDER_CRITERIA.definitions[term] || null;
export const getToothLossDefinition = (term) => TOOTH_LOSS_CRITERIA.definitions[term] || null;
export const getMandibleNonunionDefinition = (term) => MANDIBLE_NONUNION_CRITERIA.definitions[term] || null;
export const getMalignantOralNeoplasmDefinition = (term) => MALIGNANT_ORAL_NEOPLASM_CRITERIA.definitions[term] || null;
export const getBenignOralNeoplasmDefinition = (term) => BENIGN_ORAL_NEOPLASM_CRITERIA.definitions[term] || null;
export const getHIVAIDSDefinition = (term) => HIV_AIDS_CRITERIA.definitions[term] || null;
export const getHepatitisCDefinition = (term) => HEPATITIS_C_CRITERIA.definitions[term] || null;
export const getHepatitisBDefinition = (term) => HEPATITIS_B_CRITERIA.definitions[term] || null;
export const getLymeDiseaseDefinition = (term) => LYME_DISEASE_CRITERIA.definitions[term] || null;
export const getMalariaDefinition = (term) => MALARIA_CRITERIA.definitions[term] || null;
export const getBrucellosisDefinition = (term) => BRUCELLOSIS_CRITERIA.definitions[term] || null;
export const getCampylobacterDefinition = (term) => CAMPYLOBACTER_CRITERIA.definitions[term] || null;
export const getQFeverDefinition = (term) => Q_FEVER_CRITERIA.definitions[term] || null;
export const getSalmonellaDefinition = (term) => SALMONELLA_CRITERIA.definitions[term] || null;
export const getShigellaDefinition = (term) => SHIGELLA_CRITERIA.definitions[term] || null;
export const getWestNileDefinition = (term) => WEST_NILE_CRITERIA.definitions[term] || null;
export const getNTMDefinition = (term) => NTM_CRITERIA.definitions[term] || null;
export const getSomaticSymptomDisorderDefinition = (term) => { return SOMATIC_SYMPTOM_DISORDER_CRITERIA.definitions[term] || null; };
export const getOtherSpecifiedSomaticDefinition = (term) => { return OTHER_SPECIFIED_SOMATIC_CRITERIA.definitions[term] || null; };
export const getUnspecifiedSomaticDefinition = (term) => { return UNSPECIFIED_SOMATIC_CRITERIA.definitions[term] || null; };
export const getIllnessAnxietyDefinition = (term) => { return ILLNESS_ANXIETY_CRITERIA.definitions[term] || null; };
export const getOtherSpecifiedAnxietyDefinition = (term) => { return OTHER_SPECIFIED_ANXIETY_CRITERIA.definitions[term] || null; };
export const getDepersonalizationDefinition = (term) => { return DEPERSONALIZATION_DEREALIZATION_CRITERIA.definitions[term] || null; };
export const getCyclothymicDefinition = (term) => { return CYCLOTHYMIC_CRITERIA.definitions[term] || null; };
export const getAnorexiaNervosaDefinition = (term) => { return ANOREXIA_NERVOSA_CRITERIA.definitions[term] || null; };
export const getBulimiaNervosaDefinition = (term) => { return BULIMIA_NERVOSA_CRITERIA.definitions[term] || null; };
export const getSchizophreniaDefinition = (term) => SCHIZOPHRENIA_CRITERIA.definitions[term] || null;
export const getSchizoaffectiveDisorderDefinition = (term) => SCHIZOAFFECTIVE_DISORDER_CRITERIA.definitions[term] || null;
export const getDelusionalDisorderDefinition = (term) => DELUSIONAL_DISORDER_CRITERIA.definitions[term] || null;
export const getPsychoticDisorderNOSDefinition = (term) => PSYCHOTIC_DISORDER_NOS_CRITERIA.definitions[term] || null;
export const getBriefPsychoticDisorderDefinition = (term) => BRIEF_PSYCHOTIC_DISORDER_CRITERIA.definitions[term] || null;
export const getBingeEatingDisorderDefinition = (term) => BINGE_EATING_DISORDER_CRITERIA.definitions[term] || null;
export const getDissociativeIdentityDisorderDefinition = (term) => DISSOCIATIVE_IDENTITY_DISORDER_CRITERIA.definitions[term] || null;
export const getDissociativeAmnesiaDefinition = (term) => DISSOCIATIVE_AMNESIA_CRITERIA.definitions[term] || null;
export const getAcuteStressDisorderDefinition = (term) => ACUTE_STRESS_DISORDER_CRITERIA.definitions[term] || null;
export const getAntisocialPersonalityDisorderDefinition = (term) => ANTISOCIAL_PERSONALITY_DISORDER_CRITERIA.definitions[term] || null;
export const getBorderlinePersonalityDisorderDefinition = (term) => BORDERLINE_PERSONALITY_DISORDER_CRITERIA.definitions[term] || null;
export const getNarcissisticPersonalityDisorderDefinition = (term) => NARCISSISTIC_PERSONALITY_DISORDER_CRITERIA.definitions[term] || null;
export const getAvoidantPersonalityDisorderDefinition = (term) => AVOIDANT_PERSONALITY_DISORDER_CRITERIA.definitions[term] || null;
export const getCardiomyopathyDefinition = (term) => CARDIOMYOPATHY_CRITERIA.definitions[term] || null;
export const getSVTDefinition = (term) => SVT_CRITERIA.definitions[term] || null;
export const getVentricularArrhythmiaDefinition = (term) => VENTRICULAR_ARRHYTHMIA_CRITERIA.definitions[term] || null;
export const getPericarditisDefinition = (term) => PERICARDITIS_CRITERIA.definitions[term] || null;
export const getPostPhlebiticDefinition = (term) => POST_PHLEBITIC_CRITERIA.definitions[term] || null;
export const getCirrhosisDefinition = (term) => CIRRHOSIS_CRITERIA.definitions[term] || null;
export const getGastritisDefinition = (term) => GASTRITIS_CRITERIA.definitions[term] || null;
export const getPancreatitisDefinition = (term) => PANCREATITIS_CRITERIA.definitions[term] || null;
export const getBiliaryTractDefinition = (term) => BILIARY_TRACT_CRITERIA.definitions[term] || null;
export const getBronchiectasisDefinition = (term) => BRONCHIECTASIS_CRITERIA.definitions[term] || null;
export const getPulmonaryFibrosisDefinition = (term) => PULMONARY_FIBROSIS_CRITERIA.definitions[term] || null;
export const getSarcoidosisDefinition = (term) => SARCOIDOSIS_CRITERIA.definitions[term] || null;
export const getMultipleSclerosisDefinition = (term) => MULTIPLE_SCLEROSIS_CRITERIA.definitions[term] || null;
export const getParkinsonsDefinition = (term) => PARKINSONS_DISEASE_CRITERIA.definitions[term] || null;
export const getMyastheniaGravisDefinition = (term) => MYASTHENIA_GRAVIS_CRITERIA.definitions[term] || null;
export const getNarcolepsyDefinition = (term) => NARCOLEPSY_CRITERIA.definitions[term] || null;
export const getALSDefinition = (term) => ALS_CRITERIA.definitions[term] || null;
export const getSyringomyeliaDefinition = (term) => SYRINGOMYELIA_CRITERIA.definitions[term] || null;
export const getMyelitisDefinition = (term) => MYELITIS_CRITERIA.definitions[term] || null;
export const getUpperRadicularGroupDefinition = (term) => UPPER_RADICULAR_GROUP_CRITERIA.definitions?.[term] || null;
export const getMiddleRadicularGroupDefinition = (term) => MIDDLE_RADICULAR_GROUP_CRITERIA.definitions?.[term] || null;
export const getLowerRadicularGroupDefinition = (term) => LOWER_RADICULAR_GROUP_CRITERIA.definitions?.[term] || null;
export const getAllRadicularGroupsDefinition = (term) => ALL_RADICULAR_GROUPS_CRITERIA.definitions?.[term] || null;
export const getRadialNerveDefinition = (term) => RADIAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getMedianNerveDefinition = (term) => MEDIAN_NERVE_CRITERIA.definitions?.[term] || null;
export const getUlnarNerveDefinition = (term) => ULNAR_NERVE_CRITERIA.definitions?.[term] || null;
export const getMusculocutaneousNerveDefinition = (term) => MUSCULOCUTANEOUS_NERVE_CRITERIA.definitions?.[term] || null;
export const getCircumflexNerveDefinition = (term) => CIRCUMFLEX_NERVE_CRITERIA.definitions?.[term] || null;
export const getLongThoracicNerveDefinition = (term) => LONG_THORACIC_NERVE_CRITERIA.definitions?.[term] || null;
export const getSciaticNerveDefinition = (term) => SCIATIC_NERVE_CRITERIA.definitions?.[term] || null;
export const getCommonPeronealNerveDefinition = (term) => COMMON_PERONEAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getSuperficialPeronealNerveDefinition = (term) => SUPERFICIAL_PERONEAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getDeepPeronealNerveDefinition = (term) => DEEP_PERONEAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getTibialNerveDefinition = (term) => TIBIAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getPosteriorTibialNerveDefinition = (term) => POSTERIOR_TIBIAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getFemoralNerveDefinition = (term) => FEMORAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getSaphenousNerveDefinition = (term) => SAPHENOUS_NERVE_CRITERIA.definitions?.[term] || null;
export const getObturatorNerveDefinition = (term) => OBTURATOR_NERVE_CRITERIA.definitions?.[term] || null;
export const getLateralFemoralCutaneousNerveDefinition = (term) => LATERAL_FEMORAL_CUTANEOUS_NERVE_CRITERIA.definitions?.[term] || null;
export const getIlioinguinalNerveDefinition = (term) => ILIOINGUINAL_NERVE_CRITERIA.definitions?.[term] || null;
export const getJacksonianEpilepsyDefinition = (term) => EPILEPSY_JACKSONIAN_CRITERIA.definitions[term] || null;
export const getDiencephalicEpilepsyDefinition = (term) => EPILEPSY_DIENCEPHALIC_CRITERIA.definitions[term] || null;
export const getPsychomotorEpilepsyDefinition = (term) => EPILEPSY_PSYCHOMOTOR_CRITERIA.definitions[term] || null;
export const getColdInjuryDefinition = (term) => COLD_INJURY_CRITERIA.definitions[term] || null;
export const getPADDefinition = (term) => PAD_CRITERIA.definitions[term] || null;
export const getHyperthyroidismDefinition = (term) => HYPERTHYROIDISM_CRITERIA.definitions[term] || null;
export const getThyroiditisDefinition = (term) => THYROIDITIS_CRITERIA.definitions[term] || null;
export const getHyperparathyroidismDefinition = (term) => HYPERPARATHYROIDISM_CRITERIA.definitions[term] || null;
export const getHypoparathyroidismDefinition = (term) => HYPOPARATHYROIDISM_CRITERIA.definitions[term] || null;
export const getAddisonsDiseaseDefinition = (term) => ADDISONS_DISEASE_CRITERIA.definitions[term] || null;
export const getCushingsSyndromeDefinition = (term) => CUSHINGS_SYNDROME_CRITERIA.definitions[term] || null;
export const getDiabetesInsipidusDefinition = (term) => DIABETES_INSIPIDUS_CRITERIA.definitions[term] || null;
export const getHyperaldosteronismDefinition = (term) => HYPERALDOSTERONISM_CRITERIA.definitions[term] || null;
export const getGoutDefinition = (term) => GOUT_CRITERIA.definitions[term] || null;
export const getBursitisDefinition = (term) => BURSITIS_CRITERIA.definitions[term] || null;
export const getTendinitisDefinition = (term) => TENDINITIS_CRITERIA.definitions[term] || null;
export const getMyositisDefinition = (term) => MYOSITIS_CRITERIA.definitions[term] || null;
export const getOsteomyelitisDefinition = (term) => OSTEOMYELITIS_CRITERIA.definitions[term] || null;
export const getMultiJointArthritisDefinition = (term) => MULTI_JOINT_ARTHRITIS_CRITERIA.definitions[term] || null;
export const getVertebralFractureDefinition = (term) => VERTEBRAL_FRACTURE_CRITERIA.definitions[term] || null;
export const getSacroiliacInjuryDefinition = (term) => SACROILIAC_INJURY_CRITERIA.definitions[term] || null;
export const getSpinalStenosisDefinition = (term) => SPINAL_STENOSIS_CRITERIA.definitions[term] || null;
export const getAnkylosingSpondylitisDefinition = (term) => ANKYLOSING_SPONDYLITIS_CRITERIA.definitions[term] || null;
export const getSpinalFusionDefinition = (term) => SPINAL_FUSION_CRITERIA.definitions[term] || null;
export const getWeakFootDefinition = (term) => WEAK_FOOT_CRITERIA.definitions[term] || null;
export const getClawFootDefinition = (term) => CLAW_FOOT_CRITERIA.definitions[term] || null;
export const getMetatarsalgiaDefinition = (term) => METATARSALGIA_CRITERIA.definitions[term] || null;
export const getHalluxValgusDefinition = (term) => HALLUX_VALGUS_CRITERIA.definitions[term] || null;
export const getHalluxRigidusDefinition = (term) => HALLUX_RIGIDUS_CRITERIA.definitions[term] || null;
export const getHerniaDefinition = (term) => HERNIA_CRITERIA.definitions[term] || null;
export const getPeritonealAdhesionsDefinition = (term) => PERITONEAL_ADHESIONS_CRITERIA.definitions[term] || null;
export const getEsophagealStrictureDefinition = (term) => ESOPHAGEAL_STRICTURE_CRITERIA.definitions[term] || null;
export const getPostgastrectomyDefinition = (term) => POSTGASTRECTOMY_CRITERIA.definitions[term] || null;
export const getIntestinalFistulaDefinition = (term) => INTESTINAL_FISTULA_CRITERIA.definitions[term] || null;
export const getAcneDefinition = (term) => ACNE_CRITERIA.definitions[term] || null;
export const getChloracneDefinition = (term) => CHLORACNE_CRITERIA.definitions[term] || null;
export const getAlopeciaAreataDefinition = (term) => ALOPECIA_AREATA_CRITERIA.definitions[term] || null;
export const getHyperhidrosisDefinition = (term) => HYPERHIDROSIS_CRITERIA.definitions[term] || null;
export const getDiscoidLupusDefinition = (term) => DISCOID_LUPUS_CRITERIA.definitions[term] || null;
export const getBullousDisordersDefinition = (term) => BULLOUS_DISORDERS_CRITERIA.definitions[term] || null;
export const getCutaneousVasculitisDefinition = (term) => CUTANEOUS_VASCULITIS_CRITERIA.definitions[term] || null;
export const getDermatophytosisDefinition = (term) => DERMATOPHYTOSIS_CRITERIA.definitions[term] || null;
export const getSkinInfectionsDefinition = (term) => SKIN_INFECTIONS_CRITERIA.definitions[term] || null;
export const getGeneralSkinFormulaDefinition = (term) => GENERAL_SKIN_FORMULA_CRITERIA.definitions[term] || null;
export const getGeneralEyeFormulaDefinition = (term) => GENERAL_EYE_FORMULA_CRITERIA.definitions[term] || null;
export const getUveitisDefinition = (term) => UVEITIS_CRITERIA.definitions[term] || null;
export const getKeratitisDefinition = (term) => KERATITIS_CRITERIA.definitions[term] || null;
export const getChronicConjunctivitisDefinition = (term) => CHRONIC_CONJUNCTIVITIS_CRITERIA.definitions[term] || null;
export const getScleritisDefinition = (term) => SCLERITIS_CRITERIA.definitions[term] || null;
export const getPeripheralVestibularDefinition = (term) => PERIPHERAL_VESTIBULAR_CRITERIA.definitions[term] || null;
export const getChronicSuppurativeOtitisMediaDefinition = (term) => CHRONIC_SUPPURATIVE_OTITIS_MEDIA_CRITERIA.definitions[term] || null;
export const getChronicOtitisExternaDefinition = (term) => CHRONIC_OTITIS_EXTERNA_CRITERIA.definitions[term] || null;
export const getChronicNonsuppurativeOtitisMediaDefinition = (term) => CHRONIC_NONSUPPURATIVE_OTITIS_MEDIA_CRITERIA.definitions[term] || null;


















